[0m11:40:13.420830 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83481650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff834794d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83481090>]}


============================== 11:40:13.423642 | 243f6e3e-858d-4f92-bdb5-e5831154888b ==============================
[0m11:40:13.423642 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:40:13.424024 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'no_print': 'None', 'version_check': 'True', 'static_parser': 'True', 'target_path': 'None', 'write_json': 'True', 'printer_width': '80', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '/opt/bluealpha/dbt_project', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'debug': 'False', 'empty': 'False', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_path': '/opt/bluealpha/dbt_project/logs', 'log_format': 'default', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'introspect': 'True'}
[0m11:40:13.425136 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'bluealpha_dbt'
[0m11:40:13.425658 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.024542542, "process_in_blocks": "0", "process_kernel_time": 0.078108, "process_mem_max_rss": "105660", "process_out_blocks": "1194", "process_user_time": 0.689955}
[0m11:40:13.425897 [debug] [MainThread]: Command `dbt run` failed at 11:40:13.425859 after 0.02 seconds
[0m11:40:13.426101 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83482bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83481650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83483110>]}
[0m11:40:13.426324 [debug] [MainThread]: Flushing usage events
[0m11:40:13.872120 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:41:57.368544 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f441250>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8acf6650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a873d50>]}


============================== 11:41:57.371498 | 89d295d5-4551-4d19-8f6e-e2f63f60fa53 ==============================
[0m11:41:57.371498 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:41:57.371873 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'target_path': 'None', 'fail_fast': 'False', 'debug': 'False', 'empty': 'False', 'static_parser': 'True', 'version_check': 'True', 'no_print': 'None', 'warn_error': 'None', 'log_format': 'default', 'partial_parse': 'True', 'printer_width': '80', 'introspect': 'True', 'log_cache_events': 'False', 'write_json': 'True', 'profiles_dir': '/opt/bluealpha/dbt_project', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_colors': 'True'}
[0m11:41:57.373286 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'bluealpha_dbt'
[0m11:41:57.373830 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.028317668, "process_in_blocks": "0", "process_kernel_time": 0.069045, "process_mem_max_rss": "105536", "process_out_blocks": "2", "process_user_time": 0.714472}
[0m11:41:57.374288 [debug] [MainThread]: Command `dbt run` failed at 11:41:57.374217 after 0.03 seconds
[0m11:41:57.374549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a883dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a880a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a80cad0>]}
[0m11:41:57.374779 [debug] [MainThread]: Flushing usage events
[0m11:41:57.765338 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:42:03.156949 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfcb410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf4699d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfcb110>]}


============================== 11:42:03.159686 | b7b9bf6b-3d91-4e1b-ba80-7625cb034b80 ==============================
[0m11:42:03.159686 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:42:03.160033 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'empty': 'False', 'warn_error': 'None', 'target_path': 'None', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'invocation_command': 'dbt run', 'quiet': 'False', 'write_json': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'partial_parse': 'True', 'no_print': 'None', 'fail_fast': 'False', 'introspect': 'True'}
[0m11:42:03.161198 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'bluealpha_dbt'
[0m11:42:03.161718 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.023583125, "process_in_blocks": "0", "process_kernel_time": 0.067006, "process_mem_max_rss": "105520", "process_out_blocks": "2", "process_user_time": 0.696063}
[0m11:42:03.161975 [debug] [MainThread]: Command `dbt run` failed at 11:42:03.161929 after 0.02 seconds
[0m11:42:03.162188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfca7d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadfcad10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae49ebd0>]}
[0m11:42:03.162421 [debug] [MainThread]: Flushing usage events
[0m11:42:03.515570 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:42:15.417711 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95420b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95460c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95460b50>]}


============================== 11:42:15.420345 | 8e23aee0-71cd-4505-bc20-4cac891a46fe ==============================
[0m11:42:15.420345 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:42:15.420688 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'empty': 'False', 'partial_parse': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'profiles_dir': '/opt/bluealpha/dbt_project', 'use_experimental_parser': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'cache_selected_only': 'False', 'write_json': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'printer_width': '80', 'introspect': 'True', 'fail_fast': 'False', 'no_print': 'None', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'version_check': 'True'}
[0m11:42:15.421907 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'bluealpha_dbt'
[0m11:42:15.422396 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.023252416, "process_in_blocks": "0", "process_kernel_time": 0.05617, "process_mem_max_rss": "105512", "process_out_blocks": "2", "process_user_time": 0.683071}
[0m11:42:15.422667 [debug] [MainThread]: Command `dbt run` failed at 11:42:15.422608 after 0.02 seconds
[0m11:42:15.422878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9548c990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9548fa90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95653a50>]}
[0m11:42:15.423088 [debug] [MainThread]: Flushing usage events
[0m11:42:15.768359 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:44:17.561050 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bc2a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c1e310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c1fc50>]}


============================== 11:44:17.564564 | aeb3d1be-ebe3-44de-8a81-46b85da362d4 ==============================
[0m11:44:17.564564 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:44:17.565008 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'use_colors': 'True', 'version_check': 'True', 'empty': 'False', 'no_print': 'None', 'target_path': 'None', 'warn_error': 'None', 'log_format': 'default', 'static_parser': 'True', 'use_experimental_parser': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'write_json': 'True', 'invocation_command': 'dbt run', 'introspect': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'profiles_dir': '/opt/bluealpha/dbt_project', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'fail_fast': 'False', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True'}
[0m11:44:17.567115 [error] [MainThread]: Encountered an error:
Runtime Error
  Could not find profile named 'bluealpha_dbt'
[0m11:44:17.567992 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.027948584, "process_in_blocks": "0", "process_kernel_time": 0.07996, "process_mem_max_rss": "105492", "process_out_blocks": "2", "process_user_time": 0.780617}
[0m11:44:17.568408 [debug] [MainThread]: Command `dbt run` failed at 11:44:17.568308 after 0.03 seconds
[0m11:44:17.568813 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bc29d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bc1050>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c00dd0>]}
[0m11:44:17.569194 [debug] [MainThread]: Flushing usage events
[0m11:44:18.652122 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:45:05.853307 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81088190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80f65510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80e45190>]}


============================== 11:45:05.856065 | 1a3192d7-55d2-46e3-afda-d4119d81fdb4 ==============================
[0m11:45:05.856065 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:45:05.856377 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'use_colors': 'True', 'indirect_selection': 'eager', 'log_cache_events': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'invocation_command': 'dbt run', 'version_check': 'True', 'target_path': 'None', 'partial_parse': 'True', 'log_format': 'default', 'use_experimental_parser': 'False', 'empty': 'False', 'write_json': 'True', 'static_parser': 'True', 'introspect': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'printer_width': '80', 'quiet': 'False', 'debug': 'False'}
[0m11:45:05.921995 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8044ec10>]}
[0m11:45:05.941741 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83885690>]}
[0m11:45:05.942110 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:45:05.966843 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:45:05.967467 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m11:45:05.967719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80373010>]}
[0m11:45:06.300181 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m11:45:06.300606 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80300d50>]}
[0m11:45:06.410039 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff24550>]}
[0m11:45:06.444083 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:45:06.445014 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:45:06.453488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e7a4e90>]}
[0m11:45:06.453755 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:45:06.453979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff00850>]}
[0m11:45:06.454919 [info ] [MainThread]: 
[0m11:45:06.455125 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:45:06.455331 [info ] [MainThread]: 
[0m11:45:06.455618 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:45:06.457274 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:45:06.457572 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:45:06.461484 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:45:06.471795 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:45:06.472035 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:45:06.472223 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:45:06.472466 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:45:06.472718 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:45:06.472945 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:45:06.473157 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:06.473368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:06.473591 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:45:06.478756 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m11:45:06.478948 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m11:45:06.479073 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.005 seconds
[0m11:45:06.479688 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:45:06.480221 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:45:06.480744 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:45:06.482025 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_marts)
[0m11:45:06.482243 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_staging)
[0m11:45:06.482432 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_intermediate)
[0m11:45:06.482677 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_marts"
"
[0m11:45:06.482952 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_staging"
"
[0m11:45:06.483220 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_intermediate"
"
[0m11:45:06.485399 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m11:45:06.486483 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m11:45:06.515217 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m11:45:06.515473 [debug] [ThreadPool]: On create_warehouse_staging_marts: BEGIN
[0m11:45:06.515701 [debug] [ThreadPool]: On create_warehouse_staging_staging: BEGIN
[0m11:45:06.515910 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: BEGIN
[0m11:45:06.516084 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.516287 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.516542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.520548 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:45:06.520755 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:45:06.520912 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:45:06.521103 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m11:45:06.521320 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m11:45:06.521529 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m11:45:06.521806 [debug] [ThreadPool]: On create_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_staging"} */
create schema if not exists "staging_staging"
[0m11:45:06.522096 [debug] [ThreadPool]: On create_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_marts"} */
create schema if not exists "staging_marts"
[0m11:45:06.522312 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_intermediate"} */
create schema if not exists "staging_intermediate"
[0m11:45:06.523942 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m11:45:06.524093 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m11:45:06.524230 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.002 seconds
[0m11:45:06.524705 [debug] [ThreadPool]: On create_warehouse_staging_staging: COMMIT
[0m11:45:06.525140 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: COMMIT
[0m11:45:06.525575 [debug] [ThreadPool]: On create_warehouse_staging_marts: COMMIT
[0m11:45:06.525802 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m11:45:06.526010 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m11:45:06.526210 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m11:45:06.526410 [debug] [ThreadPool]: On create_warehouse_staging_staging: COMMIT
[0m11:45:06.526622 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: COMMIT
[0m11:45:06.526818 [debug] [ThreadPool]: On create_warehouse_staging_marts: COMMIT
[0m11:45:06.527364 [debug] [ThreadPool]: SQL status: COMMIT in 0.000 seconds
[0m11:45:06.527554 [debug] [ThreadPool]: On create_warehouse_staging_staging: Close
[0m11:45:06.527692 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m11:45:06.527817 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m11:45:06.528195 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: Close
[0m11:45:06.528401 [debug] [ThreadPool]: On create_warehouse_staging_marts: Close
[0m11:45:06.529421 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_marts, now list_warehouse_staging_marts)
[0m11:45:06.529739 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_intermediate, now list_warehouse_staging_staging)
[0m11:45:06.532082 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:45:06.532245 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_staging, now list_warehouse_staging_intermediate)
[0m11:45:06.533132 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:45:06.533321 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:45:06.534138 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:45:06.534334 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:45:06.534486 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.534669 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:45:06.534840 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.535127 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:45:06.538558 [debug] [ThreadPool]: SQL status: BEGIN in 0.003 seconds
[0m11:45:06.538758 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:45:06.538933 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:45:06.539115 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:45:06.539367 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:45:06.539581 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:45:06.539780 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:45:06.539999 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:45:06.540212 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:45:06.544343 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m11:45:06.544554 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m11:45:06.544698 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m11:45:06.545274 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:45:06.545758 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:45:06.546285 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:45:06.546566 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:45:06.546756 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:45:06.546931 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:45:06.549568 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.549776 [debug] [MainThread]: On master: BEGIN
[0m11:45:06.549925 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:45:06.552784 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:45:06.552990 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.553172 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:45:06.562764 [debug] [MainThread]: SQL status: SELECT 0 in 0.009 seconds
[0m11:45:06.563264 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e43ad90>]}
[0m11:45:06.563483 [debug] [MainThread]: On master: ROLLBACK
[0m11:45:06.563700 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.563904 [debug] [MainThread]: On master: BEGIN
[0m11:45:06.564172 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:45:06.564370 [debug] [MainThread]: On master: COMMIT
[0m11:45:06.564580 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.564765 [debug] [MainThread]: On master: COMMIT
[0m11:45:06.564971 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:45:06.565141 [debug] [MainThread]: On master: Close
[0m11:45:06.567223 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:45:06.567417 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:45:06.567611 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:45:06.567898 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:45:06.568205 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:45:06.568520 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:45:06.568788 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:45:06.569040 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:45:06.569301 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:45:06.569555 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:45:06.569844 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:45:06.570092 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:45:06.572858 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:45:06.573978 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:45:06.575015 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:45:06.576649 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:45:06.588757 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:45:06.588943 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:45:06.590329 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:45:06.591736 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:45:06.593019 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:45:06.594558 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:45:06.594828 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:45:06.595033 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:45:06.595221 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:45:06.595362 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:45:06.595561 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:45:06.595765 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:45:06.596099 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:45:06.596327 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:45:06.599678 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m11:45:06.599876 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m11:45:06.600031 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:45:06.600240 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:45:06.600483 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:45:06.600701 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:45:06.600923 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_number) as rn
    from src
),
clean as (
    select
        row_number,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean;
  );
[0m11:45:06.601185 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean;
  );
[0m11:45:06.601423 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean;
  );
[0m11:45:06.601973 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 59: from clean;
                   ^

[0m11:45:06.602217 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 48: from clean;
                   ^

[0m11:45:06.602474 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:45:06.602674 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 40: from clean;
                   ^

[0m11:45:06.602868 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:45:06.603166 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:45:06.603316 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:45:06.603610 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:45:06.605260 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:45:06.605743 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:45:06.606901 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:45:06.607826 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7fea3550>]}
[0m11:45:06.609040 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:45:06.609264 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e6eb090>]}
[0m11:45:06.609651 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:45:06.609968 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1a3192d7-55d2-46e3-afda-d4119d81fdb4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ff41c10>]}
[0m11:45:06.610289 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:45:06.610586 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:45:06.610914 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:45:06.611221 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:45:06.611520 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:45:06.611804 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:45:06.612421 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:45:06.612702 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:45:06.613043 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:45:06.613291 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:45:06.613694 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:45:06.613916 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:45:06.614155 [info ] [Thread-2 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:45:06.614577 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:45:06.615021 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:45:06.615239 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:45:06.615484 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:45:06.616257 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.616463 [debug] [MainThread]: On master: BEGIN
[0m11:45:06.616682 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:45:06.619724 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:45:06.619955 [debug] [MainThread]: On master: COMMIT
[0m11:45:06.620146 [debug] [MainThread]: Using postgres connection "master"
[0m11:45:06.620332 [debug] [MainThread]: On master: COMMIT
[0m11:45:06.620591 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:45:06.620801 [debug] [MainThread]: On master: Close
[0m11:45:06.621034 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:45:06.621206 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:45:06.621375 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:45:06.621540 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:45:06.621780 [info ] [MainThread]: 
[0m11:45:06.621979 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.17 seconds (0.17s).
[0m11:45:06.622380 [debug] [MainThread]: Command end result
[0m11:45:06.634995 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:45:06.635804 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:45:06.638110 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:45:06.638270 [info ] [MainThread]: 
[0m11:45:06.638466 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:45:06.638618 [info ] [MainThread]: 
[0m11:45:06.638817 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:45:06.639004 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:45:06.639157 [info ] [MainThread]: 
[0m11:45:06.639315 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:45:06.639484 [info ] [MainThread]: 
[0m11:45:06.639675 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:45:06.639863 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:45:06.640018 [info ] [MainThread]: 
[0m11:45:06.640180 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:45:06.640325 [info ] [MainThread]: 
[0m11:45:06.640491 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:45:06.640655 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:45:06.640790 [info ] [MainThread]: 
[0m11:45:06.640939 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:45:06.641073 [info ] [MainThread]: 
[0m11:45:06.641244 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:45:06.641533 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:45:06.642011 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.8079966, "process_in_blocks": "0", "process_kernel_time": 0.109294, "process_mem_max_rss": "134132", "process_out_blocks": "3070", "process_user_time": 1.375708}
[0m11:45:06.642241 [debug] [MainThread]: Command `dbt run` failed at 11:45:06.642207 after 0.81 seconds
[0m11:45:06.642410 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80034310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80053c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80051550>]}
[0m11:45:06.642611 [debug] [MainThread]: Flushing usage events
[0m11:45:06.993477 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:46:45.307436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff986d0bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff986c7610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff986d0c10>]}


============================== 11:46:45.310139 | e800d36c-6d74-4967-885a-6da1020c465d ==============================
[0m11:46:45.310139 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:46:45.310611 [debug] [MainThread]: running dbt with arguments {'log_path': '/opt/bluealpha/dbt_project/logs', 'profiles_dir': '/opt/bluealpha/dbt_project', 'log_cache_events': 'False', 'no_print': 'None', 'cache_selected_only': 'False', 'use_colors': 'True', 'debug': 'False', 'invocation_command': 'dbt run', 'printer_width': '80', 'warn_error': 'None', 'version_check': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'quiet': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'write_json': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False'}
[0m11:46:45.370191 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97a88150>]}
[0m11:46:45.389527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b134e90>]}
[0m11:46:45.389883 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:46:45.414806 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:46:45.459441 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:46:45.459715 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:46:45.459889 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:46:45.476490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff977932d0>]}
[0m11:46:45.510249 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:46:45.511138 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:46:45.519087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97aa1550>]}
[0m11:46:45.519364 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:46:45.519616 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff976ef410>]}
[0m11:46:45.520526 [info ] [MainThread]: 
[0m11:46:45.520774 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:46:45.521008 [info ] [MainThread]: 
[0m11:46:45.521409 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:46:45.523080 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:46:45.523356 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:46:45.523640 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:46:45.561691 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:46:45.561886 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:46:45.562046 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:46:45.562257 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:46:45.562470 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:46:45.562654 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:46:45.562853 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:46:45.563066 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:46:45.563241 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:46:45.568283 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:46:45.568455 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:46:45.568599 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:46:45.569137 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:46:45.569682 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:46:45.570264 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:46:45.572132 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:46:45.572373 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:46:45.574706 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:46:45.574880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:46:45.575706 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:46:45.575906 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:46:45.576694 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:46:45.576908 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:46:45.577096 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:46:45.577305 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:46:45.577494 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:46:45.577817 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:46:45.581438 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:46:45.581665 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:46:45.581823 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:46:45.581995 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:46:45.582248 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:46:45.582460 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:46:45.582644 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:46:45.582882 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:46:45.583132 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:46:45.585739 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:46:45.585900 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:46:45.586048 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:46:45.586643 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:46:45.587108 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:46:45.587581 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:46:45.587845 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:46:45.588056 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:46:45.588257 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:46:45.591045 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.591297 [debug] [MainThread]: On master: BEGIN
[0m11:46:45.591486 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:46:45.594834 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:46:45.595111 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.595323 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:46:45.603786 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:46:45.604350 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff977b0910>]}
[0m11:46:45.604611 [debug] [MainThread]: On master: ROLLBACK
[0m11:46:45.604884 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.605062 [debug] [MainThread]: On master: BEGIN
[0m11:46:45.605354 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:46:45.605617 [debug] [MainThread]: On master: COMMIT
[0m11:46:45.605811 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.605976 [debug] [MainThread]: On master: COMMIT
[0m11:46:45.606257 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:46:45.606448 [debug] [MainThread]: On master: Close
[0m11:46:45.608882 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:46:45.609177 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:46:45.609389 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:46:45.609694 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:46:45.609970 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:46:45.610310 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:46:45.610663 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:46:45.610936 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:46:45.611180 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:46:45.611387 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:46:45.611589 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:46:45.611794 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:46:45.614796 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:46:45.615951 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:46:45.617121 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:46:45.618104 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:46:45.618295 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:46:45.618455 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:46:45.632152 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:46:45.633650 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:46:45.635052 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:46:45.635946 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:46:45.636428 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:46:45.636299 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:46:45.636678 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:46:45.636860 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:46:45.637077 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:46:45.637300 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:46:45.637650 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:46:45.637894 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:46:45.641101 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m11:46:45.641287 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m11:46:45.641447 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m11:46:45.641638 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:46:45.641844 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:46:45.642073 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:46:45.642285 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean;
  );
[0m11:46:45.642535 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_number) as rn
    from src
),
clean as (
    select
        row_number,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean;
  );
[0m11:46:45.642801 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean;
  );
[0m11:46:45.643163 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 40: from clean;
                   ^

[0m11:46:45.643394 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 59: from clean;
                   ^

[0m11:46:45.643646 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:46:45.643834 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 48: from clean;
                   ^

[0m11:46:45.644023 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:46:45.644340 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:46:45.644484 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:46:45.644777 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:46:45.646308 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:46:45.646625 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:46:45.647639 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:46:45.648616 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff977091d0>]}
[0m11:46:45.649724 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:46:45.649953 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95bf0910>]}
[0m11:46:45.650379 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:46:45.650745 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e800d36c-6d74-4967-885a-6da1020c465d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95b97cd0>]}
[0m11:46:45.651075 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:46:45.651431 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:46:45.651752 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:46:45.652183 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:46:45.652487 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:46:45.652796 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:46:45.653409 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:46:45.653756 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:46:45.653985 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:46:45.654288 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:46:45.654493 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:46:45.654820 [info ] [Thread-1 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:46:45.655097 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:46:45.655337 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:46:45.655864 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:46:45.656051 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:46:45.656267 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:46:45.656889 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.657070 [debug] [MainThread]: On master: BEGIN
[0m11:46:45.657226 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:46:45.660071 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:46:45.660280 [debug] [MainThread]: On master: COMMIT
[0m11:46:45.660434 [debug] [MainThread]: Using postgres connection "master"
[0m11:46:45.660572 [debug] [MainThread]: On master: COMMIT
[0m11:46:45.660781 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:46:45.660954 [debug] [MainThread]: On master: Close
[0m11:46:45.661160 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:46:45.661390 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:46:45.661636 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:46:45.661827 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:46:45.662055 [info ] [MainThread]: 
[0m11:46:45.662261 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.14 seconds (0.14s).
[0m11:46:45.662726 [debug] [MainThread]: Command end result
[0m11:46:45.675370 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:46:45.676248 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:46:45.678782 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:46:45.678934 [info ] [MainThread]: 
[0m11:46:45.679152 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:46:45.679415 [info ] [MainThread]: 
[0m11:46:45.679649 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:46:45.679883 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:46:45.680083 [info ] [MainThread]: 
[0m11:46:45.680358 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:46:45.680556 [info ] [MainThread]: 
[0m11:46:45.680767 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:46:45.680983 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:46:45.681170 [info ] [MainThread]: 
[0m11:46:45.681367 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:46:45.681553 [info ] [MainThread]: 
[0m11:46:45.681792 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:46:45.682009 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:46:45.682209 [info ] [MainThread]: 
[0m11:46:45.682465 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:46:45.682670 [info ] [MainThread]: 
[0m11:46:45.682866 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:46:45.683353 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.39588043, "process_in_blocks": "0", "process_kernel_time": 0.081437, "process_mem_max_rss": "128112", "process_out_blocks": "2107", "process_user_time": 1.005399}
[0m11:46:45.683578 [debug] [MainThread]: Command `dbt run` failed at 11:46:45.683542 after 0.40 seconds
[0m11:46:45.683756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d2e3450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d2e3310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95b90fd0>]}
[0m11:46:45.683948 [debug] [MainThread]: Flushing usage events
[0m11:46:46.099590 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:47:08.346231 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a9437d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a942d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a941850>]}


============================== 11:47:08.348889 | 8228eec6-15d7-4894-9f37-c1569260c472 ==============================
[0m11:47:08.348889 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:47:08.349195 [debug] [MainThread]: running dbt with arguments {'write_json': 'True', 'empty': 'False', 'indirect_selection': 'eager', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'printer_width': '80', 'introspect': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'profiles_dir': '/opt/bluealpha/dbt_project', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'log_format': 'default', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'static_parser': 'True', 'quiet': 'False'}
[0m11:47:08.408180 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d412710>]}
[0m11:47:08.427756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3c2a50>]}
[0m11:47:08.428104 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:47:08.452402 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:47:08.496985 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:47:08.497227 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:47:08.497418 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:47:08.513258 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a8f63d0>]}
[0m11:47:08.546030 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:47:08.546827 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:47:08.554639 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a943090>]}
[0m11:47:08.554946 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:47:08.555164 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79a51310>]}
[0m11:47:08.555996 [info ] [MainThread]: 
[0m11:47:08.556185 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:47:08.556330 [info ] [MainThread]: 
[0m11:47:08.556570 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:47:08.558202 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:47:08.558489 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:47:08.562823 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:47:08.594849 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:47:08.595041 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:47:08.595198 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:47:08.595412 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:47:08.595651 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:47:08.595861 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:47:08.596071 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:47:08.596306 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:47:08.596509 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:47:08.601696 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:47:08.601871 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:47:08.602015 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:47:08.602582 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:47:08.603137 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:47:08.603633 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:47:08.605378 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:47:08.605648 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:47:08.605937 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:47:08.608158 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:47:08.609010 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:47:08.609815 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:47:08.610007 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:47:08.610222 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:47:08.610436 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:47:08.610609 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:47:08.610832 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:47:08.611032 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:47:08.614708 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:47:08.614977 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:47:08.615155 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:47:08.615390 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:47:08.615606 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:47:08.615810 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:47:08.616175 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:47:08.616428 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:47:08.616694 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:47:08.618571 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:47:08.618874 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:47:08.619402 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:47:08.619559 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:47:08.620132 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:47:08.620402 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:47:08.620781 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:47:08.621059 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:47:08.621452 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:47:08.623642 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.623935 [debug] [MainThread]: On master: BEGIN
[0m11:47:08.624149 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:47:08.627252 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:47:08.627496 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.627698 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:47:08.636228 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:47:08.636820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff79e00a10>]}
[0m11:47:08.637073 [debug] [MainThread]: On master: ROLLBACK
[0m11:47:08.637300 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.637450 [debug] [MainThread]: On master: BEGIN
[0m11:47:08.637678 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:47:08.637829 [debug] [MainThread]: On master: COMMIT
[0m11:47:08.638014 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.638154 [debug] [MainThread]: On master: COMMIT
[0m11:47:08.638367 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:47:08.638559 [debug] [MainThread]: On master: Close
[0m11:47:08.640740 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:47:08.640955 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:47:08.641167 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:47:08.641489 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:47:08.641813 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:47:08.642073 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:47:08.642357 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:47:08.642596 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:47:08.642825 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:47:08.643066 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:47:08.643284 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:47:08.643476 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:47:08.646541 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:47:08.647642 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:47:08.648705 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:47:08.649560 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:47:08.661798 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:47:08.661981 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:47:08.663280 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:47:08.664601 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:47:08.665984 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:47:08.666616 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:47:08.666839 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:47:08.667080 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:47:08.667316 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:47:08.667510 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:47:08.667727 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:47:08.667942 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:47:08.668132 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:47:08.668449 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:47:08.672052 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m11:47:08.672254 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:47:08.672427 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m11:47:08.672621 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:47:08.672837 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:47:08.673060 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:47:08.673281 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_number) as rn
    from src
),
clean as (
    select
        row_number,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean;
  );
[0m11:47:08.673527 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean;
  );
[0m11:47:08.673782 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean;
  );
[0m11:47:08.674191 [debug] [Thread-1 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 59: from clean;
                   ^

[0m11:47:08.674397 [debug] [Thread-3 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 40: from clean;
                   ^

[0m11:47:08.674622 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:47:08.674819 [debug] [Thread-2 (]: Postgres adapter: Postgres error: syntax error at or near ";"
LINE 48: from clean;
                   ^

[0m11:47:08.675004 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:47:08.675315 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:47:08.675471 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:47:08.675796 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:47:08.677376 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:47:08.677702 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:47:08.678754 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:47:08.679549 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff785d3890>]}
[0m11:47:08.680605 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:47:08.680829 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7865a150>]}
[0m11:47:08.681199 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:47:08.681508 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8228eec6-15d7-4894-9f37-c1569260c472', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7867a8d0>]}
[0m11:47:08.681839 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:47:08.682786 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:47:08.682434 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:47:08.682094 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:47:08.683087 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:47:08.683370 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:47:08.684014 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:47:08.684419 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:47:08.684680 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:47:08.685005 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:47:08.685228 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:47:08.685502 [info ] [Thread-1 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:47:08.685785 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:47:08.686001 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:47:08.686523 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:47:08.686721 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:47:08.686929 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:47:08.687645 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.687900 [debug] [MainThread]: On master: BEGIN
[0m11:47:08.688084 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:47:08.691130 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:47:08.691421 [debug] [MainThread]: On master: COMMIT
[0m11:47:08.691625 [debug] [MainThread]: Using postgres connection "master"
[0m11:47:08.691801 [debug] [MainThread]: On master: COMMIT
[0m11:47:08.692069 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:47:08.692287 [debug] [MainThread]: On master: Close
[0m11:47:08.692578 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:47:08.692763 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:47:08.692948 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:47:08.693126 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:47:08.693364 [info ] [MainThread]: 
[0m11:47:08.693565 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.14 seconds (0.14s).
[0m11:47:08.694018 [debug] [MainThread]: Command end result
[0m11:47:08.705732 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:47:08.706515 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:47:08.708909 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:47:08.709087 [info ] [MainThread]: 
[0m11:47:08.709377 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:47:08.709719 [info ] [MainThread]: 
[0m11:47:08.710011 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:47:08.710202 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  syntax error at or near ";"
  LINE 40: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:47:08.710358 [info ] [MainThread]: 
[0m11:47:08.710528 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:47:08.710693 [info ] [MainThread]: 
[0m11:47:08.710866 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:47:08.711045 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  syntax error at or near ";"
  LINE 59: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:47:08.711209 [info ] [MainThread]: 
[0m11:47:08.711392 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:47:08.711537 [info ] [MainThread]: 
[0m11:47:08.711712 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:47:08.711922 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  syntax error at or near ";"
  LINE 48: from clean;
                     ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:47:08.712060 [info ] [MainThread]: 
[0m11:47:08.712206 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:47:08.712359 [info ] [MainThread]: 
[0m11:47:08.712528 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:47:08.713005 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.3866094, "process_in_blocks": "0", "process_kernel_time": 0.076652, "process_mem_max_rss": "127796", "process_out_blocks": "2107", "process_user_time": 0.977324}
[0m11:47:08.713238 [debug] [MainThread]: Command `dbt run` failed at 11:47:08.713203 after 0.39 seconds
[0m11:47:08.713412 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a921090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d3b0b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ab137d0>]}
[0m11:47:08.713578 [debug] [MainThread]: Flushing usage events
[0m11:47:09.074202 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:48:08.028952 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa826d590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84a3bd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84a3e90>]}


============================== 11:48:08.031847 | a2adf52e-0a51-4e0d-9b76-51babae02e2e ==============================
[0m11:48:08.031847 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:48:08.032263 [debug] [MainThread]: running dbt with arguments {'log_format': 'default', 'version_check': 'True', 'use_experimental_parser': 'False', 'no_print': 'None', 'log_cache_events': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'cache_selected_only': 'False', 'target_path': 'None', 'introspect': 'True', 'empty': 'False', 'write_json': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'use_colors': 'True', 'warn_error': 'None', 'printer_width': '80', 'invocation_command': 'dbt run', 'partial_parse': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'static_parser': 'True', 'profiles_dir': '/opt/bluealpha/dbt_project', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m11:48:08.099036 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa785e310>]}
[0m11:48:08.119313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaca7290>]}
[0m11:48:08.119845 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:48:08.145018 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:48:08.192194 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m11:48:08.192561 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_google_ads_daily.sql
[0m11:48:08.192818 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_facebook_ads_daily.sql
[0m11:48:08.193091 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m11:48:08.301609 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m11:48:08.302046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa73d1d50>]}
[0m11:48:08.362432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8550250>]}
[0m11:48:08.395571 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:48:08.396528 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:48:08.405119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa773fa10>]}
[0m11:48:08.405370 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:48:08.405587 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7349e10>]}
[0m11:48:08.406485 [info ] [MainThread]: 
[0m11:48:08.406720 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:48:08.406970 [info ] [MainThread]: 
[0m11:48:08.407295 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:48:08.408964 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:48:08.409240 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:48:08.413077 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:48:08.423789 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:48:08.424039 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:48:08.424245 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:48:08.424510 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:48:08.424742 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:48:08.424970 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:48:08.425195 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:48:08.425421 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:48:08.425649 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:48:08.430918 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:48:08.431104 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:48:08.431242 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:48:08.431936 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:48:08.432500 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:48:08.433029 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:48:08.434395 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:48:08.434670 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:48:08.434918 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:48:08.437253 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:48:08.438121 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:48:08.438972 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:48:08.439198 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:48:08.439435 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:48:08.439674 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:48:08.439863 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:48:08.440073 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:48:08.440291 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:48:08.444455 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:48:08.444655 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:48:08.444831 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:48:08.445004 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:48:08.445219 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:48:08.445445 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:48:08.445656 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:48:08.445879 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:48:08.446113 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:48:08.449009 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:48:08.449171 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:48:08.449308 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:48:08.449918 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:48:08.450405 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:48:08.450908 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:48:08.451247 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:48:08.451471 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:48:08.451691 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:48:08.454757 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.454955 [debug] [MainThread]: On master: BEGIN
[0m11:48:08.455104 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:48:08.458349 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:48:08.458712 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.458957 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:48:08.467697 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:48:08.468314 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5a39490>]}
[0m11:48:08.468564 [debug] [MainThread]: On master: ROLLBACK
[0m11:48:08.468910 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.469098 [debug] [MainThread]: On master: BEGIN
[0m11:48:08.469363 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:48:08.469590 [debug] [MainThread]: On master: COMMIT
[0m11:48:08.469769 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.469916 [debug] [MainThread]: On master: COMMIT
[0m11:48:08.470094 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:48:08.470238 [debug] [MainThread]: On master: Close
[0m11:48:08.472295 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:48:08.472475 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:48:08.472658 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:48:08.472963 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:48:08.473302 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:48:08.473656 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:48:08.473986 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:48:08.474256 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:48:08.474533 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:48:08.474776 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:48:08.475020 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:48:08.475230 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:48:08.478549 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:48:08.479689 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:48:08.480742 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:48:08.481393 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:48:08.481647 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:48:08.494150 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:48:08.494446 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:48:08.495784 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:48:08.497276 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:48:08.497653 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:48:08.498079 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:48:08.498295 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:48:08.498544 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:48:08.498724 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:48:08.498989 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:48:08.499200 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:48:08.499402 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:48:08.499811 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:48:08.503356 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m11:48:08.503721 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:48:08.503936 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:48:08.504128 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m11:48:08.504374 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:48:08.504586 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_number) as rn
    from src
),
clean as (
    select
        row_number,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean
  );
[0m11:48:08.505014 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:48:08.505257 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean
  );
[0m11:48:08.505743 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean
  );
[0m11:48:08.506743 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                              ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:48:08.507494 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15:         row_number,
                 ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:48:08.507782 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15:         row_number,
                 ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:48:08.507964 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:48:08.508209 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:48:08.508450 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:48:08.508809 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:48:08.509070 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:48:08.509319 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:48:08.511077 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:48:08.512281 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:48:08.513366 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:48:08.514254 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9faf6cd0>]}
[0m11:48:08.514557 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d9c4b10>]}
[0m11:48:08.514849 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a2adf52e-0a51-4e0d-9b76-51babae02e2e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7246fd0>]}
[0m11:48:08.515261 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:48:08.515655 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:48:08.516028 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:48:08.516349 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:48:08.516643 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:48:08.516906 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:48:08.517186 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:48:08.517909 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:48:08.518154 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:48:08.518409 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:48:08.518656 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:48:08.519064 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:48:08.519296 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:48:08.519548 [info ] [Thread-3 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:48:08.519946 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:48:08.520445 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:48:08.520666 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:48:08.520916 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:48:08.521599 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.521809 [debug] [MainThread]: On master: BEGIN
[0m11:48:08.521986 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:48:08.525243 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:48:08.525477 [debug] [MainThread]: On master: COMMIT
[0m11:48:08.525670 [debug] [MainThread]: Using postgres connection "master"
[0m11:48:08.525847 [debug] [MainThread]: On master: COMMIT
[0m11:48:08.526092 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:48:08.526281 [debug] [MainThread]: On master: Close
[0m11:48:08.526503 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:48:08.526672 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:48:08.526847 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:48:08.527004 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:48:08.527272 [info ] [MainThread]: 
[0m11:48:08.527552 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m11:48:08.528110 [debug] [MainThread]: Command end result
[0m11:48:08.540368 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:48:08.541232 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:48:08.543628 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:48:08.543826 [info ] [MainThread]: 
[0m11:48:08.544054 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:48:08.544293 [info ] [MainThread]: 
[0m11:48:08.544563 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:48:08.544809 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:48:08.545032 [info ] [MainThread]: 
[0m11:48:08.545247 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:48:08.545425 [info ] [MainThread]: 
[0m11:48:08.545610 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:48:08.545829 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:48:08.546020 [info ] [MainThread]: 
[0m11:48:08.546228 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:48:08.546412 [info ] [MainThread]: 
[0m11:48:08.546640 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:48:08.546871 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:48:08.547096 [info ] [MainThread]: 
[0m11:48:08.547321 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:48:08.547545 [info ] [MainThread]: 
[0m11:48:08.547814 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:48:08.548163 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:48:08.548715 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.53983057, "process_in_blocks": "0", "process_kernel_time": 0.140178, "process_mem_max_rss": "132224", "process_out_blocks": "3070", "process_user_time": 1.144456}
[0m11:48:08.548961 [debug] [MainThread]: Command `dbt run` failed at 11:48:08.548920 after 0.54 seconds
[0m11:48:08.549200 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84a3a10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84a3b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84a3890>]}
[0m11:48:08.549387 [debug] [MainThread]: Flushing usage events
[0m11:48:08.963796 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:49:10.686223 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92931910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92931550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92930c10>]}


============================== 11:49:10.688785 | d43b42ac-66f7-4aad-ac66-f4d6d4de4a97 ==============================
[0m11:49:10.688785 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:49:10.689091 [debug] [MainThread]: running dbt with arguments {'log_path': '/opt/bluealpha/dbt_project/logs', 'profiles_dir': '/opt/bluealpha/dbt_project', 'log_format': 'default', 'quiet': 'False', 'introspect': 'True', 'use_colors': 'True', 'version_check': 'True', 'write_json': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run', 'printer_width': '80', 'warn_error': 'None', 'empty': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'send_anonymous_usage_stats': 'True', 'log_cache_events': 'False', 'debug': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'static_parser': 'True', 'target_path': 'None'}
[0m11:49:10.748699 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91dea1d0>]}
[0m11:49:10.768253 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95361510>]}
[0m11:49:10.768631 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:49:10.792790 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:49:10.839184 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m11:49:10.839471 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m11:49:10.839663 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m11:49:10.857013 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff929d4450>]}
[0m11:49:10.890603 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:49:10.891419 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:49:10.899320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91848210>]}
[0m11:49:10.899590 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:49:10.899780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91aa0490>]}
[0m11:49:10.900690 [info ] [MainThread]: 
[0m11:49:10.900885 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:49:10.901039 [info ] [MainThread]: 
[0m11:49:10.901301 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:49:10.902922 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:49:10.903201 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:49:10.907505 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:49:10.940434 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:49:10.940618 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:49:10.940756 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:49:10.940961 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:49:10.941176 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:49:10.941399 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:49:10.941622 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:49:10.941821 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:49:10.942022 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:49:10.947081 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:49:10.947254 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.005 seconds
[0m11:49:10.947397 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:49:10.947901 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:49:10.948464 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:49:10.948958 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:49:10.950576 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:49:10.950831 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:49:10.951081 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:49:10.953252 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:49:10.954099 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:49:10.954911 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:49:10.955103 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:49:10.955324 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:49:10.955532 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:49:10.955705 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:49:10.955943 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:49:10.956151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:49:10.960100 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:49:10.960336 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:49:10.960572 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:49:10.960720 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:49:10.960927 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:49:10.961145 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:49:10.961335 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:49:10.961583 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:49:10.961802 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:49:10.964374 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:49:10.964544 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:49:10.964684 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:49:10.965241 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:49:10.965687 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:49:10.966167 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:49:10.966438 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:49:10.966637 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:49:10.966827 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:49:10.969666 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:10.969948 [debug] [MainThread]: On master: BEGIN
[0m11:49:10.970178 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:49:10.973154 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:49:10.973385 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:10.973647 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:49:10.982028 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:49:10.982605 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91d93d50>]}
[0m11:49:10.982857 [debug] [MainThread]: On master: ROLLBACK
[0m11:49:10.983096 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:10.983264 [debug] [MainThread]: On master: BEGIN
[0m11:49:10.983532 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:49:10.983818 [debug] [MainThread]: On master: COMMIT
[0m11:49:10.983987 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:10.984135 [debug] [MainThread]: On master: COMMIT
[0m11:49:10.984350 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:49:10.984518 [debug] [MainThread]: On master: Close
[0m11:49:10.986602 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:49:10.986781 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:49:10.986952 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:49:10.987254 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:49:10.987583 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:49:10.987875 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:49:10.988215 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:49:10.988453 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:49:10.988683 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:49:10.988909 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:49:10.989131 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:49:10.989449 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:49:10.992481 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:49:10.993574 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:49:10.994627 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:49:10.995393 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:49:10.995682 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:49:11.008799 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:49:11.009056 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:49:11.010375 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:49:11.011786 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:49:11.012171 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:49:11.012565 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:49:11.012777 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:49:11.013008 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:49:11.013182 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:49:11.013741 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:49:11.013574 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:49:11.013385 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:49:11.013895 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:49:11.017474 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m11:49:11.017674 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:49:11.017849 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m11:49:11.018458 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:49:11.018264 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:49:11.018043 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:49:11.018640 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean
  );
[0m11:49:11.018865 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_number,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean
  );
[0m11:49:11.019063 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_number) as rn
    from src
),
clean as (
    select
        row_number,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean
  );
[0m11:49:11.019569 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15:         row_number,
                 ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:49:11.019784 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                              ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:49:11.019983 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "row_number" does not exist
LINE 15:         row_number,
                 ^
HINT:  Perhaps you meant to reference the column "src.row_num".

[0m11:49:11.020197 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:49:11.020444 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:49:11.020689 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:49:11.021001 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:49:11.021257 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:49:11.021488 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:49:11.023088 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:49:11.024166 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:49:11.025317 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:49:11.026108 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91852050>]}
[0m11:49:11.026367 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83fef250>]}
[0m11:49:11.026631 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd43b42ac-66f7-4aad-ac66-f4d6d4de4a97', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91aa0250>]}
[0m11:49:11.026976 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:49:11.027322 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:49:11.027630 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:49:11.027907 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:49:11.028206 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:49:11.028509 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:49:11.028785 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:49:11.029479 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:49:11.029732 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:49:11.029970 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:49:11.030351 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:49:11.030595 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:49:11.030828 [info ] [Thread-1 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:49:11.031071 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:49:11.031307 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:49:11.031866 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:49:11.032062 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:49:11.032254 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:49:11.032998 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:11.033193 [debug] [MainThread]: On master: BEGIN
[0m11:49:11.033352 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:49:11.036429 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:49:11.036709 [debug] [MainThread]: On master: COMMIT
[0m11:49:11.036895 [debug] [MainThread]: Using postgres connection "master"
[0m11:49:11.037059 [debug] [MainThread]: On master: COMMIT
[0m11:49:11.037309 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:49:11.037522 [debug] [MainThread]: On master: Close
[0m11:49:11.037743 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:49:11.037921 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:49:11.038178 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:49:11.038391 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:49:11.038663 [info ] [MainThread]: 
[0m11:49:11.038875 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.14 seconds (0.14s).
[0m11:49:11.039295 [debug] [MainThread]: Command end result
[0m11:49:11.051942 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:49:11.052700 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:49:11.055119 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:49:11.055305 [info ] [MainThread]: 
[0m11:49:11.055492 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:49:11.055652 [info ] [MainThread]: 
[0m11:49:11.055867 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:49:11.056077 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:49:11.056249 [info ] [MainThread]: 
[0m11:49:11.056425 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:49:11.056591 [info ] [MainThread]: 
[0m11:49:11.056765 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:49:11.056935 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "row_number" does not exist
  LINE 15: ...row_number() over (partition by order_id order by row_number...
                                                                ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:49:11.057080 [info ] [MainThread]: 
[0m11:49:11.057243 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:49:11.057402 [info ] [MainThread]: 
[0m11:49:11.057581 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:49:11.057748 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "row_number" does not exist
  LINE 15:         row_number,
                   ^
  HINT:  Perhaps you meant to reference the column "src.row_num".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:49:11.057891 [info ] [MainThread]: 
[0m11:49:11.058046 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:49:11.058212 [info ] [MainThread]: 
[0m11:49:11.058375 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:49:11.058840 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.39223114, "process_in_blocks": "0", "process_kernel_time": 0.087436, "process_mem_max_rss": "127660", "process_out_blocks": "2111", "process_user_time": 0.957828}
[0m11:49:11.059070 [debug] [MainThread]: Command `dbt run` failed at 11:49:11.059034 after 0.39 seconds
[0m11:49:11.059276 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff975604d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92b638d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92924b50>]}
[0m11:49:11.059475 [debug] [MainThread]: Flushing usage events
[0m11:49:11.451042 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:50:13.763878 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9bd9d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9bda10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9bcc90>]}


============================== 11:50:13.767391 | 2e96da34-0e7e-4a34-804c-2fb1dc127638 ==============================
[0m11:50:13.767391 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:50:13.767968 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'use_colors': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'write_json': 'True', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'printer_width': '80', 'quiet': 'False', 'warn_error': 'None', 'invocation_command': 'dbt run', 'profiles_dir': '/opt/bluealpha/dbt_project', 'cache_selected_only': 'False', 'partial_parse': 'True', 'debug': 'False', 'log_format': 'default', 'no_print': 'None', 'introspect': 'True', 'fail_fast': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m11:50:13.848761 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffabbf3b90>]}
[0m11:50:13.868536 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffae4a7110>]}
[0m11:50:13.869068 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:50:13.893988 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:50:13.941816 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m11:50:13.942228 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_google_ads_daily.sql
[0m11:50:13.942454 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_facebook_ads_daily.sql
[0m11:50:13.942708 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m11:50:14.055264 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m11:50:14.055697 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaa42a10>]}
[0m11:50:14.118163 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae726d0>]}
[0m11:50:14.152829 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:50:14.153868 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:50:14.162719 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaae17110>]}
[0m11:50:14.163037 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:50:14.163250 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaafbfe90>]}
[0m11:50:14.164179 [info ] [MainThread]: 
[0m11:50:14.164438 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:50:14.164736 [info ] [MainThread]: 
[0m11:50:14.165078 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:50:14.166884 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:50:14.167188 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:50:14.171142 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:50:14.182386 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:50:14.182607 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:50:14.182822 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:50:14.183134 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:50:14.183399 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:50:14.183659 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:50:14.183877 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:50:14.184079 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:50:14.184287 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:50:14.189841 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:50:14.190039 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:50:14.190185 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:50:14.190806 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:50:14.191380 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:50:14.191872 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:50:14.193436 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:50:14.193728 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:50:14.194002 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:50:14.196261 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:50:14.197121 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:50:14.197914 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:50:14.198104 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:50:14.198330 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:50:14.198559 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:50:14.198760 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:50:14.198953 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:50:14.199151 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:50:14.203192 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:50:14.203388 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:50:14.203545 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m11:50:14.203715 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:50:14.203922 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:50:14.204164 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:50:14.204353 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:50:14.204584 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:50:14.204817 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:50:14.207681 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:50:14.207908 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:50:14.208092 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:50:14.208664 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:50:14.209183 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:50:14.209668 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:50:14.209920 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:50:14.210115 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:50:14.210289 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:50:14.213200 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.213421 [debug] [MainThread]: On master: BEGIN
[0m11:50:14.213582 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:50:14.216567 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:50:14.216900 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.217130 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:50:14.225696 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:50:14.226278 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa369db50>]}
[0m11:50:14.226519 [debug] [MainThread]: On master: ROLLBACK
[0m11:50:14.226716 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.226842 [debug] [MainThread]: On master: BEGIN
[0m11:50:14.227066 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:50:14.227298 [debug] [MainThread]: On master: COMMIT
[0m11:50:14.227487 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.227636 [debug] [MainThread]: On master: COMMIT
[0m11:50:14.227811 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:50:14.227941 [debug] [MainThread]: On master: Close
[0m11:50:14.230074 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:50:14.230257 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:50:14.230470 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:50:14.230794 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:50:14.231157 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:50:14.231628 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:50:14.232027 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:50:14.232328 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:50:14.232671 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:50:14.232962 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:50:14.233276 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:50:14.233531 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:50:14.237232 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:50:14.238393 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:50:14.239512 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:50:14.240345 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:50:14.240517 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:50:14.246658 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:50:14.252918 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:50:14.254249 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:50:14.255557 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:50:14.256287 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:50:14.256471 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:50:14.256696 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:50:14.256847 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:50:14.257005 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:50:14.257189 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:50:14.257358 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:50:14.257515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:50:14.257723 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:50:14.261483 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:50:14.261684 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m11:50:14.261864 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m11:50:14.262051 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:50:14.262245 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:50:14.262443 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:50:14.262647 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from src
)

select 
    'google'::text as platform,
    *
from clean
  );
[0m11:50:14.262890 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from deduped
    where rn =1 
)

select 
    'crm'::text as platform,
    *
from clean
  );
[0m11:50:14.263124 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from src
)

select 
    'facebook'::text as platform,
    *
from clean
  );
[0m11:50:14.264059 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "date" does not exist
LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                          ^

[0m11:50:14.264509 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:50:14.264696 [debug] [Thread-2 (]: Postgres adapter: Postgres error: column "campaign_date" does not exist
LINE 38:             and campaign_date is not null 
                         ^
HINT:  Perhaps you meant to reference the column "src.campaign_name".

[0m11:50:14.264906 [debug] [Thread-3 (]: Postgres adapter: Postgres error: column "campaign_date" does not exist
LINE 33:         (campaign_id is not null and campaign_date is not nu...
                                              ^
HINT:  Perhaps you meant to reference the column "src.campaign_name".

[0m11:50:14.265182 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:50:14.265346 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: ROLLBACK
[0m11:50:14.265532 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: ROLLBACK
[0m11:50:14.266880 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:50:14.267598 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:50:14.267848 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:50:14.268775 [debug] [Thread-2 (]: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 38:             and campaign_date is not null 
                           ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:50:14.269500 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa91dc250>]}
[0m11:50:14.270491 [debug] [Thread-3 (]: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 33:         (campaign_id is not null and campaign_date is not nu...
                                                ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:50:14.270693 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa354da90>]}
[0m11:50:14.271109 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:50:14.271484 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '2e96da34-0e7e-4a34-804c-2fb1dc127638', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa10ebc10>]}
[0m11:50:14.271839 [error] [Thread-2 (]: 2 of 6 ERROR creating sql view model staging_staging.stg_facebook_ads_daily .... [[31mERROR[0m in 0.04s]
[0m11:50:14.272245 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:50:14.272581 [error] [Thread-3 (]: 3 of 6 ERROR creating sql view model staging_staging.stg_google_ads_daily ...... [[31mERROR[0m in 0.04s]
[0m11:50:14.272958 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:50:14.273294 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:50:14.273586 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:50:14.274297 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_facebook_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 38:             and campaign_date is not null 
                           ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql.
[0m11:50:14.274628 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:50:14.275007 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_google_ads_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 33:         (campaign_id is not null and campaign_date is not nu...
                                                ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql.
[0m11:50:14.275286 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:50:14.275729 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:50:14.275952 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:50:14.276193 [info ] [Thread-2 (]: 5 of 6 SKIP relation staging_intermediate.int_campaign_daily ................... [[33mSKIP[0m]
[0m11:50:14.276649 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:50:14.277065 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:50:14.277268 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:50:14.277546 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:50:14.278271 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.278469 [debug] [MainThread]: On master: BEGIN
[0m11:50:14.278627 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:50:14.281678 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:50:14.281911 [debug] [MainThread]: On master: COMMIT
[0m11:50:14.282069 [debug] [MainThread]: Using postgres connection "master"
[0m11:50:14.282204 [debug] [MainThread]: On master: COMMIT
[0m11:50:14.282409 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:50:14.282577 [debug] [MainThread]: On master: Close
[0m11:50:14.282806 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:50:14.282981 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m11:50:14.283127 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:50:14.283278 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:50:14.283540 [info ] [MainThread]: 
[0m11:50:14.283746 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.12 seconds (0.12s).
[0m11:50:14.284263 [debug] [MainThread]: Command end result
[0m11:50:14.297456 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:50:14.298328 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:50:14.300642 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:50:14.300826 [info ] [MainThread]: 
[0m11:50:14.301057 [info ] [MainThread]: [31mCompleted with 3 errors, 0 partial successes, and 0 warnings:[0m
[0m11:50:14.301298 [info ] [MainThread]: 
[0m11:50:14.301573 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:50:14.301808 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:50:14.301987 [info ] [MainThread]: 
[0m11:50:14.302220 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:50:14.302428 [info ] [MainThread]: 
[0m11:50:14.302692 [error] [MainThread]: [31mFailure in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)[0m
[0m11:50:14.302925 [error] [MainThread]:   Database Error in model stg_facebook_ads_daily (models/staging/stg_facebook_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 38:             and campaign_date is not null 
                           ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:50:14.303170 [info ] [MainThread]: 
[0m11:50:14.303380 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_facebook_ads_daily.sql
[0m11:50:14.303569 [info ] [MainThread]: 
[0m11:50:14.303860 [error] [MainThread]: [31mFailure in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)[0m
[0m11:50:14.304108 [error] [MainThread]:   Database Error in model stg_google_ads_daily (models/staging/stg_google_ads_daily.sql)
  column "campaign_date" does not exist
  LINE 33:         (campaign_id is not null and campaign_date is not nu...
                                                ^
  HINT:  Perhaps you meant to reference the column "src.campaign_name".
  compiled code at target/run/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:50:14.304322 [info ] [MainThread]: 
[0m11:50:14.304677 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_google_ads_daily.sql
[0m11:50:14.304907 [info ] [MainThread]: 
[0m11:50:14.305132 [info ] [MainThread]: Done. PASS=0 WARN=0 ERROR=3 SKIP=3 NO-OP=0 TOTAL=6
[0m11:50:14.305471 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:50:14.306089 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.56239414, "process_in_blocks": "0", "process_kernel_time": 0.168087, "process_mem_max_rss": "132104", "process_out_blocks": "3070", "process_user_time": 1.147599}
[0m11:50:14.306829 [debug] [MainThread]: Command `dbt run` failed at 11:50:14.306788 after 0.56 seconds
[0m11:50:14.307070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0864550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9b3e50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab9b3f50>]}
[0m11:50:14.307328 [debug] [MainThread]: Flushing usage events
[0m11:50:14.735745 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m11:59:52.368294 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b46d810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b6a3750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b46da50>]}


============================== 11:59:52.371454 | 71e2eb86-69d5-4b7b-9baa-0544680aa005 ==============================
[0m11:59:52.371454 [info ] [MainThread]: Running with dbt=1.11.3
[0m11:59:52.371753 [debug] [MainThread]: running dbt with arguments {'log_cache_events': 'False', 'introspect': 'True', 'partial_parse': 'True', 'no_print': 'None', 'printer_width': '80', 'log_format': 'default', 'use_colors': 'True', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'profiles_dir': '.', 'write_json': 'True', 'empty': 'False', 'fail_fast': 'False', 'quiet': 'False', 'cache_selected_only': 'False', 'invocation_command': 'dbt run --profiles-dir .', 'warn_error': 'None', 'version_check': 'True', 'static_parser': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'send_anonymous_usage_stats': 'True', 'debug': 'False', 'target_path': 'None', 'use_experimental_parser': 'False'}
[0m11:59:52.442487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aa6e710>]}
[0m11:59:52.462370 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8df52f50>]}
[0m11:59:52.462825 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m11:59:52.488146 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m11:59:52.536495 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 3 files changed.
[0m11:59:52.537062 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m11:59:52.537330 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_google_ads_daily.sql
[0m11:59:52.537549 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_facebook_ads_daily.sql
[0m11:59:52.648625 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'stg_crm_orders_daily' in
package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests should
be nested under the `arguments` property.
[0m11:59:52.649046 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a689cd0>]}
[0m11:59:52.711722 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b57b590>]}
[0m11:59:52.745650 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:59:52.746740 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:59:52.755343 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aa644d0>]}
[0m11:59:52.755695 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m11:59:52.756012 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c9cc110>]}
[0m11:59:52.756943 [info ] [MainThread]: 
[0m11:59:52.757180 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m11:59:52.757420 [info ] [MainThread]: 
[0m11:59:52.757733 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m11:59:52.759496 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:59:52.759765 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:59:52.763635 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m11:59:52.774929 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:59:52.775131 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:59:52.775280 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m11:59:52.775513 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:59:52.775729 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:59:52.775937 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m11:59:52.776148 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:52.776368 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:52.776614 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m11:59:52.782169 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:59:52.782360 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:59:52.782509 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m11:59:52.783039 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:59:52.783572 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:59:52.784091 [debug] [ThreadPool]: On list_warehouse: Close
[0m11:59:52.786403 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m11:59:52.786693 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m11:59:52.789099 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:59:52.789312 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m11:59:52.790116 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:59:52.790338 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m11:59:52.791099 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:59:52.791323 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m11:59:52.791508 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:52.791716 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m11:59:52.791909 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:52.792232 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m11:59:52.795869 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:59:52.796113 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:59:52.796346 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m11:59:52.796475 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m11:59:52.796685 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m11:59:52.796929 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m11:59:52.797173 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m11:59:52.797407 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m11:59:52.797636 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m11:59:52.800282 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:59:52.800448 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m11:59:52.800587 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m11:59:52.801097 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m11:59:52.801543 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m11:59:52.801980 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m11:59:52.802293 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m11:59:52.802484 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m11:59:52.802686 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m11:59:52.805024 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.805220 [debug] [MainThread]: On master: BEGIN
[0m11:59:52.805391 [debug] [MainThread]: Opening a new connection, currently in state init
[0m11:59:52.808454 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:59:52.808723 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.808922 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m11:59:52.817149 [debug] [MainThread]: SQL status: SELECT 0 in 0.008 seconds
[0m11:59:52.817649 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82d11550>]}
[0m11:59:52.817899 [debug] [MainThread]: On master: ROLLBACK
[0m11:59:52.818146 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.818301 [debug] [MainThread]: On master: BEGIN
[0m11:59:52.818569 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m11:59:52.818777 [debug] [MainThread]: On master: COMMIT
[0m11:59:52.818940 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.819107 [debug] [MainThread]: On master: COMMIT
[0m11:59:52.819364 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:52.819525 [debug] [MainThread]: On master: Close
[0m11:59:52.821796 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:59:52.821985 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:59:52.822158 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:59:52.822485 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m11:59:52.822823 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m11:59:52.823118 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m11:59:52.823461 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m11:59:52.823711 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m11:59:52.823946 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m11:59:52.824180 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:59:52.824462 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:59:52.824713 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m11:59:52.827983 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:59:52.829119 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.830186 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.831350 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:59:52.831600 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:59:52.843266 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m11:59:52.843901 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:59:52.845222 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.846545 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.847188 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:59:52.847370 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.847572 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m11:59:52.847788 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.847964 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m11:59:52.848174 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:59:52.848369 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m11:59:52.848537 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m11:59:52.848869 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m11:59:52.852435 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m11:59:52.852612 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m11:59:52.852768 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m11:59:52.852960 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.853177 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.853381 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m11:59:52.853580 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m11:59:52.853820 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m11:59:52.854096 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\w+ \d{1,2}, \d{4}$' then to_date(date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m11:59:52.856120 [debug] [Thread-1 (]: Postgres adapter: Postgres error: column "date" does not exist
LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                          ^

[0m11:59:52.856607 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m11:59:52.857373 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m11:59:52.859625 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:59:52.860546 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80bb5e10>]}
[0m11:59:52.861022 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m11:59:52.861836 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m11:59:52.862212 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m11:59:52.863146 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m11:59:52.863776 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m11:59:52.864308 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m11:59:52.866568 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m11:59:52.866863 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.012 seconds
[0m11:59:52.869918 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.871343 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.871646 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m11:59:52.871862 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m11:59:52.872423 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m11:59:52.878668 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m11:59:52.879064 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m11:59:52.879439 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.880136 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m11:59:52.880375 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m11:59:52.880572 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.880991 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m11:59:52.881685 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m11:59:52.881862 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m11:59:52.886092 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m11:59:52.887459 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m11:59:52.889759 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m11:59:52.890157 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m11:59:52.890398 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m11:59:52.890597 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m11:59:52.890991 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m11:59:52.891157 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.000 seconds
[0m11:59:52.892143 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m11:59:52.892697 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m11:59:52.893043 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a688e10>]}
[0m11:59:52.893329 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80c4ae50>]}
[0m11:59:52.893637 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m11:59:52.894137 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m11:59:52.895097 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m11:59:52.895399 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m11:59:52.895971 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m11:59:52.896238 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m11:59:52.896516 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m11:59:52.896730 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m11:59:52.898247 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m11:59:52.899051 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m11:59:52.913065 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m11:59:52.913833 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m11:59:52.914006 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m11:59:52.914194 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m11:59:52.917505 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m11:59:52.917732 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m11:59:52.917931 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m11:59:52.924755 [debug] [Thread-1 (]: SQL status: SELECT 450 in 0.007 seconds
[0m11:59:52.926965 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m11:59:52.927237 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m11:59:52.927447 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m11:59:52.928050 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m11:59:52.928500 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m11:59:52.928845 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '71e2eb86-69d5-4b7b-9baa-0544680aa005', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80bb50d0>]}
[0m11:59:52.929183 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 450[0m in 0.03s]
[0m11:59:52.929491 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m11:59:52.929958 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m11:59:52.930267 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m11:59:52.930534 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m11:59:52.931302 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.931505 [debug] [MainThread]: On master: BEGIN
[0m11:59:52.931688 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m11:59:52.934868 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m11:59:52.935101 [debug] [MainThread]: On master: COMMIT
[0m11:59:52.935283 [debug] [MainThread]: Using postgres connection "master"
[0m11:59:52.935422 [debug] [MainThread]: On master: COMMIT
[0m11:59:52.935616 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m11:59:52.935783 [debug] [MainThread]: On master: Close
[0m11:59:52.935999 [debug] [MainThread]: Connection 'master' was properly closed.
[0m11:59:52.936150 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m11:59:52.936318 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m11:59:52.936545 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m11:59:52.936772 [info ] [MainThread]: 
[0m11:59:52.937003 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m11:59:52.937538 [debug] [MainThread]: Command end result
[0m11:59:52.949682 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m11:59:52.950486 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m11:59:52.953237 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m11:59:52.953434 [info ] [MainThread]: 
[0m11:59:52.953621 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m11:59:52.953832 [info ] [MainThread]: 
[0m11:59:52.954142 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m11:59:52.954424 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  column "date" does not exist
  LINE 24:             when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(da...
                            ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:59:52.954676 [info ] [MainThread]: 
[0m11:59:52.954930 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m11:59:52.955151 [info ] [MainThread]: 
[0m11:59:52.955417 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=2 NO-OP=0 TOTAL=6
[0m11:59:52.955726 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m11:59:52.956260 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.60871965, "process_in_blocks": "0", "process_kernel_time": 0.131823, "process_mem_max_rss": "134016", "process_out_blocks": "3091", "process_user_time": 1.193404}
[0m11:59:52.956536 [debug] [MainThread]: Command `dbt run` failed at 11:59:52.956486 after 0.61 seconds
[0m11:59:52.956756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b46eb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b46d010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff903ccb10>]}
[0m11:59:52.956935 [debug] [MainThread]: Flushing usage events
[0m11:59:53.382204 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:02:30.108861 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84f2d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84f2650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa848e050>]}


============================== 12:02:30.111855 | 4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5 ==============================
[0m12:02:30.111855 [info ] [MainThread]: Running with dbt=1.11.3
[0m12:02:30.112161 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'debug': 'False', 'static_parser': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_path': '/opt/bluealpha/dbt_project/logs', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_cache_events': 'False', 'profiles_dir': '.', 'fail_fast': 'False', 'version_check': 'True', 'introspect': 'True', 'log_format': 'default', 'target_path': 'None', 'partial_parse': 'True', 'printer_width': '80', 'no_print': 'None', 'quiet': 'False'}
[0m12:02:30.178332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7937710>]}
[0m12:02:30.198119 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaec4ed0>]}
[0m12:02:30.198519 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:02:30.227673 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m12:02:30.276249 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:02:30.276779 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m12:02:30.388057 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'stg_crm_orders_daily' in
package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests should
be nested under the `arguments` property.
[0m12:02:30.388566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa75449d0>]}
[0m12:02:30.448268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7a87550>]}
[0m12:02:30.482316 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:02:30.483256 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:02:30.492323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7572ad0>]}
[0m12:02:30.492615 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m12:02:30.492981 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7943750>]}
[0m12:02:30.493943 [info ] [MainThread]: 
[0m12:02:30.494160 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:02:30.494438 [info ] [MainThread]: 
[0m12:02:30.494721 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:02:30.496445 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:02:30.496720 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:02:30.500963 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:02:30.513144 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:02:30.513353 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:02:30.513524 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:02:30.513766 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:02:30.514000 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:02:30.514214 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:02:30.514464 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:30.514709 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:30.514959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:02:30.520410 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m12:02:30.520598 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m12:02:30.520738 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m12:02:30.521298 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:02:30.521844 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:02:30.522396 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:02:30.524273 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m12:02:30.524584 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m12:02:30.526944 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:02:30.527139 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m12:02:30.527994 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:02:30.528195 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m12:02:30.528985 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:02:30.529211 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m12:02:30.529406 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:02:30.529622 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m12:02:30.529818 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:02:30.530137 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:02:30.533262 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:02:30.533683 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:02:30.533913 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:02:30.534112 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:02:30.534301 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m12:02:30.534528 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:02:30.534737 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:02:30.535048 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m12:02:30.535317 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m12:02:30.537560 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m12:02:30.537737 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m12:02:30.537880 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m12:02:30.538411 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m12:02:30.538883 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m12:02:30.539391 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m12:02:30.539651 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m12:02:30.539841 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m12:02:30.540027 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m12:02:30.542742 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.542959 [debug] [MainThread]: On master: BEGIN
[0m12:02:30.543125 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:02:30.546079 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:02:30.546380 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.546567 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:02:30.555637 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m12:02:30.556162 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fd51d50>]}
[0m12:02:30.556417 [debug] [MainThread]: On master: ROLLBACK
[0m12:02:30.556649 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.556814 [debug] [MainThread]: On master: BEGIN
[0m12:02:30.557093 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:02:30.557362 [debug] [MainThread]: On master: COMMIT
[0m12:02:30.557523 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.557667 [debug] [MainThread]: On master: COMMIT
[0m12:02:30.557874 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:02:30.558030 [debug] [MainThread]: On master: Close
[0m12:02:30.560056 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:02:30.560237 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:02:30.560399 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:02:30.560705 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m12:02:30.561115 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m12:02:30.561566 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m12:02:30.561937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m12:02:30.562200 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m12:02:30.562455 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m12:02:30.562711 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:02:30.562953 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:02:30.563170 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m12:02:30.565944 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:02:30.567050 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.568829 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.569661 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:02:30.569938 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:02:30.581319 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m12:02:30.582119 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:02:30.583428 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.584745 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.585429 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:02:30.585616 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.585832 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m12:02:30.586067 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.586630 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m12:02:30.586458 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:02:30.586244 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m12:02:30.587079 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:02:30.586770 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:02:30.590552 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:02:30.590801 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.591003 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m12:02:30.591294 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m12:02:30.591521 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:02:30.591705 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:02:30.591992 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.592252 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            nullif(trim(order_id),'') is not null 
            and nullif(trim(customer_id),'') is not null 
            and nullif(revenue,'')::numeric is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m12:02:30.592566 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m12:02:30.593686 [debug] [Thread-1 (]: Postgres adapter: Postgres error: invalid input syntax for type numeric: ""
LINE 54:             and nullif(revenue,'')::numeric is not null 
                                        ^

[0m12:02:30.594050 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: ROLLBACK
[0m12:02:30.594949 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m12:02:30.595153 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:02:30.598475 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.598831 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m12:02:30.599013 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m12:02:30.600570 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.601443 [debug] [Thread-1 (]: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  invalid input syntax for type numeric: ""
  LINE 54:             and nullif(revenue,'')::numeric is not null 
                                          ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m12:02:30.601626 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:02:30.601845 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m12:02:30.602657 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fd30ed0>]}
[0m12:02:30.603822 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.604274 [error] [Thread-1 (]: 1 of 6 ERROR creating sql view model staging_staging.stg_crm_orders_daily ...... [[31mERROR[0m in 0.04s]
[0m12:02:30.604538 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:02:30.604764 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m12:02:30.605069 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:02:30.606198 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.606547 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.stg_crm_orders_daily' to be skipped because of status 'error'.  Reason: Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  invalid input syntax for type numeric: ""
  LINE 54:             and nullif(revenue,'')::numeric is not null 
                                          ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql.
[0m12:02:30.606701 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:02:30.606905 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m12:02:30.607477 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m12:02:30.613355 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:02:30.613787 [info ] [Thread-4 (]: 4 of 6 SKIP relation staging_intermediate.int_crm_orders ....................... [[33mSKIP[0m]
[0m12:02:30.614070 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.614300 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:02:30.614525 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m12:02:30.614749 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:02:30.615379 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:02:30.615835 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.616471 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:02:30.616652 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m12:02:30.619796 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m12:02:30.619950 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m12:02:30.621714 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:02:30.622676 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m12:02:30.622887 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m12:02:30.623276 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:02:30.623529 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m12:02:30.624875 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:02:30.625020 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:02:30.625954 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m12:02:30.626505 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m12:02:30.626872 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fdb2950>]}
[0m12:02:30.627207 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5bfdd50>]}
[0m12:02:30.627526 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m12:02:30.628022 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m12:02:30.628345 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:02:30.628645 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:02:30.629246 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m12:02:30.629510 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m12:02:30.629796 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m12:02:30.629985 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m12:02:30.631565 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.632171 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m12:02:30.646821 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.647077 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp120230641226"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m12:02:30.647288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:02:30.656366 [debug] [Thread-1 (]: SQL status: SELECT 450 in 0.009 seconds
[0m12:02:30.661210 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.661432 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m12:02:30.661701 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m12:02:30.661913 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.662093 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp120230641226'
        
      order by ordinal_position

  
[0m12:02:30.668901 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.007 seconds
[0m12:02:30.671226 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.671467 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:02:30.672680 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:02:30.676031 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.676256 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:02:30.677341 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:02:30.682874 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.683643 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.683916 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp120230641226" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp120230641226"
    )
  
[0m12:02:30.685951 [debug] [Thread-1 (]: SQL status: INSERT 0 450 in 0.002 seconds
[0m12:02:30.686615 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:02:30.686815 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:02:30.686985 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:02:30.687738 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:02:30.688091 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m12:02:30.688423 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f90dcda-13aa-4fff-8c15-7e13a4fe8ae5', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fd0ad90>]}
[0m12:02:30.688833 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 450[0m in 0.06s]
[0m12:02:30.689324 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m12:02:30.689843 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m12:02:30.690059 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m12:02:30.690290 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m12:02:30.691114 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.691334 [debug] [MainThread]: On master: BEGIN
[0m12:02:30.691513 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:02:30.694236 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:02:30.694442 [debug] [MainThread]: On master: COMMIT
[0m12:02:30.694609 [debug] [MainThread]: Using postgres connection "master"
[0m12:02:30.694739 [debug] [MainThread]: On master: COMMIT
[0m12:02:30.694904 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:02:30.695033 [debug] [MainThread]: On master: Close
[0m12:02:30.695222 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:02:30.695426 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m12:02:30.695727 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m12:02:30.696005 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m12:02:30.696249 [info ] [MainThread]: 
[0m12:02:30.696472 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m12:02:30.696979 [debug] [MainThread]: Command end result
[0m12:02:30.709605 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:02:30.710527 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:02:30.713273 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m12:02:30.713470 [info ] [MainThread]: 
[0m12:02:30.713687 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:02:30.713904 [info ] [MainThread]: 
[0m12:02:30.714129 [error] [MainThread]: [31mFailure in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)[0m
[0m12:02:30.714360 [error] [MainThread]:   Database Error in model stg_crm_orders_daily (models/staging/stg_crm_orders_daily.sql)
  invalid input syntax for type numeric: ""
  LINE 54:             and nullif(revenue,'')::numeric is not null 
                                          ^
  compiled code at target/run/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m12:02:30.714572 [info ] [MainThread]: 
[0m12:02:30.714794 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/staging/stg_crm_orders_daily.sql
[0m12:02:30.714987 [info ] [MainThread]: 
[0m12:02:30.715210 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=1 SKIP=2 NO-OP=0 TOTAL=6
[0m12:02:30.715526 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:02:30.716171 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6264779, "process_in_blocks": "0", "process_kernel_time": 0.146905, "process_mem_max_rss": "134188", "process_out_blocks": "3102", "process_user_time": 1.21952}
[0m12:02:30.716464 [debug] [MainThread]: Command `dbt run` failed at 12:02:30.716414 after 0.63 seconds
[0m12:02:30.716673 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84f1c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa84f3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad33cb10>]}
[0m12:02:30.716876 [debug] [MainThread]: Flushing usage events
[0m12:02:31.727617 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:03:56.475705 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2b41990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e20c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2b34bd0>]}


============================== 12:03:56.478437 | f6af1c6a-a759-4cc4-9e01-945fc74445e1 ==============================
[0m12:03:56.478437 [info ] [MainThread]: Running with dbt=1.11.3
[0m12:03:56.478779 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'version_check': 'True', 'warn_error': 'None', 'printer_width': '80', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'use_colors': 'True', 'quiet': 'False', 'target_path': 'None', 'log_cache_events': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'introspect': 'True', 'profiles_dir': '.', 'fail_fast': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'cache_selected_only': 'False', 'write_json': 'True'}
[0m12:03:56.538704 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2bf2790>]}
[0m12:03:56.558472 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa561f3d0>]}
[0m12:03:56.558912 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:03:56.583204 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m12:03:56.630426 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:03:56.630782 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m12:03:56.740853 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'stg_crm_orders_daily' in
package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests should
be nested under the `arguments` property.
[0m12:03:56.741348 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1dd2190>]}
[0m12:03:56.802224 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2bc7450>]}
[0m12:03:56.836116 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:03:56.837012 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:03:56.844866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1c20590>]}
[0m12:03:56.845750 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m12:03:56.845954 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1b6b510>]}
[0m12:03:56.846905 [info ] [MainThread]: 
[0m12:03:56.847098 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:03:56.847327 [info ] [MainThread]: 
[0m12:03:56.847656 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:03:56.849495 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:03:56.849780 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:03:56.854305 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:03:56.863430 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:03:56.864149 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:03:56.864286 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:03:56.864516 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:03:56.864726 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:03:56.864926 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:03:56.865128 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:56.865324 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:56.865589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:03:56.876296 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.011 seconds
[0m12:03:56.876482 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.011 seconds
[0m12:03:56.877131 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:03:56.877308 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.012 seconds
[0m12:03:56.877822 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:03:56.878965 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:03:56.880177 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m12:03:56.880424 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m12:03:56.880702 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m12:03:56.883181 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:03:56.884170 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:03:56.885060 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:03:56.885255 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m12:03:56.885451 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m12:03:56.885664 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m12:03:56.885852 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:03:56.886012 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:03:56.886157 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:03:56.890073 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.890242 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.890394 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.890582 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:03:56.891136 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m12:03:56.890954 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:03:56.890778 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:03:56.891438 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m12:03:56.891696 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m12:03:56.893936 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m12:03:56.894779 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m12:03:56.894194 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m12:03:56.894059 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m12:03:56.895948 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m12:03:56.895472 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m12:03:56.895047 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m12:03:56.896191 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m12:03:56.896391 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m12:03:56.899016 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:56.899220 [debug] [MainThread]: On master: BEGIN
[0m12:03:56.899396 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:03:56.902836 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:03:56.903181 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:56.903443 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:03:56.912692 [debug] [MainThread]: SQL status: SELECT 2 in 0.009 seconds
[0m12:03:56.913296 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1c13410>]}
[0m12:03:56.913576 [debug] [MainThread]: On master: ROLLBACK
[0m12:03:56.913827 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:56.913987 [debug] [MainThread]: On master: BEGIN
[0m12:03:56.914280 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:03:56.914601 [debug] [MainThread]: On master: COMMIT
[0m12:03:56.914801 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:56.914961 [debug] [MainThread]: On master: COMMIT
[0m12:03:56.915168 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:03:56.915334 [debug] [MainThread]: On master: Close
[0m12:03:56.917355 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:03:56.917553 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:03:56.917721 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:03:56.918007 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m12:03:56.918352 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m12:03:56.918707 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m12:03:56.919042 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m12:03:56.919292 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m12:03:56.919552 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m12:03:56.919771 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:03:56.920030 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:03:56.920241 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m12:03:56.923086 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.924897 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.925903 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.926535 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:03:56.926885 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:03:56.940566 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.941296 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.941488 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m12:03:56.942071 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.943352 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.943630 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.943764 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m12:03:56.944093 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m12:03:56.944694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:56.944491 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:03:56.944335 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.945084 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m12:03:56.945375 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:03:56.948061 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.948261 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.948534 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.948779 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.949030 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m12:03:56.949300 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m12:03:56.949519 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:03:56.949888 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.950112 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m12:03:56.952958 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:03:56.953282 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m12:03:56.953149 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:03:56.955979 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.957147 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.958685 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m12:03:56.958493 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m12:03:56.958275 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.959019 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m12:03:56.959173 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:03:56.959353 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:03:56.960736 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.960908 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:03:56.962973 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.963263 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m12:03:56.968234 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:03:56.968777 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.968455 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m12:03:56.968939 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:03:56.969122 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:03:56.970548 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:03:56.970712 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:03:56.971030 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.971841 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:03:56.972017 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m12:03:56.972202 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:03:56.972415 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.974636 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m12:03:56.974990 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:03:56.975153 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m12:03:56.976994 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:03:56.978019 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m12:03:56.978180 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m12:03:56.978337 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m12:03:56.978710 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:03:56.979624 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m12:03:56.979911 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m12:03:56.980076 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m12:03:56.980356 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:03:56.981877 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m12:03:56.981708 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:03:56.981554 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m12:03:56.982486 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m12:03:56.982659 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:03:56.983589 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa00a6a50>]}
[0m12:03:56.983774 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2169750>]}
[0m12:03:56.984399 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m12:03:56.984735 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m12:03:56.985107 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m12:03:56.985430 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e422610>]}
[0m12:03:56.985682 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:03:56.985949 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:03:56.986224 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m12:03:56.986617 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m12:03:56.986976 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:03:56.987229 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m12:03:56.987744 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m12:03:56.987954 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m12:03:56.988220 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m12:03:56.988480 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m12:03:56.988696 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m12:03:56.990063 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m12:03:56.990270 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m12:03:56.991702 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:56.991994 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m12:03:56.999679 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m12:03:57.005950 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m12:03:57.008604 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.008899 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp120357006829"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m12:03:57.009162 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:03:57.009344 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:03:57.009686 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m12:03:57.010021 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:03:57.012999 [debug] [Thread-4 (]: SQL status: BEGIN in 0.003 seconds
[0m12:03:57.013250 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:03:57.013454 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE
  );
  
  
[0m12:03:57.018189 [debug] [Thread-1 (]: SQL status: SELECT 450 in 0.009 seconds
[0m12:03:57.023349 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.023543 [debug] [Thread-4 (]: Postgres adapter: Postgres error: date/time field value out of range: "15/01/2024"

[0m12:03:57.023747 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m12:03:57.023935 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: ROLLBACK
[0m12:03:57.024203 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m12:03:57.024513 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m12:03:57.024694 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.025775 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp120357006829'
        
      order by ordinal_position

  
[0m12:03:57.026947 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:03:57.028698 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e419210>]}
[0m12:03:57.029699 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.04s]
[0m12:03:57.030307 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m12:03:57.031022 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.004 seconds
[0m12:03:57.031283 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql.
[0m12:03:57.033576 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.034156 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:03:57.035266 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:03:57.038614 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.038843 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:03:57.039842 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:03:57.045182 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.045836 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.046068 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp120357006829" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp120357006829"
    )
  
[0m12:03:57.047463 [debug] [Thread-1 (]: SQL status: INSERT 0 450 in 0.001 seconds
[0m12:03:57.048079 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:03:57.048253 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:03:57.048398 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:03:57.048860 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m12:03:57.049191 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m12:03:57.049543 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'f6af1c6a-a759-4cc4-9e01-945fc74445e1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6e58eed0>]}
[0m12:03:57.049951 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 450[0m in 0.06s]
[0m12:03:57.050377 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m12:03:57.051954 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m12:03:57.052195 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m12:03:57.052453 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m12:03:57.053171 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:57.053382 [debug] [MainThread]: On master: BEGIN
[0m12:03:57.053542 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:03:57.056279 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:03:57.056489 [debug] [MainThread]: On master: COMMIT
[0m12:03:57.056662 [debug] [MainThread]: Using postgres connection "master"
[0m12:03:57.056818 [debug] [MainThread]: On master: COMMIT
[0m12:03:57.057024 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:03:57.057193 [debug] [MainThread]: On master: Close
[0m12:03:57.057988 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:03:57.058247 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m12:03:57.058515 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m12:03:57.058709 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m12:03:57.058865 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m12:03:57.059063 [info ] [MainThread]: 
[0m12:03:57.059280 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m12:03:57.059847 [debug] [MainThread]: Command end result
[0m12:03:57.072633 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:03:57.073441 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:03:57.075808 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m12:03:57.076071 [info ] [MainThread]: 
[0m12:03:57.076277 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:03:57.076546 [info ] [MainThread]: 
[0m12:03:57.076777 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m12:03:57.076986 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:03:57.077184 [info ] [MainThread]: 
[0m12:03:57.077421 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:03:57.077673 [info ] [MainThread]: 
[0m12:03:57.077885 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m12:03:57.078193 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:03:57.078785 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.62224674, "process_in_blocks": "0", "process_kernel_time": 0.08275, "process_mem_max_rss": "134576", "process_out_blocks": "3112", "process_user_time": 1.210356}
[0m12:03:57.079007 [debug] [MainThread]: Command `dbt run` failed at 12:03:57.078972 after 0.62 seconds
[0m12:03:57.079196 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7d25d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7a9cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7a9f110>]}
[0m12:03:57.079377 [debug] [MainThread]: Flushing usage events
[0m12:03:57.583723 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:06:38.952866 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa06cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa2a3f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa06cdd0>]}


============================== 12:06:38.955821 | fc028066-11a0-438a-aa47-7b894bc33c8f ==============================
[0m12:06:38.955821 [info ] [MainThread]: Running with dbt=1.11.3
[0m12:06:38.956190 [debug] [MainThread]: running dbt with arguments {'use_experimental_parser': 'False', 'printer_width': '80', 'indirect_selection': 'eager', 'no_print': 'None', 'introspect': 'True', 'empty': 'False', 'warn_error': 'None', 'version_check': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'log_format': 'default', 'profiles_dir': '.', 'debug': 'False', 'cache_selected_only': 'False', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'quiet': 'False', 'partial_parse': 'True', 'target_path': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'static_parser': 'True', 'log_cache_events': 'False', 'write_json': 'True'}
[0m12:06:39.021077 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9512650>]}
[0m12:06:39.042193 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacaa5890>]}
[0m12:06:39.042736 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:06:39.069207 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m12:06:39.117125 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:06:39.117532 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m12:06:39.227501 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'stg_crm_orders_daily' in
package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests should
be nested under the `arguments` property.
[0m12:06:39.227997 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9152310>]}
[0m12:06:39.288058 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa138f10>]}
[0m12:06:39.321628 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:06:39.322507 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:06:39.330899 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9055290>]}
[0m12:06:39.331163 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m12:06:39.331377 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa957ae90>]}
[0m12:06:39.332358 [info ] [MainThread]: 
[0m12:06:39.332587 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:06:39.332804 [info ] [MainThread]: 
[0m12:06:39.333069 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:06:39.334815 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:06:39.335110 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:06:39.339447 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:06:39.350788 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:06:39.350965 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:06:39.351108 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:06:39.351286 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:06:39.351557 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:06:39.351764 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:06:39.351949 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:06:39.352146 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:06:39.352342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:06:39.358008 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m12:06:39.358186 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m12:06:39.358329 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m12:06:39.358880 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:06:39.359432 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:06:39.359935 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:06:39.361258 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m12:06:39.361537 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m12:06:39.361845 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m12:06:39.364186 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:06:39.365088 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:06:39.365942 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:06:39.366252 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m12:06:39.366889 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:06:39.366698 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m12:06:39.366463 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m12:06:39.367237 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:06:39.367614 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:06:39.371312 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.371540 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.371730 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.371925 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:06:39.372525 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m12:06:39.372336 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:06:39.372134 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:06:39.372831 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m12:06:39.373081 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m12:06:39.375210 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m12:06:39.375884 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m12:06:39.375359 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m12:06:39.376027 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m12:06:39.376265 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m12:06:39.376700 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m12:06:39.377205 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m12:06:39.377718 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m12:06:39.378039 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m12:06:39.380512 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.380789 [debug] [MainThread]: On master: BEGIN
[0m12:06:39.380970 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:06:39.383947 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:06:39.384198 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.384393 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:06:39.393544 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m12:06:39.394123 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaab98e10>]}
[0m12:06:39.394385 [debug] [MainThread]: On master: ROLLBACK
[0m12:06:39.394636 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.394789 [debug] [MainThread]: On master: BEGIN
[0m12:06:39.395047 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:06:39.395263 [debug] [MainThread]: On master: COMMIT
[0m12:06:39.395435 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.395596 [debug] [MainThread]: On master: COMMIT
[0m12:06:39.395795 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:06:39.395962 [debug] [MainThread]: On master: Close
[0m12:06:39.398060 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:06:39.398258 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:06:39.398406 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:06:39.398707 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m12:06:39.399039 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m12:06:39.399351 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m12:06:39.399693 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m12:06:39.399940 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m12:06:39.400170 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m12:06:39.400364 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:06:39.400603 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:06:39.400838 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m12:06:39.403560 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.404687 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.406366 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.407055 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:06:39.412731 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:06:39.419703 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.419931 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m12:06:39.421278 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.422749 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.423111 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.423493 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.423627 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m12:06:39.423986 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.424178 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m12:06:39.424822 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:06:39.424634 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m12:06:39.424387 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:06:39.425107 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:06:39.428660 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.428875 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.429566 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.429361 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:06:39.429155 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.430162 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m12:06:39.429974 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.429762 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m12:06:39.430477 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m12:06:39.433910 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:06:39.434095 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:06:39.434256 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m12:06:39.437101 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.438289 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.439469 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.440161 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m12:06:39.439933 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m12:06:39.439694 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m12:06:39.440650 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:06:39.440927 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:06:39.440802 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:06:39.442093 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.443164 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.445157 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m12:06:39.444983 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m12:06:39.444772 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.445724 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m12:06:39.445573 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:06:39.445873 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:06:39.451888 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:06:39.452962 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.452714 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:06:39.452089 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m12:06:39.454044 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:06:39.453392 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.453155 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:06:39.454251 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.454490 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:06:39.454848 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:06:39.455257 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m12:06:39.457594 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m12:06:39.457756 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m12:06:39.457895 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:06:39.459766 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:06:39.460703 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m12:06:39.461571 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m12:06:39.461763 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m12:06:39.462099 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:06:39.462385 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:06:39.462660 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m12:06:39.462878 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m12:06:39.463313 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:06:39.464634 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m12:06:39.464797 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:06:39.464962 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m12:06:39.465694 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1d20590>]}
[0m12:06:39.466197 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m12:06:39.466718 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m12:06:39.467669 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1ba3350>]}
[0m12:06:39.467377 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa965ec90>]}
[0m12:06:39.467049 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m12:06:39.468769 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:06:39.468378 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m12:06:39.467993 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m12:06:39.469203 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:06:39.469447 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:06:39.469820 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m12:06:39.470130 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m12:06:39.470360 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m12:06:39.470713 [info ] [Thread-3 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m12:06:39.471043 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m12:06:39.471274 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m12:06:39.471493 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m12:06:39.471710 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m12:06:39.473214 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.474407 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m12:06:39.475029 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m12:06:39.475224 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m12:06:39.489522 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.491866 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp120639484128"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m12:06:39.491642 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m12:06:39.492117 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:06:39.492960 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:06:39.493184 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m12:06:39.493389 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:06:39.498036 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m12:06:39.498347 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:06:39.498606 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE
  );
  
  
[0m12:06:39.502254 [debug] [Thread-4 (]: SQL status: SELECT 450 in 0.010 seconds
[0m12:06:39.507664 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.507912 [debug] [Thread-3 (]: Postgres adapter: Postgres error: date/time field value out of range: "15/01/2024"

[0m12:06:39.508195 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m12:06:39.508397 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: ROLLBACK
[0m12:06:39.508764 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m12:06:39.509006 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m12:06:39.509192 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.510061 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp120639484128'
        
      order by ordinal_position

  
[0m12:06:39.511488 [debug] [Thread-3 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:06:39.511837 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0b4b510>]}
[0m12:06:39.512493 [error] [Thread-3 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.04s]
[0m12:06:39.513387 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m12:06:39.513693 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql.
[0m12:06:39.514881 [debug] [Thread-4 (]: SQL status: SELECT 15 in 0.004 seconds
[0m12:06:39.517221 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.517464 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:06:39.518715 [debug] [Thread-4 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:06:39.522100 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.522334 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:06:39.523436 [debug] [Thread-4 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:06:39.528813 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.529427 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.529666 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp120639484128" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp120639484128"
    )
  
[0m12:06:39.531517 [debug] [Thread-4 (]: SQL status: INSERT 0 450 in 0.002 seconds
[0m12:06:39.532090 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:06:39.532293 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:06:39.532468 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:06:39.533552 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m12:06:39.533916 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m12:06:39.534185 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'fc028066-11a0-438a-aa47-7b894bc33c8f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1d65050>]}
[0m12:06:39.534776 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 450[0m in 0.06s]
[0m12:06:39.535267 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m12:06:39.536794 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m12:06:39.537076 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m12:06:39.537318 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m12:06:39.538056 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.538284 [debug] [MainThread]: On master: BEGIN
[0m12:06:39.538458 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:06:39.541345 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:06:39.541632 [debug] [MainThread]: On master: COMMIT
[0m12:06:39.541834 [debug] [MainThread]: Using postgres connection "master"
[0m12:06:39.541993 [debug] [MainThread]: On master: COMMIT
[0m12:06:39.542195 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:06:39.542344 [debug] [MainThread]: On master: Close
[0m12:06:39.543171 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:06:39.543314 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m12:06:39.543473 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m12:06:39.543626 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m12:06:39.543754 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m12:06:39.543973 [info ] [MainThread]: 
[0m12:06:39.544200 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m12:06:39.544723 [debug] [MainThread]: Command end result
[0m12:06:39.557814 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:06:39.559011 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:06:39.561492 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m12:06:39.561691 [info ] [MainThread]: 
[0m12:06:39.561917 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m12:06:39.562142 [info ] [MainThread]: 
[0m12:06:39.562371 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m12:06:39.562649 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  date/time field value out of range: "15/01/2024"
  compiled code at target/run/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:06:39.562847 [info ] [MainThread]: 
[0m12:06:39.563053 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m12:06:39.563264 [info ] [MainThread]: 
[0m12:06:39.563488 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m12:06:39.563842 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:06:39.564385 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6319585, "process_in_blocks": "0", "process_kernel_time": 0.091187, "process_mem_max_rss": "134948", "process_out_blocks": "3115", "process_user_time": 1.217505}
[0m12:06:39.564661 [debug] [MainThread]: Command `dbt run` failed at 12:06:39.564617 after 0.63 seconds
[0m12:06:39.564900 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef1cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef1f110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa063f50>]}
[0m12:06:39.565082 [debug] [MainThread]: Flushing usage events
[0m12:06:40.049945 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:07:30.706047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6ab0c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa68e4c10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa67c1310>]}


============================== 12:07:30.708847 | 4bef3c36-1dcf-4282-b046-080ff879a67d ==============================
[0m12:07:30.708847 [info ] [MainThread]: Running with dbt=1.11.3
[0m12:07:30.709201 [debug] [MainThread]: running dbt with arguments {'log_path': '/opt/bluealpha/dbt_project/logs', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'printer_width': '80', 'debug': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'profiles_dir': '.', 'static_parser': 'True', 'write_json': 'True', 'introspect': 'True', 'empty': 'False', 'partial_parse': 'True', 'quiet': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt run --profiles-dir .', 'target_path': 'None'}
[0m12:07:30.775957 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c8ba50>]}
[0m12:07:30.796646 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa92b2c50>]}
[0m12:07:30.797156 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:07:30.822505 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m12:07:30.870425 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m12:07:30.870781 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/staging/stg_crm_orders_daily.sql
[0m12:07:30.986644 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `unique` defined on 'stg_crm_orders_daily' in
package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests should
be nested under the `arguments` property.
[0m12:07:30.987169 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa56fdfd0>]}
[0m12:07:31.048586 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5d56c90>]}
[0m12:07:31.082183 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:07:31.083264 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:07:31.092159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa56e8b10>]}
[0m12:07:31.092562 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m12:07:31.092810 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5a15c50>]}
[0m12:07:31.093767 [info ] [MainThread]: 
[0m12:07:31.094001 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:07:31.094222 [info ] [MainThread]: 
[0m12:07:31.094549 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:07:31.096334 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:07:31.096636 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:07:31.100887 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m12:07:31.111459 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:07:31.111628 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:07:31.111770 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m12:07:31.111985 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:07:31.112240 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:07:31.112476 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m12:07:31.112677 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:31.112875 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:31.113073 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:31.118292 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m12:07:31.118474 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m12:07:31.118611 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m12:07:31.119098 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:07:31.119631 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:07:31.120091 [debug] [ThreadPool]: On list_warehouse: Close
[0m12:07:31.121335 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m12:07:31.121612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m12:07:31.121862 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m12:07:31.124078 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:07:31.124938 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:07:31.125738 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:07:31.125931 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m12:07:31.126134 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m12:07:31.126356 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m12:07:31.126549 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:07:31.126749 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:07:31.126942 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m12:07:31.130478 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:07:31.130728 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:07:31.130881 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m12:07:31.131055 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:07:31.131262 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:07:31.131477 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:07:31.131659 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m12:07:31.131879 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m12:07:31.132096 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m12:07:31.134744 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m12:07:31.134891 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m12:07:31.135024 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.003 seconds
[0m12:07:31.135627 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m12:07:31.136117 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m12:07:31.136659 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m12:07:31.136989 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m12:07:31.137198 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m12:07:31.137445 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m12:07:31.140481 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.140683 [debug] [MainThread]: On master: BEGIN
[0m12:07:31.140860 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:07:31.143871 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:07:31.144180 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.144413 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:07:31.153734 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m12:07:31.154380 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8c55710>]}
[0m12:07:31.154661 [debug] [MainThread]: On master: ROLLBACK
[0m12:07:31.154960 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.155112 [debug] [MainThread]: On master: BEGIN
[0m12:07:31.155399 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:07:31.155623 [debug] [MainThread]: On master: COMMIT
[0m12:07:31.155782 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.155921 [debug] [MainThread]: On master: COMMIT
[0m12:07:31.156112 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:07:31.156302 [debug] [MainThread]: On master: Close
[0m12:07:31.158345 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:07:31.158525 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:07:31.158686 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:07:31.158962 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m12:07:31.159329 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m12:07:31.159689 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m12:07:31.160014 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m12:07:31.160329 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m12:07:31.160573 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m12:07:31.160800 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:07:31.161021 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:07:31.161240 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m12:07:31.164164 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.165969 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.166961 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.167604 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:07:31.173481 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:07:31.180398 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.180630 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m12:07:31.181872 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.183461 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.183775 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.184264 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.184418 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m12:07:31.184652 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.184837 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m12:07:31.185029 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:31.185202 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m12:07:31.185349 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:07:31.185660 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:07:31.188858 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m12:07:31.189109 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:31.189290 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.189467 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:31.189702 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.189890 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m12:07:31.190106 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.190365 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m12:07:31.190728 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m12:07:31.193158 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m12:07:31.196212 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.196373 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m12:07:31.196533 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m12:07:31.196721 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m12:07:31.197895 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.199090 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.199408 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m12:07:31.199575 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:07:31.199759 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m12:07:31.201052 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.201232 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:07:31.201532 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m12:07:31.201687 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:07:31.203631 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.205058 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.205296 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:07:31.205496 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m12:07:31.205720 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m12:07:31.211769 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:07:31.212273 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.212435 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:07:31.212594 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m12:07:31.212779 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m12:07:31.213457 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:07:31.214155 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:07:31.214521 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.214845 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.215009 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m12:07:31.215210 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m12:07:31.215434 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m12:07:31.217715 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m12:07:31.219786 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m12:07:31.219949 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m12:07:31.220113 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m12:07:31.220271 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m12:07:31.221215 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m12:07:31.222179 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m12:07:31.222692 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m12:07:31.223066 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m12:07:31.223233 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:07:31.223420 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m12:07:31.223647 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m12:07:31.224649 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m12:07:31.225707 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:07:31.225975 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m12:07:31.226551 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m12:07:31.226726 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff57f1cc50>]}
[0m12:07:31.227321 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m12:07:31.227625 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96177b90>]}
[0m12:07:31.227939 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m12:07:31.228304 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5d54d10>]}
[0m12:07:31.229179 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m12:07:31.229628 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m12:07:31.229930 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m12:07:31.230254 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m12:07:31.230683 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m12:07:31.231046 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m12:07:31.231363 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m12:07:31.231574 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m12:07:31.231842 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m12:07:31.232161 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m12:07:31.232397 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m12:07:31.232599 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m12:07:31.232791 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m12:07:31.234148 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m12:07:31.235538 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.236098 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m12:07:31.236336 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m12:07:31.250129 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m12:07:31.252797 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.253267 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp120731251687"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m12:07:31.253596 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:31.253830 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:07:31.254181 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m12:07:31.254446 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:07:31.257568 [debug] [Thread-4 (]: SQL status: BEGIN in 0.003 seconds
[0m12:07:31.258757 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:07:31.258979 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE
  );
  
  
[0m12:07:31.262658 [debug] [Thread-4 (]: SQL status: SELECT 79 in 0.003 seconds
[0m12:07:31.262838 [debug] [Thread-1 (]: SQL status: SELECT 450 in 0.009 seconds
[0m12:07:31.265010 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m12:07:31.270435 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.270747 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m12:07:31.270969 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m12:07:31.271153 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m12:07:31.271533 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m12:07:31.271812 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.271985 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m12:07:31.272205 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp120731251687'
        
      order by ordinal_position

  
[0m12:07:31.272588 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m12:07:31.273024 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96196910>]}
[0m12:07:31.273341 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.04s]
[0m12:07:31.273652 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m12:07:31.276382 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.004 seconds
[0m12:07:31.278532 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.278750 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:07:31.279900 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:07:31.283145 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.283356 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m12:07:31.284351 [debug] [Thread-1 (]: SQL status: SELECT 15 in 0.001 seconds
[0m12:07:31.289660 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.290257 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.290486 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp120731251687" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp120731251687"
    )
  
[0m12:07:31.291776 [debug] [Thread-1 (]: SQL status: INSERT 0 450 in 0.001 seconds
[0m12:07:31.292336 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:07:31.292553 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m12:07:31.292739 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m12:07:31.293215 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m12:07:31.293637 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m12:07:31.293925 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c44450>]}
[0m12:07:31.294303 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 450[0m in 0.06s]
[0m12:07:31.294784 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m12:07:31.295346 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m12:07:31.295582 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m12:07:31.295927 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m12:07:31.296135 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m12:07:31.297513 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.298253 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m12:07:31.302885 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.303506 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.303691 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m12:07:31.303847 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:07:31.306799 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m12:07:31.307021 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.307242 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m12:07:31.311571 [debug] [Thread-2 (]: SQL status: SELECT 450 in 0.004 seconds
[0m12:07:31.312910 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.313068 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m12:07:31.313350 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m12:07:31.313872 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m12:07:31.314032 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.314169 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m12:07:31.314674 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m12:07:31.315777 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m12:07:31.316950 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m12:07:31.317112 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m12:07:31.317359 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.000 seconds
[0m12:07:31.317917 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m12:07:31.318199 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4bef3c36-1dcf-4282-b046-080ff879a67d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97dbb050>]}
[0m12:07:31.318498 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 450[0m in 0.02s]
[0m12:07:31.318832 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m12:07:31.319639 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.319835 [debug] [MainThread]: On master: BEGIN
[0m12:07:31.319988 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:07:31.323165 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:07:31.323422 [debug] [MainThread]: On master: COMMIT
[0m12:07:31.323602 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:31.323766 [debug] [MainThread]: On master: COMMIT
[0m12:07:31.323985 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:07:31.324157 [debug] [MainThread]: On master: Close
[0m12:07:31.324388 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:07:31.324538 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m12:07:31.324684 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m12:07:31.324827 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m12:07:31.324989 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m12:07:31.325234 [info ] [MainThread]: 
[0m12:07:31.325454 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m12:07:31.326019 [debug] [MainThread]: Command end result
[0m12:07:31.339159 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:07:31.340094 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:07:31.342831 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m12:07:31.342999 [info ] [MainThread]: 
[0m12:07:31.343203 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:07:31.343485 [info ] [MainThread]: 
[0m12:07:31.343783 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m12:07:31.344163 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 3 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m12:07:31.344737 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.65732694, "process_in_blocks": "0", "process_kernel_time": 0.132596, "process_mem_max_rss": "135200", "process_out_blocks": "3134", "process_user_time": 1.236563}
[0m12:07:31.344949 [debug] [MainThread]: Command `dbt run` succeeded at 12:07:31.344916 after 0.66 seconds
[0m12:07:31.345148 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6a03650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab72cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab6ef3d0>]}
[0m12:07:31.345355 [debug] [MainThread]: Flushing usage events
[0m12:07:31.783679 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m12:07:38.425964 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa68f1f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa68f3810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa68f1650>]}


============================== 12:07:38.428726 | 80dd2ca8-6f32-4f0f-a358-70fd9323587d ==============================
[0m12:07:38.428726 [info ] [MainThread]: Running with dbt=1.11.3
[0m12:07:38.429080 [debug] [MainThread]: running dbt with arguments {'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'version_check': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'static_parser': 'True', 'debug': 'False', 'partial_parse': 'True', 'no_print': 'None', 'write_json': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'quiet': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'warn_error': 'None', 'log_format': 'default', 'target_path': 'None', 'invocation_command': 'dbt test --profiles-dir .', 'fail_fast': 'False', 'use_colors': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m12:07:38.489130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5ee9010>]}
[0m12:07:38.508534 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9326e90>]}
[0m12:07:38.508927 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m12:07:38.532352 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m12:07:38.575618 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m12:07:38.575911 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m12:07:38.576084 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m12:07:38.592069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5e771d0>]}
[0m12:07:38.625231 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:07:38.626089 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:07:38.637598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa58fb750>]}
[0m12:07:38.637923 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m12:07:38.638138 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5a67b90>]}
[0m12:07:38.639225 [info ] [MainThread]: 
[0m12:07:38.639416 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m12:07:38.639651 [info ] [MainThread]: 
[0m12:07:38.639993 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m12:07:38.641653 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m12:07:38.641934 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m12:07:38.670819 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m12:07:38.680597 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:07:38.680767 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:07:38.680905 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:07:38.681089 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m12:07:38.681318 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m12:07:38.681548 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m12:07:38.681750 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:38.681954 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:38.682144 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m12:07:38.686611 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m12:07:38.686794 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m12:07:38.686960 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m12:07:38.687148 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m12:07:38.687392 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m12:07:38.687594 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m12:07:38.687795 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m12:07:38.688019 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m12:07:38.688244 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m12:07:38.690833 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m12:07:38.690984 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m12:07:38.691115 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m12:07:38.691704 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m12:07:38.692264 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m12:07:38.692757 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m12:07:38.693079 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m12:07:38.693270 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m12:07:38.693461 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m12:07:38.696344 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.696621 [debug] [MainThread]: On master: BEGIN
[0m12:07:38.696806 [debug] [MainThread]: Opening a new connection, currently in state init
[0m12:07:38.699631 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:07:38.699883 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.700082 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m12:07:38.709414 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m12:07:38.709977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '80dd2ca8-6f32-4f0f-a358-70fd9323587d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7ce4390>]}
[0m12:07:38.710242 [debug] [MainThread]: On master: ROLLBACK
[0m12:07:38.710480 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.710634 [debug] [MainThread]: On master: BEGIN
[0m12:07:38.710904 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m12:07:38.711136 [debug] [MainThread]: On master: COMMIT
[0m12:07:38.711343 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.711502 [debug] [MainThread]: On master: COMMIT
[0m12:07:38.711694 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:07:38.711871 [debug] [MainThread]: On master: Close
[0m12:07:38.714009 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m12:07:38.714224 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m12:07:38.714477 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m12:07:38.714664 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m12:07:38.714825 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m12:07:38.715150 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m12:07:38.715454 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m12:07:38.715735 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m12:07:38.716064 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m12:07:38.716339 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m12:07:38.716589 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m12:07:38.716855 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m12:07:38.717093 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m12:07:38.717354 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m12:07:38.717601 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m12:07:38.717854 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m12:07:38.724537 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m12:07:38.728254 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m12:07:38.729719 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m12:07:38.731237 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m12:07:38.732440 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m12:07:38.732833 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m12:07:38.738820 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m12:07:38.739004 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m12:07:38.739954 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m12:07:38.740100 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m12:07:38.740987 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m12:07:38.742506 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m12:07:38.742967 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m12:07:38.743152 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m12:07:38.743499 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m12:07:38.743705 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m12:07:38.743903 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m12:07:38.744186 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m12:07:38.744351 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:38.744574 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m12:07:38.744743 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:07:38.744922 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m12:07:38.745229 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:07:38.745625 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m12:07:38.749035 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.749225 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.749391 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m12:07:38.749550 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.749720 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m12:07:38.749918 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m12:07:38.750097 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m12:07:38.750285 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m12:07:38.750470 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.750687 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.750901 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m12:07:38.751120 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.751833 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m12:07:38.751992 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.753804 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m12:07:38.753987 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:07:38.754175 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m12:07:38.754790 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m12:07:38.755466 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m12:07:38.755615 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m12:07:38.756121 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m12:07:38.756373 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m12:07:38.756570 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m12:07:38.756849 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m12:07:38.757240 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m12:07:38.757498 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m12:07:38.757846 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m12:07:38.758163 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m12:07:38.758526 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m12:07:38.758835 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m12:07:38.759132 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m12:07:38.759403 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m12:07:38.759717 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m12:07:38.759941 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m12:07:38.760258 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m12:07:38.760513 [info ] [Thread-3 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m12:07:38.760880 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m12:07:38.761178 [info ] [Thread-2 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m12:07:38.761486 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m12:07:38.761801 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m12:07:38.762075 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m12:07:38.762435 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m12:07:38.762676 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m12:07:38.762911 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m12:07:38.763143 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m12:07:38.763353 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m12:07:38.763570 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m12:07:38.765352 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m12:07:38.765600 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m12:07:38.767046 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m12:07:38.768554 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m12:07:38.771040 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m12:07:38.771441 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m12:07:38.771940 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m12:07:38.773042 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m12:07:38.773184 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m12:07:38.774127 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m12:07:38.774263 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m12:07:38.775364 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m12:07:38.775620 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m12:07:38.776694 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m12:07:38.777160 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m12:07:38.777387 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m12:07:38.777614 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m12:07:38.777846 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m12:07:38.778098 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:07:38.778260 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m12:07:38.778439 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m12:07:38.778644 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:07:38.778957 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m12:07:38.779451 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:38.779143 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:07:38.782281 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.782522 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.782675 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m12:07:38.782925 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m12:07:38.783215 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.783392 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.783542 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.783682 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.784007 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m12:07:38.784253 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m12:07:38.784409 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.000 seconds
[0m12:07:38.784698 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.784931 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.785117 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.785890 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m12:07:38.787300 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m12:07:38.787487 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.787751 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m12:07:38.787916 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m12:07:38.788066 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m12:07:38.788593 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m12:07:38.788959 [info ] [Thread-2 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m12:07:38.789387 [info ] [Thread-3 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m12:07:38.790108 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m12:07:38.790446 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m12:07:38.790677 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m12:07:38.790923 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m12:07:38.791192 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m12:07:38.791437 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m12:07:38.791692 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m12:07:38.791943 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m12:07:38.792297 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m12:07:38.792564 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m12:07:38.792778 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m12:07:38.793017 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m12:07:38.793351 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m12:07:38.793604 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m12:07:38.793874 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m12:07:38.794078 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m12:07:38.794288 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m12:07:38.794555 [info ] [Thread-1 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m12:07:38.794821 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m12:07:38.795010 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m12:07:38.795215 [info ] [Thread-4 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m12:07:38.795491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m12:07:38.797398 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m12:07:38.798921 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m12:07:38.799170 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m12:07:38.799424 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m12:07:38.800000 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m12:07:38.800358 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m12:07:38.801792 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m12:07:38.801930 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m12:07:38.804154 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m12:07:38.805089 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m12:07:38.806118 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m12:07:38.806409 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m12:07:38.806846 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m12:07:38.807135 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m12:07:38.808792 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m12:07:38.809805 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m12:07:38.809985 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m12:07:38.810143 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m12:07:38.810575 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m12:07:38.810837 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m12:07:38.810967 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m12:07:38.811154 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m12:07:38.811351 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:07:38.811590 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m12:07:38.811931 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m12:07:38.812254 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m12:07:38.812817 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m12:07:38.815471 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.815640 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m12:07:38.815871 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m12:07:38.816120 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m12:07:38.816286 [debug] [Thread-4 (]: SQL status: BEGIN in 0.003 seconds
[0m12:07:38.816514 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.816705 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m12:07:38.816897 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.817104 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m12:07:38.817381 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m12:07:38.817677 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m12:07:38.817902 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m12:07:38.818259 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.818424 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.819092 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m12:07:38.819256 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.819400 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.819897 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m12:07:38.820149 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m12:07:38.820631 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m12:07:38.821160 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m12:07:38.821472 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m12:07:38.821721 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m12:07:38.822119 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m12:07:38.822429 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m12:07:38.822678 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m12:07:38.822983 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m12:07:38.823296 [info ] [Thread-4 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.02s]
[0m12:07:38.823676 [info ] [Thread-1 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m12:07:38.824048 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m12:07:38.824301 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m12:07:38.824587 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m12:07:38.824868 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m12:07:38.825228 [info ] [Thread-3 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m12:07:38.825760 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m12:07:38.825951 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m12:07:38.827701 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m12:07:38.828174 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m12:07:38.829090 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m12:07:38.829549 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m12:07:38.829708 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m12:07:38.829853 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m12:07:38.832784 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m12:07:38.833006 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m12:07:38.833175 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m12:07:38.834634 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m12:07:38.835201 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m12:07:38.835389 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m12:07:38.835647 [info ] [Thread-3 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m12:07:38.835973 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m12:07:38.836698 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.836894 [debug] [MainThread]: On master: BEGIN
[0m12:07:38.837044 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m12:07:38.839848 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m12:07:38.840087 [debug] [MainThread]: On master: COMMIT
[0m12:07:38.840310 [debug] [MainThread]: Using postgres connection "master"
[0m12:07:38.840495 [debug] [MainThread]: On master: COMMIT
[0m12:07:38.840722 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m12:07:38.840897 [debug] [MainThread]: On master: Close
[0m12:07:38.841089 [debug] [MainThread]: Connection 'master' was properly closed.
[0m12:07:38.841259 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m12:07:38.841418 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m12:07:38.841576 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59' was properly closed.
[0m12:07:38.841742 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m12:07:38.841928 [info ] [MainThread]: 
[0m12:07:38.842153 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m12:07:38.842950 [debug] [MainThread]: Command end result
[0m12:07:38.856101 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m12:07:38.857020 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m12:07:38.859870 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m12:07:38.860054 [info ] [MainThread]: 
[0m12:07:38.860284 [info ] [MainThread]: [32mCompleted successfully[0m
[0m12:07:38.860534 [info ] [MainThread]: 
[0m12:07:38.860786 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m12:07:38.861321 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.4536637, "process_in_blocks": "0", "process_kernel_time": 0.099197, "process_mem_max_rss": "129804", "process_out_blocks": "2158", "process_user_time": 1.050679}
[0m12:07:38.861617 [debug] [MainThread]: Command `dbt test` succeeded at 12:07:38.861576 after 0.45 seconds
[0m12:07:38.861841 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab5b3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa69140d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab79cb10>]}
[0m12:07:38.862033 [debug] [MainThread]: Flushing usage events
[0m12:07:39.239726 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:53:05.681745 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8951a210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8951a490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89519310>]}


============================== 19:53:05.684909 | 5e52b5bc-b5c9-4fbf-b3dd-444742296900 ==============================
[0m19:53:05.684909 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:53:05.685188 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt run', 'introspect': 'True', 'target_path': 'None', 'use_colors': 'True', 'write_json': 'True', 'fail_fast': 'False', 'empty': 'False', 'static_parser': 'True', 'no_print': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'printer_width': '80', 'log_format': 'default', 'cache_selected_only': 'False', 'version_check': 'True', 'debug': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_cache_events': 'False'}
[0m19:53:05.751466 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88981050>]}
[0m19:53:05.774524 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bfc3090>]}
[0m19:53:05.775087 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:53:05.805543 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:53:05.853605 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 2 files changed.
[0m19:53:05.854029 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_campaign_daily.sql
[0m19:53:05.854277 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_crm_orders.sql
[0m19:53:06.021732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b1a7b10>]}
[0m19:53:06.056301 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:53:06.057374 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:53:06.066943 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88737d50>]}
[0m19:53:06.067311 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:53:06.067525 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88a99ad0>]}
[0m19:53:06.068500 [info ] [MainThread]: 
[0m19:53:06.068722 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:53:06.068874 [info ] [MainThread]: 
[0m19:53:06.069149 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:53:06.070898 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:06.071169 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:06.075364 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:06.085538 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:06.085756 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:06.085923 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:06.086133 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:06.086358 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:06.086579 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:06.086794 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:06.086994 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:06.087195 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:06.092210 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:53:06.092408 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:53:06.092541 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:53:06.093139 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:06.093634 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:06.094135 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:06.095698 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:53:06.096048 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:53:06.098418 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:53:06.098612 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:53:06.099511 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:53:06.099718 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:53:06.100577 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:53:06.100791 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:53:06.100987 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:06.101196 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:53:06.101396 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:06.101738 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:06.105636 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:53:06.105825 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:53:06.105973 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:53:06.106154 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:53:06.106411 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:53:06.106623 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:53:06.106821 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:53:06.107094 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:53:06.107335 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:53:06.112387 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.005 seconds
[0m19:53:06.112607 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.005 seconds
[0m19:53:06.112762 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.005 seconds
[0m19:53:06.113493 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:53:06.114003 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:53:06.114471 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:53:06.114721 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:53:06.114909 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:53:06.115101 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:53:06.118025 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.118268 [debug] [MainThread]: On master: BEGIN
[0m19:53:06.118456 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:53:06.121437 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:53:06.121656 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.121916 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:53:06.133785 [debug] [MainThread]: SQL status: SELECT 3 in 0.012 seconds
[0m19:53:06.134368 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8671edd0>]}
[0m19:53:06.134633 [debug] [MainThread]: On master: ROLLBACK
[0m19:53:06.134848 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.135008 [debug] [MainThread]: On master: BEGIN
[0m19:53:06.135259 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:53:06.135469 [debug] [MainThread]: On master: COMMIT
[0m19:53:06.135671 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.135856 [debug] [MainThread]: On master: COMMIT
[0m19:53:06.136098 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:53:06.136304 [debug] [MainThread]: On master: Close
[0m19:53:06.138351 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:06.138528 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:06.138706 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:06.138969 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:53:06.139346 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:53:06.139656 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:53:06.139919 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:53:06.140175 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:53:06.140415 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:53:06.140616 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:06.140840 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:06.141116 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:06.144543 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.145629 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.146706 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.147717 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:06.147909 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:06.148060 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:06.160505 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.162371 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.163772 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.164955 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.165181 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.165381 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.165538 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:53:06.165754 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:53:06.166001 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:53:06.166230 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:53:06.166443 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:06.166654 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:53:06.170420 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:53:06.170614 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:53:06.170831 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m19:53:06.171010 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.171274 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.171523 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.171723 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:53:06.171969 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:53:06.172211 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:53:06.182255 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.009 seconds
[0m19:53:06.182458 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m19:53:06.185064 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.185248 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.013 seconds
[0m19:53:06.186369 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.186581 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:53:06.188357 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.188541 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:53:06.188844 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:53:06.189408 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:53:06.189586 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:06.189742 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:06.190764 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.191894 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.193012 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.193222 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:53:06.193397 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:53:06.193592 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:53:06.193978 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:06.199806 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:53:06.199986 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:53:06.200146 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:53:06.200354 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.200907 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:53:06.201514 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:53:06.201728 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:53:06.201922 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.202121 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.202425 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:53:06.202698 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:53:06.202857 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m19:53:06.205473 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:53:06.205643 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m19:53:06.205789 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:53:06.207708 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:06.208641 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:53:06.209553 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:53:06.209775 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:53:06.210092 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:06.210441 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:06.210736 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:53:06.210967 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:53:06.212740 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:53:06.212900 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:53:06.213046 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:53:06.214015 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:53:06.214488 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:53:06.214964 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:53:06.215817 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff884a1090>]}
[0m19:53:06.216101 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff867c1a50>]}
[0m19:53:06.216473 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff887cc6d0>]}
[0m19:53:06.216880 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m19:53:06.217332 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m19:53:06.217681 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.08s]
[0m19:53:06.218062 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:06.218312 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:06.218585 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:06.219033 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:53:06.219477 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:53:06.219736 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:53:06.220014 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:53:06.220332 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:53:06.220582 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:53:06.220785 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:53:06.220979 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:53:06.223268 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:53:06.224779 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:53:06.225679 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:53:06.225837 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:53:06.240961 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:53:06.242479 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:53:06.242706 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195306235945"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:53:06.242967 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195306241907"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m19:53:06.243244 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:53:06.243487 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:06.247307 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "where"
LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
         ^

[0m19:53:06.247675 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:53:06.248685 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m19:53:06.250015 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:53:06.250283 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:53:06.250559 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff844950d0>]}
[0m19:53:06.251843 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:53:06.252118 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.03s]
[0m19:53:06.252419 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5e52b5bc-b5c9-4fbf-b3dd-444742296900', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84644c10>]}
[0m19:53:06.252674 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:53:06.252963 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:53:06.253262 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^.
[0m19:53:06.253546 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:53:06.254132 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m19:53:06.254577 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:53:06.254819 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:53:06.255062 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:53:06.255837 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.256050 [debug] [MainThread]: On master: BEGIN
[0m19:53:06.256218 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:53:06.258900 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:53:06.259116 [debug] [MainThread]: On master: COMMIT
[0m19:53:06.259313 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:06.259461 [debug] [MainThread]: On master: COMMIT
[0m19:53:06.259678 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:53:06.259841 [debug] [MainThread]: On master: Close
[0m19:53:06.260050 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:53:06.260240 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:53:06.260394 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:53:06.260550 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:53:06.260732 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:53:06.260945 [info ] [MainThread]: 
[0m19:53:06.261151 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.19 seconds (0.19s).
[0m19:53:06.261620 [debug] [MainThread]: Command end result
[0m19:53:06.274120 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:53:06.275095 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:53:06.278066 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:53:06.278279 [info ] [MainThread]: 
[0m19:53:06.278503 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:53:06.278680 [info ] [MainThread]: 
[0m19:53:06.278896 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m19:53:06.279070 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:53:06.279273 [info ] [MainThread]: 
[0m19:53:06.279438 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m19:53:06.279584 [info ] [MainThread]: 
[0m19:53:06.279751 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:53:06.279914 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:53:06.280048 [info ] [MainThread]: 
[0m19:53:06.280215 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:53:06.280383 [info ] [MainThread]: 
[0m19:53:06.280568 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=6
[0m19:53:06.281066 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.6204362, "process_in_blocks": "0", "process_kernel_time": 0.10593, "process_mem_max_rss": "134108", "process_out_blocks": "4300", "process_user_time": 1.206603}
[0m19:53:06.281301 [debug] [MainThread]: Command `dbt run` failed at 19:53:06.281263 after 0.62 seconds
[0m19:53:06.281505 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89519210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8951acd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88b13110>]}
[0m19:53:06.281684 [debug] [MainThread]: Flushing usage events
[0m19:53:06.773200 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:53:58.589407 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff814dd350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff814dd650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff814dc9d0>]}


============================== 19:53:58.592561 | dcae57dc-58fa-4d83-a736-3ea15a4ab37f ==============================
[0m19:53:58.592561 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:53:58.592917 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'partial_parse': 'True', 'warn_error': 'None', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'log_cache_events': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'version_check': 'True', 'target_path': 'None', 'indirect_selection': 'eager', 'log_path': '/opt/bluealpha/dbt_project/logs', 'quiet': 'False', 'static_parser': 'True', 'debug': 'False', 'write_json': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'no_print': 'None', 'empty': 'False', 'use_colors': 'True', 'printer_width': '80', 'fail_fast': 'False', 'log_format': 'default'}
[0m19:53:58.660171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80a52710>]}
[0m19:53:58.680192 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83f171d0>]}
[0m19:53:58.680612 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:53:58.706990 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:53:58.755157 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:53:58.755460 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:53:58.755660 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:53:58.772867 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff807e1790>]}
[0m19:53:58.810358 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:53:58.811510 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:53:58.820274 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80af6b90>]}
[0m19:53:58.820613 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:53:58.820872 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81543ad0>]}
[0m19:53:58.821833 [info ] [MainThread]: 
[0m19:53:58.822076 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:53:58.822325 [info ] [MainThread]: 
[0m19:53:58.822647 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:53:58.824514 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:58.824778 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:58.829389 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:53:58.863627 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:58.863825 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:58.863968 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:53:58.864198 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:58.864421 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:58.864636 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:53:58.864840 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:58.865039 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:58.865252 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:53:58.871746 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.007 seconds
[0m19:53:58.871938 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.007 seconds
[0m19:53:58.872516 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:58.872663 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.007 seconds
[0m19:53:58.873124 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:58.873997 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:53:58.875361 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:53:58.875671 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:53:58.875906 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:53:58.878290 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:53:58.879146 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:53:58.879960 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:53:58.880194 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:53:58.880417 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:53:58.880623 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:53:58.880824 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:58.881022 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:58.881215 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:53:58.885311 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:53:58.885510 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:53:58.885642 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:53:58.885842 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:53:58.886050 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:53:58.886288 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:53:58.886520 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:53:58.886772 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:53:58.887005 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:53:58.889696 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m19:53:58.889853 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m19:53:58.889974 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m19:53:58.890605 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:53:58.891136 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:53:58.891735 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:53:58.892054 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:53:58.892254 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:53:58.892471 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:53:58.895654 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:58.895850 [debug] [MainThread]: On master: BEGIN
[0m19:53:58.895999 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:53:58.899188 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:53:58.899407 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:58.899614 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:53:58.909487 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m19:53:58.910332 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff807203d0>]}
[0m19:53:58.910693 [debug] [MainThread]: On master: ROLLBACK
[0m19:53:58.911071 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:58.911308 [debug] [MainThread]: On master: BEGIN
[0m19:53:58.911954 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:53:58.912229 [debug] [MainThread]: On master: COMMIT
[0m19:53:58.912452 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:58.912639 [debug] [MainThread]: On master: COMMIT
[0m19:53:58.912917 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:53:58.913174 [debug] [MainThread]: On master: Close
[0m19:53:58.915543 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:58.915766 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:58.915945 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:58.916324 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:53:58.916680 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:53:58.917073 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:53:58.917445 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:53:58.917701 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:53:58.917959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:53:58.918201 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:58.918427 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:58.918643 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:58.921863 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.923157 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.924288 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.925111 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:58.925396 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:58.938758 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.938976 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:58.940453 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.942074 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.942524 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.942856 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:53:58.943056 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.943290 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:58.943453 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.943683 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:53:58.944024 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:53:58.944319 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:53:58.944550 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:53:58.947397 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:53:58.947668 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.947830 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:53:58.948065 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:53:58.948270 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:53:58.948472 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.948812 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.949067 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:53:58.949348 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:53:58.951901 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:53:58.952060 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:53:58.954690 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.954841 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:53:58.955974 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.956210 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:53:58.957414 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.957639 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:53:58.957994 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:53:58.958179 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:58.959562 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.959713 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:53:58.959853 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:53:58.960043 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:53:58.961315 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.962445 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.962751 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:53:58.962912 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:58.963094 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:53:58.969362 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:53:58.969576 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:53:58.969902 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.970045 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:53:58.970717 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:53:58.970956 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:53:58.971560 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:53:58.971785 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.972151 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.972881 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:53:58.973072 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:53:58.973279 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:53:58.976614 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:53:58.976774 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m19:53:58.978805 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:53:58.978966 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m19:53:58.979861 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:53:58.980077 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:53:58.980959 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:53:58.981336 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:53:58.981771 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:53:58.981997 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:53:58.982391 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:53:58.982544 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:53:58.983759 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:53:58.983928 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:53:58.984080 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:53:58.985251 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:53:58.985458 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff807e1550>]}
[0m19:53:58.985974 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:53:58.986288 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8ff710>]}
[0m19:53:58.986650 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:53:58.987024 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff804153d0>]}
[0m19:53:58.987426 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:53:58.987861 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:53:58.988218 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:53:58.988527 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:53:58.988910 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:53:58.989178 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:53:58.989565 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:53:58.989954 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:53:58.990211 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:53:58.990469 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:53:58.990792 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:53:58.991047 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:53:58.994589 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:53:58.994822 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:53:58.996750 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:53:58.997106 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:53:59.011638 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:53:59.011861 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:53:59.012062 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195359006705"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:53:59.013532 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:53:59.013737 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:53:59.013944 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195359012976"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m19:53:59.014275 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:53:59.017351 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "where"
LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
         ^

[0m19:53:59.017688 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:53:59.017878 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m19:53:59.018783 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:53:59.021274 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:53:59.021847 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:53:59.022112 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8c1ed0>]}
[0m19:53:59.022415 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'dcae57dc-58fa-4d83-a736-3ea15a4ab37f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c789f50>]}
[0m19:53:59.022765 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.03s]
[0m19:53:59.023193 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:53:59.023565 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:53:59.023841 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:53:59.024220 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^.
[0m19:53:59.024969 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m19:53:59.025491 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:53:59.025739 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:53:59.026059 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:53:59.026940 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:59.027121 [debug] [MainThread]: On master: BEGIN
[0m19:53:59.027280 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:53:59.030393 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:53:59.030599 [debug] [MainThread]: On master: COMMIT
[0m19:53:59.030785 [debug] [MainThread]: Using postgres connection "master"
[0m19:53:59.030974 [debug] [MainThread]: On master: COMMIT
[0m19:53:59.031227 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:53:59.031437 [debug] [MainThread]: On master: Close
[0m19:53:59.031666 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:53:59.031903 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:53:59.032096 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:53:59.032320 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:53:59.032551 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:53:59.032781 [info ] [MainThread]: 
[0m19:53:59.032999 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m19:53:59.033506 [debug] [MainThread]: Command end result
[0m19:53:59.048224 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:53:59.049202 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:53:59.051853 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:53:59.052041 [info ] [MainThread]: 
[0m19:53:59.052276 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:53:59.052532 [info ] [MainThread]: 
[0m19:53:59.052777 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m19:53:59.053006 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:53:59.053225 [info ] [MainThread]: 
[0m19:53:59.053493 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m19:53:59.053700 [info ] [MainThread]: 
[0m19:53:59.053942 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:53:59.054196 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:53:59.054415 [info ] [MainThread]: 
[0m19:53:59.054656 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:53:59.054874 [info ] [MainThread]: 
[0m19:53:59.055105 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=6
[0m19:53:59.055695 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.4864708, "process_in_blocks": "0", "process_kernel_time": 0.145551, "process_mem_max_rss": "129804", "process_out_blocks": "2147", "process_user_time": 1.089615}
[0m19:53:59.055965 [debug] [MainThread]: Command `dbt run` failed at 19:53:59.055920 after 0.49 seconds
[0m19:53:59.056208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8638cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e8f34d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82d51150>]}
[0m19:53:59.056416 [debug] [MainThread]: Flushing usage events
[0m19:53:59.520963 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:54:02.948233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f711710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f711890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f710d90>]}


============================== 19:54:02.951104 | 7f49606c-4ad9-471d-a907-d7ed736aab9d ==============================
[0m19:54:02.951104 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:54:02.951531 [debug] [MainThread]: running dbt with arguments {'log_path': '/opt/bluealpha/dbt_project/logs', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'debug': 'False', 'target_path': 'None', 'fail_fast': 'False', 'log_format': 'default', 'version_check': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'invocation_command': 'dbt run', 'printer_width': '80', 'cache_selected_only': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'empty': 'False', 'quiet': 'False', 'warn_error': 'None', 'use_experimental_parser': 'False', 'use_colors': 'True', 'partial_parse': 'True'}
[0m19:54:03.015658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80412a10>]}
[0m19:54:03.035627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82147510>]}
[0m19:54:03.036026 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:54:03.060930 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:54:03.108474 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:54:03.108778 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:54:03.108989 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:54:03.126207 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e870750>]}
[0m19:54:03.161600 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:54:03.162478 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:54:03.170779 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f773410>]}
[0m19:54:03.171118 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:54:03.171337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80bad850>]}
[0m19:54:03.172318 [info ] [MainThread]: 
[0m19:54:03.172677 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:54:03.172946 [info ] [MainThread]: 
[0m19:54:03.173272 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:54:03.175262 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:54:03.175581 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:54:03.180425 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:54:03.216174 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:54:03.216383 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:54:03.216536 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:54:03.216794 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:54:03.217044 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:54:03.217267 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:54:03.217491 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:54:03.217744 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:54:03.217948 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:54:03.223438 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:54:03.223614 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:54:03.223749 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:54:03.224345 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:54:03.224885 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:54:03.225476 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:54:03.227142 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:54:03.227442 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:54:03.227873 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:54:03.230375 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:54:03.231432 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:54:03.232619 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:54:03.232975 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:54:03.233290 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:54:03.233551 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:54:03.233757 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:54:03.233985 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:54:03.234196 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:54:03.238834 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:54:03.239095 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:54:03.239351 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:54:03.239620 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:54:03.239903 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:54:03.240190 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:54:03.240453 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:54:03.240718 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:54:03.240994 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:54:03.244255 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m19:54:03.244557 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m19:54:03.244806 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m19:54:03.245584 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:54:03.246264 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:54:03.246875 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:54:03.247327 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:54:03.247626 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:54:03.248019 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:54:03.251535 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.251834 [debug] [MainThread]: On master: BEGIN
[0m19:54:03.252056 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:54:03.257283 [debug] [MainThread]: SQL status: BEGIN in 0.005 seconds
[0m19:54:03.257615 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.257901 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:54:03.267775 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m19:54:03.268409 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e64d710>]}
[0m19:54:03.268679 [debug] [MainThread]: On master: ROLLBACK
[0m19:54:03.268935 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.269126 [debug] [MainThread]: On master: BEGIN
[0m19:54:03.269478 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:54:03.269672 [debug] [MainThread]: On master: COMMIT
[0m19:54:03.269846 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.270005 [debug] [MainThread]: On master: COMMIT
[0m19:54:03.270230 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:54:03.270441 [debug] [MainThread]: On master: Close
[0m19:54:03.272568 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:54:03.272755 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:54:03.272925 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:54:03.273204 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:54:03.273570 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:54:03.273894 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:54:03.274194 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:54:03.274462 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:54:03.274693 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:54:03.274943 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:54:03.275196 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:54:03.275455 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:54:03.278412 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.279505 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.280558 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.281349 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:54:03.281656 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:54:03.294833 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.296149 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.296345 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:54:03.296925 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.298207 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.298448 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.299016 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:54:03.298651 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:54:03.299229 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:54:03.299444 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.299637 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:54:03.299993 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:54:03.300404 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:54:03.303377 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:54:03.303605 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:54:03.303887 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.304120 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.304288 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:54:03.304490 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:54:03.304755 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:54:03.304996 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.305888 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:54:03.308486 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:54:03.308712 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:54:03.308917 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:54:03.311890 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.313147 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.314336 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.314557 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:54:03.314791 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:54:03.315012 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:54:03.315580 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.315739 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.315909 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.316957 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.318057 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.319127 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.319350 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:54:03.319594 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:54:03.319827 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:54:03.320260 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.320546 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.320709 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:54:03.326334 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:54:03.326993 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:54:03.327596 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:54:03.327798 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.328044 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.328275 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.328464 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:54:03.328691 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:54:03.328943 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:54:03.329599 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m19:54:03.332997 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:54:03.333229 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m19:54:03.333456 [debug] [Thread-3 (]: SQL status: COMMIT in 0.004 seconds
[0m19:54:03.335249 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:54:03.336655 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:54:03.337751 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:54:03.337971 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:54:03.338372 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:54:03.338759 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:54:03.339105 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:54:03.339345 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:54:03.339745 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:54:03.340950 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:54:03.341120 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:54:03.341307 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:54:03.342027 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c2020d0>]}
[0m19:54:03.342589 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:54:03.343134 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:54:03.343485 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:54:03.343844 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c21add0>]}
[0m19:54:03.344133 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e64d8d0>]}
[0m19:54:03.344403 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:54:03.344746 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:54:03.345157 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:54:03.345612 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:54:03.345892 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:54:03.346274 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:54:03.346673 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:54:03.346903 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:54:03.347251 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:54:03.347602 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:54:03.347848 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:54:03.348058 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:54:03.348279 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:54:03.351881 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:54:03.353666 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:54:03.354370 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:54:03.354617 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:54:03.368794 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:54:03.370310 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:54:03.370563 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195403363666"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:54:03.370808 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195403369737"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m19:54:03.371102 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:54:03.371326 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:54:03.375305 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "where"
LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
         ^

[0m19:54:03.375695 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:54:03.375919 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m19:54:03.377128 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:54:03.379347 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:54:03.379932 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:54:03.380257 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c2180d0>]}
[0m19:54:03.380531 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7f49606c-4ad9-471d-a907-d7ed736aab9d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e631390>]}
[0m19:54:03.380900 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:54:03.381259 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.03s]
[0m19:54:03.381590 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:54:03.381840 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:54:03.382169 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m19:54:03.382743 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^.
[0m19:54:03.383139 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:54:03.383432 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:54:03.383688 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:54:03.384515 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.384707 [debug] [MainThread]: On master: BEGIN
[0m19:54:03.384898 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:54:03.387994 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:54:03.388210 [debug] [MainThread]: On master: COMMIT
[0m19:54:03.388403 [debug] [MainThread]: Using postgres connection "master"
[0m19:54:03.388570 [debug] [MainThread]: On master: COMMIT
[0m19:54:03.388803 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:54:03.389011 [debug] [MainThread]: On master: Close
[0m19:54:03.389257 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:54:03.389453 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:54:03.389616 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:54:03.389753 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:54:03.389903 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:54:03.390142 [info ] [MainThread]: 
[0m19:54:03.390371 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m19:54:03.390868 [debug] [MainThread]: Command end result
[0m19:54:03.404000 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:54:03.404893 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:54:03.407683 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:54:03.407868 [info ] [MainThread]: 
[0m19:54:03.408066 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:54:03.408241 [info ] [MainThread]: 
[0m19:54:03.408430 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:54:03.408633 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:54:03.408813 [info ] [MainThread]: 
[0m19:54:03.408988 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:54:03.409139 [info ] [MainThread]: 
[0m19:54:03.409326 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m19:54:03.409506 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:54:03.409647 [info ] [MainThread]: 
[0m19:54:03.409803 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m19:54:03.409945 [info ] [MainThread]: 
[0m19:54:03.410106 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=6
[0m19:54:03.410640 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.48188138, "process_in_blocks": "0", "process_kernel_time": 0.096338, "process_mem_max_rss": "130172", "process_out_blocks": "2147", "process_user_time": 1.07478}
[0m19:54:03.410884 [debug] [MainThread]: Command `dbt run` failed at 19:54:03.410850 after 0.48 seconds
[0m19:54:03.411069 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f9437d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e880dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f727590>]}
[0m19:54:03.411251 [debug] [MainThread]: Flushing usage events
[0m19:54:03.844759 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:55:08.699265 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa33aa090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3399310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa33a9d50>]}


============================== 19:55:08.702448 | e3e4e8bf-8c36-4658-b98d-e86159a5110c ==============================
[0m19:55:08.702448 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:55:08.702814 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'version_check': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'use_experimental_parser': 'False', 'no_print': 'None', 'printer_width': '80', 'debug': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'log_format': 'default', 'target_path': 'None', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'log_cache_events': 'False', 'warn_error': 'None', 'quiet': 'False', 'write_json': 'True', 'indirect_selection': 'eager', 'empty': 'False', 'invocation_command': 'dbt run', 'static_parser': 'True', 'profiles_dir': '/opt/bluealpha/dbt_project'}
[0m19:55:08.778807 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2861d10>]}
[0m19:55:08.798317 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5e77290>]}
[0m19:55:08.798712 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:55:08.824450 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:55:08.870365 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:55:08.870650 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:55:08.870858 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:55:08.887320 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2518d10>]}
[0m19:55:08.920878 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:55:08.921665 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:55:08.930234 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa299ce10>]}
[0m19:55:08.930531 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:55:08.930750 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa25c9d10>]}
[0m19:55:08.931742 [info ] [MainThread]: 
[0m19:55:08.931934 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:55:08.932097 [info ] [MainThread]: 
[0m19:55:08.932367 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:55:08.933977 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:55:08.934266 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:55:08.939071 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:55:08.981068 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:55:08.981267 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:55:08.981430 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:55:08.981676 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:55:08.981903 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:55:08.982129 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:55:08.982349 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:55:08.982560 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:55:08.982771 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:55:08.988527 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:55:08.988729 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:55:08.988900 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.007 seconds
[0m19:55:08.989455 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:55:08.989996 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:55:08.990533 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:55:08.991910 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:55:08.992180 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:55:08.992421 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:55:08.994695 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:55:08.995611 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:55:08.996434 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:55:08.996651 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:55:08.996870 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:55:08.997077 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:55:08.997249 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:55:08.997457 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:55:08.997684 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:55:09.001541 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:55:09.001867 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:55:09.002030 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:55:09.002237 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:55:09.002487 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:55:09.002621 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:55:09.002951 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:55:09.003208 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:55:09.003810 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:55:09.005012 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m19:55:09.005811 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:55:09.006005 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m19:55:09.006178 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:55:09.006411 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:55:09.006936 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:55:09.007414 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:55:09.008043 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:55:09.008233 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:55:09.011397 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.011620 [debug] [MainThread]: On master: BEGIN
[0m19:55:09.011803 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:55:09.014745 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:55:09.014958 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.015161 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:55:09.024716 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:55:09.025213 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa267fb50>]}
[0m19:55:09.025450 [debug] [MainThread]: On master: ROLLBACK
[0m19:55:09.025684 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.025841 [debug] [MainThread]: On master: BEGIN
[0m19:55:09.026115 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:55:09.026299 [debug] [MainThread]: On master: COMMIT
[0m19:55:09.026450 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.026597 [debug] [MainThread]: On master: COMMIT
[0m19:55:09.026829 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:55:09.026995 [debug] [MainThread]: On master: Close
[0m19:55:09.028953 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:55:09.029135 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:55:09.029308 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:55:09.029580 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:55:09.029920 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:55:09.030233 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:55:09.030529 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:55:09.030790 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:55:09.031028 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:55:09.031256 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:55:09.031479 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:55:09.031699 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:55:09.034556 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.035674 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.036743 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.037511 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:55:09.037821 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:55:09.051477 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.051708 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:55:09.053103 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.054664 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.055032 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.055371 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.055525 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:55:09.055757 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.055882 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:55:09.056516 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:55:09.056312 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:55:09.056068 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:55:09.056815 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:55:09.060434 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:55:09.060663 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:55:09.060823 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.060991 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:55:09.061219 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.061433 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:55:09.061681 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.061903 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:55:09.062195 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:55:09.065592 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:55:09.065781 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:55:09.065935 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:55:09.068570 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.069731 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.070908 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.071145 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:55:09.071353 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:55:09.071564 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:55:09.072058 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.072455 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.072622 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.073615 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.074693 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.075728 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.075966 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:55:09.076216 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:55:09.076432 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:55:09.076882 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.077047 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.077194 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:55:09.082782 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:55:09.083428 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:55:09.084023 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:55:09.084268 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.084462 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.084680 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.084895 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:55:09.085081 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:55:09.085307 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:55:09.086198 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m19:55:09.086396 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:55:09.086532 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m19:55:09.089504 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:55:09.090439 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:55:09.091370 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:55:09.093220 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:55:09.093569 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:55:09.093932 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:55:09.094160 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:55:09.094356 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:55:09.094557 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:55:09.095818 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:55:09.096790 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:55:09.096949 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:55:09.097101 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:55:09.097959 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0921ad0>]}
[0m19:55:09.098456 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:55:09.098946 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:55:09.099279 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:55:09.099599 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2602410>]}
[0m19:55:09.099908 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2601150>]}
[0m19:55:09.100218 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:55:09.100549 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:55:09.101105 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:55:09.101525 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:55:09.101776 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:55:09.102055 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:55:09.102326 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:55:09.102785 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:55:09.103069 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:55:09.103335 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:55:09.103555 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:55:09.103747 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:55:09.106926 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:55:09.107147 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:55:09.108786 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:55:09.109022 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:55:09.123271 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:55:09.123456 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:55:09.123654 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195509118484"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:55:09.125176 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:55:09.125381 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:55:09.125612 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195509124623"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m19:55:09.125923 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:55:09.129364 [debug] [Thread-4 (]: Postgres adapter: Postgres error: syntax error at or near "where"
LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
         ^

[0m19:55:09.129922 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m19:55:09.130157 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:55:09.130429 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:55:09.133895 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:55:09.134532 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:55:09.134824 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0797d10>]}
[0m19:55:09.135183 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e3e4e8bf-8c36-4658-b98d-e86159a5110c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa06e2d90>]}
[0m19:55:09.135538 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.03s]
[0m19:55:09.135949 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:55:09.136255 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:55:09.136556 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:55:09.136840 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^.
[0m19:55:09.137486 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m19:55:09.137912 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:55:09.138181 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:55:09.138432 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:55:09.139192 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.139396 [debug] [MainThread]: On master: BEGIN
[0m19:55:09.139559 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:55:09.142697 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:55:09.142922 [debug] [MainThread]: On master: COMMIT
[0m19:55:09.143108 [debug] [MainThread]: Using postgres connection "master"
[0m19:55:09.143305 [debug] [MainThread]: On master: COMMIT
[0m19:55:09.143539 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:55:09.143709 [debug] [MainThread]: On master: Close
[0m19:55:09.143932 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:55:09.144116 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:55:09.144295 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:55:09.144452 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:55:09.144583 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:55:09.144778 [info ] [MainThread]: 
[0m19:55:09.144982 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m19:55:09.145487 [debug] [MainThread]: Command end result
[0m19:55:09.158330 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:55:09.159117 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:55:09.161918 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:55:09.162106 [info ] [MainThread]: 
[0m19:55:09.162309 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:55:09.162496 [info ] [MainThread]: 
[0m19:55:09.162711 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m19:55:09.162888 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  syntax error at or near "where"
  LINE 32: where load_ts > (select max(load_ts) from "warehouse"."stagi...
           ^
[0m19:55:09.163033 [info ] [MainThread]: 
[0m19:55:09.163206 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m19:55:09.163352 [info ] [MainThread]: 
[0m19:55:09.163518 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:55:09.163686 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:55:09.163854 [info ] [MainThread]: 
[0m19:55:09.164052 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:55:09.164214 [info ] [MainThread]: 
[0m19:55:09.164375 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=6
[0m19:55:09.164897 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.48558375, "process_in_blocks": "0", "process_kernel_time": 0.174322, "process_mem_max_rss": "130356", "process_out_blocks": "2147", "process_user_time": 1.063966}
[0m19:55:09.165130 [debug] [MainThread]: Command `dbt run` failed at 19:55:09.165083 after 0.49 seconds
[0m19:55:09.165323 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0956390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa80704d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa339bf50>]}
[0m19:55:09.165501 [debug] [MainThread]: Flushing usage events
[0m19:55:09.682337 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:56:05.069432 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaad6010>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaad5ed0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaaad4d10>]}


============================== 19:56:05.072121 | 56bb250f-34cd-4636-8bff-796cfe17d77e ==============================
[0m19:56:05.072121 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:56:05.072431 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'use_colors': 'True', 'warn_error': 'None', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'static_parser': 'True', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'version_check': 'True', 'indirect_selection': 'eager', 'log_format': 'default', 'no_print': 'None', 'cache_selected_only': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'target_path': 'None', 'debug': 'False', 'fail_fast': 'False', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'False', 'invocation_command': 'dbt run', 'write_json': 'True', 'introspect': 'True'}
[0m19:56:05.131157 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffab64e750>]}
[0m19:56:05.150503 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffad582c10>]}
[0m19:56:05.150900 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:56:05.176071 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:56:05.223534 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:56:05.223923 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_crm_orders.sql
[0m19:56:05.383070 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9ab6350>]}
[0m19:56:05.416488 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:05.417392 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:05.425437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9bb6910>]}
[0m19:56:05.425710 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:56:05.425923 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaab35d50>]}
[0m19:56:05.426867 [info ] [MainThread]: 
[0m19:56:05.427067 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:56:05.427262 [info ] [MainThread]: 
[0m19:56:05.427548 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:56:05.429267 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:05.429557 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:05.433873 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:05.443609 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:05.443801 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:05.443944 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:05.444155 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:05.444360 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:05.444575 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:05.444782 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:05.444959 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:05.445159 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:05.450232 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:56:05.450415 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:56:05.450596 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:56:05.451206 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:05.451788 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:05.452373 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:05.453845 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:56:05.454136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:56:05.454444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:56:05.457032 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:05.458021 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:05.458932 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:05.459134 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:56:05.459376 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:56:05.459606 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:56:05.459784 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:05.459983 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:05.460183 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:05.463939 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:56:05.464190 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:56:05.464476 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:05.464667 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:56:05.464863 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:05.465055 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:56:05.465271 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:05.465481 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:56:05.465822 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:56:05.468223 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m19:56:05.468461 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m19:56:05.468663 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m19:56:05.469438 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:56:05.470141 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:56:05.470751 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:56:05.471082 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:56:05.471315 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:56:05.471594 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:56:05.475361 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.475638 [debug] [MainThread]: On master: BEGIN
[0m19:56:05.475855 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:56:05.479289 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:56:05.479563 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.479790 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:56:05.489832 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m19:56:05.490467 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9c347d0>]}
[0m19:56:05.490750 [debug] [MainThread]: On master: ROLLBACK
[0m19:56:05.491011 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.491223 [debug] [MainThread]: On master: BEGIN
[0m19:56:05.491566 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:56:05.491769 [debug] [MainThread]: On master: COMMIT
[0m19:56:05.491960 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.492140 [debug] [MainThread]: On master: COMMIT
[0m19:56:05.492400 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:05.492577 [debug] [MainThread]: On master: Close
[0m19:56:05.494614 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:05.494795 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:05.494971 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:05.495262 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:56:05.495602 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:56:05.495909 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:56:05.496206 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:56:05.496445 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:56:05.496735 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:56:05.496960 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:05.497185 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:05.497399 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:05.500376 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.502203 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.503238 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.504064 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:05.504369 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:05.516053 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.516366 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:05.517786 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.519359 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.519674 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.520121 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:56:05.520334 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.520556 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.520694 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:05.520900 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:56:05.521096 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:56:05.521450 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:05.521706 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:56:05.524405 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:05.524665 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.524960 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:56:05.525145 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m19:56:05.525306 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:05.525543 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.525814 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.526070 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:56:05.526398 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:56:05.528384 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:56:05.531212 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.531373 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:56:05.531540 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m19:56:05.531718 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:56:05.532914 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.534099 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.534384 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:56:05.534570 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:05.534755 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:56:05.535933 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.536088 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:56:05.536334 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:56:05.536486 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:05.538036 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.539183 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.539411 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:56:05.539600 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:56:05.539790 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:56:05.545272 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:56:05.545737 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.545969 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:05.546122 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:05.546266 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:56:05.546891 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:56:05.547573 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:56:05.547904 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.548398 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.548571 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:56:05.548757 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:56:05.548971 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:56:05.551105 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:56:05.553634 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:05.553801 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m19:56:05.553955 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m19:56:05.554132 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:56:05.555029 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:56:05.556028 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:56:05.556507 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:05.556891 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:05.557052 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:56:05.557232 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:56:05.557446 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:56:05.558396 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:56:05.559407 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:56:05.559572 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:56:05.559863 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa999b750>]}
[0m19:56:05.560339 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:56:05.560863 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:56:05.561180 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m19:56:05.561512 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa047390>]}
[0m19:56:05.561773 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc56250>]}
[0m19:56:05.562040 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:05.562406 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:56:05.562742 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:56:05.563177 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:56:05.563394 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:05.563697 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:05.563982 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:56:05.564452 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:56:05.564762 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:56:05.565008 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:56:05.565249 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:56:05.565462 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:56:05.568131 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:56:05.568476 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:56:05.570784 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:05.571367 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:56:05.571979 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:56:05.587194 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:05.589724 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:05.590095 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195605581724"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:56:05.590401 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195605589073"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned

where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m19:56:05.590780 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:56:05.591001 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:05.595515 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 32:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m19:56:05.595746 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m19:56:05.596081 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:56:05.596358 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:56:05.599472 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:56:05.600052 [debug] [Thread-4 (]: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  aggregate functions are not allowed in WHERE
  LINE 32:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:56:05.600341 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaa056c50>]}
[0m19:56:05.600593 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '56bb250f-34cd-4636-8bff-796cfe17d77e', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9d40c10>]}
[0m19:56:05.600958 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:56:05.601333 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_crm_orders  [[31mERROR[0m in 0.04s]
[0m19:56:05.601644 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:56:05.601897 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:56:05.602197 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m19:56:05.602784 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_crm_orders' to be skipped because of status 'error'.  Reason: Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  aggregate functions are not allowed in WHERE
  LINE 32:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m19:56:05.603259 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:05.603488 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:56:05.603763 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:05.604580 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.604851 [debug] [MainThread]: On master: BEGIN
[0m19:56:05.605060 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:56:05.608270 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:56:05.608511 [debug] [MainThread]: On master: COMMIT
[0m19:56:05.608715 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:05.608890 [debug] [MainThread]: On master: COMMIT
[0m19:56:05.609115 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:05.609278 [debug] [MainThread]: On master: Close
[0m19:56:05.609507 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:56:05.609703 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:56:05.609929 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:56:05.610144 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:56:05.610297 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:56:05.610516 [info ] [MainThread]: 
[0m19:56:05.610733 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.18 seconds (0.18s).
[0m19:56:05.611173 [debug] [MainThread]: Command end result
[0m19:56:05.623389 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:05.624293 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:05.626995 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:56:05.627205 [info ] [MainThread]: 
[0m19:56:05.627490 [info ] [MainThread]: [31mCompleted with 2 errors, 0 partial successes, and 0 warnings:[0m
[0m19:56:05.627720 [info ] [MainThread]: 
[0m19:56:05.627981 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:56:05.628290 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 86: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m19:56:05.628542 [info ] [MainThread]: 
[0m19:56:05.628790 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:56:05.629045 [info ] [MainThread]: 
[0m19:56:05.629280 [error] [MainThread]: [31mFailure in model int_crm_orders (models/intermediate/int_crm_orders.sql)[0m
[0m19:56:05.629543 [error] [MainThread]:   Database Error in model int_crm_orders (models/intermediate/int_crm_orders.sql)
  aggregate functions are not allowed in WHERE
  LINE 32:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:56:05.629733 [info ] [MainThread]: 
[0m19:56:05.629965 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_crm_orders.sql
[0m19:56:05.630202 [info ] [MainThread]: 
[0m19:56:05.630455 [info ] [MainThread]: Done. PASS=3 WARN=0 ERROR=2 SKIP=1 NO-OP=0 TOTAL=6
[0m19:56:05.631010 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5803925, "process_in_blocks": "0", "process_kernel_time": 0.117057, "process_mem_max_rss": "133996", "process_out_blocks": "3110", "process_user_time": 1.14875}
[0m19:56:05.631314 [debug] [MainThread]: Command `dbt run` failed at 19:56:05.631253 after 0.58 seconds
[0m19:56:05.631554 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaabe93d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99bbfb90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99bbdd10>]}
[0m19:56:05.631806 [debug] [MainThread]: Flushing usage events
[0m19:56:06.204728 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:56:42.409287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d671f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d661310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d671690>]}


============================== 19:56:42.412262 | 04d7d91e-cf7d-493b-8665-04eea0fc7101 ==============================
[0m19:56:42.412262 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:56:42.412621 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'version_check': 'True', 'fail_fast': 'False', 'log_cache_events': 'False', 'invocation_command': 'dbt run --full-refresh --profiles-dir .', 'target_path': 'None', 'partial_parse': 'True', 'write_json': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'static_parser': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'debug': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'use_colors': 'True', 'use_experimental_parser': 'False', 'empty': 'False', 'warn_error': 'None', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'profiles_dir': '.'}
[0m19:56:42.481809 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7cae79d0>]}
[0m19:56:42.502526 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80152f90>]}
[0m19:56:42.502994 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:56:42.528870 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:56:42.577850 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m19:56:42.578285 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_campaign_daily.sql
[0m19:56:42.755457 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ea769d0>]}
[0m19:56:42.794637 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:42.795877 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:42.805448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d9467d0>]}
[0m19:56:42.805780 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:56:42.806025 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c60d950>]}
[0m19:56:42.807062 [info ] [MainThread]: 
[0m19:56:42.807447 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:56:42.807796 [info ] [MainThread]: 
[0m19:56:42.808214 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:56:42.810229 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:42.810589 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:42.815497 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:56:42.829156 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:42.829384 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:42.829533 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:56:42.829757 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:42.830003 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:42.830231 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:56:42.830515 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:42.830735 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:42.830988 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:42.844213 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.013 seconds
[0m19:56:42.844460 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.014 seconds
[0m19:56:42.844661 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.014 seconds
[0m19:56:42.845314 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:42.846182 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:42.846867 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:56:42.848987 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:56:42.849286 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:56:42.849545 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:56:42.852197 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:42.853158 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:42.854043 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:42.854366 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:56:42.854589 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:56:42.854777 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:56:42.855003 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:42.855185 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:42.855396 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:56:42.859938 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:56:42.860152 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:56:42.860299 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:56:42.860486 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:42.860704 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:42.860973 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:42.861287 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:56:42.861548 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:56:42.861789 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:56:42.864581 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:42.864770 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m19:56:42.864913 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m19:56:42.865644 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:56:42.866291 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:56:42.866949 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:56:42.867337 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:56:42.867489 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:56:42.867694 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:56:42.870508 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:42.870761 [debug] [MainThread]: On master: BEGIN
[0m19:56:42.870987 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:56:42.874843 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m19:56:42.875111 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:42.875324 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:56:42.885249 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m19:56:42.885893 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c8f56d0>]}
[0m19:56:42.886183 [debug] [MainThread]: On master: ROLLBACK
[0m19:56:42.886462 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:42.886625 [debug] [MainThread]: On master: BEGIN
[0m19:56:42.886936 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:56:42.887120 [debug] [MainThread]: On master: COMMIT
[0m19:56:42.887273 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:42.887430 [debug] [MainThread]: On master: COMMIT
[0m19:56:42.887650 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:42.887829 [debug] [MainThread]: On master: Close
[0m19:56:42.890205 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:42.890463 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:42.890695 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:42.891253 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:56:42.891719 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:56:42.892094 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:56:42.892445 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:56:42.892674 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:56:42.892943 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:56:42.893225 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:42.893453 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:42.893694 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:42.896612 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.898490 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.899579 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.900457 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:42.900667 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:42.913676 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.913975 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:42.915494 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.917235 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.917751 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.917996 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:56:42.918232 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.918390 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:42.918628 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.919089 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:56:42.918785 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:56:42.919252 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:56:42.919454 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:42.923642 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:42.923838 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:42.924089 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:42.924353 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.924604 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.924826 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.925070 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:56:42.925364 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:56:42.925644 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:56:42.929331 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:56:42.929512 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:56:42.929671 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:56:42.932338 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.933796 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.935094 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.935329 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:56:42.935545 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:56:42.935782 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:56:42.936350 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.936505 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.936656 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.937927 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.939772 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.941027 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.941276 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:56:42.941564 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:56:42.941832 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:56:42.942474 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.942648 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.942795 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:42.948479 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:56:42.949282 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:56:42.950124 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:56:42.950376 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.950643 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.950914 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.951138 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:56:42.951397 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:56:42.951638 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:56:42.952616 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:56:42.955006 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:56:42.955202 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m19:56:42.955388 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m19:56:42.957225 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:56:42.958484 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:56:42.959546 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:56:42.959743 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:56:42.960149 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:56:42.960534 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:56:42.960932 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:56:42.961202 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:56:42.961669 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:56:42.963021 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:56:42.963198 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:56:42.963354 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m19:56:42.964284 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a90b6d0>]}
[0m19:56:42.964917 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:56:42.965542 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:56:42.965948 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:56:42.966432 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a9f8f10>]}
[0m19:56:42.966831 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7a86d590>]}
[0m19:56:42.967196 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:56:42.967559 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:56:42.968019 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:56:42.968510 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:56:42.968770 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:56:42.969070 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:56:42.969335 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:56:42.969850 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:56:42.970134 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:56:42.970379 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:56:42.970644 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:56:42.970863 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:56:42.973312 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:56:42.973575 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:56:42.975446 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:42.975858 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:56:42.983762 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:56:42.990240 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m19:56:42.992803 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:42.993838 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:42.994036 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:42.994225 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m19:56:42.994418 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m19:56:42.994621 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:42.994840 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:56:42.998940 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:42.999122 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:42.999325 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:42.999532 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:42.999730 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m19:56:43.000032 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

  );
  
  
[0m19:56:43.006370 [debug] [Thread-4 (]: SQL status: SELECT 79 in 0.006 seconds
[0m19:56:43.009254 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:43.009520 [debug] [Thread-1 (]: SQL status: SELECT 630 in 0.009 seconds
[0m19:56:43.009784 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders" rename to "int_crm_orders__dbt_backup"
[0m19:56:43.011399 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:43.011927 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily" rename to "int_campaign_daily__dbt_backup"
[0m19:56:43.012131 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:43.013468 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:43.013645 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:56:43.013872 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp" rename to "int_crm_orders"
[0m19:56:43.015111 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:43.015448 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp" rename to "int_campaign_daily"
[0m19:56:43.015610 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:43.016391 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:56:43.016577 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:56:43.016833 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:43.017564 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m19:56:43.017790 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:56:43.017979 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:43.018261 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m19:56:43.019154 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m19:56:43.019361 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m19:56:43.020441 [debug] [Thread-4 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup"
[0m19:56:43.021438 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup"
[0m19:56:43.022751 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:56:43.023228 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:56:43.023477 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
drop table if exists "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup" cascade
[0m19:56:43.023707 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
drop table if exists "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup" cascade
[0m19:56:43.027250 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.003 seconds
[0m19:56:43.028169 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:56:43.028358 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.004 seconds
[0m19:56:43.028733 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff787fc550>]}
[0m19:56:43.029326 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:56:43.029708 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.06s]
[0m19:56:43.030117 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7aa4e4d0>]}
[0m19:56:43.030391 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:56:43.030742 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 630[0m in 0.06s]
[0m19:56:43.031358 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:56:43.031825 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:43.032216 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m19:56:43.032529 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m19:56:43.032747 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:43.034467 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.035144 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:43.040554 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.041203 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.041451 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m19:56:43.041694 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:43.045078 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m19:56:43.045325 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.045532 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m19:56:43.051431 [debug] [Thread-2 (]: SQL status: SELECT 630 in 0.006 seconds
[0m19:56:43.053099 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.053367 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m19:56:43.053698 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:43.055894 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.056124 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m19:56:43.056449 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:56:43.057093 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m19:56:43.057302 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.057490 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m19:56:43.058418 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m19:56:43.059494 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m19:56:43.059792 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m19:56:43.059944 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m19:56:43.061680 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m19:56:43.062267 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m19:56:43.062574 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '04d7d91e-cf7d-493b-8665-04eea0fc7101', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7861a810>]}
[0m19:56:43.062907 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 630[0m in 0.03s]
[0m19:56:43.063209 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:56:43.064092 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:43.064288 [debug] [MainThread]: On master: BEGIN
[0m19:56:43.064454 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:56:43.067364 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:56:43.067567 [debug] [MainThread]: On master: COMMIT
[0m19:56:43.067755 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:43.067936 [debug] [MainThread]: On master: COMMIT
[0m19:56:43.068319 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:43.068525 [debug] [MainThread]: On master: Close
[0m19:56:43.068800 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:56:43.068996 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:56:43.069184 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m19:56:43.069416 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:56:43.069615 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:56:43.069840 [info ] [MainThread]: 
[0m19:56:43.070043 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m19:56:43.070610 [debug] [MainThread]: Command end result
[0m19:56:43.083385 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:43.084644 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:43.087680 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:56:43.087889 [info ] [MainThread]: 
[0m19:56:43.088252 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:56:43.088486 [info ] [MainThread]: 
[0m19:56:43.088746 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m19:56:43.089367 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.69856143, "process_in_blocks": "0", "process_kernel_time": 0.237881, "process_mem_max_rss": "134536", "process_out_blocks": "3139", "process_user_time": 1.32434}
[0m19:56:43.089665 [debug] [MainThread]: Command `dbt run` succeeded at 19:56:43.089602 after 0.70 seconds
[0m19:56:43.089916 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff823e3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7eb8f3d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d6606d0>]}
[0m19:56:43.090138 [debug] [MainThread]: Flushing usage events
[0m19:56:43.595783 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:56:49.344540 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c8823d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c8df090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c881bd0>]}


============================== 19:56:49.347403 | ddbe4335-ab4e-4e35-b27b-532bdcf61e54 ==============================
[0m19:56:49.347403 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:56:49.347781 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'debug': 'False', 'no_print': 'None', 'empty': 'None', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt test --profiles-dir .', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'quiet': 'False', 'indirect_selection': 'eager', 'introspect': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'profiles_dir': '.', 'log_path': '/opt/bluealpha/dbt_project/logs', 'log_format': 'default', 'target_path': 'None', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None'}
[0m19:56:49.408509 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8be71dd0>]}
[0m19:56:49.428047 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8f2b30d0>]}
[0m19:56:49.428402 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:56:49.453432 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:56:49.499106 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:56:49.499377 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:56:49.499514 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:56:49.515781 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c923190>]}
[0m19:56:49.552508 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:49.553600 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:49.567403 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b83a090>]}
[0m19:56:49.567742 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:56:49.567977 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8bd8cd10>]}
[0m19:56:49.569098 [info ] [MainThread]: 
[0m19:56:49.569424 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:56:49.569724 [info ] [MainThread]: 
[0m19:56:49.570052 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:56:49.571817 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m19:56:49.572108 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m19:56:49.600214 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m19:56:49.611261 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:49.611443 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:49.611584 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:49.611791 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:56:49.612025 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:56:49.612253 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:56:49.612460 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:49.612665 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:49.612863 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:56:49.617857 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.618078 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.618228 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m19:56:49.618401 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:56:49.618645 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:56:49.618867 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:56:49.619075 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:56:49.619327 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:56:49.619561 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:56:49.622447 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:49.622595 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m19:56:49.622738 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m19:56:49.623318 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:56:49.623913 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:56:49.624377 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:56:49.624684 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:56:49.624870 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:56:49.625059 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:56:49.627978 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.628246 [debug] [MainThread]: On master: BEGIN
[0m19:56:49.628438 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:56:49.631493 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:56:49.631725 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.631951 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:56:49.641472 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:56:49.642041 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ddbe4335-ab4e-4e35-b27b-532bdcf61e54', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b7fb290>]}
[0m19:56:49.642333 [debug] [MainThread]: On master: ROLLBACK
[0m19:56:49.642576 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.642742 [debug] [MainThread]: On master: BEGIN
[0m19:56:49.643026 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:56:49.643205 [debug] [MainThread]: On master: COMMIT
[0m19:56:49.643369 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.643510 [debug] [MainThread]: On master: COMMIT
[0m19:56:49.643709 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:49.643878 [debug] [MainThread]: On master: Close
[0m19:56:49.645937 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m19:56:49.646121 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m19:56:49.646347 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m19:56:49.646547 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m19:56:49.646717 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m19:56:49.647084 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m19:56:49.647381 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m19:56:49.647655 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m19:56:49.647980 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m19:56:49.648222 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m19:56:49.648437 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m19:56:49.648697 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m19:56:49.648937 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m19:56:49.649154 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m19:56:49.649351 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m19:56:49.649592 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m19:56:49.656256 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m19:56:49.659698 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m19:56:49.661327 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m19:56:49.662838 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m19:56:49.664669 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m19:56:49.664982 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m19:56:49.670872 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m19:56:49.671048 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m19:56:49.672131 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m19:56:49.672306 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m19:56:49.673344 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m19:56:49.673679 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m19:56:49.675117 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m19:56:49.674965 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m19:56:49.674602 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m19:56:49.675309 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:49.675522 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m19:56:49.675668 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m19:56:49.676343 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m19:56:49.676602 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m19:56:49.676828 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:56:49.677077 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:49.677390 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m19:56:49.678105 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:56:49.679877 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.680829 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m19:56:49.681371 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.681563 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.681739 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:49.681924 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.682196 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m19:56:49.682461 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m19:56:49.682660 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.682848 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m19:56:49.683087 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.683322 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.685017 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m19:56:49.685301 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m19:56:49.685808 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m19:56:49.686027 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.686178 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.686540 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m19:56:49.687441 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m19:56:49.687648 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:49.688386 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m19:56:49.688672 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m19:56:49.688944 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m19:56:49.689405 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m19:56:49.689716 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m19:56:49.689882 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m19:56:49.690250 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m19:56:49.690647 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m19:56:49.690892 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m19:56:49.691235 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m19:56:49.691677 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m19:56:49.692060 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m19:56:49.692399 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m19:56:49.692656 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m19:56:49.692912 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m19:56:49.693304 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m19:56:49.693556 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m19:56:49.693802 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m19:56:49.694054 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m19:56:49.694331 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m19:56:49.694569 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m19:56:49.696519 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m19:56:49.696763 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m19:56:49.697012 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m19:56:49.697312 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m19:56:49.697718 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m19:56:49.697987 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m19:56:49.698154 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m19:56:49.698382 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m19:56:49.699917 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m19:56:49.700904 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m19:56:49.701118 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m19:56:49.703394 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m19:56:49.705395 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m19:56:49.705575 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m19:56:49.705764 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m19:56:49.706200 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m19:56:49.707030 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m19:56:49.707219 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m19:56:49.707397 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m19:56:49.708260 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m19:56:49.709653 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m19:56:49.709914 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:49.710163 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m19:56:49.710831 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m19:56:49.711166 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m19:56:49.711334 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m19:56:49.711551 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m19:56:49.711764 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m19:56:49.712011 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:56:49.712250 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m19:56:49.712461 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:49.714293 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:49.714541 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m19:56:49.714768 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.715856 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.716065 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:49.716237 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:49.716402 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:56:49.717019 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m19:56:49.717260 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m19:56:49.717493 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m19:56:49.717708 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m19:56:49.717988 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m19:56:49.718320 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.718634 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.718903 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.719325 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m19:56:49.720049 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m19:56:49.720738 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m19:56:49.721455 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m19:56:49.721630 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:49.721801 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:49.721983 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m19:56:49.722310 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m19:56:49.722805 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m19:56:49.723400 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m19:56:49.723594 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m19:56:49.723997 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m19:56:49.724371 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m19:56:49.724538 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m19:56:49.724753 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m19:56:49.725056 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m19:56:49.725410 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m19:56:49.725728 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m19:56:49.725978 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m19:56:49.726283 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m19:56:49.726579 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m19:56:49.726847 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m19:56:49.728876 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m19:56:49.729141 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m19:56:49.729457 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m19:56:49.729730 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m19:56:49.730201 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m19:56:49.730451 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m19:56:49.730634 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m19:56:49.730923 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m19:56:49.731218 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m19:56:49.732205 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m19:56:49.732436 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m19:56:49.732614 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m19:56:49.734107 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m19:56:49.734425 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m19:56:49.734616 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m19:56:49.734797 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m19:56:49.736443 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m19:56:49.736650 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m19:56:49.738721 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m19:56:49.738911 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m19:56:49.739928 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m19:56:49.740248 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m19:56:49.740395 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:49.740710 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m19:56:49.742652 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m19:56:49.742884 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m19:56:49.744089 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m19:56:49.744481 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m19:56:49.744695 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m19:56:49.744951 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:56:49.745230 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m19:56:49.745442 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m19:56:49.745828 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m19:56:49.746116 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m19:56:49.746433 [debug] [Thread-2 (]: SQL status: BEGIN in 0.006 seconds
[0m19:56:49.746640 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:56:49.746942 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m19:56:49.747338 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.748291 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.749196 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m19:56:49.749709 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.750042 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m19:56:49.750196 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m19:56:49.750352 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m19:56:49.750528 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m19:56:49.750729 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m19:56:49.751048 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m19:56:49.751283 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m19:56:49.751522 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.751774 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:56:49.752062 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m19:56:49.752292 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m19:56:49.752740 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m19:56:49.753107 [info ] [Thread-2 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m19:56:49.753281 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.753515 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m19:56:49.753686 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.754278 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m19:56:49.754446 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m19:56:49.754658 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m19:56:49.755280 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m19:56:49.755559 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m19:56:49.756035 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m19:56:49.757917 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m19:56:49.758190 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m19:56:49.758437 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m19:56:49.758746 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m19:56:49.759173 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m19:56:49.759484 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m19:56:49.759647 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m19:56:49.759996 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m19:56:49.760317 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m19:56:49.761494 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m19:56:49.761738 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m19:56:49.762505 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m19:56:49.762720 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m19:56:49.762879 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:56:49.765549 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m19:56:49.765763 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m19:56:49.765943 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m19:56:49.767719 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m19:56:49.768336 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m19:56:49.768535 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m19:56:49.768758 [info ] [Thread-2 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.02s]
[0m19:56:49.769115 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m19:56:49.769913 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.770121 [debug] [MainThread]: On master: BEGIN
[0m19:56:49.770283 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:56:49.773159 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:56:49.773371 [debug] [MainThread]: On master: COMMIT
[0m19:56:49.773551 [debug] [MainThread]: Using postgres connection "master"
[0m19:56:49.773715 [debug] [MainThread]: On master: COMMIT
[0m19:56:49.773946 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:56:49.774139 [debug] [MainThread]: On master: Close
[0m19:56:49.774355 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:56:49.774523 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m19:56:49.774697 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m19:56:49.774840 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m19:56:49.775009 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m19:56:49.775223 [info ] [MainThread]: 
[0m19:56:49.775430 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m19:56:49.776326 [debug] [MainThread]: Command end result
[0m19:56:49.788923 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:56:49.789767 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:56:49.792808 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:56:49.793005 [info ] [MainThread]: 
[0m19:56:49.793270 [info ] [MainThread]: [32mCompleted successfully[0m
[0m19:56:49.793508 [info ] [MainThread]: 
[0m19:56:49.793773 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m19:56:49.794312 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.46836787, "process_in_blocks": "0", "process_kernel_time": 0.128619, "process_mem_max_rss": "129872", "process_out_blocks": "2160", "process_user_time": 1.087235}
[0m19:56:49.794553 [debug] [MainThread]: Command `dbt test` succeeded at 19:56:49.794516 after 0.47 seconds
[0m19:56:49.794760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff919b5d90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8dd9f2d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8c8e8250>]}
[0m19:56:49.794974 [debug] [MainThread]: Flushing usage events
[0m19:56:50.166376 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:57:10.800796 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5c71f50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb87443d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6151b90>]}


============================== 19:57:10.803480 | cce27786-41bc-4451-870b-58e588f62fc4 ==============================
[0m19:57:10.803480 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:57:10.803815 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'write_json': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'use_colors': 'True', 'introspect': 'True', 'empty': 'False', 'no_print': 'None', 'invocation_command': 'dbt run', 'cache_selected_only': 'False', 'partial_parse': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'quiet': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'profiles_dir': '/opt/bluealpha/dbt_project', 'version_check': 'True', 'target_path': 'None', 'log_format': 'default', 'fail_fast': 'False', 'warn_error': 'None', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True'}
[0m19:57:10.862679 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb50ba710>]}
[0m19:57:10.882110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8755550>]}
[0m19:57:10.882485 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:57:10.906457 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:57:10.950169 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:57:10.950423 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:57:10.950614 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:57:10.967003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4dd0250>]}
[0m19:57:11.000468 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:57:11.001296 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:57:11.009075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb51f7350>]}
[0m19:57:11.009378 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:57:11.009614 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4de03d0>]}
[0m19:57:11.010498 [info ] [MainThread]: 
[0m19:57:11.010720 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:57:11.010879 [info ] [MainThread]: 
[0m19:57:11.011122 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:57:11.012746 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:57:11.013042 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:57:11.017432 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:57:11.054014 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:57:11.054219 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:57:11.054372 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:57:11.054599 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:57:11.054828 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:57:11.055017 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:57:11.055235 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:57:11.055455 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:57:11.055646 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:57:11.060763 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:57:11.060965 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.005 seconds
[0m19:57:11.061110 [debug] [ThreadPool]: SQL status: SELECT 14 in 0.006 seconds
[0m19:57:11.061678 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:57:11.062207 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:57:11.062690 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:57:11.064158 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:57:11.064426 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:57:11.066821 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:57:11.067007 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:57:11.067865 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:57:11.068072 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:57:11.068859 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:57:11.069067 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:57:11.069250 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:57:11.069467 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:57:11.069658 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:57:11.070037 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:57:11.073630 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:57:11.073796 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:57:11.073940 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:57:11.074122 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:57:11.074340 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:57:11.074550 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:57:11.074753 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:57:11.074993 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:57:11.075239 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:57:11.077602 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m19:57:11.077748 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:57:11.077913 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m19:57:11.078442 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:57:11.078937 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:57:11.079409 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:57:11.079677 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:57:11.079888 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:57:11.080076 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:57:11.083444 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.083651 [debug] [MainThread]: On master: BEGIN
[0m19:57:11.083829 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:57:11.086654 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:57:11.086863 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.087086 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:57:11.096404 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:57:11.096892 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6799650>]}
[0m19:57:11.097143 [debug] [MainThread]: On master: ROLLBACK
[0m19:57:11.097389 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.097562 [debug] [MainThread]: On master: BEGIN
[0m19:57:11.097842 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:57:11.098023 [debug] [MainThread]: On master: COMMIT
[0m19:57:11.098170 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.098306 [debug] [MainThread]: On master: COMMIT
[0m19:57:11.098498 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:57:11.098662 [debug] [MainThread]: On master: Close
[0m19:57:11.100747 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:57:11.100952 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:57:11.101127 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:57:11.101418 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:57:11.101775 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:57:11.102089 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:57:11.102387 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:57:11.102637 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:57:11.102880 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:57:11.103150 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:57:11.103368 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:57:11.103604 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:57:11.106445 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.107526 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.108654 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.109455 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:57:11.109750 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:57:11.123115 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.123412 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:57:11.124937 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.126407 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.126665 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.127134 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:57:11.127395 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.127587 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.127749 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:57:11.127965 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:57:11.128174 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:57:11.128499 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:57:11.128785 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:57:11.131926 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m19:57:11.132107 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:57:11.132268 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:57:11.132465 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.132701 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.132927 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.133125 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:57:11.133375 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:57:11.133619 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:57:11.137110 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:57:11.139910 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.140076 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:57:11.140234 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m19:57:11.140428 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:57:11.141674 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.142779 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.143094 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:57:11.143250 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:57:11.143447 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:57:11.143854 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:57:11.144989 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.146145 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.146318 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:57:11.146503 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:57:11.146707 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:57:11.147837 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.148253 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:57:11.148424 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:57:11.148606 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:57:11.154677 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:57:11.154909 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:57:11.155486 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:57:11.155752 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.156336 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:57:11.156578 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.156895 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:57:11.157160 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.157401 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:57:11.157744 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:57:11.158045 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m19:57:11.160486 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:57:11.160650 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m19:57:11.160799 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m19:57:11.162646 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:57:11.163530 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:57:11.164424 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:57:11.164648 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:57:11.165024 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:57:11.165328 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:57:11.165616 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:57:11.165949 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:57:11.166125 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:57:11.167277 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:57:11.167433 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:57:11.167596 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:57:11.168366 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4237b50>]}
[0m19:57:11.168873 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:57:11.169378 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:57:11.169713 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:57:11.170036 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb51e3bd0>]}
[0m19:57:11.170314 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb425c910>]}
[0m19:57:11.170607 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:57:11.170928 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:57:11.171268 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:57:11.171759 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:57:11.172017 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:57:11.172265 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:57:11.172535 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:57:11.173004 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:57:11.173234 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:57:11.173504 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:57:11.173759 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:57:11.173995 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:57:11.177296 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.177516 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:57:11.179331 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:57:11.179656 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:57:11.193656 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.193846 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:57:11.194050 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195711188358"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:57:11.195583 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:57:11.195802 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:57:11.196103 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195711195025"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m19:57:11.196469 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:57:11.199776 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m19:57:11.200102 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:57:11.202225 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:57:11.202659 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb41fca50>]}
[0m19:57:11.203078 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:57:11.203291 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.007 seconds
[0m19:57:11.203510 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:57:11.209604 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.210006 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m19:57:11.210232 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m19:57:11.210836 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m19:57:11.211041 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.211234 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp195711188358'
        
      order by ordinal_position

  
[0m19:57:11.218893 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.007 seconds
[0m19:57:11.220844 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.221075 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:57:11.222253 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:57:11.225508 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.225766 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:57:11.226731 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:57:11.231970 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.232611 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.232827 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp195711188358" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp195711188358"
    )
  
[0m19:57:11.233405 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m19:57:11.233987 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:57:11.234174 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:57:11.234367 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:57:11.234857 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m19:57:11.235244 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:57:11.235572 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cce27786-41bc-4451-870b-58e588f62fc4', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacf50210>]}
[0m19:57:11.235921 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m19:57:11.236341 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:57:11.236808 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:57:11.237141 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:57:11.237344 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:57:11.238198 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.238428 [debug] [MainThread]: On master: BEGIN
[0m19:57:11.238613 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:57:11.241454 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:57:11.241671 [debug] [MainThread]: On master: COMMIT
[0m19:57:11.241867 [debug] [MainThread]: Using postgres connection "master"
[0m19:57:11.242008 [debug] [MainThread]: On master: COMMIT
[0m19:57:11.242191 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:57:11.242335 [debug] [MainThread]: On master: Close
[0m19:57:11.242526 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:57:11.242698 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:57:11.242864 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:57:11.243022 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:57:11.243151 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:57:11.243372 [info ] [MainThread]: 
[0m19:57:11.243566 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m19:57:11.244030 [debug] [MainThread]: Command end result
[0m19:57:11.256371 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:57:11.257175 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:57:11.259924 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:57:11.260106 [info ] [MainThread]: 
[0m19:57:11.260297 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:57:11.260470 [info ] [MainThread]: 
[0m19:57:11.260683 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:57:11.260957 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:57:11.261149 [info ] [MainThread]: 
[0m19:57:11.261317 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:57:11.261474 [info ] [MainThread]: 
[0m19:57:11.261665 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m19:57:11.262333 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.48008904, "process_in_blocks": "0", "process_kernel_time": 0.113389, "process_mem_max_rss": "130000", "process_out_blocks": "2156", "process_user_time": 1.031544}
[0m19:57:11.262625 [debug] [MainThread]: Command `dbt run` failed at 19:57:11.262585 after 0.48 seconds
[0m19:57:11.262922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5cd6910>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5cd6490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffba9504d0>]}
[0m19:57:11.263193 [debug] [MainThread]: Flushing usage events
[0m19:57:11.700273 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:58:08.289829 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc418d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc41590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc41a90>]}


============================== 19:58:08.292761 | 63734b97-d6b8-4c7e-bb54-51ffd4dfb59b ==============================
[0m19:58:08.292761 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:58:08.293199 [debug] [MainThread]: running dbt with arguments {'static_parser': 'True', 'empty': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'log_path': '/opt/bluealpha/dbt_project/logs', 'warn_error': 'None', 'fail_fast': 'False', 'partial_parse': 'True', 'cache_selected_only': 'False', 'quiet': 'False', 'write_json': 'True', 'log_format': 'default', 'debug': 'False', 'use_experimental_parser': 'False', 'introspect': 'True', 'target_path': 'None', 'log_cache_events': 'False', 'use_colors': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'printer_width': '80', 'version_check': 'True', 'invocation_command': 'dbt run', 'indirect_selection': 'eager'}
[0m19:58:08.369771 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e5ab410>]}
[0m19:58:08.390166 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e675250>]}
[0m19:58:08.390592 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:58:08.416462 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:58:08.463508 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:58:08.463755 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:58:08.463892 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:58:08.480130 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ad93c90>]}
[0m19:58:08.513358 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:58:08.514127 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:58:08.522936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b09cc10>]}
[0m19:58:08.523367 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:58:08.523563 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9b2379d0>]}
[0m19:58:08.524398 [info ] [MainThread]: 
[0m19:58:08.524578 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:58:08.524726 [info ] [MainThread]: 
[0m19:58:08.525023 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:58:08.526694 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:08.527022 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:08.531537 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:08.565537 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:08.565737 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:08.565900 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:08.566129 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:08.566356 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:08.566578 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:08.566787 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:08.567026 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:08.567222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:08.572529 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.005 seconds
[0m19:58:08.572716 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.006 seconds
[0m19:58:08.572865 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.006 seconds
[0m19:58:08.573476 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:08.574062 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:08.574525 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:08.576172 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:58:08.576449 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:58:08.576696 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:58:08.579031 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:58:08.579900 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:58:08.580738 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:58:08.580939 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:58:08.581158 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:58:08.581378 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:58:08.581551 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:08.581748 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:08.581943 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:08.586461 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:58:08.586626 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:58:08.586755 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m19:58:08.586934 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:58:08.587176 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:58:08.587380 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:58:08.587572 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:58:08.587790 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:58:08.588031 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:58:08.590761 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m19:58:08.590910 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m19:58:08.591058 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m19:58:08.591680 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:58:08.592216 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:58:08.592680 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:58:08.592945 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:58:08.593166 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:58:08.593355 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:58:08.596478 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.596651 [debug] [MainThread]: On master: BEGIN
[0m19:58:08.596810 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:58:08.599697 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:58:08.599912 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.600120 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:58:08.609606 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:58:08.610131 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ab902d0>]}
[0m19:58:08.610411 [debug] [MainThread]: On master: ROLLBACK
[0m19:58:08.610660 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.610821 [debug] [MainThread]: On master: BEGIN
[0m19:58:08.611096 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:58:08.611276 [debug] [MainThread]: On master: COMMIT
[0m19:58:08.611421 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.611556 [debug] [MainThread]: On master: COMMIT
[0m19:58:08.611745 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:58:08.611896 [debug] [MainThread]: On master: Close
[0m19:58:08.613809 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:08.613988 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:08.614173 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:08.614440 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:58:08.614761 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:58:08.615048 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:58:08.615348 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:58:08.615578 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:58:08.615874 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:58:08.616132 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:08.616357 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:08.616571 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:08.619312 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.620429 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.621453 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.623118 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:08.623307 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:08.623536 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:08.636509 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.637818 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.639140 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.639917 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.640144 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.640386 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:58:08.640652 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.640794 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:58:08.641437 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:58:08.641234 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:58:08.640997 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:58:08.641792 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:58:08.645235 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:58:08.645410 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:58:08.645563 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:58:08.645753 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.645953 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.646170 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.646394 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:58:08.646648 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:58:08.646880 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:58:08.650440 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:58:08.650733 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:58:08.650968 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:58:08.653692 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.654839 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.655900 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.656146 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:58:08.656368 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:58:08.656613 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:58:08.657094 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:08.658411 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.658593 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:58:08.658734 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m19:58:08.658929 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:58:08.659985 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.661106 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.661415 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:58:08.661596 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:08.661785 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:58:08.667737 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:58:08.667915 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m19:58:08.668217 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.668399 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:08.668977 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:58:08.669234 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:58:08.669829 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:58:08.670047 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.670400 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.670898 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:58:08.671068 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m19:58:08.671263 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:58:08.674355 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:58:08.674532 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m19:58:08.676823 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:08.677003 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m19:58:08.677869 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:58:08.678086 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:58:08.678983 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:58:08.679338 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:08.679842 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:08.680082 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:58:08.680256 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:08.680458 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:58:08.681543 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:58:08.681722 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:08.682618 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:08.682848 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9905da90>]}
[0m19:58:08.683489 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:58:08.684151 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:58:08.684522 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:08.684856 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99066b10>]}
[0m19:58:08.685128 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99065f90>]}
[0m19:58:08.685397 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:08.685677 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:08.686057 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:08.686484 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:08.686752 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:08.687078 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:58:08.687398 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:58:08.687642 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:58:08.687904 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:58:08.688241 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m19:58:08.688447 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m19:58:08.688653 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:58:08.688818 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:58:08.692161 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.693862 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:58:08.694887 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:58:08.695068 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:58:08.708722 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.710198 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:58:08.710415 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195808703753"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:58:08.710720 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195808709639"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m19:58:08.710943 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:58:08.711174 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:58:08.715514 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m19:58:08.716109 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:58:08.719330 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:58:08.719768 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ab5d050>]}
[0m19:58:08.720254 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:58:08.720773 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:58:08.721155 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m19:58:08.721700 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.011 seconds
[0m19:58:08.726560 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.726745 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m19:58:08.726985 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m19:58:08.727171 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.727354 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp195808703753'
        
      order by ordinal_position

  
[0m19:58:08.731207 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.004 seconds
[0m19:58:08.734120 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.734358 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:58:08.735459 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:58:08.738672 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.738869 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:58:08.739851 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:58:08.745178 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.745687 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.745899 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp195808703753" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp195808703753"
    )
  
[0m19:58:08.746506 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m19:58:08.747068 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:58:08.747250 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:08.747404 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:58:08.747838 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m19:58:08.748134 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:58:08.748405 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '63734b97-d6b8-4c7e-bb54-51ffd4dfb59b', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff991d4f10>]}
[0m19:58:08.748757 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m19:58:08.749131 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:58:08.749624 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:58:08.749858 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:58:08.750099 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:58:08.750903 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.751159 [debug] [MainThread]: On master: BEGIN
[0m19:58:08.751361 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:58:08.754240 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:58:08.754463 [debug] [MainThread]: On master: COMMIT
[0m19:58:08.754636 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:08.754783 [debug] [MainThread]: On master: COMMIT
[0m19:58:08.754974 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:58:08.755141 [debug] [MainThread]: On master: Close
[0m19:58:08.755382 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:58:08.755564 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m19:58:08.755727 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:58:08.755866 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:58:08.756040 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:58:08.756249 [info ] [MainThread]: 
[0m19:58:08.756423 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m19:58:08.756876 [debug] [MainThread]: Command end result
[0m19:58:08.769840 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:58:08.770902 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:58:08.773876 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:58:08.774072 [info ] [MainThread]: 
[0m19:58:08.774319 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:58:08.774501 [info ] [MainThread]: 
[0m19:58:08.774692 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:58:08.774887 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:58:08.775066 [info ] [MainThread]: 
[0m19:58:08.775247 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:58:08.775397 [info ] [MainThread]: 
[0m19:58:08.775572 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m19:58:08.776148 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.50650895, "process_in_blocks": "0", "process_kernel_time": 0.171866, "process_mem_max_rss": "130492", "process_out_blocks": "2156", "process_user_time": 1.067596}
[0m19:58:08.776395 [debug] [MainThread]: Command `dbt run` failed at 19:58:08.776359 after 0.51 seconds
[0m19:58:08.776585 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc42b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9bc407d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa08704d0>]}
[0m19:58:08.776763 [debug] [MainThread]: Flushing usage events
[0m19:58:09.292824 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:58:20.181827 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b73890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86534550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86537150>]}


============================== 19:58:20.184638 | a6e7ab04-015d-42ad-9781-1647af502bba ==============================
[0m19:58:20.184638 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:58:20.184958 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'partial_parse': 'True', 'indirect_selection': 'eager', 'debug': 'False', 'use_experimental_parser': 'False', 'quiet': 'False', 'log_format': 'default', 'invocation_command': 'dbt run', 'fail_fast': 'False', 'printer_width': '80', 'profiles_dir': '/opt/bluealpha/dbt_project', 'empty': 'False', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'target_path': 'None', 'log_path': '/opt/bluealpha/dbt_project/logs', 'write_json': 'True', 'warn_error': 'None', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'version_check': 'True', 'cache_selected_only': 'False', 'static_parser': 'True', 'no_print': 'None', 'use_colors': 'True'}
[0m19:58:20.244226 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b7c5d0>]}
[0m19:58:20.263804 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86545610>]}
[0m19:58:20.264206 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:58:20.288426 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:58:20.335947 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:58:20.336305 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:58:20.336939 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:58:20.353922 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82e0df90>]}
[0m19:58:20.387626 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:58:20.388500 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:58:20.396567 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82c60650>]}
[0m19:58:20.396855 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:58:20.397115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82d28510>]}
[0m19:58:20.398004 [info ] [MainThread]: 
[0m19:58:20.398192 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:58:20.398343 [info ] [MainThread]: 
[0m19:58:20.398587 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:58:20.400323 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:20.400616 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:20.405236 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:58:20.438225 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:20.438421 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:20.438571 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:58:20.438771 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:20.439018 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:20.439202 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:58:20.439418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:20.439640 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:20.439827 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:58:20.444670 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.005 seconds
[0m19:58:20.444847 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.005 seconds
[0m19:58:20.445001 [debug] [ThreadPool]: SQL status: SELECT 16 in 0.005 seconds
[0m19:58:20.445572 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:20.446108 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:20.446636 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:58:20.448009 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:58:20.448331 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:58:20.448571 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:58:20.450853 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:58:20.451752 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:58:20.452578 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:58:20.452780 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:58:20.453040 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:58:20.453254 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:58:20.453431 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:20.453638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:20.453833 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:58:20.457904 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:58:20.458144 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:58:20.458286 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:58:20.458509 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:58:20.458746 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:58:20.458983 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:58:20.459191 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:58:20.459435 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:58:20.459658 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:58:20.462136 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:58:20.462304 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m19:58:20.462444 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m19:58:20.463139 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:58:20.463672 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:58:20.464172 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:58:20.464441 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:58:20.464696 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:58:20.464889 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:58:20.468174 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.468446 [debug] [MainThread]: On master: BEGIN
[0m19:58:20.468641 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:58:20.471776 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:58:20.472005 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.472239 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:58:20.481683 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:58:20.482268 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80f1d4d0>]}
[0m19:58:20.482533 [debug] [MainThread]: On master: ROLLBACK
[0m19:58:20.482801 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.482985 [debug] [MainThread]: On master: BEGIN
[0m19:58:20.483274 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:58:20.483459 [debug] [MainThread]: On master: COMMIT
[0m19:58:20.483611 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.483750 [debug] [MainThread]: On master: COMMIT
[0m19:58:20.483954 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:58:20.484142 [debug] [MainThread]: On master: Close
[0m19:58:20.486202 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:20.486392 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:20.486568 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:20.486891 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:58:20.487239 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:58:20.487537 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:58:20.487819 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:58:20.488088 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:58:20.488349 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:58:20.488585 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:20.488816 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:20.489010 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:20.491914 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.493095 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.494092 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.494914 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:20.495123 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:20.495352 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:20.508825 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.510482 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.511841 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.512648 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.512859 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.513112 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:58:20.513409 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.513559 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:58:20.513760 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:58:20.513992 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:58:20.514258 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:58:20.514656 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:58:20.518158 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m19:58:20.518379 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m19:58:20.518552 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m19:58:20.518755 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.518967 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.519188 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.519398 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:58:20.519669 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:58:20.519935 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:58:20.522582 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:58:20.522781 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m19:58:20.522953 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m19:58:20.525830 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.526961 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.528138 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.528339 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:58:20.528565 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:58:20.528787 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:58:20.529268 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:20.529428 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:20.529616 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:20.530675 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.531730 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.532852 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.533088 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:58:20.533332 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:58:20.533564 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:58:20.533957 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:58:20.540705 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:58:20.540878 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:58:20.541149 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.007 seconds
[0m19:58:20.541359 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.542014 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:58:20.542636 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:58:20.542836 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:58:20.543085 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.543312 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.543638 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:58:20.543953 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m19:58:20.544137 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:58:20.546566 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:58:20.546735 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m19:58:20.548716 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:58:20.548893 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m19:58:20.549840 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:58:20.550062 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:58:20.550988 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:58:20.551324 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:58:20.551779 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:58:20.552012 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:58:20.552177 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:20.552355 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:58:20.553447 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:58:20.553612 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:20.554440 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:58:20.554798 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fe2210>]}
[0m19:58:20.555297 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:58:20.555855 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:58:20.556303 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:20.556767 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80fb0e90>]}
[0m19:58:20.557156 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82d7c110>]}
[0m19:58:20.557407 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:58:20.557861 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:20.558220 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:58:20.558632 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:58:20.558916 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:58:20.559260 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:58:20.559592 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:58:20.559832 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:58:20.560082 [info ] [Thread-2 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:58:20.560378 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m19:58:20.560603 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m19:58:20.560815 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:58:20.560985 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:58:20.564838 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:58:20.566356 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.566969 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:58:20.567133 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:58:20.580666 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:58:20.582151 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.582407 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195820575617"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m19:58:20.582679 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195820581580"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:58:20.582960 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:58:20.583197 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:58:20.587194 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m19:58:20.587541 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:58:20.589914 [debug] [Thread-4 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:58:20.590366 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82a33f10>]}
[0m19:58:20.590700 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:58:20.591049 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:58:20.591228 [debug] [Thread-2 (]: SQL status: SELECT 12 in 0.008 seconds
[0m19:58:20.591503 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m19:58:20.597428 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.598036 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m19:58:20.598343 [debug] [Thread-2 (]: SQL status: BEGIN in 0.000 seconds
[0m19:58:20.598540 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.598716 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp195820581580'
        
      order by ordinal_position

  
[0m19:58:20.602917 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.004 seconds
[0m19:58:20.604924 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.605187 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:58:20.606523 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:58:20.609727 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.609961 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:58:20.611050 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:58:20.616589 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.617201 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.617433 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp195820581580" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp195820581580"
    )
  
[0m19:58:20.618079 [debug] [Thread-2 (]: SQL status: INSERT 0 12 in 0.000 seconds
[0m19:58:20.618660 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:58:20.618830 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:58:20.618999 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:58:20.619599 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m19:58:20.619924 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:58:20.620260 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'a6e7ab04-015d-42ad-9781-1647af502bba', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82a33d90>]}
[0m19:58:20.620682 [info ] [Thread-2 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 12[0m in 0.06s]
[0m19:58:20.621182 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:58:20.621562 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:58:20.621842 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:58:20.622184 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:58:20.622894 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.623071 [debug] [MainThread]: On master: BEGIN
[0m19:58:20.623218 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:58:20.625982 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:58:20.626182 [debug] [MainThread]: On master: COMMIT
[0m19:58:20.626352 [debug] [MainThread]: Using postgres connection "master"
[0m19:58:20.626498 [debug] [MainThread]: On master: COMMIT
[0m19:58:20.626704 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:58:20.626862 [debug] [MainThread]: On master: Close
[0m19:58:20.627061 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:58:20.627207 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:58:20.627337 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m19:58:20.627464 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:58:20.627620 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:58:20.627827 [info ] [MainThread]: 
[0m19:58:20.628015 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m19:58:20.628499 [debug] [MainThread]: Command end result
[0m19:58:20.641460 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:58:20.642289 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:58:20.645016 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:58:20.645204 [info ] [MainThread]: 
[0m19:58:20.645388 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:58:20.645551 [info ] [MainThread]: 
[0m19:58:20.645731 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:58:20.645902 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:58:20.646057 [info ] [MainThread]: 
[0m19:58:20.646253 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:58:20.646438 [info ] [MainThread]: 
[0m19:58:20.646623 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m19:58:20.647119 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.48410943, "process_in_blocks": "0", "process_kernel_time": 0.097319, "process_mem_max_rss": "130968", "process_out_blocks": "2156", "process_user_time": 1.056473}
[0m19:58:20.647389 [debug] [MainThread]: Command `dbt run` failed at 19:58:20.647348 after 0.48 seconds
[0m19:58:20.647609 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b7c090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84fadb50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b5b990>]}
[0m19:58:20.647796 [debug] [MainThread]: Flushing usage events
[0m19:58:21.095909 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m19:59:28.172537 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e4a3410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e495190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e4a1c10>]}


============================== 19:59:28.176383 | e799a359-b209-4f46-bfe8-cbe4488dda45 ==============================
[0m19:59:28.176383 [info ] [MainThread]: Running with dbt=1.11.3
[0m19:59:28.176717 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'True', 'use_colors': 'True', 'static_parser': 'True', 'printer_width': '80', 'version_check': 'True', 'introspect': 'True', 'indirect_selection': 'eager', 'profiles_dir': '.', 'log_cache_events': 'False', 'warn_error': 'None', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'no_print': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'empty': 'False', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'debug': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'quiet': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs'}
[0m19:59:28.242849 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d957910>]}
[0m19:59:28.262501 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0ed6fd0>]}
[0m19:59:28.262907 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m19:59:28.287940 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m19:59:28.335692 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m19:59:28.335974 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m19:59:28.336166 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m19:59:28.353014 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d963a90>]}
[0m19:59:28.386843 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:59:28.387798 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:59:28.397300 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d8d7210>]}
[0m19:59:28.397657 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m19:59:28.397864 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d9ac710>]}
[0m19:59:28.398808 [info ] [MainThread]: 
[0m19:59:28.399038 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m19:59:28.399311 [info ] [MainThread]: 
[0m19:59:28.399612 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m19:59:28.401312 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:59:28.401632 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:59:28.406023 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m19:59:28.442158 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:59:28.442367 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:59:28.442515 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m19:59:28.442754 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:59:28.442999 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:59:28.443227 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m19:59:28.443457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:59:28.443667 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:59:28.443873 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m19:59:28.449433 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m19:59:28.449752 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m19:59:28.449925 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m19:59:28.450422 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:59:28.450946 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:59:28.451432 [debug] [ThreadPool]: On list_warehouse: Close
[0m19:59:28.452798 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m19:59:28.453089 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m19:59:28.455504 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:59:28.455683 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m19:59:28.456517 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:59:28.456718 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m19:59:28.457530 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:59:28.457732 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m19:59:28.457922 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:59:28.458110 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m19:59:28.458298 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:59:28.458638 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m19:59:28.462164 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:59:28.462452 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m19:59:28.462608 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:59:28.462872 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m19:59:28.463038 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m19:59:28.463203 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m19:59:28.463577 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m19:59:28.463776 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m19:59:28.464022 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m19:59:28.466263 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m19:59:28.467237 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m19:59:28.466689 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m19:59:28.466395 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m19:59:28.467507 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m19:59:28.467882 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m19:59:28.468326 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m19:59:28.468928 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m19:59:28.469116 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m19:59:28.471633 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.471902 [debug] [MainThread]: On master: BEGIN
[0m19:59:28.472086 [debug] [MainThread]: Opening a new connection, currently in state init
[0m19:59:28.475142 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:59:28.475397 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.475593 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m19:59:28.485108 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m19:59:28.485662 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d93f550>]}
[0m19:59:28.485942 [debug] [MainThread]: On master: ROLLBACK
[0m19:59:28.486191 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.486358 [debug] [MainThread]: On master: BEGIN
[0m19:59:28.486636 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m19:59:28.486817 [debug] [MainThread]: On master: COMMIT
[0m19:59:28.486967 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.487102 [debug] [MainThread]: On master: COMMIT
[0m19:59:28.487304 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:59:28.487483 [debug] [MainThread]: On master: Close
[0m19:59:28.489525 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:59:28.489705 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:59:28.489859 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:59:28.490119 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m19:59:28.490457 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m19:59:28.490776 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m19:59:28.491096 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m19:59:28.491403 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m19:59:28.491664 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m19:59:28.491863 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:59:28.492095 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:59:28.492316 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m19:59:28.495176 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.496237 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.497297 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.498614 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:59:28.498982 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:59:28.511865 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.512208 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m19:59:28.513696 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.515166 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.515514 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.515860 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.516036 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m19:59:28.516541 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m19:59:28.516361 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m19:59:28.516221 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.516849 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:59:28.517060 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m19:59:28.517433 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m19:59:28.520816 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m19:59:28.520998 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m19:59:28.521672 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.521449 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m19:59:28.521252 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.521857 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m19:59:28.522063 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.522277 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m19:59:28.522582 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m19:59:28.526590 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:59:28.526758 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:59:28.526902 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m19:59:28.529419 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.530613 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.531699 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.531862 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m19:59:28.532048 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m19:59:28.532248 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m19:59:28.532679 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.532871 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.533047 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.536068 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.535107 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.534029 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.536619 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m19:59:28.536438 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m19:59:28.536236 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m19:59:28.536960 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.537190 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.537327 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m19:59:28.543972 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:59:28.543429 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:59:28.542789 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:59:28.544576 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.544381 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.544158 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.544754 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m19:59:28.544968 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m19:59:28.545143 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m19:59:28.545999 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m19:59:28.548941 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m19:59:28.549091 [debug] [Thread-1 (]: SQL status: COMMIT in 0.004 seconds
[0m19:59:28.549236 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m19:59:28.550960 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m19:59:28.552961 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m19:59:28.552744 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m19:59:28.551842 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m19:59:28.553378 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m19:59:28.553767 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m19:59:28.554020 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m19:59:28.554179 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:59:28.554346 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m19:59:28.555433 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m19:59:28.555589 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:59:28.556444 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m19:59:28.556977 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m19:59:28.557138 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c18a150>]}
[0m19:59:28.557645 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m19:59:28.557938 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9d3b8a10>]}
[0m19:59:28.558268 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m19:59:28.558638 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c18a150>]}
[0m19:59:28.558970 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m19:59:28.559353 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m19:59:28.559636 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m19:59:28.559944 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m19:59:28.560304 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m19:59:28.560639 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m19:59:28.560932 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m19:59:28.561164 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m19:59:28.561561 [info ] [Thread-2 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m19:59:28.561908 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m19:59:28.562126 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m19:59:28.562350 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m19:59:28.562590 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m19:59:28.566226 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m19:59:28.567493 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.568250 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m19:59:28.568463 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m19:59:28.582581 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m19:59:28.584035 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.584499 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp195928583497"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m19:59:28.584266 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp195928577555"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m19:59:28.584940 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m19:59:28.584692 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m19:59:28.590026 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m19:59:28.590404 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m19:59:28.593467 [debug] [Thread-4 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:59:28.594052 [debug] [Thread-2 (]: SQL status: SELECT 0 in 0.009 seconds
[0m19:59:28.594304 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff956e5910>]}
[0m19:59:28.598952 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m19:59:28.600020 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m19:59:28.599778 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.600288 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m19:59:28.600458 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m19:59:28.601030 [debug] [Thread-2 (]: SQL status: BEGIN in 0.000 seconds
[0m19:59:28.601219 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.601383 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp195928583497'
        
      order by ordinal_position

  
[0m19:59:28.605766 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.004 seconds
[0m19:59:28.608692 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.608907 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:59:28.610028 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:59:28.613186 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.613412 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m19:59:28.614390 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m19:59:28.619517 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.620064 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.620279 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp195928583497" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp195928583497"
    )
  
[0m19:59:28.620858 [debug] [Thread-2 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m19:59:28.621428 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:59:28.621608 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m19:59:28.621767 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m19:59:28.622203 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m19:59:28.622574 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m19:59:28.622859 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e799a359-b209-4f46-bfe8-cbe4488dda45', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff957a7190>]}
[0m19:59:28.623309 [info ] [Thread-2 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m19:59:28.623598 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m19:59:28.624250 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m19:59:28.624477 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m19:59:28.624726 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m19:59:28.626094 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.626305 [debug] [MainThread]: On master: BEGIN
[0m19:59:28.626467 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m19:59:28.628986 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m19:59:28.629149 [debug] [MainThread]: On master: COMMIT
[0m19:59:28.629323 [debug] [MainThread]: Using postgres connection "master"
[0m19:59:28.629478 [debug] [MainThread]: On master: COMMIT
[0m19:59:28.629657 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m19:59:28.629801 [debug] [MainThread]: On master: Close
[0m19:59:28.630509 [debug] [MainThread]: Connection 'master' was properly closed.
[0m19:59:28.630698 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m19:59:28.630833 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m19:59:28.630979 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m19:59:28.631122 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m19:59:28.631329 [info ] [MainThread]: 
[0m19:59:28.631587 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m19:59:28.632404 [debug] [MainThread]: Command end result
[0m19:59:28.644866 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m19:59:28.645733 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m19:59:28.648486 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m19:59:28.648664 [info ] [MainThread]: 
[0m19:59:28.648890 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m19:59:28.649095 [info ] [MainThread]: 
[0m19:59:28.649332 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m19:59:28.649550 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m19:59:28.649729 [info ] [MainThread]: 
[0m19:59:28.649956 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m19:59:28.650192 [info ] [MainThread]: 
[0m19:59:28.650395 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m19:59:28.650883 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.49709332, "process_in_blocks": "0", "process_kernel_time": 0.104285, "process_mem_max_rss": "130932", "process_out_blocks": "2156", "process_user_time": 1.086971}
[0m19:59:28.651133 [debug] [MainThread]: Command `dbt run` failed at 19:59:28.651090 after 0.50 seconds
[0m19:59:28.651340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa334cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e497b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e497c50>]}
[0m19:59:28.651533 [debug] [MainThread]: Flushing usage events
[0m19:59:29.138528 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:00:22.263086 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa510de10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5105190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa55f1b90>]}


============================== 20:00:22.265735 | b6b6be89-e0a4-4155-86d1-8fcee6b9492c ==============================
[0m20:00:22.265735 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:00:22.266054 [debug] [MainThread]: running dbt with arguments {'empty': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'debug': 'False', 'use_colors': 'True', 'invocation_command': 'dbt run', 'log_path': '/opt/bluealpha/dbt_project/logs', 'no_print': 'None', 'profiles_dir': '/opt/bluealpha/dbt_project', 'use_experimental_parser': 'False', 'static_parser': 'True', 'cache_selected_only': 'False', 'write_json': 'True', 'version_check': 'True', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_format': 'default', 'quiet': 'False', 'target_path': 'None', 'warn_error': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'introspect': 'True'}
[0m20:00:22.327584 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5c8a710>]}
[0m20:00:22.347172 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7bf5510>]}
[0m20:00:22.347548 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:00:22.371750 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:00:22.419754 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:00:22.420015 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:00:22.420153 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:00:22.436513 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4271050>]}
[0m20:00:22.469328 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:00:22.470142 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:00:22.480488 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa6e30c90>]}
[0m20:00:22.480795 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:00:22.481017 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa45d4490>]}
[0m20:00:22.481965 [info ] [MainThread]: 
[0m20:00:22.482162 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:00:22.482318 [info ] [MainThread]: 
[0m20:00:22.482592 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:00:22.484177 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:00:22.484449 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:00:22.488945 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:00:22.520424 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:00:22.520633 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:00:22.520802 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:00:22.521034 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:00:22.521263 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:00:22.521499 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:00:22.521726 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:00:22.521935 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:00:22.522140 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:00:22.527281 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:00:22.527453 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:00:22.527609 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:00:22.528165 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:00:22.528714 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:00:22.529180 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:00:22.530768 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:00:22.531043 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:00:22.531293 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:00:22.533577 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:00:22.534460 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:00:22.535337 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:00:22.535570 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:00:22.535791 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:00:22.535997 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:00:22.536192 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:00:22.536397 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:00:22.536602 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:00:22.540572 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:00:22.540875 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:00:22.541079 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:00:22.541217 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:00:22.541437 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:00:22.541667 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:00:22.541873 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:00:22.542100 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:00:22.542334 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:00:22.544817 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:00:22.544989 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:00:22.545144 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:00:22.545806 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:00:22.546282 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:00:22.546779 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:00:22.547094 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:00:22.547244 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:00:22.547443 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:00:22.550449 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.550793 [debug] [MainThread]: On master: BEGIN
[0m20:00:22.550987 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:00:22.553893 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:00:22.554095 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.554272 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:00:22.563697 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:00:22.564249 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa27de050>]}
[0m20:00:22.564566 [debug] [MainThread]: On master: ROLLBACK
[0m20:00:22.564822 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.564978 [debug] [MainThread]: On master: BEGIN
[0m20:00:22.565242 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:00:22.565408 [debug] [MainThread]: On master: COMMIT
[0m20:00:22.565675 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.565871 [debug] [MainThread]: On master: COMMIT
[0m20:00:22.566106 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:00:22.566310 [debug] [MainThread]: On master: Close
[0m20:00:22.568322 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:00:22.568527 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:00:22.568715 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:00:22.568986 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:00:22.569309 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:00:22.569635 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:00:22.569937 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:00:22.570184 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:00:22.570423 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:00:22.570676 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:00:22.570907 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:00:22.571129 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:00:22.574067 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.575180 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.576196 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.576961 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:00:22.577267 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:00:22.590198 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.590370 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:00:22.591703 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.593245 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.594051 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.594453 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.594761 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:00:22.595050 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.595227 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:00:22.595444 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:00:22.595680 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:00:22.595893 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:00:22.596249 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:00:22.600066 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:00:22.600311 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:00:22.600591 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:00:22.600813 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.601052 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.601271 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.601502 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:00:22.601788 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:00:22.602049 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:00:22.605464 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:00:22.605641 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:00:22.605794 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:00:22.608383 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.609625 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.610774 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.610972 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:00:22.611183 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:00:22.611408 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:00:22.611896 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.612046 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.612188 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.613253 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.614446 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.615549 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.615747 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:00:22.615984 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:00:22.616255 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:00:22.616772 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.616955 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.617103 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:00:22.622722 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:00:22.623368 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:00:22.623980 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:00:22.624187 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.624408 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.624678 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.624888 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:00:22.625107 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:00:22.625347 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:00:22.626025 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m20:00:22.628970 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:00:22.629134 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m20:00:22.629287 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m20:00:22.631273 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:00:22.632288 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:00:22.633325 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:00:22.633604 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:00:22.634018 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:00:22.634599 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:00:22.635457 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:00:22.635836 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:00:22.636341 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:00:22.637714 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:00:22.637882 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m20:00:22.638025 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:00:22.639165 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:00:22.639334 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa404a3d0>]}
[0m20:00:22.639913 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:00:22.640225 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa24f9c10>]}
[0m20:00:22.640559 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:00:22.640939 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa24fb290>]}
[0m20:00:22.641240 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:00:22.641657 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:00:22.642033 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:00:22.642365 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:00:22.642750 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:00:22.642978 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:00:22.643366 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:00:22.643794 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:00:22.644064 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m20:00:22.644320 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:00:22.644554 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:00:22.644760 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m20:00:22.648157 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.648386 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:00:22.650219 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:00:22.650806 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:00:22.651132 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:00:22.664835 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.666264 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:00:22.666533 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200022659721"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:00:22.666773 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200022665693"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m20:00:22.667133 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:00:22.667330 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:00:22.671244 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m20:00:22.671603 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:00:22.674012 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m20:00:22.674373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa4024290>]}
[0m20:00:22.674735 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m20:00:22.674938 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.008 seconds
[0m20:00:22.675192 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:00:22.680214 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.680542 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m20:00:22.680764 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:00:22.681452 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m20:00:22.681678 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.681904 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200022659721'
        
      order by ordinal_position

  
[0m20:00:22.686204 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.004 seconds
[0m20:00:22.689085 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.689332 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:00:22.690517 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:00:22.693674 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.693911 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:00:22.694908 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:00:22.700038 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.700667 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.700895 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200022659721" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200022659721"
    )
  
[0m20:00:22.701531 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m20:00:22.702124 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:00:22.702338 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:00:22.702519 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:00:22.702941 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m20:00:22.703258 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:00:22.703579 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'b6b6be89-e0a4-4155-86d1-8fcee6b9492c', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa25f3610>]}
[0m20:00:22.704139 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m20:00:22.704511 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:00:22.705026 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:00:22.705264 [info ] [Thread-2 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m20:00:22.705531 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:00:22.706310 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.706499 [debug] [MainThread]: On master: BEGIN
[0m20:00:22.706647 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:00:22.709423 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:00:22.709621 [debug] [MainThread]: On master: COMMIT
[0m20:00:22.709784 [debug] [MainThread]: Using postgres connection "master"
[0m20:00:22.709920 [debug] [MainThread]: On master: COMMIT
[0m20:00:22.710093 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:00:22.710248 [debug] [MainThread]: On master: Close
[0m20:00:22.710437 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:00:22.710591 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:00:22.710830 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m20:00:22.711003 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:00:22.711140 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:00:22.711332 [info ] [MainThread]: 
[0m20:00:22.711502 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m20:00:22.711970 [debug] [MainThread]: Command end result
[0m20:00:22.724702 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:00:22.725775 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:00:22.729026 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:00:22.729260 [info ] [MainThread]: 
[0m20:00:22.729459 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:00:22.729632 [info ] [MainThread]: 
[0m20:00:22.729900 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m20:00:22.730211 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m20:00:22.730454 [info ] [MainThread]: 
[0m20:00:22.730711 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m20:00:22.730882 [info ] [MainThread]: 
[0m20:00:22.731066 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m20:00:22.731658 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.48736787, "process_in_blocks": "0", "process_kernel_time": 0.109004, "process_mem_max_rss": "130080", "process_out_blocks": "2156", "process_user_time": 1.034042}
[0m20:00:22.731963 [debug] [MainThread]: Command `dbt run` failed at 20:00:22.731923 after 0.49 seconds
[0m20:00:22.732233 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa55f18d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa03d6210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa03e2250>]}
[0m20:00:22.732575 [debug] [MainThread]: Flushing usage events
[0m20:00:23.181216 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:02:24.994791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa31f4d50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5cd3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3265510>]}


============================== 20:02:24.998242 | cc76a933-4996-4e87-bf85-9c797abef9f9 ==============================
[0m20:02:24.998242 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:02:24.998666 [debug] [MainThread]: running dbt with arguments {'indirect_selection': 'eager', 'warn_error': 'None', 'printer_width': '80', 'log_format': 'default', 'empty': 'False', 'use_colors': 'True', 'target_path': 'None', 'static_parser': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'no_print': 'None', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'introspect': 'True', 'log_cache_events': 'False', 'partial_parse': 'True', 'fail_fast': 'False', 'invocation_command': 'dbt run', 'write_json': 'True', 'debug': 'False', 'version_check': 'True', 'profiles_dir': '/opt/bluealpha/dbt_project'}
[0m20:02:25.076262 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa267bf10>]}
[0m20:02:25.096936 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5cdd790>]}
[0m20:02:25.097487 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:02:25.124641 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:02:25.173328 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:02:25.173653 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:02:25.173877 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:02:25.190535 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa236ffd0>]}
[0m20:02:25.224148 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:02:25.225108 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:02:25.234313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa22af4d0>]}
[0m20:02:25.234594 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:02:25.234792 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa31fe290>]}
[0m20:02:25.235723 [info ] [MainThread]: 
[0m20:02:25.235908 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:02:25.236065 [info ] [MainThread]: 
[0m20:02:25.236347 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:02:25.238101 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:02:25.238406 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:02:25.243061 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:02:25.285413 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:02:25.285662 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:02:25.285855 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:02:25.286176 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:02:25.286454 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:02:25.286714 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:02:25.286981 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:02:25.287207 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:02:25.287425 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:02:25.293557 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:02:25.293827 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:02:25.294055 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:02:25.294749 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:02:25.295391 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:02:25.295985 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:02:25.297998 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:02:25.298345 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:02:25.298688 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:02:25.301620 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:02:25.302740 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:02:25.303749 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:02:25.304043 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:02:25.304297 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:02:25.304595 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:02:25.304857 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:25.305184 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:25.305487 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:02:25.309912 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:02:25.310124 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:02:25.310268 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:02:25.310452 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:02:25.310664 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:02:25.310824 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:02:25.311422 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:02:25.311226 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:02:25.311009 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:02:25.314014 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:02:25.314168 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:02:25.314295 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m20:02:25.314977 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:02:25.315482 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:02:25.315994 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:02:25.316294 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:02:25.316501 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:02:25.316691 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:02:25.319682 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.319906 [debug] [MainThread]: On master: BEGIN
[0m20:02:25.320086 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:02:25.323225 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:02:25.323462 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.323679 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:02:25.333473 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m20:02:25.334105 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2147fd0>]}
[0m20:02:25.334361 [debug] [MainThread]: On master: ROLLBACK
[0m20:02:25.334614 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.334765 [debug] [MainThread]: On master: BEGIN
[0m20:02:25.335064 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:02:25.335252 [debug] [MainThread]: On master: COMMIT
[0m20:02:25.335401 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.335537 [debug] [MainThread]: On master: COMMIT
[0m20:02:25.335731 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:02:25.335921 [debug] [MainThread]: On master: Close
[0m20:02:25.337979 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:02:25.338179 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:02:25.338341 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:02:25.338624 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:02:25.338960 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:02:25.339314 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:02:25.339628 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:02:25.339902 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:02:25.340170 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:02:25.340436 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:02:25.340660 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:02:25.340949 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:02:25.343956 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.345125 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.346172 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.346982 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:02:25.347174 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:02:25.361010 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.361225 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:02:25.362723 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.364250 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.364630 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.364967 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:02:25.365183 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.365400 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.365543 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:02:25.365771 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:02:25.365977 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:02:25.366354 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:02:25.366598 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:02:25.370036 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m20:02:25.370224 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:02:25.370401 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:02:25.370601 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.370828 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.371137 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.371431 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:02:25.371763 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:02:25.372048 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:02:25.376227 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:02:25.376406 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:02:25.376561 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:02:25.379265 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.380428 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.381581 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.381819 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:02:25.382023 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:02:25.382256 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:02:25.382764 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.382926 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.383070 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.384203 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.385258 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.386382 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.386609 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:02:25.386816 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:02:25.387043 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:02:25.387479 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.387637 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.387779 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:02:25.393351 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:02:25.394003 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:02:25.394612 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:02:25.394846 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.395093 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.395333 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.395591 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:02:25.395794 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:02:25.396021 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:02:25.396699 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m20:02:25.396900 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:02:25.397055 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:02:25.400114 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:02:25.401033 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:02:25.401943 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:02:25.403832 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:02:25.404203 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:02:25.404549 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:02:25.404749 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:02:25.404919 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:02:25.405112 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:02:25.406346 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:02:25.406524 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:02:25.406683 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:02:25.407719 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:02:25.408505 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:02:25.409155 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:02:25.410088 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa06c0810>]}
[0m20:02:25.410424 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa06c5650>]}
[0m20:02:25.410699 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa06c4050>]}
[0m20:02:25.411117 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:02:25.411480 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:02:25.411829 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:02:25.412153 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:02:25.412426 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:02:25.412743 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:02:25.413211 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:02:25.413553 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:02:25.413775 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:02:25.414066 [info ] [Thread-2 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:02:25.414367 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m20:02:25.414607 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m20:02:25.414825 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:02:25.415052 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:02:25.419399 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:02:25.421119 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.422108 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:02:25.422341 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:02:25.437309 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:02:25.438994 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.439313 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200225431821"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
    
    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")
    
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned
  );
  
  
[0m20:02:25.439581 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200225438376"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:02:25.439878 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:02:25.440148 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:02:25.444904 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                   ^

[0m20:02:25.445579 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:02:25.448292 [debug] [Thread-4 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m20:02:25.448506 [debug] [Thread-2 (]: SQL status: SELECT 0 in 0.008 seconds
[0m20:02:25.448825 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa06d50d0>]}
[0m20:02:25.454612 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.455092 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m20:02:25.455444 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:02:25.455750 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:02:25.456270 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^.
[0m20:02:25.456446 [debug] [Thread-2 (]: SQL status: BEGIN in 0.000 seconds
[0m20:02:25.457115 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.457415 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200225438376'
        
      order by ordinal_position

  
[0m20:02:25.462908 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.005 seconds
[0m20:02:25.466081 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.466371 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:02:25.467694 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:02:25.470953 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.471204 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:02:25.472222 [debug] [Thread-2 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:02:25.477824 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.478529 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.478772 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200225438376" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200225438376"
    )
  
[0m20:02:25.479421 [debug] [Thread-2 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m20:02:25.480014 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:02:25.480214 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:02:25.480418 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:02:25.481110 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:02:25.481447 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:02:25.481768 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'cc76a933-4996-4e87-bf85-9c797abef9f9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2122f50>]}
[0m20:02:25.482239 [info ] [Thread-2 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.07s]
[0m20:02:25.482669 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:02:25.483234 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:02:25.483473 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m20:02:25.483690 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:02:25.484529 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.484768 [debug] [MainThread]: On master: BEGIN
[0m20:02:25.484973 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:02:25.488251 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:02:25.488472 [debug] [MainThread]: On master: COMMIT
[0m20:02:25.488659 [debug] [MainThread]: Using postgres connection "master"
[0m20:02:25.488808 [debug] [MainThread]: On master: COMMIT
[0m20:02:25.489022 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:02:25.489168 [debug] [MainThread]: On master: Close
[0m20:02:25.489377 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:02:25.489543 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m20:02:25.489678 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m20:02:25.489806 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:02:25.489938 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:02:25.490152 [info ] [MainThread]: 
[0m20:02:25.490397 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m20:02:25.491147 [debug] [MainThread]: Command end result
[0m20:02:25.503954 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:02:25.504868 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:02:25.507571 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:02:25.507773 [info ] [MainThread]: 
[0m20:02:25.507978 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:02:25.508203 [info ] [MainThread]: 
[0m20:02:25.508452 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m20:02:25.508663 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 35:     and load_ts > (select max(load_ts) from "warehouse"."sta...
                                     ^
[0m20:02:25.508833 [info ] [MainThread]: 
[0m20:02:25.509053 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m20:02:25.509218 [info ] [MainThread]: 
[0m20:02:25.509399 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m20:02:25.509916 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.5369094, "process_in_blocks": "0", "process_kernel_time": 0.181004, "process_mem_max_rss": "130544", "process_out_blocks": "2156", "process_user_time": 1.125244}
[0m20:02:25.510138 [debug] [MainThread]: Command `dbt run` failed at 20:02:25.510102 after 0.54 seconds
[0m20:02:25.510337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa3433a50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7efec90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa31f7e50>]}
[0m20:02:25.510510 [debug] [MainThread]: Flushing usage events
[0m20:02:25.996392 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:03:07.533338 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5ee2d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5ee35d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5ee1950>]}


============================== 20:03:07.536558 | ee79807d-8b1b-440b-a20c-87c2da342250 ==============================
[0m20:03:07.536558 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:03:07.536932 [debug] [MainThread]: running dbt with arguments {'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'log_path': '/opt/bluealpha/dbt_project/logs', 'log_cache_events': 'False', 'partial_parse': 'True', 'debug': 'False', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'warn_error': 'None', 'quiet': 'False', 'no_print': 'None', 'empty': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'use_colors': 'True', 'indirect_selection': 'eager', 'printer_width': '80', 'introspect': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'invocation_command': 'dbt run --profiles-dir .', 'fail_fast': 'False', 'target_path': 'None', 'write_json': 'True'}
[0m20:03:07.611860 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb52cae50>]}
[0m20:03:07.633795 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb88b6ed0>]}
[0m20:03:07.634316 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:03:07.665642 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:03:07.718589 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:03:07.718985 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_campaign_daily.sql
[0m20:03:07.881756 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4e9bf50>]}
[0m20:03:07.917977 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:03:07.918854 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:03:07.928008 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4f20950>]}
[0m20:03:07.928302 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:03:07.928487 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb73dcb90>]}
[0m20:03:07.929568 [info ] [MainThread]: 
[0m20:03:07.929847 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:03:07.930062 [info ] [MainThread]: 
[0m20:03:07.930415 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:03:07.932234 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:03:07.932579 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:03:07.937397 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:03:07.950366 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:03:07.950563 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:03:07.950727 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:03:07.950932 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:03:07.951146 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:03:07.951356 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:03:07.951561 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:07.951787 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:07.952052 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:03:07.960905 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m20:03:07.961083 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.010 seconds
[0m20:03:07.961221 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.009 seconds
[0m20:03:07.961776 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:03:07.962277 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:03:07.962807 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:03:07.964130 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:03:07.964470 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:03:07.966958 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:03:07.967136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:03:07.968109 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:03:07.968334 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:03:07.969186 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:03:07.969415 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:03:07.969623 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:07.969846 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:03:07.970080 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:07.970470 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:03:07.974429 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:03:07.974958 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:03:07.975177 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:03:07.975344 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m20:03:07.975533 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:03:07.975773 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:03:07.976009 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:03:07.976318 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:03:07.976633 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:03:07.978947 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:03:07.979121 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m20:03:07.979811 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:03:07.979977 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m20:03:07.980446 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:03:07.980704 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:03:07.981144 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:03:07.981381 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:03:07.981916 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:03:07.984537 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:07.984733 [debug] [MainThread]: On master: BEGIN
[0m20:03:07.984903 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:03:07.988247 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:03:07.988464 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:07.988672 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:03:07.998477 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m20:03:07.999006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb69dd2d0>]}
[0m20:03:07.999258 [debug] [MainThread]: On master: ROLLBACK
[0m20:03:07.999496 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:07.999684 [debug] [MainThread]: On master: BEGIN
[0m20:03:07.999981 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:03:08.000160 [debug] [MainThread]: On master: COMMIT
[0m20:03:08.000337 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:08.000495 [debug] [MainThread]: On master: COMMIT
[0m20:03:08.000739 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:03:08.000922 [debug] [MainThread]: On master: Close
[0m20:03:08.002937 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:03:08.003121 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:03:08.003281 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:03:08.003545 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:03:08.003883 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:03:08.004206 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:03:08.004543 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:03:08.004878 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:03:08.005144 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:03:08.005403 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:03:08.005644 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:03:08.005866 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:03:08.008775 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.010514 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.011484 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.014286 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:03:08.014580 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:03:08.026544 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.026815 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:03:08.028273 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.029884 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.030301 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.030555 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.030863 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:03:08.031096 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:03:08.031267 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.031457 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:08.031653 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:03:08.031841 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:03:08.032453 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:03:08.035879 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:03:08.036059 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:03:08.036215 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:03:08.036411 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.036644 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.036871 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.037081 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:03:08.037348 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:03:08.037615 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:03:08.044097 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m20:03:08.044332 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m20:03:08.044518 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m20:03:08.047544 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.048879 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.050310 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.050556 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:03:08.050802 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:03:08.051033 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:03:08.051559 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.051736 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.051897 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.053145 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.054857 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.055963 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.056163 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:03:08.056382 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:03:08.056584 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:03:08.057028 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.057238 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.057433 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:03:08.063106 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:03:08.063910 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:03:08.064639 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:03:08.064886 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.065083 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.065304 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.065526 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:03:08.065710 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:03:08.065921 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:03:08.066638 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m20:03:08.066811 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m20:03:08.066962 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:03:08.069346 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:03:08.070270 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:03:08.071198 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:03:08.073126 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:03:08.073492 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:03:08.073801 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:03:08.074000 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:03:08.074208 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:03:08.074384 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:03:08.077765 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m20:03:08.077933 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.003 seconds
[0m20:03:08.078087 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.003 seconds
[0m20:03:08.079091 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:03:08.079601 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:03:08.080145 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:03:08.081138 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8970990>]}
[0m20:03:08.081330 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb40e8250>]}
[0m20:03:08.081625 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb414a210>]}
[0m20:03:08.081979 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m20:03:08.082416 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.08s]
[0m20:03:08.082780 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m20:03:08.083132 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:03:08.083415 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:03:08.083677 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:03:08.084066 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:03:08.084489 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:03:08.084722 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:03:08.085014 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:03:08.085338 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m20:03:08.085571 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m20:03:08.085804 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:03:08.086023 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:03:08.088416 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.089913 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:03:08.090814 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:03:08.096687 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:03:08.105353 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.107427 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:03:08.107660 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200308100406"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:03:08.107882 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200308106908"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m20:03:08.108132 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:03:08.108314 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:03:08.112885 [debug] [Thread-1 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m20:03:08.113268 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:03:08.115496 [debug] [Thread-1 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:03:08.116092 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffacf59050>]}
[0m20:03:08.116566 [error] [Thread-1 (]: 5 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m20:03:08.117091 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:03:08.117890 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m20:03:08.119062 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.011 seconds
[0m20:03:08.124066 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.124290 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:03:08.124621 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m20:03:08.124825 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.125026 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200308100406'
        
      order by ordinal_position

  
[0m20:03:08.129891 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.005 seconds
[0m20:03:08.131868 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.132090 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:03:08.133207 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:03:08.136373 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.136594 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:03:08.137545 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:03:08.142814 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.143371 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.143592 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200308100406" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200308100406"
    )
  
[0m20:03:08.144249 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m20:03:08.144787 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:03:08.144963 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:03:08.145113 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:03:08.145539 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m20:03:08.145852 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:03:08.146141 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'ee79807d-8b1b-440b-a20c-87c2da342250', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4209290>]}
[0m20:03:08.146562 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m20:03:08.147280 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:03:08.147922 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:03:08.148174 [info ] [Thread-3 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m20:03:08.148473 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:03:08.149242 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:08.149416 [debug] [MainThread]: On master: BEGIN
[0m20:03:08.149560 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:03:08.152668 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:03:08.152866 [debug] [MainThread]: On master: COMMIT
[0m20:03:08.153050 [debug] [MainThread]: Using postgres connection "master"
[0m20:03:08.153192 [debug] [MainThread]: On master: COMMIT
[0m20:03:08.153357 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:03:08.153484 [debug] [MainThread]: On master: Close
[0m20:03:08.153675 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:03:08.153821 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:03:08.153948 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m20:03:08.154078 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:03:08.154274 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:03:08.154644 [info ] [MainThread]: 
[0m20:03:08.154885 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m20:03:08.155426 [debug] [MainThread]: Command end result
[0m20:03:08.168117 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:03:08.168942 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:03:08.171464 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:03:08.171648 [info ] [MainThread]: 
[0m20:03:08.172009 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:03:08.172285 [info ] [MainThread]: 
[0m20:03:08.172518 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m20:03:08.172776 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:03:08.173087 [info ] [MainThread]: 
[0m20:03:08.173313 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m20:03:08.173492 [info ] [MainThread]: 
[0m20:03:08.173762 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m20:03:08.174366 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.660082, "process_in_blocks": "0", "process_kernel_time": 0.214224, "process_mem_max_rss": "134576", "process_out_blocks": "3115", "process_user_time": 1.222572}
[0m20:03:08.174596 [debug] [MainThread]: Command `dbt run` failed at 20:03:08.174563 after 0.66 seconds
[0m20:03:08.174798 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbad2cb10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb69dd110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5e71f90>]}
[0m20:03:08.175006 [debug] [MainThread]: Flushing usage events
[0m20:03:08.647695 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:04:04.373359 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a8c3510>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a685190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a691790>]}


============================== 20:04:04.376814 | c6c59f5a-4dfa-417a-aba5-d600326bb2b2 ==============================
[0m20:04:04.376814 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:04:04.377181 [debug] [MainThread]: running dbt with arguments {'partial_parse': 'False', 'debug': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'no_print': 'None', 'log_format': 'default', 'write_json': 'True', 'introspect': 'True', 'fail_fast': 'False', 'profiles_dir': '.', 'target_path': 'None', 'send_anonymous_usage_stats': 'True', 'cache_selected_only': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'quiet': 'False', 'invocation_command': 'dbt run --no-partial-parse --profiles-dir .', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'warn_error': 'None', 'log_path': '/opt/bluealpha/dbt_project/logs', 'use_colors': 'True', 'empty': 'False', 'static_parser': 'True'}
[0m20:04:04.454246 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c1ae10>]}
[0m20:04:04.474566 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d0c54d0>]}
[0m20:04:04.475017 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:04:04.501428 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:04:04.502028 [debug] [MainThread]: Partial parsing not enabled
[0m20:04:04.846850 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m20:04:04.847255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89c8d6d0>]}
[0m20:04:04.957281 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff896dca90>]}
[0m20:04:04.993192 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:04.994157 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:05.002760 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83a9bc90>]}
[0m20:04:05.003064 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:04:05.003304 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff880180d0>]}
[0m20:04:05.004249 [info ] [MainThread]: 
[0m20:04:05.004468 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:04:05.004667 [info ] [MainThread]: 
[0m20:04:05.004976 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:04:05.006678 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:05.006947 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:05.010788 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:05.022640 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:05.022815 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:05.022970 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:05.023156 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:05.023345 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:05.023536 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:05.023746 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:05.023937 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:05.024122 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:05.030420 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:04:05.030675 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:04:05.030825 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:04:05.031321 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:05.031868 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:05.032336 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:05.033564 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:04:05.033883 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:04:05.034147 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:04:05.065661 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:05.066579 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:05.067378 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:05.067606 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:04:05.067848 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:04:05.068097 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:04:05.068294 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:05.068492 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:05.068702 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:05.073180 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:04:05.073363 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:04:05.073499 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:04:05.073720 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:05.073937 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:05.074136 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:05.074347 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:04:05.074567 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:04:05.074783 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:04:05.077722 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m20:04:05.077874 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m20:04:05.078006 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m20:04:05.078573 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:04:05.079080 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:04:05.079598 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:04:05.079888 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:04:05.080073 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:04:05.080306 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:04:05.083155 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.083421 [debug] [MainThread]: On master: BEGIN
[0m20:04:05.083648 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:04:05.086475 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:05.086683 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.086896 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:04:05.096262 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:04:05.096832 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff839f5e50>]}
[0m20:04:05.097097 [debug] [MainThread]: On master: ROLLBACK
[0m20:04:05.097357 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.097544 [debug] [MainThread]: On master: BEGIN
[0m20:04:05.097847 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:04:05.098046 [debug] [MainThread]: On master: COMMIT
[0m20:04:05.098224 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.098418 [debug] [MainThread]: On master: COMMIT
[0m20:04:05.098645 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:05.098842 [debug] [MainThread]: On master: Close
[0m20:04:05.100815 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:05.100993 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:05.101157 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:05.101430 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:04:05.101889 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:04:05.102211 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:04:05.102531 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:04:05.102822 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:04:05.103065 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:04:05.103291 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:05.103515 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:05.103766 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:05.106671 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.107759 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.108798 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.109628 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:05.109894 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:05.110049 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:05.122266 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.124676 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.125987 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.126890 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.127091 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.127362 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.127544 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:04:05.127789 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:04:05.128023 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:04:05.128242 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:05.128459 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:04:05.128674 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:05.132383 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:05.132567 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:05.132721 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:05.132922 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.133142 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.133356 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.133583 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:04:05.133856 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:04:05.134120 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:04:05.137936 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:04:05.138148 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:04:05.138362 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:04:05.141051 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.142192 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.143316 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.143573 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:04:05.143806 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:04:05.144037 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:04:05.144561 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.144719 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.144854 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.145873 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.146956 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.148041 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.148259 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:04:05.148479 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:04:05.148715 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:04:05.149123 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.149308 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.149464 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:05.155154 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:05.155807 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:05.156411 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:05.156651 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.156879 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.157124 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.157346 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:05.157560 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:05.157774 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:05.159140 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:05.159328 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:05.159495 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:05.161758 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:04:05.162809 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:04:05.164415 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:04:05.166242 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:05.166758 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:05.167238 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:05.167517 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:04:05.167785 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:04:05.168030 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:04:05.169175 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:05.169351 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:05.169514 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:05.170440 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:04:05.171010 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:04:05.171521 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:04:05.172368 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89816590>]}
[0m20:04:05.172623 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89809a90>]}
[0m20:04:05.172931 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89859310>]}
[0m20:04:05.173346 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:05.173756 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:05.174133 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:05.174492 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:05.174771 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:05.175021 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:05.175472 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:05.175842 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:04:05.176045 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:04:05.176335 [info ] [Thread-3 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:04:05.176695 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m20:04:05.176959 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m20:04:05.177174 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:04:05.177362 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:04:05.180007 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:05.181336 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.182044 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:04:05.182309 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:04:05.195988 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:05.197456 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.197756 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200405191127"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m20:04:05.198015 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200405196901"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:04:05.198288 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:04:05.198526 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:05.203107 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m20:04:05.203428 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:04:05.205572 [debug] [Thread-4 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:04:05.206006 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a7eb2d0>]}
[0m20:04:05.206352 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m20:04:05.206564 [debug] [Thread-3 (]: SQL status: SELECT 0 in 0.008 seconds
[0m20:04:05.206868 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:05.211878 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.212202 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m20:04:05.212401 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:04:05.213021 [debug] [Thread-3 (]: SQL status: BEGIN in 0.000 seconds
[0m20:04:05.213235 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.213425 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200405196901'
        
      order by ordinal_position

  
[0m20:04:05.218001 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.004 seconds
[0m20:04:05.220052 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.220264 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:04:05.221391 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:04:05.224749 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.224955 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:04:05.225945 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:04:05.232691 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.233479 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.233855 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200405196901" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200405196901"
    )
  
[0m20:04:05.234888 [debug] [Thread-3 (]: SQL status: INSERT 0 0 in 0.001 seconds
[0m20:04:05.235661 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:05.235901 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:05.236112 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:05.236807 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m20:04:05.237318 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:04:05.237733 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c6c59f5a-4dfa-417a-aba5-d600326bb2b2', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89beac90>]}
[0m20:04:05.238129 [info ] [Thread-3 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m20:04:05.238574 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:04:05.239055 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:05.239450 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m20:04:05.239711 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:05.240478 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.240694 [debug] [MainThread]: On master: BEGIN
[0m20:04:05.240867 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:04:05.243714 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:05.243924 [debug] [MainThread]: On master: COMMIT
[0m20:04:05.244104 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:05.244301 [debug] [MainThread]: On master: COMMIT
[0m20:04:05.244639 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:05.244872 [debug] [MainThread]: On master: Close
[0m20:04:05.245120 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:04:05.245297 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:04:05.245444 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:04:05.245614 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m20:04:05.245763 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:04:05.246003 [info ] [MainThread]: 
[0m20:04:05.246261 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m20:04:05.246815 [debug] [MainThread]: Command end result
[0m20:04:05.260642 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:05.261724 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:05.264567 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:04:05.264841 [info ] [MainThread]: 
[0m20:04:05.265079 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:04:05.265367 [info ] [MainThread]: 
[0m20:04:05.265645 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m20:04:05.265870 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:04:05.266078 [info ] [MainThread]: 
[0m20:04:05.266330 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m20:04:05.266542 [info ] [MainThread]: 
[0m20:04:05.266758 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m20:04:05.267086 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m20:04:05.267616 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.9146998, "process_in_blocks": "0", "process_kernel_time": 0.210731, "process_mem_max_rss": "136480", "process_out_blocks": "3109", "process_user_time": 1.488166}
[0m20:04:05.267877 [debug] [MainThread]: Command `dbt run` failed at 20:04:05.267836 after 0.92 seconds
[0m20:04:05.268083 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b3bc90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b38e10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83b3ac90>]}
[0m20:04:05.268294 [debug] [MainThread]: Flushing usage events
[0m20:04:05.757780 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:04:30.893820 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff93227850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9305bf10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92ffb290>]}


============================== 20:04:30.896487 | 05184d5c-727c-4089-8214-cfcb7bbe715a ==============================
[0m20:04:30.896487 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:04:30.896888 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'version_check': 'True', 'target_path': 'None', 'write_json': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'printer_width': '80', 'log_format': 'default', 'static_parser': 'True', 'fail_fast': 'False', 'quiet': 'False', 'empty': 'False', 'warn_error': 'None', 'log_path': '/opt/bluealpha/dbt_project/logs', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'use_colors': 'True', 'introspect': 'True', 'debug': 'False', 'profiles_dir': '.', 'invocation_command': 'dbt run --full-refresh --profiles-dir .'}
[0m20:04:30.956462 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff925ed890>]}
[0m20:04:30.976087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95ac6e90>]}
[0m20:04:30.976435 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:04:31.000624 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:04:31.044770 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:04:31.045095 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:04:31.045274 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:04:31.061220 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9213d250>]}
[0m20:04:31.094388 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:31.095230 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:31.103167 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9249c610>]}
[0m20:04:31.103411 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:04:31.103653 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff92238cd0>]}
[0m20:04:31.104596 [info ] [MainThread]: 
[0m20:04:31.104802 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:04:31.105037 [info ] [MainThread]: 
[0m20:04:31.105328 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:04:31.107033 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:31.107300 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:31.107567 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:31.145090 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:31.145281 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:31.145442 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:31.145673 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:31.145887 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:31.146077 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:31.146314 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:31.146532 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:31.146712 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:31.151804 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:04:31.151977 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:04:31.152114 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:04:31.152695 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:31.153200 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:31.153695 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:31.155167 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:04:31.155521 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:04:31.157826 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:31.158069 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:04:31.158928 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:31.159129 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:04:31.159912 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:31.160126 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:04:31.160307 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:31.160521 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:04:31.160732 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:31.161083 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:31.165001 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:04:31.165163 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:04:31.165291 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:04:31.165466 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:31.165700 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:31.165913 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:31.166095 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:04:31.166316 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:04:31.166538 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:04:31.169052 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:04:31.169218 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:04:31.169345 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:04:31.169957 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:04:31.170443 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:04:31.170927 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:04:31.171207 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:04:31.171435 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:04:31.171649 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:04:31.174479 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.174759 [debug] [MainThread]: On master: BEGIN
[0m20:04:31.174954 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:04:31.177998 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:31.178223 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.178442 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:04:31.187853 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:04:31.188439 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90429c90>]}
[0m20:04:31.188720 [debug] [MainThread]: On master: ROLLBACK
[0m20:04:31.188987 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.189157 [debug] [MainThread]: On master: BEGIN
[0m20:04:31.189441 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:04:31.189665 [debug] [MainThread]: On master: COMMIT
[0m20:04:31.189843 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.190009 [debug] [MainThread]: On master: COMMIT
[0m20:04:31.190237 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:31.190396 [debug] [MainThread]: On master: Close
[0m20:04:31.192401 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:31.192593 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:31.192771 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:31.193038 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:04:31.193357 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:04:31.193729 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:04:31.194034 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:04:31.194284 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:04:31.194541 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:04:31.194786 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:31.194982 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:31.195196 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:31.198109 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.199172 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.200296 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.201071 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:31.201244 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:31.214018 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.214228 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:31.215570 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.217064 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.217336 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.217756 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:04:31.217942 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.218139 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.218270 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:04:31.218474 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:04:31.218683 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:04:31.219146 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:31.219519 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:31.222401 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:31.222723 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.222910 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:31.223065 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:31.223268 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:04:31.223486 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.223702 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.224049 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:04:31.224340 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:04:31.226367 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m20:04:31.226717 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m20:04:31.229641 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.229812 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m20:04:31.231002 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.231197 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:04:31.232446 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.232667 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:04:31.232940 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:04:31.233090 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.233560 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.234641 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.234787 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m20:04:31.235866 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.236061 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:04:31.237145 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.237367 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:04:31.237689 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:04:31.237865 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.238215 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.244339 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:31.244522 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m20:04:31.245150 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:31.245347 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.245926 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:31.246147 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.246334 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:31.246567 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.246801 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:31.247105 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:31.247558 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:31.247916 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m20:04:31.250052 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:04:31.250215 [debug] [Thread-1 (]: SQL status: COMMIT in 0.002 seconds
[0m20:04:31.251141 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:04:31.253074 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:31.253970 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:04:31.254296 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:31.254463 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:04:31.254829 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:31.255024 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:04:31.255279 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:04:31.255750 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:31.256780 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:04:31.256935 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:31.257083 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:31.257770 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9054f390>]}
[0m20:04:31.258318 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:04:31.258849 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:04:31.259170 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.06s]
[0m20:04:31.259509 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff904a50d0>]}
[0m20:04:31.259835 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91f31250>]}
[0m20:04:31.260101 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:31.260458 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m20:04:31.260797 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:31.261258 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:31.261536 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:31.261909 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:31.262242 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:04:31.262456 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:04:31.262776 [info ] [Thread-3 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:04:31.263096 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m20:04:31.263347 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m20:04:31.263589 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:04:31.263808 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:04:31.267219 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.268431 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.269177 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:04:31.269343 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:04:31.282529 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.284033 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.284448 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.284768 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m20:04:31.284988 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:04:31.285266 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.285552 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:04:31.285753 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:31.288549 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:31.288799 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.288948 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m20:04:31.289140 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


  );
  
  
[0m20:04:31.289343 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.289639 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

  );
  
  
[0m20:04:31.293784 [debug] [Thread-3 (]: SQL status: SELECT 79 in 0.004 seconds
[0m20:04:31.297562 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.297738 [debug] [Thread-4 (]: SQL status: SELECT 720 in 0.008 seconds
[0m20:04:31.297965 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders" rename to "int_crm_orders__dbt_backup"
[0m20:04:31.299158 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.299600 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily" rename to "int_campaign_daily__dbt_backup"
[0m20:04:31.299754 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.300901 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.301068 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m20:04:31.301257 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp" rename to "int_crm_orders"
[0m20:04:31.302284 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.302584 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp" rename to "int_campaign_daily"
[0m20:04:31.302731 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.303024 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.303605 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:31.304176 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:04:31.304377 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.304543 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.304741 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:31.304917 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:04:31.305845 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:31.306064 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:31.307033 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup"
[0m20:04:31.307979 [debug] [Thread-4 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup"
[0m20:04:31.309132 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:31.309428 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:31.309631 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
drop table if exists "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup" cascade
[0m20:04:31.309796 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
drop table if exists "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup" cascade
[0m20:04:31.312066 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m20:04:31.312773 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:04:31.312916 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.003 seconds
[0m20:04:31.313233 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9034ef50>]}
[0m20:04:31.313744 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:04:31.314087 [info ] [Thread-3 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.05s]
[0m20:04:31.314534 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff904b3a50>]}
[0m20:04:31.314831 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:04:31.315148 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 720[0m in 0.05s]
[0m20:04:31.315632 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:31.316109 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:31.316449 [info ] [Thread-1 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m20:04:31.316737 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m20:04:31.316993 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:31.318455 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.319270 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:31.324613 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.325105 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.325275 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m20:04:31.325455 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:31.328838 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m20:04:31.329062 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.329266 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m20:04:31.334047 [debug] [Thread-1 (]: SQL status: SELECT 720 in 0.005 seconds
[0m20:04:31.335314 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.335467 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m20:04:31.335697 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.336686 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.336923 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m20:04:31.337305 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:31.337980 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:04:31.338153 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.338327 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:04:31.339022 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:31.339891 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m20:04:31.341169 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:04:31.341328 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m20:04:31.342816 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.001 seconds
[0m20:04:31.343277 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m20:04:31.343583 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '05184d5c-727c-4089-8214-cfcb7bbe715a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff901d76d0>]}
[0m20:04:31.343897 [info ] [Thread-1 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 720[0m in 0.03s]
[0m20:04:31.344253 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:31.345036 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.345236 [debug] [MainThread]: On master: BEGIN
[0m20:04:31.345407 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:04:31.348180 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:31.348367 [debug] [MainThread]: On master: COMMIT
[0m20:04:31.348540 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:31.348699 [debug] [MainThread]: On master: COMMIT
[0m20:04:31.348976 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:31.349224 [debug] [MainThread]: On master: Close
[0m20:04:31.349529 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:04:31.349712 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:04:31.349839 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m20:04:31.349958 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:04:31.350102 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:04:31.350323 [info ] [MainThread]: 
[0m20:04:31.350513 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m20:04:31.351079 [debug] [MainThread]: Command end result
[0m20:04:31.362456 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:31.363291 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:31.366039 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:04:31.366216 [info ] [MainThread]: 
[0m20:04:31.366424 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:04:31.366666 [info ] [MainThread]: 
[0m20:04:31.366857 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m20:04:31.367391 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.49175903, "process_in_blocks": "0", "process_kernel_time": 0.09124, "process_mem_max_rss": "130700", "process_out_blocks": "2177", "process_user_time": 1.067818}
[0m20:04:31.367628 [debug] [MainThread]: Command `dbt run` succeeded at 20:04:31.367596 after 0.49 seconds
[0m20:04:31.367838 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff933c4490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9303bd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97d53550>]}
[0m20:04:31.368028 [debug] [MainThread]: Flushing usage events
[0m20:04:31.834266 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:04:36.900759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d7d150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d7cd90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d7c610>]}


============================== 20:04:36.903432 | 300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa ==============================
[0m20:04:36.903432 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:04:36.903905 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'version_check': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'target_path': 'None', 'log_format': 'default', 'warn_error': 'None', 'invocation_command': 'dbt run --profiles-dir .', 'quiet': 'False', 'write_json': 'True', 'empty': 'False', 'profiles_dir': '.', 'partial_parse': 'True', 'static_parser': 'True', 'printer_width': '80', 'log_path': '/opt/bluealpha/dbt_project/logs', 'use_colors': 'True', 'no_print': 'None', 'debug': 'False', 'indirect_selection': 'eager'}
[0m20:04:36.963732 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff852c8d50>]}
[0m20:04:36.983152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff867b6dd0>]}
[0m20:04:36.983545 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:04:37.007926 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:04:37.050825 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:04:37.051096 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:04:37.051275 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:04:37.067387 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff852de550>]}
[0m20:04:37.100398 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:37.101233 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:37.109229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8339d510>]}
[0m20:04:37.109509 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:04:37.109702 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d75a50>]}
[0m20:04:37.110600 [info ] [MainThread]: 
[0m20:04:37.110825 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:04:37.111097 [info ] [MainThread]: 
[0m20:04:37.111407 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:04:37.113077 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:37.113367 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:37.117837 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:04:37.150935 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:37.151134 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:37.151291 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:04:37.151534 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:37.151785 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:37.152010 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:04:37.152218 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:37.152418 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:37.152625 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:04:37.157410 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:04:37.157598 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:04:37.157740 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:04:37.158289 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:37.158837 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:37.159291 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:04:37.160541 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:04:37.160841 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:04:37.163179 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:37.163359 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:04:37.164204 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:37.164393 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:04:37.165170 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:37.165380 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:04:37.165568 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:37.165786 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:04:37.165986 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:37.166313 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:04:37.169605 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:04:37.169918 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:04:37.170103 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:04:37.170266 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:04:37.170420 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:04:37.170647 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:04:37.170848 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:04:37.171116 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:04:37.171344 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:04:37.172730 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:04:37.173551 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:04:37.173701 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:04:37.173838 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:04:37.174069 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:04:37.174484 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:04:37.174961 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:04:37.175483 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:04:37.175744 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:04:37.178214 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.178428 [debug] [MainThread]: On master: BEGIN
[0m20:04:37.178592 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:04:37.181391 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:37.181598 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.181780 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:04:37.190982 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:04:37.191527 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8328dc90>]}
[0m20:04:37.191779 [debug] [MainThread]: On master: ROLLBACK
[0m20:04:37.192012 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.192159 [debug] [MainThread]: On master: BEGIN
[0m20:04:37.192425 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:04:37.192743 [debug] [MainThread]: On master: COMMIT
[0m20:04:37.192910 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.193074 [debug] [MainThread]: On master: COMMIT
[0m20:04:37.193280 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:37.193431 [debug] [MainThread]: On master: Close
[0m20:04:37.195408 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:37.195591 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:37.195773 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:37.196050 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:04:37.196391 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:04:37.196762 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:04:37.197083 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:04:37.197327 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:04:37.197558 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:04:37.197825 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:37.198051 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:37.198238 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:37.201096 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.202209 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.203199 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.204051 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:37.204244 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:37.204483 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:37.217186 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.218555 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.219896 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.220659 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.220905 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.221126 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:04:37.221291 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.221920 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:04:37.221714 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:04:37.221515 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:04:37.222370 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:04:37.222063 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:37.225638 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:37.225848 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m20:04:37.226024 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:04:37.226222 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.226442 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.226675 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.226902 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:04:37.227161 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:04:37.227404 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:04:37.229986 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.002 seconds
[0m20:04:37.230195 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:04:37.232970 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.233145 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m20:04:37.234321 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.234549 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:04:37.235654 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.235833 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:04:37.236151 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:04:37.236318 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.236744 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.236904 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.237993 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.239012 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.240031 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.240255 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:04:37.240473 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:04:37.240692 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:04:37.241119 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.241263 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.241390 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:04:37.247112 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:37.247765 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:37.248353 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:37.248579 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.248789 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.249007 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.249221 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:04:37.249408 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:04:37.249622 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:04:37.250333 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m20:04:37.250553 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m20:04:37.250700 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:37.253705 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:04:37.254584 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:04:37.255434 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:04:37.257316 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:04:37.257687 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:04:37.258013 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:04:37.258237 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:04:37.258455 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:04:37.258636 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:04:37.259402 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:37.259715 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:04:37.260623 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:04:37.260792 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.002 seconds
[0m20:04:37.261281 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:04:37.262307 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:04:37.262553 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8006db50>]}
[0m20:04:37.262824 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8125a210>]}
[0m20:04:37.263082 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff848f6e10>]}
[0m20:04:37.263415 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.06s]
[0m20:04:37.263890 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:37.264301 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:04:37.264639 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:04:37.264925 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:04:37.265171 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:04:37.265692 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:37.266003 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:04:37.266268 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:04:37.266769 [info ] [Thread-3 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:04:37.267107 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m20:04:37.267351 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m20:04:37.267671 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:04:37.267896 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:04:37.271636 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:37.272956 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.273607 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:04:37.273840 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:04:37.288127 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:04:37.289766 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.290046 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200437282546"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m20:04:37.290285 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200437289190"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:04:37.290522 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:04:37.290750 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:04:37.294670 [debug] [Thread-4 (]: Postgres adapter: Postgres error: aggregate functions are not allowed in WHERE
LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                 ^

[0m20:04:37.294979 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:04:37.297139 [debug] [Thread-4 (]: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:04:37.297325 [debug] [Thread-3 (]: SQL status: SELECT 0 in 0.007 seconds
[0m20:04:37.297600 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8116d710>]}
[0m20:04:37.302788 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.303110 [error] [Thread-4 (]: 4 of 6 ERROR creating sql incremental model staging_intermediate.int_campaign_daily  [[31mERROR[0m in 0.03s]
[0m20:04:37.303409 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:04:37.303695 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:04:37.304047 [debug] [Thread-7 (]: Marking all children of 'model.bluealpha_dbt.int_campaign_daily' to be skipped because of status 'error'.  Reason: Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^.
[0m20:04:37.304206 [debug] [Thread-3 (]: SQL status: BEGIN in 0.000 seconds
[0m20:04:37.304750 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.304948 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200437289190'
        
      order by ordinal_position

  
[0m20:04:37.309327 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.004 seconds
[0m20:04:37.312264 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.312483 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:04:37.313622 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:04:37.316823 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.317087 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:04:37.318027 [debug] [Thread-3 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:04:37.323191 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.323787 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.323997 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200437289190" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200437289190"
    )
  
[0m20:04:37.324613 [debug] [Thread-3 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m20:04:37.325137 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:37.325320 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:04:37.325483 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:04:37.326193 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:04:37.326490 [debug] [Thread-3 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:04:37.326806 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '300aae8f-b1c6-4f5f-a4b3-5fae0dbb01fa', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff81162890>]}
[0m20:04:37.327219 [info ] [Thread-3 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.06s]
[0m20:04:37.327694 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:04:37.328200 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:37.328399 [info ] [Thread-1 (]: 6 of 6 SKIP relation staging_marts.fact_campaign_daily ......................... [[33mSKIP[0m]
[0m20:04:37.328625 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:04:37.329385 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.329671 [debug] [MainThread]: On master: BEGIN
[0m20:04:37.329862 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:04:37.332584 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:04:37.332785 [debug] [MainThread]: On master: COMMIT
[0m20:04:37.332970 [debug] [MainThread]: Using postgres connection "master"
[0m20:04:37.333127 [debug] [MainThread]: On master: COMMIT
[0m20:04:37.333317 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:04:37.333474 [debug] [MainThread]: On master: Close
[0m20:04:37.333724 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:04:37.333877 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:04:37.334025 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:04:37.334168 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m20:04:37.334310 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:04:37.334521 [info ] [MainThread]: 
[0m20:04:37.334709 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m20:04:37.335313 [debug] [MainThread]: Command end result
[0m20:04:37.348222 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:04:37.349130 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:04:37.352047 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:04:37.352203 [info ] [MainThread]: 
[0m20:04:37.352405 [info ] [MainThread]: [31mCompleted with 1 error, 0 partial successes, and 0 warnings:[0m
[0m20:04:37.352630 [info ] [MainThread]: 
[0m20:04:37.352856 [error] [MainThread]: [31mFailure in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)[0m
[0m20:04:37.353083 [error] [MainThread]:   Database Error in model int_campaign_daily (models/intermediate/int_campaign_daily.sql)
  aggregate functions are not allowed in WHERE
  LINE 87: where load_ts > (select max(load_ts) from "warehouse"."stagi...
                                   ^
[0m20:04:37.353280 [info ] [MainThread]: 
[0m20:04:37.353538 [info ] [MainThread]:   compiled code at target/compiled/bluealpha_dbt/models/intermediate/int_campaign_daily.sql
[0m20:04:37.353728 [info ] [MainThread]: 
[0m20:04:37.353957 [info ] [MainThread]: Done. PASS=4 WARN=0 ERROR=1 SKIP=1 NO-OP=0 TOTAL=6
[0m20:04:37.354530 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": false, "command_wall_clock_time": 0.47237656, "process_in_blocks": "0", "process_kernel_time": 0.081309, "process_mem_max_rss": "130892", "process_out_blocks": "2154", "process_user_time": 1.06706}
[0m20:04:37.354771 [debug] [MainThread]: Command `dbt run` failed at 20:04:37.354737 after 0.47 seconds
[0m20:04:37.354972 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83de7410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83faf750>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88c2cb10>]}
[0m20:04:37.355183 [debug] [MainThread]: Flushing usage events
[0m20:04:37.829139 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:06:41.614620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9f90550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9ff30d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9ff1ed0>]}


============================== 20:06:41.618666 | d47c562f-1ebd-49cf-90dc-edd5497fad92 ==============================
[0m20:06:41.618666 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:06:41.619025 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'indirect_selection': 'eager', 'no_print': 'None', 'use_colors': 'True', 'static_parser': 'True', 'cache_selected_only': 'False', 'use_experimental_parser': 'False', 'debug': 'False', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'target_path': 'None', 'fail_fast': 'False', 'empty': 'False', 'invocation_command': 'dbt run --full-refresh --profiles-dir .', 'write_json': 'True', 'introspect': 'True', 'version_check': 'True', 'log_format': 'default', 'printer_width': '80', 'quiet': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'log_cache_events': 'False', 'send_anonymous_usage_stats': 'True'}
[0m20:06:41.695208 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa93dab10>]}
[0m20:06:41.716633 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaca75350>]}
[0m20:06:41.717184 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:06:41.745164 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:06:41.797795 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 1 files changed.
[0m20:06:41.798303 [debug] [MainThread]: Partial parsing: updated file: bluealpha_dbt://models/intermediate/int_campaign_daily.sql
[0m20:06:41.991709 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa957ee50>]}
[0m20:06:42.026791 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:42.027779 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:42.036419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa9071050>]}
[0m20:06:42.036737 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:06:42.036973 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa957dad0>]}
[0m20:06:42.037945 [info ] [MainThread]: 
[0m20:06:42.038190 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:06:42.038425 [info ] [MainThread]: 
[0m20:06:42.038729 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:06:42.040497 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:42.040833 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:42.041093 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:42.057263 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:42.057450 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:42.057590 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:42.057807 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:42.058024 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:42.058249 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:42.058457 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:42.058661 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:42.058871 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:42.065327 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:06:42.065494 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:06:42.065631 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m20:06:42.066188 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:42.066714 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:42.067162 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:42.068429 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:06:42.068700 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:06:42.068952 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:06:42.071177 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:42.071978 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:42.072756 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:42.072937 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:06:42.073174 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:06:42.073381 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:06:42.073559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:42.073783 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:42.073993 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:42.078109 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.078293 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:06:42.078429 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.078613 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:42.078851 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:42.079074 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:42.079261 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:06:42.079477 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:06:42.079698 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:06:42.082541 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:42.082721 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m20:06:42.082876 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m20:06:42.083519 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:06:42.084017 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:06:42.084484 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:06:42.084769 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:06:42.084978 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:06:42.085167 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:06:42.088004 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.088230 [debug] [MainThread]: On master: BEGIN
[0m20:06:42.088397 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:06:42.091823 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:42.092047 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.092252 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:06:42.101982 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m20:06:42.102490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa81c9510>]}
[0m20:06:42.102737 [debug] [MainThread]: On master: ROLLBACK
[0m20:06:42.102971 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.103116 [debug] [MainThread]: On master: BEGIN
[0m20:06:42.103390 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:06:42.103585 [debug] [MainThread]: On master: COMMIT
[0m20:06:42.103756 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.103927 [debug] [MainThread]: On master: COMMIT
[0m20:06:42.104136 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:42.104288 [debug] [MainThread]: On master: Close
[0m20:06:42.106363 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:42.106550 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:42.106732 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:42.107071 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:06:42.107424 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:06:42.107784 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:06:42.108139 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:06:42.108379 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:06:42.108615 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:06:42.108923 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:42.109140 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:42.109356 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:42.112236 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.113961 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.114944 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.115755 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:42.115938 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:42.127841 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:42.128754 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.130092 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.131459 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.132119 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.132295 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.132497 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:06:42.132731 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.132875 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:06:42.133064 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:42.133277 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:06:42.133481 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:42.133775 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:42.137323 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.137509 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.137668 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.137865 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.138085 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.138283 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.138462 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:06:42.138696 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:06:42.138981 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:06:42.143095 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:06:42.143285 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:06:42.143435 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m20:06:42.146015 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.147208 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.148374 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.148602 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:06:42.148823 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:06:42.149047 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:06:42.149588 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.149759 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.149901 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.150940 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.152454 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.153475 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.153666 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:06:42.154013 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:06:42.154234 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:06:42.154619 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.154872 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.155051 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.160359 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:06:42.160970 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:06:42.161607 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:06:42.161868 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.162117 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.162341 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.162526 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:06:42.162737 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:06:42.162954 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:06:42.163850 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:42.166058 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:06:42.166224 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m20:06:42.166385 [debug] [Thread-2 (]: SQL status: COMMIT in 0.003 seconds
[0m20:06:42.168000 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:42.168935 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:06:42.169895 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:06:42.170090 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:06:42.170475 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:42.170802 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:42.171077 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:06:42.171291 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:06:42.171645 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:06:42.172718 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:06:42.172877 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:06:42.173036 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:06:42.174150 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:06:42.174338 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8261490>]}
[0m20:06:42.174886 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:06:42.175218 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa81f44d0>]}
[0m20:06:42.175599 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m20:06:42.176000 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8e711d0>]}
[0m20:06:42.176278 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:06:42.176617 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:42.177000 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:06:42.177314 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:42.177724 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:42.178102 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:06:42.178383 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:06:42.178624 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:06:42.178949 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:06:42.179302 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m20:06:42.179587 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m20:06:42.179834 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:06:42.180063 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:06:42.182424 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.183960 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.184621 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:06:42.184874 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:06:42.198443 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.200524 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.201154 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.201402 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.201546 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m20:06:42.201752 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:06:42.201988 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:42.202171 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:06:42.205850 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.206023 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.206214 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.206448 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.206662 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


  );
  
  
[0m20:06:42.206893 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

  );
  
  
[0m20:06:42.211788 [debug] [Thread-4 (]: SQL status: SELECT 79 in 0.005 seconds
[0m20:06:42.214749 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.214973 [debug] [Thread-1 (]: SQL status: SELECT 720 in 0.008 seconds
[0m20:06:42.215183 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders" rename to "int_crm_orders__dbt_backup"
[0m20:06:42.216301 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.216607 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily" rename to "int_campaign_daily__dbt_backup"
[0m20:06:42.216770 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.217946 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.218099 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m20:06:42.218288 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp" rename to "int_crm_orders"
[0m20:06:42.219322 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.219590 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp" rename to "int_campaign_daily"
[0m20:06:42.219744 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.220084 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.220621 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:06:42.221245 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:06:42.221474 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.221663 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.221889 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:06:42.222072 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:06:42.222982 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:42.223135 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:42.224098 [debug] [Thread-4 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup"
[0m20:06:42.224971 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup"
[0m20:06:42.226151 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:42.226455 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:42.226662 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
drop table if exists "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup" cascade
[0m20:06:42.226884 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
drop table if exists "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup" cascade
[0m20:06:42.229527 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m20:06:42.229706 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.003 seconds
[0m20:06:42.230238 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:06:42.230726 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:06:42.231065 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa8180550>]}
[0m20:06:42.231373 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa81ca610>]}
[0m20:06:42.231816 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.05s]
[0m20:06:42.232425 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 720[0m in 0.05s]
[0m20:06:42.232853 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:06:42.233158 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:06:42.233713 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:42.234073 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m20:06:42.234346 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m20:06:42.234568 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:42.236095 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.236589 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:42.241377 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.241783 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.241989 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m20:06:42.242173 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:42.245726 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:42.245949 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.246148 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m20:06:42.250817 [debug] [Thread-2 (]: SQL status: SELECT 720 in 0.004 seconds
[0m20:06:42.252165 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.252326 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m20:06:42.252656 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.254583 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.254796 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m20:06:42.255091 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:42.255676 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:06:42.255858 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.256006 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:06:42.256784 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:42.257575 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m20:06:42.257856 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:42.258006 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m20:06:42.259506 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m20:06:42.260109 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m20:06:42.260429 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'd47c562f-1ebd-49cf-90dc-edd5497fad92', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa0ec32d0>]}
[0m20:06:42.260744 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 720[0m in 0.03s]
[0m20:06:42.261118 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:42.261856 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.262046 [debug] [MainThread]: On master: BEGIN
[0m20:06:42.262220 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:06:42.265140 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:42.265346 [debug] [MainThread]: On master: COMMIT
[0m20:06:42.265506 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:42.265648 [debug] [MainThread]: On master: COMMIT
[0m20:06:42.265860 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:42.266028 [debug] [MainThread]: On master: Close
[0m20:06:42.266237 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:06:42.266381 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:06:42.266528 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m20:06:42.266672 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m20:06:42.266834 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:06:42.267044 [info ] [MainThread]: 
[0m20:06:42.267247 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m20:06:42.267824 [debug] [MainThread]: Command end result
[0m20:06:42.280126 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:42.281010 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:42.283553 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:06:42.283726 [info ] [MainThread]: 
[0m20:06:42.283948 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:06:42.284204 [info ] [MainThread]: 
[0m20:06:42.284438 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m20:06:42.284994 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.6898706, "process_in_blocks": "0", "process_kernel_time": 0.209008, "process_mem_max_rss": "134712", "process_out_blocks": "3138", "process_user_time": 1.250048}
[0m20:06:42.285222 [debug] [MainThread]: Command `dbt run` succeeded at 20:06:42.285188 after 0.69 seconds
[0m20:06:42.285427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf175dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaef7b610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaee60510>]}
[0m20:06:42.285618 [debug] [MainThread]: Flushing usage events
[0m20:06:42.790757 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:06:47.905353 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f861f90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1e08210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f861a10>]}


============================== 20:06:47.908081 | 8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d ==============================
[0m20:06:47.908081 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:06:47.908416 [debug] [MainThread]: running dbt with arguments {'cache_selected_only': 'False', 'no_print': 'None', 'fail_fast': 'False', 'quiet': 'False', 'invocation_command': 'dbt run --profiles-dir .', 'debug': 'False', 'use_colors': 'True', 'write_json': 'True', 'use_experimental_parser': 'False', 'version_check': 'True', 'profiles_dir': '.', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'partial_parse': 'True', 'static_parser': 'True', 'empty': 'False', 'printer_width': '80', 'log_cache_events': 'False', 'introspect': 'True', 'warn_error': 'None', 'target_path': 'None', 'log_format': 'default', 'log_path': '/opt/bluealpha/dbt_project/logs', 'send_anonymous_usage_stats': 'True', 'indirect_selection': 'eager'}
[0m20:06:47.969490 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f8c2350>]}
[0m20:06:47.989018 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2295790>]}
[0m20:06:47.989403 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:06:48.013733 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:06:48.058008 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:06:48.058281 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:06:48.058448 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:06:48.079277 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9f8a9610>]}
[0m20:06:48.114798 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:48.115728 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:48.123700 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eab3cd0>]}
[0m20:06:48.123990 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:06:48.124214 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9eab3bd0>]}
[0m20:06:48.125237 [info ] [MainThread]: 
[0m20:06:48.125476 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:06:48.125769 [info ] [MainThread]: 
[0m20:06:48.126133 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:06:48.127985 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:48.128301 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:48.132933 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:06:48.167428 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:48.167617 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:48.167771 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:06:48.167977 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:48.168224 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:48.168435 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:06:48.168684 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:48.168901 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:48.169145 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:48.174440 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:06:48.174612 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:06:48.174772 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:06:48.175288 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:48.175856 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:48.176374 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:06:48.178178 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:06:48.178441 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:06:48.180662 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:48.180880 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:06:48.181755 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:48.181972 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:06:48.182738 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:48.182964 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:06:48.183147 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:48.183350 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:06:48.183542 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:48.183901 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:06:48.187594 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:06:48.187788 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:06:48.187916 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:06:48.188092 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:48.188304 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:48.188510 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:48.188699 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:06:48.188933 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:06:48.189162 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:06:48.191566 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:06:48.191740 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:48.191898 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:06:48.192452 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:06:48.192943 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:06:48.193409 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:06:48.193673 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:06:48.193870 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:06:48.194104 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:06:48.197265 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.197464 [debug] [MainThread]: On master: BEGIN
[0m20:06:48.197628 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:06:48.200540 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:48.200767 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.200978 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:06:48.210310 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:06:48.210855 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cf18ad0>]}
[0m20:06:48.211098 [debug] [MainThread]: On master: ROLLBACK
[0m20:06:48.211334 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.211481 [debug] [MainThread]: On master: BEGIN
[0m20:06:48.211772 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:06:48.211958 [debug] [MainThread]: On master: COMMIT
[0m20:06:48.212114 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.212252 [debug] [MainThread]: On master: COMMIT
[0m20:06:48.212450 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.212609 [debug] [MainThread]: On master: Close
[0m20:06:48.214618 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:48.214807 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:48.214986 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:48.215264 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:06:48.215589 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:06:48.215931 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:06:48.216249 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:06:48.216489 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:06:48.216755 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:06:48.217060 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:48.217282 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:48.217503 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:48.220285 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.221361 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.222379 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.223198 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:48.223384 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:48.223614 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:48.236358 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.237730 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.239046 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.239787 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.239987 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.240239 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:06:48.240485 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.241062 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:06:48.240863 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:48.240627 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:06:48.241240 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:48.241595 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:48.245278 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:48.245457 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:48.245612 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:48.245826 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.246031 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.246237 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.246453 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:06:48.246752 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:06:48.246991 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:06:48.250313 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:06:48.250642 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:06:48.250931 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:06:48.253936 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.255285 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.256493 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.256709 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:06:48.256929 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:06:48.257154 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:06:48.257766 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.257931 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.258079 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m20:06:48.259352 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.260755 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.261932 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.262131 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:06:48.262380 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:06:48.262616 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:06:48.263126 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.263335 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.263522 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.271115 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:06:48.271792 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:06:48.272405 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:06:48.272616 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.272832 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.273053 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.273230 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:06:48.273423 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:06:48.273619 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:06:48.274212 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.274399 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.274588 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:48.276989 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:06:48.277951 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:06:48.278869 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:06:48.280850 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:06:48.281321 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:06:48.281776 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:06:48.281997 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:06:48.282228 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:06:48.282449 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:06:48.283303 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:06:48.284460 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:06:48.284615 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.002 seconds
[0m20:06:48.284789 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.002 seconds
[0m20:06:48.285503 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cc48ad0>]}
[0m20:06:48.286056 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:06:48.286605 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:06:48.286962 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:06:48.287315 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cc88750>]}
[0m20:06:48.287600 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9e91d790>]}
[0m20:06:48.287878 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:06:48.288276 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:06:48.288629 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:06:48.289146 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:06:48.289375 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:06:48.289634 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:06:48.289907 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:06:48.290374 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:06:48.290631 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m20:06:48.290885 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:06:48.291136 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:06:48.291337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m20:06:48.294835 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.295025 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:06:48.296766 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.297154 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:06:48.308881 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:06:48.311299 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.312774 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.313001 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200648305944"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:06:48.313282 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200648312248"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m20:06:48.313502 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:06:48.313671 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:48.321003 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.007 seconds
[0m20:06:48.327133 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.327307 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.014 seconds
[0m20:06:48.327513 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:06:48.328580 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.328881 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m20:06:48.329042 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m20:06:48.329303 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m20:06:48.329448 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.329660 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.329973 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200648305944'
        
      order by ordinal_position

  
[0m20:06:48.330290 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp200648312248'
        
      order by ordinal_position

  
[0m20:06:48.335664 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.005 seconds
[0m20:06:48.335851 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.005 seconds
[0m20:06:48.337768 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.339037 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.339249 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:06:48.339492 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:06:48.340663 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:06:48.340831 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m20:06:48.344015 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.345290 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.345483 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:06:48.345728 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:06:48.346753 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:06:48.346912 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m20:06:48.352013 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.352881 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.353462 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.353679 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200648305944" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200648305944"
    )
  
[0m20:06:48.353920 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.354171 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp200648312248" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp200648312248"
    )
  
[0m20:06:48.354351 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m20:06:48.355042 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:06:48.355253 [debug] [Thread-1 (]: SQL status: INSERT 0 0 in 0.001 seconds
[0m20:06:48.355450 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:06:48.355982 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:06:48.356201 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:06:48.356389 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:06:48.356762 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:06:48.357037 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.357290 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.357581 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:06:48.357895 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:06:48.358227 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9ed80b50>]}
[0m20:06:48.358469 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9cd26710>]}
[0m20:06:48.358807 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.07s]
[0m20:06:48.359358 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 0[0m in 0.07s]
[0m20:06:48.359792 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:06:48.360112 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:06:48.360887 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:48.361181 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m20:06:48.361445 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m20:06:48.361664 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:48.363102 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.363572 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:48.368719 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.369125 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.369287 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m20:06:48.369459 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:48.372576 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m20:06:48.372791 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.373001 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m20:06:48.377354 [debug] [Thread-2 (]: SQL status: SELECT 720 in 0.004 seconds
[0m20:06:48.379794 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.379969 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m20:06:48.380227 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.382152 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.382345 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m20:06:48.382624 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:06:48.383198 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:06:48.383353 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.383520 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:06:48.384257 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m20:06:48.385090 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m20:06:48.386345 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:06:48.386505 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m20:06:48.387909 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.001 seconds
[0m20:06:48.388409 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m20:06:48.388681 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '8d721b3a-e1ce-40a3-9af2-b4a8301e9d5d', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c402c10>]}
[0m20:06:48.388987 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 720[0m in 0.03s]
[0m20:06:48.389278 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:06:48.390151 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.390361 [debug] [MainThread]: On master: BEGIN
[0m20:06:48.390528 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:06:48.393475 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:48.393673 [debug] [MainThread]: On master: COMMIT
[0m20:06:48.393859 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:48.394006 [debug] [MainThread]: On master: COMMIT
[0m20:06:48.394198 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:48.394341 [debug] [MainThread]: On master: Close
[0m20:06:48.394555 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:06:48.394706 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m20:06:48.394861 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:06:48.394982 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m20:06:48.395114 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:06:48.395325 [info ] [MainThread]: 
[0m20:06:48.395569 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m20:06:48.396116 [debug] [MainThread]: Command end result
[0m20:06:48.408388 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:48.409286 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:48.412145 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:06:48.412316 [info ] [MainThread]: 
[0m20:06:48.412529 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:06:48.412780 [info ] [MainThread]: 
[0m20:06:48.412978 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m20:06:48.413516 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.52661735, "process_in_blocks": "0", "process_kernel_time": 0.078388, "process_mem_max_rss": "130700", "process_out_blocks": "2184", "process_user_time": 1.096447}
[0m20:06:48.413786 [debug] [MainThread]: Command `dbt run` succeeded at 20:06:48.413747 after 0.53 seconds
[0m20:06:48.414003 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fb420d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9fd3d850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa470f110>]}
[0m20:06:48.414212 [debug] [MainThread]: Flushing usage events
[0m20:06:48.877857 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:06:55.476324 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88101650>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff881017d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88100fd0>]}


============================== 20:06:55.478982 | d8f7f380-b7d0-42e5-8f31-f29cee2f9248 ==============================
[0m20:06:55.478982 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:06:55.479328 [debug] [MainThread]: running dbt with arguments {'version_check': 'True', 'empty': 'None', 'invocation_command': 'dbt test --profiles-dir .', 'cache_selected_only': 'False', 'no_print': 'None', 'indirect_selection': 'eager', 'target_path': 'None', 'introspect': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'log_cache_events': 'False', 'profiles_dir': '.', 'static_parser': 'True', 'fail_fast': 'False', 'debug': 'False', 'log_format': 'default', 'partial_parse': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'use_experimental_parser': 'False', 'write_json': 'True', 'warn_error': 'None', 'quiet': 'False', 'printer_width': '80', 'use_colors': 'True'}
[0m20:06:55.538550 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff875a7a10>]}
[0m20:06:55.557854 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8ab36f10>]}
[0m20:06:55.558209 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:06:55.582069 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:06:55.624796 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:06:55.625094 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:06:55.625258 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:06:55.641518 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff872689d0>]}
[0m20:06:55.674941 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:55.675755 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:55.687533 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff870bff10>]}
[0m20:06:55.687844 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:06:55.688074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff875a7e90>]}
[0m20:06:55.689242 [info ] [MainThread]: 
[0m20:06:55.689440 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:06:55.689658 [info ] [MainThread]: 
[0m20:06:55.689996 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:06:55.691629 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m20:06:55.715801 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m20:06:55.691930 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m20:06:55.730001 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:55.730193 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:55.730337 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:55.730528 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:06:55.730756 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:06:55.730964 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:06:55.731185 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:55.731385 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:55.731589 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:06:55.736026 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.736212 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.736346 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.736523 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:06:55.736736 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:06:55.736977 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:06:55.737202 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:06:55.737422 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:06:55.737662 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:06:55.740080 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:55.740266 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:06:55.740422 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:06:55.740954 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:06:55.741463 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:06:55.742002 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:06:55.742421 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:06:55.742617 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:06:55.742896 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:06:55.746339 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.746560 [debug] [MainThread]: On master: BEGIN
[0m20:06:55.746731 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:06:55.750046 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:55.750281 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.750493 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:06:55.760037 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:06:55.760560 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'd8f7f380-b7d0-42e5-8f31-f29cee2f9248', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88c28e50>]}
[0m20:06:55.760815 [debug] [MainThread]: On master: ROLLBACK
[0m20:06:55.761072 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.761235 [debug] [MainThread]: On master: BEGIN
[0m20:06:55.761522 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:06:55.761715 [debug] [MainThread]: On master: COMMIT
[0m20:06:55.761877 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.762010 [debug] [MainThread]: On master: COMMIT
[0m20:06:55.762208 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:55.762357 [debug] [MainThread]: On master: Close
[0m20:06:55.764482 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:06:55.764676 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:06:55.764932 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:06:55.765135 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:06:55.765304 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m20:06:55.765611 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m20:06:55.765919 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m20:06:55.766234 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m20:06:55.766549 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m20:06:55.766812 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m20:06:55.767071 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m20:06:55.767335 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m20:06:55.767562 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:06:55.767787 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:06:55.768043 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:06:55.768262 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:06:55.774675 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:06:55.778038 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:06:55.779517 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:06:55.781087 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:06:55.781931 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:06:55.782233 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:06:55.782494 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:06:55.788420 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:06:55.788682 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:06:55.789521 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:06:55.790443 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:06:55.791606 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:06:55.791954 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:06:55.792286 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:06:55.792885 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m20:06:55.793157 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:06:55.793403 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:06:55.793537 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m20:06:55.793748 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:55.793980 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m20:06:55.794167 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m20:06:55.794365 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:55.794653 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:55.794881 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:06:55.798530 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.798917 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.799125 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:06:55.799297 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.799460 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.799665 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:06:55.799854 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.800080 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:06:55.800289 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:06:55.800493 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m20:06:55.800775 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.801036 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.801242 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.801826 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m20:06:55.803549 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m20:06:55.803730 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:55.804429 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m20:06:55.804603 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m20:06:55.804892 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m20:06:55.805378 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m20:06:55.805666 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m20:06:55.806187 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m20:06:55.806547 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m20:06:55.806908 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m20:06:55.807175 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m20:06:55.808007 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m20:06:55.808216 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:06:55.808531 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m20:06:55.808922 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:06:55.809247 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m20:06:55.809542 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:06:55.809912 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:06:55.810203 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:06:55.810510 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:06:55.810734 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m20:06:55.811076 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:06:55.811335 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m20:06:55.811670 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:06:55.811953 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m20:06:55.812183 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m20:06:55.812472 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m20:06:55.812714 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m20:06:55.813013 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:06:55.813257 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m20:06:55.813477 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:06:55.813731 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m20:06:55.815613 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:06:55.815934 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:06:55.817492 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:06:55.817748 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:06:55.819504 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:06:55.819813 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:06:55.822177 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:06:55.822433 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:06:55.823438 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:06:55.823728 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:06:55.824616 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:06:55.824831 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:06:55.825796 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:06:55.826117 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:06:55.827069 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:06:55.827282 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:06:55.827533 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m20:06:55.827851 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:06:55.828046 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m20:06:55.828260 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:06:55.828402 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:55.828589 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m20:06:55.828779 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:55.828938 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m20:06:55.829536 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:55.829237 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:06:55.832958 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.833160 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.833349 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.833560 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:06:55.833797 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.833947 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:06:55.834178 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:06:55.834367 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.834559 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:06:55.834748 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.834971 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.835252 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.835809 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m20:06:55.836735 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m20:06:55.836881 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.837032 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.837175 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:55.837412 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m20:06:55.837933 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m20:06:55.838515 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m20:06:55.839012 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m20:06:55.839358 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m20:06:55.839814 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m20:06:55.840017 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m20:06:55.841105 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m20:06:55.840434 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:06:55.840733 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m20:06:55.840220 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m20:06:55.841441 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:06:55.841722 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:06:55.842025 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:06:55.842309 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m20:06:55.842609 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:06:55.842904 [info ] [Thread-3 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m20:06:55.843215 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:06:55.843499 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:06:55.843759 [info ] [Thread-2 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m20:06:55.844132 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m20:06:55.844416 [info ] [Thread-1 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m20:06:55.844729 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:06:55.844993 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m20:06:55.845245 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:06:55.845491 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m20:06:55.845684 [info ] [Thread-4 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m20:06:55.846005 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:06:55.847879 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:06:55.848137 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:06:55.848343 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m20:06:55.849949 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:06:55.851642 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:06:55.851990 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:06:55.852160 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:06:55.852734 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:06:55.854889 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:06:55.855110 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:06:55.856057 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:06:55.856946 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:06:55.858657 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:06:55.858923 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:06:55.859307 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:06:55.859565 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:06:55.860416 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:06:55.860715 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:06:55.860851 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m20:06:55.861035 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m20:06:55.861356 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m20:06:55.861725 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:55.861939 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:06:55.862146 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:06:55.862348 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:06:55.862676 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m20:06:55.863305 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:06:55.866614 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.866848 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.867075 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m20:06:55.867262 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:06:55.867424 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:06:55.867671 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:06:55.867933 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:06:55.868181 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:06:55.868392 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.868621 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.868860 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m20:06:55.869095 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:06:55.870453 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.870632 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.871336 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m20:06:55.871517 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:06:55.871663 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.872240 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m20:06:55.872994 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m20:06:55.873193 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m20:06:55.873725 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m20:06:55.874031 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m20:06:55.875091 [info ] [Thread-3 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m20:06:55.874501 [info ] [Thread-4 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m20:06:55.874798 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m20:06:55.874234 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m20:06:55.875460 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:06:55.875773 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:06:55.876082 [info ] [Thread-1 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m20:06:55.876482 [info ] [Thread-2 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m20:06:55.876784 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:06:55.877193 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:06:55.877429 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:06:55.877633 [info ] [Thread-3 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m20:06:55.878156 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m20:06:55.878355 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:06:55.880227 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:06:55.880731 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:06:55.881717 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:06:55.882104 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:06:55.882262 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m20:06:55.882400 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:06:55.885029 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m20:06:55.885242 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:06:55.885428 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m20:06:55.886951 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:06:55.887497 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m20:06:55.887702 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m20:06:55.887953 [info ] [Thread-3 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m20:06:55.888260 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:06:55.889037 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.889233 [debug] [MainThread]: On master: BEGIN
[0m20:06:55.889390 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:06:55.892120 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:06:55.892473 [debug] [MainThread]: On master: COMMIT
[0m20:06:55.892667 [debug] [MainThread]: Using postgres connection "master"
[0m20:06:55.892839 [debug] [MainThread]: On master: COMMIT
[0m20:06:55.893072 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:06:55.893249 [debug] [MainThread]: On master: Close
[0m20:06:55.893481 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:06:55.893628 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m20:06:55.893789 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m20:06:55.893932 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m20:06:55.894069 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m20:06:55.894235 [info ] [MainThread]: 
[0m20:06:55.894418 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m20:06:55.895244 [debug] [MainThread]: Command end result
[0m20:06:55.907849 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:06:55.908637 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:06:55.911676 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:06:55.911879 [info ] [MainThread]: 
[0m20:06:55.912103 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:06:55.912335 [info ] [MainThread]: 
[0m20:06:55.912565 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m20:06:55.913105 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.4554323, "process_in_blocks": "0", "process_kernel_time": 0.082033, "process_mem_max_rss": "129772", "process_out_blocks": "2159", "process_user_time": 1.050429}
[0m20:06:55.913354 [debug] [MainThread]: Command `dbt test` succeeded at 20:06:55.913314 after 0.46 seconds
[0m20:06:55.913573 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cfaf110>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cf91990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8cf91810>]}
[0m20:06:55.913786 [debug] [MainThread]: Flushing usage events
[0m20:06:56.272586 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:07:20.422542 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83fc0fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83d47c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83cd59d0>]}


============================== 20:07:20.425310 | 18a9d284-5c29-459a-a642-7557487648a0 ==============================
[0m20:07:20.425310 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:07:20.425643 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'no_print': 'None', 'quiet': 'False', 'introspect': 'True', 'write_json': 'True', 'use_colors': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'fail_fast': 'False', 'warn_error': 'None', 'partial_parse': 'True', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'invocation_command': 'dbt run', 'printer_width': '80', 'profiles_dir': '/opt/bluealpha/dbt_project', 'empty': 'False', 'static_parser': 'True', 'debug': 'False', 'log_cache_events': 'False', 'use_experimental_parser': 'False', 'log_format': 'default'}
[0m20:07:20.485427 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff83198350>]}
[0m20:07:20.505056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8670ea90>]}
[0m20:07:20.505428 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:07:20.529790 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:07:20.572872 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:07:20.573153 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:07:20.573331 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:07:20.592288 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82e36d50>]}
[0m20:07:20.635122 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:07:20.636299 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:07:20.644451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff832ceb50>]}
[0m20:07:20.644708 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:07:20.644917 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff866426d0>]}
[0m20:07:20.645826 [info ] [MainThread]: 
[0m20:07:20.646021 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:07:20.646201 [info ] [MainThread]: 
[0m20:07:20.646493 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:07:20.648525 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:07:20.649005 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:07:20.653894 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m20:07:20.686029 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:07:20.686248 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:07:20.686410 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m20:07:20.686662 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:07:20.686947 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:07:20.687210 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m20:07:20.687449 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:20.687654 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:20.687854 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:20.692882 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:07:20.693055 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.005 seconds
[0m20:07:20.693198 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.006 seconds
[0m20:07:20.693797 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:07:20.694373 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:07:20.694863 [debug] [ThreadPool]: On list_warehouse: Close
[0m20:07:20.696444 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m20:07:20.696743 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m20:07:20.699028 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:07:20.699276 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m20:07:20.700128 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:07:20.700330 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:07:20.701122 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:07:20.701330 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:07:20.701506 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:20.701726 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:07:20.701922 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:20.702291 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m20:07:20.706204 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:07:20.706394 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:07:20.706524 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m20:07:20.706761 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:07:20.707036 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:07:20.707249 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:07:20.707475 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:07:20.707727 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:07:20.707978 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:07:20.710502 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:20.710699 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:07:20.710851 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:07:20.711415 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:07:20.711934 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:07:20.712415 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:07:20.712690 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:07:20.712963 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:07:20.713152 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:07:20.716250 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.716525 [debug] [MainThread]: On master: BEGIN
[0m20:07:20.716773 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:07:20.743451 [debug] [MainThread]: SQL status: BEGIN in 0.027 seconds
[0m20:07:20.745979 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.747033 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:07:20.769783 [debug] [MainThread]: SQL status: SELECT 3 in 0.022 seconds
[0m20:07:20.770753 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82bfd6d0>]}
[0m20:07:20.771194 [debug] [MainThread]: On master: ROLLBACK
[0m20:07:20.771608 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.771852 [debug] [MainThread]: On master: BEGIN
[0m20:07:20.772322 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:07:20.772591 [debug] [MainThread]: On master: COMMIT
[0m20:07:20.772830 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.773093 [debug] [MainThread]: On master: COMMIT
[0m20:07:20.773408 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:07:20.773675 [debug] [MainThread]: On master: Close
[0m20:07:20.776113 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:07:20.776314 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:07:20.776491 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:07:20.776841 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m20:07:20.777182 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m20:07:20.777504 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m20:07:20.777859 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m20:07:20.778128 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m20:07:20.778400 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m20:07:20.778788 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:07:20.779081 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:07:20.779388 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m20:07:20.782751 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.786869 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.789017 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.789956 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:07:20.790263 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:07:20.803874 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m20:07:20.804722 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.806264 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.807713 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.808602 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.808805 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.809053 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m20:07:20.809314 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m20:07:20.809492 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.809739 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:20.809987 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:07:20.810238 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m20:07:20.810990 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:07:20.813985 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:20.814198 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:20.814434 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.814743 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.815017 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m20:07:20.815208 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:20.815430 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m20:07:20.815824 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.816512 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m20:07:20.818544 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:07:20.818766 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m20:07:20.821615 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.821812 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m20:07:20.822916 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.823129 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m20:07:20.824221 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.824448 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m20:07:20.824774 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m20:07:20.824976 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.825414 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.825605 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.826634 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.827686 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.828770 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.829011 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m20:07:20.829250 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m20:07:20.829482 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m20:07:20.830070 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.830260 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.830397 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.835907 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:07:20.836548 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:07:20.837146 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:07:20.837336 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.837563 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.837805 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.837990 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m20:07:20.838180 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m20:07:20.838374 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m20:07:20.839069 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m20:07:20.842064 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m20:07:20.842229 [debug] [Thread-2 (]: SQL status: COMMIT in 0.004 seconds
[0m20:07:20.842383 [debug] [Thread-3 (]: SQL status: COMMIT in 0.003 seconds
[0m20:07:20.844080 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m20:07:20.844960 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m20:07:20.845826 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m20:07:20.846022 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m20:07:20.846395 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m20:07:20.846761 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m20:07:20.847037 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m20:07:20.847284 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m20:07:20.847595 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:07:20.848912 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m20:07:20.849082 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:07:20.849237 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m20:07:20.850079 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff811aa3d0>]}
[0m20:07:20.850599 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m20:07:20.851109 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m20:07:20.851438 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:07:20.851792 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82c9c4d0>]}
[0m20:07:20.852045 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82ce0550>]}
[0m20:07:20.852365 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m20:07:20.852736 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m20:07:20.853086 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m20:07:20.853498 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m20:07:20.853734 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m20:07:20.853986 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m20:07:20.854217 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m20:07:20.854712 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m20:07:20.854967 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m20:07:20.855192 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m20:07:20.855426 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m20:07:20.855636 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m20:07:20.858863 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.859052 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m20:07:20.860624 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.860947 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m20:07:20.866670 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m20:07:20.874941 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.876433 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.876661 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp200720870014"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m20:07:20.876953 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp200720875862"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m20:07:20.877234 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:07:20.877410 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:20.886968 [debug] [Thread-4 (]: SQL status: SELECT 14 in 0.010 seconds
[0m20:07:20.887209 [debug] [Thread-1 (]: SQL status: SELECT 90 in 0.010 seconds
[0m20:07:20.892305 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.894208 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.894454 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m20:07:20.894682 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m20:07:20.895066 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m20:07:20.895447 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m20:07:20.895689 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.896010 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.896260 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp200720870014'
        
      order by ordinal_position

  
[0m20:07:20.896511 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp200720875862'
        
      order by ordinal_position

  
[0m20:07:20.901094 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.004 seconds
[0m20:07:20.901279 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.004 seconds
[0m20:07:20.903342 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.904632 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.904907 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:07:20.905147 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:07:20.906328 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:07:20.906499 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m20:07:20.909911 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.911278 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.911512 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:07:20.911770 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m20:07:20.912825 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m20:07:20.913001 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m20:07:20.918142 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.919064 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.919861 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.920134 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.920305 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp200720870014" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp200720870014"
    )
  
[0m20:07:20.920556 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp200720875862" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp200720875862"
    )
  
[0m20:07:20.921413 [debug] [Thread-4 (]: SQL status: INSERT 0 14 in 0.001 seconds
[0m20:07:20.922209 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:07:20.922371 [debug] [Thread-1 (]: SQL status: INSERT 0 90 in 0.001 seconds
[0m20:07:20.922576 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m20:07:20.923107 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:07:20.923301 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m20:07:20.923498 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m20:07:20.923807 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m20:07:20.924220 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m20:07:20.924359 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m20:07:20.924733 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m20:07:20.925078 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m20:07:20.925412 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6af07450>]}
[0m20:07:20.925682 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6af07c50>]}
[0m20:07:20.926265 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 14[0m in 0.07s]
[0m20:07:20.926805 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 90[0m in 0.07s]
[0m20:07:20.927096 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m20:07:20.927373 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m20:07:20.928299 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m20:07:20.928665 [info ] [Thread-3 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m20:07:20.928926 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m20:07:20.929138 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m20:07:20.930590 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.931203 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m20:07:20.936125 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.936535 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.936708 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m20:07:20.936867 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:07:20.939641 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m20:07:20.939866 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.940073 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m20:07:20.943900 [debug] [Thread-3 (]: SQL status: SELECT 90 in 0.004 seconds
[0m20:07:20.946671 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.946878 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m20:07:20.947209 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.948281 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.948437 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m20:07:20.948736 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m20:07:20.949338 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:07:20.949495 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.949692 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m20:07:20.950296 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m20:07:20.952002 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m20:07:20.953205 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m20:07:20.953390 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m20:07:20.954783 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m20:07:20.955274 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m20:07:20.955580 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '18a9d284-5c29-459a-a642-7557487648a0', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff6afd06d0>]}
[0m20:07:20.955871 [info ] [Thread-3 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.03s]
[0m20:07:20.956117 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m20:07:20.956880 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.957071 [debug] [MainThread]: On master: BEGIN
[0m20:07:20.957244 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:07:20.959894 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:07:20.960088 [debug] [MainThread]: On master: COMMIT
[0m20:07:20.960251 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:20.960430 [debug] [MainThread]: On master: COMMIT
[0m20:07:20.960641 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:07:20.960884 [debug] [MainThread]: On master: Close
[0m20:07:20.961135 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:07:20.961312 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m20:07:20.961466 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m20:07:20.961640 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m20:07:20.961816 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m20:07:20.962038 [info ] [MainThread]: 
[0m20:07:20.962206 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m20:07:20.962715 [debug] [MainThread]: Command end result
[0m20:07:20.974353 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:07:20.975150 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:07:20.977625 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:07:20.977945 [info ] [MainThread]: 
[0m20:07:20.978193 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:07:20.978371 [info ] [MainThread]: 
[0m20:07:20.978544 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m20:07:20.979029 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.57653093, "process_in_blocks": "0", "process_kernel_time": 0.097244, "process_mem_max_rss": "130496", "process_out_blocks": "2185", "process_user_time": 1.08974}
[0m20:07:20.979258 [debug] [MainThread]: Command `dbt run` succeeded at 20:07:20.979223 after 0.58 seconds
[0m20:07:20.979456 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8892c710>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88911c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff88911b90>]}
[0m20:07:20.979660 [debug] [MainThread]: Flushing usage events
[0m20:07:21.429938 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m20:07:23.604376 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97e4cd50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97e4d190>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97e4d850>]}


============================== 20:07:23.607223 | 81f958e1-83da-4721-8f4c-7bc815e992d8 ==============================
[0m20:07:23.607223 [info ] [MainThread]: Running with dbt=1.11.3
[0m20:07:23.607583 [debug] [MainThread]: running dbt with arguments {'invocation_command': 'dbt test', 'profiles_dir': '/opt/bluealpha/dbt_project', 'quiet': 'False', 'version_check': 'True', 'partial_parse': 'True', 'printer_width': '80', 'empty': 'None', 'target_path': 'None', 'use_colors': 'True', 'indirect_selection': 'eager', 'no_print': 'None', 'fail_fast': 'False', 'send_anonymous_usage_stats': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_cache_events': 'False', 'write_json': 'True', 'cache_selected_only': 'False', 'log_format': 'default', 'debug': 'False', 'static_parser': 'True', 'use_experimental_parser': 'False', 'warn_error': 'None', 'introspect': 'True'}
[0m20:07:23.672168 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97efafd0>]}
[0m20:07:23.692016 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9a926cd0>]}
[0m20:07:23.692428 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m20:07:23.717243 [debug] [MainThread]: checksum: 97dbd983c77ef3cec7304d97135f72c53ee20ea7ab68d67bae8e0876ff0fcdb6, vars: {}, profile: , target: , version: 1.11.3
[0m20:07:23.762832 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m20:07:23.763106 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m20:07:23.763278 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m20:07:23.779677 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96f68b10>]}
[0m20:07:23.812713 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:07:23.813545 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:07:23.825289 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff970bbfd0>]}
[0m20:07:23.825619 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m20:07:23.825825 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96fcfa90>]}
[0m20:07:23.826810 [info ] [MainThread]: 
[0m20:07:23.827007 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m20:07:23.827162 [info ] [MainThread]: 
[0m20:07:23.827458 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m20:07:23.829146 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m20:07:23.829465 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m20:07:23.861214 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m20:07:23.871967 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:07:23.872142 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:07:23.872288 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:07:23.872478 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m20:07:23.872703 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m20:07:23.872914 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m20:07:23.873130 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:23.873334 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:23.873535 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m20:07:23.877985 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.878186 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.878396 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.878536 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m20:07:23.878779 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m20:07:23.878982 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m20:07:23.879184 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m20:07:23.879408 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m20:07:23.879633 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m20:07:23.882033 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m20:07:23.882202 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:23.882344 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m20:07:23.882949 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m20:07:23.883475 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m20:07:23.883981 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m20:07:23.884255 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m20:07:23.884460 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m20:07:23.884661 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m20:07:23.887807 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:23.888034 [debug] [MainThread]: On master: BEGIN
[0m20:07:23.888195 [debug] [MainThread]: Opening a new connection, currently in state init
[0m20:07:23.891125 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:07:23.891322 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:23.891550 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m20:07:23.901068 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m20:07:23.901661 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '81f958e1-83da-4721-8f4c-7bc815e992d8', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff970667d0>]}
[0m20:07:23.902006 [debug] [MainThread]: On master: ROLLBACK
[0m20:07:23.902299 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:23.902525 [debug] [MainThread]: On master: BEGIN
[0m20:07:23.903086 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m20:07:23.903290 [debug] [MainThread]: On master: COMMIT
[0m20:07:23.903477 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:23.903652 [debug] [MainThread]: On master: COMMIT
[0m20:07:23.903978 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:07:23.904164 [debug] [MainThread]: On master: Close
[0m20:07:23.906758 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:07:23.906979 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:07:23.907265 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:07:23.907483 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:07:23.907694 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m20:07:23.908072 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m20:07:23.908367 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m20:07:23.909015 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m20:07:23.909403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m20:07:23.909694 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m20:07:23.909956 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m20:07:23.910237 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m20:07:23.910465 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:07:23.910710 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:07:23.910925 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:07:23.911136 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:07:23.917713 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:07:23.921098 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:07:23.922765 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:07:23.924296 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:07:23.925079 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:07:23.925646 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:07:23.925807 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:07:23.931796 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:07:23.931975 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:07:23.932985 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:07:23.933907 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:07:23.934995 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:07:23.935298 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:07:23.935671 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:07:23.936009 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m20:07:23.936225 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:07:23.936517 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:07:23.936852 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m20:07:23.937082 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:23.937275 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m20:07:23.937485 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m20:07:23.937667 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:07:23.937989 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:07:23.938246 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m20:07:23.941794 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.942022 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:23.942296 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m20:07:23.942453 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:23.942611 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.942837 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m20:07:23.943050 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m20:07:23.943280 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m20:07:23.943490 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m20:07:23.943719 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.944047 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.944287 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.945094 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:23.945285 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m20:07:23.945463 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:23.947327 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m20:07:23.947520 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.004 seconds
[0m20:07:23.948102 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m20:07:23.948690 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m20:07:23.949013 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m20:07:23.949466 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m20:07:23.949787 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m20:07:23.950029 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m20:07:23.950334 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m20:07:23.950661 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m20:07:23.950917 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m20:07:23.951240 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m20:07:23.951618 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m20:07:23.951931 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m20:07:23.952196 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m20:07:23.952504 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m20:07:23.952777 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:07:23.953062 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m20:07:23.953300 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:07:23.953553 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:07:23.953823 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m20:07:23.954118 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:07:23.954387 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m20:07:23.954685 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m20:07:23.954995 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m20:07:23.955212 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m20:07:23.955525 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m20:07:23.955799 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m20:07:23.956054 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:07:23.956289 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m20:07:23.956533 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:07:23.956813 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:07:23.958712 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:07:23.958933 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:07:23.960598 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:07:23.962714 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:07:23.965853 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:07:23.966132 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:07:23.966807 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:07:23.967029 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:07:23.968116 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:07:23.968346 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:07:23.969213 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:07:23.970077 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:07:23.971210 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:07:23.971669 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:07:23.972328 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:07:23.972635 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m20:07:23.972876 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:07:23.973080 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m20:07:23.973248 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:07:23.974046 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m20:07:23.973654 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m20:07:23.973865 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:07:23.973450 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:07:23.974202 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:23.974378 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:07:23.978668 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.978905 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.979088 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.979275 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:23.979429 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m20:07:23.979647 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m20:07:23.979864 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m20:07:23.980076 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m20:07:23.980251 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.980451 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.980662 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.980879 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:07:23.981629 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.000 seconds
[0m20:07:23.981810 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:23.982698 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m20:07:23.982931 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:23.983113 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:23.983871 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m20:07:23.984190 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m20:07:23.984705 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m20:07:23.985316 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m20:07:23.985615 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m20:07:23.985938 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m20:07:23.986312 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m20:07:23.986519 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m20:07:23.986832 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m20:07:23.987106 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m20:07:23.987421 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m20:07:23.988461 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m20:07:23.988716 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m20:07:23.989036 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:07:23.989365 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m20:07:23.989686 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m20:07:23.989915 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:07:23.990159 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m20:07:23.990443 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:07:23.990701 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:07:23.990944 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m20:07:23.991240 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m20:07:23.991474 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m20:07:23.991749 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m20:07:23.991995 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m20:07:23.992224 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:07:23.992460 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m20:07:23.992692 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m20:07:23.992911 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:07:23.995088 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:07:23.995361 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:07:23.995588 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:07:23.997121 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:07:23.998987 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:07:24.001245 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:07:24.001495 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:07:24.002056 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:07:24.002347 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:07:24.003301 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:07:24.003545 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:07:24.004596 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:07:24.006399 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:07:24.007489 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:07:24.007856 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:07:24.008277 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:07:24.008524 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:07:24.008690 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m20:07:24.008978 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:07:24.009105 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m20:07:24.009325 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m20:07:24.009548 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m20:07:24.009776 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m20:07:24.010047 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m20:07:24.010300 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m20:07:24.010613 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:24.014370 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:24.014619 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:24.014801 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m20:07:24.014983 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m20:07:24.015148 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m20:07:24.015366 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m20:07:24.015572 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m20:07:24.015794 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m20:07:24.016002 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m20:07:24.016239 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:24.016469 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m20:07:24.016705 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m20:07:24.017937 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:24.018115 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:24.018265 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m20:07:24.018452 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:24.019117 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m20:07:24.019729 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m20:07:24.020291 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m20:07:24.020864 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m20:07:24.021145 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m20:07:24.021349 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m20:07:24.021586 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m20:07:24.021878 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m20:07:24.022165 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m20:07:24.022470 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m20:07:24.022889 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m20:07:24.023286 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m20:07:24.023613 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m20:07:24.023928 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m20:07:24.024242 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m20:07:24.024482 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m20:07:24.024751 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:07:24.025440 [info ] [Thread-1 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m20:07:24.025752 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m20:07:24.025984 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:07:24.027954 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:07:24.028560 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:07:24.029561 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:07:24.030040 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:07:24.030261 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m20:07:24.030426 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m20:07:24.033464 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m20:07:24.033693 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m20:07:24.033877 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.3", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m20:07:24.035637 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m20:07:24.036312 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m20:07:24.036527 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m20:07:24.036819 [info ] [Thread-1 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m20:07:24.037075 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m20:07:24.038275 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:24.038486 [debug] [MainThread]: On master: BEGIN
[0m20:07:24.038662 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m20:07:24.041420 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m20:07:24.041633 [debug] [MainThread]: On master: COMMIT
[0m20:07:24.041795 [debug] [MainThread]: Using postgres connection "master"
[0m20:07:24.041940 [debug] [MainThread]: On master: COMMIT
[0m20:07:24.042122 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m20:07:24.042274 [debug] [MainThread]: On master: Close
[0m20:07:24.042475 [debug] [MainThread]: Connection 'master' was properly closed.
[0m20:07:24.042646 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m20:07:24.042816 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59' was properly closed.
[0m20:07:24.042963 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m20:07:24.043114 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m20:07:24.043301 [info ] [MainThread]: 
[0m20:07:24.043524 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.22 seconds (0.22s).
[0m20:07:24.044308 [debug] [MainThread]: Command end result
[0m20:07:24.058270 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m20:07:24.059286 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m20:07:24.062680 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m20:07:24.062888 [info ] [MainThread]: 
[0m20:07:24.063103 [info ] [MainThread]: [32mCompleted successfully[0m
[0m20:07:24.063286 [info ] [MainThread]: 
[0m20:07:24.063481 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m20:07:24.064073 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.47880468, "process_in_blocks": "0", "process_kernel_time": 0.115548, "process_mem_max_rss": "129680", "process_out_blocks": "2159", "process_user_time": 1.075103}
[0m20:07:24.064322 [debug] [MainThread]: Command `dbt test` succeeded at 20:07:24.064281 after 0.48 seconds
[0m20:07:24.064578 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97ec0b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97e95b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98233150>]}
[0m20:07:24.064862 [debug] [MainThread]: Flushing usage events
[0m20:07:24.447621 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:20:51.529419 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94980290>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91d02810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91d02150>]}


============================== 21:20:51.532753 | e079b121-ea7f-4ade-8849-b5342f08f864 ==============================
[0m21:20:51.532753 [info ] [MainThread]: Running with dbt=1.11.4
[0m21:20:51.533084 [debug] [MainThread]: running dbt with arguments {'introspect': 'True', 'static_parser': 'True', 'version_check': 'True', 'target_path': 'None', 'printer_width': '80', 'quiet': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'warn_error': 'None', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'invocation_command': 'dbt run', 'debug': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'partial_parse': 'True', 'log_cache_events': 'False', 'no_print': 'None', 'fail_fast': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'use_experimental_parser': 'False', 'use_colors': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'cache_selected_only': 'False', 'empty': 'False'}
[0m21:20:51.700617 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff912f3410>]}
[0m21:20:51.720413 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff94712790>]}
[0m21:20:51.720842 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m21:20:51.752464 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m21:20:51.796341 [info ] [MainThread]: Unable to do partial parsing because of a version mismatch
[0m21:20:51.796733 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9325d010>]}
[0m21:20:52.157580 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m21:20:52.158024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b530e50>]}
[0m21:20:52.263441 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90dcbed0>]}
[0m21:20:52.297129 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m21:20:52.298476 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m21:20:52.311742 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b3f5450>]}
[0m21:20:52.312187 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m21:20:52.312515 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b2e6f10>]}
[0m21:20:52.313472 [info ] [MainThread]: 
[0m21:20:52.313693 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:20:52.313867 [info ] [MainThread]: 
[0m21:20:52.314130 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:20:52.315857 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m21:20:52.316201 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m21:20:52.316496 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m21:20:52.382873 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m21:20:52.383087 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m21:20:52.383283 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m21:20:52.383523 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m21:20:52.383768 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m21:20:52.383992 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m21:20:52.384211 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:52.384432 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:52.384612 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:52.391602 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m21:20:52.391776 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.008 seconds
[0m21:20:52.391941 [debug] [ThreadPool]: SQL status: SELECT 18 in 0.007 seconds
[0m21:20:52.392554 [debug] [ThreadPool]: On list_warehouse: Close
[0m21:20:52.393107 [debug] [ThreadPool]: On list_warehouse: Close
[0m21:20:52.393629 [debug] [ThreadPool]: On list_warehouse: Close
[0m21:20:52.395116 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m21:20:52.395397 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m21:20:52.397800 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m21:20:52.397997 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m21:20:52.398855 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m21:20:52.399063 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m21:20:52.399886 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m21:20:52.400108 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m21:20:52.400341 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:20:52.400539 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m21:20:52.400735 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:20:52.401025 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m21:20:52.404239 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.404446 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.404669 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.404884 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m21:20:52.405119 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m21:20:52.405343 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m21:20:52.405554 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m21:20:52.405780 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m21:20:52.405976 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m21:20:52.409107 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m21:20:52.409263 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m21:20:52.409395 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m21:20:52.410037 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m21:20:52.410597 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m21:20:52.411125 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m21:20:52.411402 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m21:20:52.411585 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m21:20:52.411757 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m21:20:52.414628 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.414864 [debug] [MainThread]: On master: BEGIN
[0m21:20:52.415045 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:20:52.423090 [debug] [MainThread]: SQL status: BEGIN in 0.008 seconds
[0m21:20:52.423308 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.423568 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:20:52.434432 [debug] [MainThread]: SQL status: SELECT 3 in 0.011 seconds
[0m21:20:52.435032 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b45d310>]}
[0m21:20:52.435311 [debug] [MainThread]: On master: ROLLBACK
[0m21:20:52.435563 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.435767 [debug] [MainThread]: On master: BEGIN
[0m21:20:52.436073 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:20:52.436430 [debug] [MainThread]: On master: COMMIT
[0m21:20:52.436632 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.436813 [debug] [MainThread]: On master: COMMIT
[0m21:20:52.437055 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:20:52.437261 [debug] [MainThread]: On master: Close
[0m21:20:52.439911 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m21:20:52.440088 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m21:20:52.440275 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m21:20:52.440548 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m21:20:52.440822 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m21:20:52.441102 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m21:20:52.441378 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m21:20:52.441625 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m21:20:52.441863 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m21:20:52.442078 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m21:20:52.442313 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m21:20:52.442537 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m21:20:52.445356 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.446458 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.447521 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.448867 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m21:20:52.449081 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m21:20:52.449254 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m21:20:52.461721 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.463059 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.464368 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.465869 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.466064 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.466253 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.466487 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m21:20:52.466721 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m21:20:52.466948 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m21:20:52.467189 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:52.467405 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:20:52.467615 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:20:52.471147 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.471369 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.471537 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:52.471746 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.472002 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.472225 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.472464 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m21:20:52.472737 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m21:20:52.473007 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m21:20:52.483909 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m21:20:52.484091 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.010 seconds
[0m21:20:52.484253 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.011 seconds
[0m21:20:52.486823 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.488001 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.489150 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.489388 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m21:20:52.489619 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m21:20:52.489834 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m21:20:52.490340 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.490504 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.490655 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.491721 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.492863 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.494015 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.494233 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m21:20:52.494459 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m21:20:52.494673 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m21:20:52.495059 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.495231 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.495386 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.500779 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m21:20:52.501396 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m21:20:52.502009 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m21:20:52.502239 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.502467 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.502689 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.502931 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m21:20:52.503155 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m21:20:52.503389 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m21:20:52.504201 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m21:20:52.504365 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m21:20:52.504509 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m21:20:52.506676 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m21:20:52.508332 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m21:20:52.509232 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m21:20:52.511047 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m21:20:52.511431 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m21:20:52.511822 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m21:20:52.512046 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m21:20:52.512260 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m21:20:52.512481 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m21:20:52.515434 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.003 seconds
[0m21:20:52.515587 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.003 seconds
[0m21:20:52.515736 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.003 seconds
[0m21:20:52.516700 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m21:20:52.517248 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m21:20:52.517762 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m21:20:52.518578 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b519990>]}
[0m21:20:52.518825 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8b276590>]}
[0m21:20:52.519523 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff91fbbc10>]}
[0m21:20:52.519852 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m21:20:52.520317 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.08s]
[0m21:20:52.520649 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.08s]
[0m21:20:52.520949 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m21:20:52.521211 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m21:20:52.521465 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m21:20:52.521951 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m21:20:52.522280 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m21:20:52.522525 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m21:20:52.522786 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m21:20:52.523065 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m21:20:52.523278 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m21:20:52.523491 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m21:20:52.523680 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m21:20:52.525751 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.527357 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.528421 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m21:20:52.528578 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m21:20:52.541848 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.543272 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.543545 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp212052537155"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m21:20:52.543846 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp212052542703"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m21:20:52.544131 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:20:52.544378 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:52.557113 [debug] [Thread-4 (]: SQL status: SELECT 8 in 0.013 seconds
[0m21:20:52.562010 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.562198 [debug] [Thread-1 (]: SQL status: SELECT 90 in 0.018 seconds
[0m21:20:52.562416 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m21:20:52.563661 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.563978 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m21:20:52.564137 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m21:20:52.564383 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.564693 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m21:20:52.564891 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp212052537155'
        
      order by ordinal_position

  
[0m21:20:52.565099 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.565404 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp212052542703'
        
      order by ordinal_position

  
[0m21:20:52.572999 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.008 seconds
[0m21:20:52.573167 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.007 seconds
[0m21:20:52.576077 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.577349 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.577591 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m21:20:52.577812 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m21:20:52.579017 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m21:20:52.579195 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m21:20:52.582486 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.583891 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.584131 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m21:20:52.584379 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m21:20:52.585456 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m21:20:52.585614 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m21:20:52.590744 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.591693 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.592542 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.592728 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.592940 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp212052537155" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp212052537155"
    )
  
[0m21:20:52.593243 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp212052542703" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp212052542703"
    )
  
[0m21:20:52.594044 [debug] [Thread-4 (]: SQL status: INSERT 0 8 in 0.001 seconds
[0m21:20:52.594710 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m21:20:52.594865 [debug] [Thread-1 (]: SQL status: INSERT 0 90 in 0.001 seconds
[0m21:20:52.595058 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m21:20:52.595622 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m21:20:52.595831 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m21:20:52.596056 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m21:20:52.596345 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m21:20:52.596550 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m21:20:52.596956 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m21:20:52.597103 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m21:20:52.597438 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90e9e310>]}
[0m21:20:52.597770 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m21:20:52.598156 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 8[0m in 0.07s]
[0m21:20:52.598532 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff90d76550>]}
[0m21:20:52.598818 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m21:20:52.599141 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 90[0m in 0.08s]
[0m21:20:52.599687 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m21:20:52.600094 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m21:20:52.600532 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m21:20:52.600782 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m21:20:52.600976 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m21:20:52.602389 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.603054 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m21:20:52.607713 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.608238 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.608425 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m21:20:52.608595 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:20:52.611827 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m21:20:52.612053 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.612293 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m21:20:52.615759 [debug] [Thread-2 (]: SQL status: SELECT 90 in 0.003 seconds
[0m21:20:52.618364 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.618559 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m21:20:52.618858 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.619946 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.620128 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m21:20:52.620439 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m21:20:52.621066 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m21:20:52.621258 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.621442 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m21:20:52.621869 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m21:20:52.623783 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m21:20:52.624959 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m21:20:52.625186 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m21:20:52.626914 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m21:20:52.627426 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m21:20:52.627724 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'e079b121-ea7f-4ade-8849-b5342f08f864', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff911db010>]}
[0m21:20:52.628050 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.03s]
[0m21:20:52.628353 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m21:20:52.629126 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.629334 [debug] [MainThread]: On master: BEGIN
[0m21:20:52.629504 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:20:52.632367 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m21:20:52.632580 [debug] [MainThread]: On master: COMMIT
[0m21:20:52.632788 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:52.632951 [debug] [MainThread]: On master: COMMIT
[0m21:20:52.633142 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:20:52.633302 [debug] [MainThread]: On master: Close
[0m21:20:52.633533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:52.633695 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m21:20:52.633838 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m21:20:52.633976 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m21:20:52.634120 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m21:20:52.634339 [info ] [MainThread]: 
[0m21:20:52.634519 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m21:20:52.635001 [debug] [MainThread]: Command end result
[0m21:20:52.649623 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m21:20:52.651221 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m21:20:52.654509 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m21:20:52.654771 [info ] [MainThread]: 
[0m21:20:52.655035 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:20:52.655261 [info ] [MainThread]: 
[0m21:20:52.655498 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m21:20:52.655826 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m21:20:52.656443 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 1.1495692, "process_in_blocks": "0", "process_kernel_time": 0.578532, "process_mem_max_rss": "136896", "process_out_blocks": "4331", "process_user_time": 1.684938}
[0m21:20:52.656713 [debug] [MainThread]: Command `dbt run` succeeded at 21:20:52.656672 after 1.15 seconds
[0m21:20:52.656934 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff969a4b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9692cc10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9692d490>]}
[0m21:20:52.657143 [debug] [MainThread]: Flushing usage events
[0m21:20:53.147079 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m21:20:54.438736 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86732450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86732090>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff867311d0>]}


============================== 21:20:54.441269 | 18618320-95bb-4649-9a64-131667013161 ==============================
[0m21:20:54.441269 [info ] [MainThread]: Running with dbt=1.11.4
[0m21:20:54.441620 [debug] [MainThread]: running dbt with arguments {'printer_width': '80', 'log_path': '/opt/bluealpha/dbt_project/logs', 'empty': 'None', 'warn_error': 'None', 'target_path': 'None', 'static_parser': 'True', 'quiet': 'False', 'send_anonymous_usage_stats': 'True', 'version_check': 'True', 'use_colors': 'True', 'debug': 'False', 'log_cache_events': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'introspect': 'True', 'cache_selected_only': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'log_format': 'default', 'no_print': 'None', 'write_json': 'True', 'partial_parse': 'True', 'use_experimental_parser': 'False', 'fail_fast': 'False', 'invocation_command': 'dbt test', 'indirect_selection': 'eager'}
[0m21:20:54.505255 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85b601d0>]}
[0m21:20:54.524895 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89245550>]}
[0m21:20:54.525310 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m21:20:54.550726 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m21:20:54.597165 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m21:20:54.597500 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m21:20:54.597717 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m21:20:54.615565 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87288190>]}
[0m21:20:54.655436 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m21:20:54.656652 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m21:20:54.673672 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85664050>]}
[0m21:20:54.674050 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m21:20:54.674284 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85b6f0d0>]}
[0m21:20:54.675536 [info ] [MainThread]: 
[0m21:20:54.675801 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m21:20:54.676033 [info ] [MainThread]: 
[0m21:20:54.676349 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m21:20:54.678314 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m21:20:54.678604 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m21:20:54.711978 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m21:20:54.722683 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m21:20:54.722897 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m21:20:54.723079 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m21:20:54.723330 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m21:20:54.723569 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m21:20:54.723821 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m21:20:54.724041 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:54.724270 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:54.724494 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m21:20:54.729305 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.729560 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m21:20:54.729767 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.729930 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m21:20:54.730163 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m21:20:54.730424 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m21:20:54.730690 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m21:20:54.730926 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m21:20:54.731179 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m21:20:54.733870 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m21:20:54.734034 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m21:20:54.734205 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m21:20:54.734917 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m21:20:54.735544 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m21:20:54.736104 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m21:20:54.736476 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m21:20:54.736698 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m21:20:54.736903 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m21:20:54.739965 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.740217 [debug] [MainThread]: On master: BEGIN
[0m21:20:54.740435 [debug] [MainThread]: Opening a new connection, currently in state init
[0m21:20:54.744230 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.744589 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.744866 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m21:20:54.754956 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m21:20:54.755691 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '18618320-95bb-4649-9a64-131667013161', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff841ae950>]}
[0m21:20:54.756004 [debug] [MainThread]: On master: ROLLBACK
[0m21:20:54.756314 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.756521 [debug] [MainThread]: On master: BEGIN
[0m21:20:54.756880 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m21:20:54.757128 [debug] [MainThread]: On master: COMMIT
[0m21:20:54.757441 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.757683 [debug] [MainThread]: On master: COMMIT
[0m21:20:54.758083 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:20:54.758319 [debug] [MainThread]: On master: Close
[0m21:20:54.762360 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m21:20:54.762632 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m21:20:54.762971 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m21:20:54.763257 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m21:20:54.763626 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m21:20:54.763998 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m21:20:54.764309 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m21:20:54.764611 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m21:20:54.764941 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m21:20:54.765206 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m21:20:54.765513 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m21:20:54.765830 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m21:20:54.766194 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m21:20:54.766507 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m21:20:54.766792 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m21:20:54.767058 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m21:20:54.774230 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m21:20:54.778628 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m21:20:54.780731 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m21:20:54.782987 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m21:20:54.784255 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m21:20:54.784510 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m21:20:54.784803 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m21:20:54.791609 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m21:20:54.791903 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m21:20:54.793005 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m21:20:54.794259 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m21:20:54.795649 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m21:20:54.796344 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m21:20:54.796909 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m21:20:54.797384 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m21:20:54.797580 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m21:20:54.797876 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m21:20:54.798035 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m21:20:54.798273 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:54.798505 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m21:20:54.798719 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m21:20:54.798947 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:20:54.799802 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:20:54.800075 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m21:20:54.803488 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.803982 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.804222 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.804420 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m21:20:54.804793 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m21:20:54.805024 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.805284 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m21:20:54.805545 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m21:20:54.807568 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.807909 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m21:20:54.808218 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.808820 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.809250 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.809569 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m21:20:54.811402 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m21:20:54.811644 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:20:54.811825 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m21:20:54.812463 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m21:20:54.812852 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m21:20:54.813463 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m21:20:54.814252 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m21:20:54.814644 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m21:20:54.815046 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.05s]
[0m21:20:54.815476 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m21:20:54.815720 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m21:20:54.816083 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.05s]
[0m21:20:54.816510 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m21:20:54.816900 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.05s]
[0m21:20:54.817277 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.05s]
[0m21:20:54.817603 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m21:20:54.817886 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m21:20:54.818245 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m21:20:54.818535 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m21:20:54.818802 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m21:20:54.819068 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m21:20:54.819356 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m21:20:54.819632 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m21:20:54.819879 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m21:20:54.820182 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m21:20:54.820421 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m21:20:54.820677 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m21:20:54.821025 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m21:20:54.821302 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m21:20:54.821592 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m21:20:54.821846 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m21:20:54.822094 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m21:20:54.824080 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m21:20:54.824400 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m21:20:54.824705 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m21:20:54.826505 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m21:20:54.828549 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m21:20:54.831228 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m21:20:54.831485 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m21:20:54.832315 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m21:20:54.832578 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m21:20:54.833613 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m21:20:54.833878 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m21:20:54.835064 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m21:20:54.836099 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m21:20:54.837439 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m21:20:54.837883 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m21:20:54.838746 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m21:20:54.839190 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m21:20:54.839454 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m21:20:54.839736 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m21:20:54.839896 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m21:20:54.840247 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:20:54.840494 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m21:20:54.840733 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m21:20:54.840969 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:20:54.841416 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:20:54.841703 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:54.845269 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.845473 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.845900 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m21:20:54.846151 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.846390 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.846726 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m21:20:54.846982 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.847292 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m21:20:54.847576 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m21:20:54.847918 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.848351 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.848679 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.848871 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.849657 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.850504 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m21:20:54.850708 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.850969 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:20:54.851597 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m21:20:54.851988 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m21:20:54.852578 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m21:20:54.853256 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m21:20:54.853668 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m21:20:54.854040 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m21:20:54.854419 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m21:20:54.854831 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m21:20:54.855292 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.04s]
[0m21:20:54.855632 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m21:20:54.856012 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m21:20:54.856405 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m21:20:54.856773 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m21:20:54.857087 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m21:20:54.857494 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m21:20:54.857899 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m21:20:54.858206 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m21:20:54.858577 [info ] [Thread-3 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m21:20:54.858873 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m21:20:54.859224 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m21:20:54.859538 [info ] [Thread-2 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m21:20:54.859916 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m21:20:54.860241 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m21:20:54.860564 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m21:20:54.860922 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m21:20:54.861302 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m21:20:54.861625 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m21:20:54.861946 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m21:20:54.862290 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m21:20:54.864234 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m21:20:54.864574 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m21:20:54.864875 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m21:20:54.866875 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m21:20:54.868763 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m21:20:54.871128 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m21:20:54.871373 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m21:20:54.872320 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m21:20:54.872637 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m21:20:54.873855 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m21:20:54.874119 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m21:20:54.875125 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m21:20:54.877377 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m21:20:54.878706 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m21:20:54.879241 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m21:20:54.879779 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m21:20:54.880238 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m21:20:54.880485 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m21:20:54.880879 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m21:20:54.881062 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m21:20:54.881305 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:20:54.881539 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m21:20:54.881750 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m21:20:54.881968 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m21:20:54.882389 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m21:20:54.882717 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m21:20:54.885796 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.886219 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m21:20:54.886573 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.886801 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.887118 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.887522 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m21:20:54.887751 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m21:20:54.888018 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m21:20:54.888240 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.888488 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.888749 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m21:20:54.889037 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m21:20:54.889832 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m21:20:54.890266 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:20:54.890979 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m21:20:54.891439 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.891753 [info ] [Thread-3 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m21:20:54.892026 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.892244 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m21:20:54.892869 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m21:20:54.893249 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m21:20:54.893824 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m21:20:54.894392 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m21:20:54.894739 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m21:20:54.894901 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m21:20:54.895208 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m21:20:54.895445 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m21:20:54.895613 [info ] [Thread-3 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m21:20:54.895998 [info ] [Thread-2 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.04s]
[0m21:20:54.896368 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m21:20:54.896724 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m21:20:54.896994 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m21:20:54.897307 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m21:20:54.897595 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m21:20:54.897920 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m21:20:54.898276 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m21:20:54.900738 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m21:20:54.901475 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m21:20:54.902747 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m21:20:54.903331 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m21:20:54.903580 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m21:20:54.903794 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m21:20:54.907679 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.908034 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m21:20:54.908371 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m21:20:54.910433 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m21:20:54.911218 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m21:20:54.911520 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m21:20:54.911887 [info ] [Thread-3 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m21:20:54.912285 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m21:20:54.913805 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.914089 [debug] [MainThread]: On master: BEGIN
[0m21:20:54.914357 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m21:20:54.918264 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m21:20:54.918559 [debug] [MainThread]: On master: COMMIT
[0m21:20:54.918880 [debug] [MainThread]: Using postgres connection "master"
[0m21:20:54.919234 [debug] [MainThread]: On master: COMMIT
[0m21:20:54.919652 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m21:20:54.919962 [debug] [MainThread]: On master: Close
[0m21:20:54.920355 [debug] [MainThread]: Connection 'master' was properly closed.
[0m21:20:54.920652 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m21:20:54.921111 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m21:20:54.921431 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m21:20:54.921848 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m21:20:54.922271 [info ] [MainThread]: 
[0m21:20:54.922611 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.25 seconds (0.25s).
[0m21:20:54.923693 [debug] [MainThread]: Command end result
[0m21:20:54.946921 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m21:20:54.948243 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m21:20:54.951879 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m21:20:54.952212 [info ] [MainThread]: 
[0m21:20:54.952563 [info ] [MainThread]: [32mCompleted successfully[0m
[0m21:20:54.952878 [info ] [MainThread]: 
[0m21:20:54.953154 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m21:20:54.953840 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.53328556, "process_in_blocks": "0", "process_kernel_time": 0.126477, "process_mem_max_rss": "129692", "process_out_blocks": "2159", "process_user_time": 1.077544}
[0m21:20:54.954148 [debug] [MainThread]: Command `dbt test` succeeded at 21:20:54.954101 after 0.53 seconds
[0m21:20:54.954436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8676ce50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8676d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff86c45ad0>]}
[0m21:20:54.954671 [debug] [MainThread]: Flushing usage events
[0m21:20:55.335294 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:50.518592 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff852625d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85493d10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85541050>]}


============================== 22:13:50.521584 | 5a82a08d-087d-4c1b-a244-592d46f7af4a ==============================
[0m22:13:50.521584 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:13:50.521921 [debug] [MainThread]: running dbt with arguments {'debug': 'False', 'target_path': 'None', 'invocation_command': 'dbt run', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'cache_selected_only': 'False', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'log_cache_events': 'False', 'use_colors': 'True', 'quiet': 'False', 'partial_parse': 'True', 'no_print': 'None', 'log_path': '/opt/bluealpha/dbt_project/logs', 'empty': 'False', 'introspect': 'True', 'fail_fast': 'False', 'warn_error': 'None', 'log_format': 'default', 'static_parser': 'True', 'printer_width': '80', 'profiles_dir': '/opt/bluealpha/dbt_project', 'version_check': 'True'}
[0m22:13:50.585313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff847d2710>]}
[0m22:13:50.605448 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff87c95310>]}
[0m22:13:50.605897 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:13:50.630322 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:13:50.675860 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:13:50.676096 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:13:50.676303 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:13:50.692546 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff843db790>]}
[0m22:13:50.726029 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:13:50.727486 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:13:50.736056 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84318190>]}
[0m22:13:50.736374 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:13:50.736596 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84677850>]}
[0m22:13:50.737479 [info ] [MainThread]: 
[0m22:13:50.737670 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:13:50.737822 [info ] [MainThread]: 
[0m22:13:50.738069 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:13:50.739769 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:13:50.740057 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:13:50.744414 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:13:50.777178 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:13:50.777379 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:13:50.777547 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:13:50.777768 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:13:50.778008 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:13:50.778247 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:13:50.778471 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:50.778689 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:50.778896 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:50.784196 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.005 seconds
[0m22:13:50.784373 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.006 seconds
[0m22:13:50.784504 [debug] [ThreadPool]: SQL status: SELECT 22 in 0.006 seconds
[0m22:13:50.785038 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:13:50.785566 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:13:50.786066 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:13:50.787845 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m22:13:50.788136 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m22:13:50.788399 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m22:13:50.790642 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:13:50.791479 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:13:50.792244 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:13:50.792444 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:13:50.792693 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:13:50.792904 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:13:50.793078 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:13:50.793291 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:13:50.793493 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:13:50.797689 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m22:13:50.798230 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:13:50.798474 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:13:50.798781 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:13:50.798990 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:13:50.799247 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:13:50.799634 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:13:50.799922 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:13:50.800182 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:13:50.801903 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m22:13:50.802748 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:13:50.802927 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m22:13:50.803110 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m22:13:50.803521 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:13:50.804113 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:13:50.804771 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:13:50.805519 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:13:50.805756 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:13:50.808331 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:50.808673 [debug] [MainThread]: On master: BEGIN
[0m22:13:50.808917 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:13:50.812670 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m22:13:50.812994 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:50.813293 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:13:50.823377 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m22:13:50.824074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff846bfd90>]}
[0m22:13:50.824397 [debug] [MainThread]: On master: ROLLBACK
[0m22:13:50.824704 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:50.824898 [debug] [MainThread]: On master: BEGIN
[0m22:13:50.825235 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:13:50.825478 [debug] [MainThread]: On master: COMMIT
[0m22:13:50.825692 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:50.825885 [debug] [MainThread]: On master: COMMIT
[0m22:13:50.826167 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:50.826363 [debug] [MainThread]: On master: Close
[0m22:13:50.828592 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:13:50.828777 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:13:50.828961 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:13:50.829325 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m22:13:50.829655 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m22:13:50.829951 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m22:13:50.830271 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m22:13:50.830521 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m22:13:50.830798 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_google_ads_daily)
[0m22:13:50.831060 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:13:50.831303 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:13:50.831531 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m22:13:50.834707 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.835891 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.837067 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.837991 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:13:50.838308 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:13:50.851560 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m22:13:50.852351 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.853703 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.855094 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.855909 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.856168 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.856395 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m22:13:50.856585 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.856814 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m22:13:50.857020 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:50.857240 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m22:13:50.857467 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:50.857833 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:50.861741 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:50.862028 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:50.862261 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:50.862524 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.862774 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.863084 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.863406 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m22:13:50.863695 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m22:13:50.863963 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m22:13:50.868965 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:13:50.869161 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:13:50.869314 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:13:50.872214 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.873611 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.874782 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.875020 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m22:13:50.875265 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m22:13:50.875480 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m22:13:50.876061 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:50.876230 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:50.876380 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:13:50.877590 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.878692 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.879761 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.879970 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m22:13:50.880183 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m22:13:50.880373 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m22:13:50.880790 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:50.880958 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:50.881102 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:50.886886 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:13:50.887558 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:13:50.888162 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:13:50.888382 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.888603 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.888773 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.889000 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:13:50.889241 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:13:50.889432 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:13:50.889946 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m22:13:50.890099 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m22:13:50.890254 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m22:13:50.893519 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m22:13:50.894547 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m22:13:50.895482 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m22:13:50.897337 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:13:50.897715 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:13:50.898089 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:13:50.898334 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m22:13:50.898544 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m22:13:50.898786 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m22:13:50.900321 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:13:50.900502 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:13:50.900651 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:13:50.901741 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m22:13:50.902289 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m22:13:50.902850 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m22:13:50.903848 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff827f2e50>]}
[0m22:13:50.904096 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8269b950>]}
[0m22:13:50.904429 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80532690>]}
[0m22:13:50.904883 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m22:13:50.905259 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m22:13:50.905618 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m22:13:50.905932 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:13:50.906197 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:13:50.906467 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:13:50.906957 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m22:13:50.907336 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m22:13:50.907547 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m22:13:50.907801 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m22:13:50.908109 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m22:13:50.908337 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m22:13:50.908542 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m22:13:50.908722 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m22:13:50.912155 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.913596 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.914598 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m22:13:50.914775 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m22:13:50.929235 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.930829 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.931072 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp221350923862"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m22:13:50.931396 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp221350930256"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m22:13:50.931629 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:13:50.931906 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:50.941343 [debug] [Thread-4 (]: SQL status: SELECT 0 in 0.010 seconds
[0m22:13:50.941548 [debug] [Thread-1 (]: SQL status: SELECT 0 in 0.010 seconds
[0m22:13:50.946629 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.948645 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.950416 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m22:13:50.950952 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m22:13:50.951484 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m22:13:50.951753 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m22:13:50.951952 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.952272 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.952501 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp221350923862'
        
      order by ordinal_position

  
[0m22:13:50.952744 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp221350930256'
        
      order by ordinal_position

  
[0m22:13:50.957632 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.005 seconds
[0m22:13:50.957815 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.005 seconds
[0m22:13:50.959912 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.961230 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.961486 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:13:50.961733 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:13:50.962903 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m22:13:50.963064 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m22:13:50.966301 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.967596 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.967815 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:13:50.968061 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:13:50.969034 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m22:13:50.969223 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m22:13:50.974459 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.975385 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.976084 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.976369 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.976538 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp221350923862" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp221350923862"
    )
  
[0m22:13:50.976764 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp221350930256" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp221350930256"
    )
  
[0m22:13:50.977513 [debug] [Thread-4 (]: SQL status: INSERT 0 0 in 0.000 seconds
[0m22:13:50.977672 [debug] [Thread-1 (]: SQL status: INSERT 0 0 in 0.001 seconds
[0m22:13:50.978345 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:13:50.978891 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:13:50.979110 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:13:50.979319 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:13:50.979512 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:13:50.979681 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:13:50.980204 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m22:13:50.980798 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m22:13:50.980953 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m22:13:50.981308 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff82747d90>]}
[0m22:13:50.981615 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m22:13:50.982020 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 0[0m in 0.07s]
[0m22:13:50.982476 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8283f410>]}
[0m22:13:50.982815 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m22:13:50.983214 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 0[0m in 0.07s]
[0m22:13:50.983756 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m22:13:50.984292 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m22:13:50.984543 [info ] [Thread-3 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m22:13:50.984787 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m22:13:50.984985 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m22:13:50.986504 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:50.987036 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m22:13:50.992078 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:50.992600 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:50.992821 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m22:13:50.993009 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:50.996029 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m22:13:50.996335 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:50.996531 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m22:13:50.999924 [debug] [Thread-3 (]: SQL status: SELECT 0 in 0.003 seconds
[0m22:13:51.002627 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:51.002807 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m22:13:51.003091 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:51.004126 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:51.004287 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m22:13:51.004522 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:13:51.005135 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:13:51.005293 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:51.005482 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:13:51.005950 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m22:13:51.007799 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m22:13:51.009092 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:13:51.009300 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m22:13:51.011600 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.002 seconds
[0m22:13:51.012270 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m22:13:51.012729 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '5a82a08d-087d-4c1b-a244-592d46f7af4a', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff805e06d0>]}
[0m22:13:51.013028 [info ] [Thread-3 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 0[0m in 0.03s]
[0m22:13:51.013340 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m22:13:51.014126 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:51.014298 [debug] [MainThread]: On master: BEGIN
[0m22:13:51.014440 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:13:51.017061 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:13:51.017315 [debug] [MainThread]: On master: COMMIT
[0m22:13:51.017485 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:51.017647 [debug] [MainThread]: On master: COMMIT
[0m22:13:51.017860 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:51.018002 [debug] [MainThread]: On master: Close
[0m22:13:51.018198 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:13:51.018352 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m22:13:51.018513 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m22:13:51.018654 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_facebook_ads_daily' was properly closed.
[0m22:13:51.018817 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m22:13:51.019008 [info ] [MainThread]: 
[0m22:13:51.019207 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.28 seconds (0.28s).
[0m22:13:51.019681 [debug] [MainThread]: Command end result
[0m22:13:51.032615 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:13:51.033485 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:13:51.036182 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:13:51.036378 [info ] [MainThread]: 
[0m22:13:51.036583 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:13:51.036770 [info ] [MainThread]: 
[0m22:13:51.036977 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m22:13:51.037450 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.53853285, "process_in_blocks": "0", "process_kernel_time": 0.125076, "process_mem_max_rss": "130912", "process_out_blocks": "2184", "process_user_time": 1.088368}
[0m22:13:51.037677 [debug] [MainThread]: Command `dbt run` succeeded at 22:13:51.037643 after 0.54 seconds
[0m22:13:51.037858 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff852513d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff852517d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff805498d0>]}
[0m22:13:51.038066 [debug] [MainThread]: Flushing usage events
[0m22:13:51.522932 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:13:52.962183 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb97d1f10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb97d26d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9761310>]}


============================== 22:13:52.964824 | c58daba2-48e5-4604-a5fb-1c26df643de9 ==============================
[0m22:13:52.964824 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:13:52.965158 [debug] [MainThread]: running dbt with arguments {'quiet': 'False', 'static_parser': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'profiles_dir': '/opt/bluealpha/dbt_project', 'warn_error': 'None', 'indirect_selection': 'eager', 'log_format': 'default', 'cache_selected_only': 'False', 'invocation_command': 'dbt test', 'version_check': 'True', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'fail_fast': 'False', 'write_json': 'True', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'empty': 'None', 'use_experimental_parser': 'False', 'target_path': 'None', 'debug': 'False', 'use_colors': 'True', 'no_print': 'None', 'printer_width': '80', 'log_cache_events': 'False'}
[0m22:13:53.025110 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8d6e6d0>]}
[0m22:13:53.044217 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbc2554d0>]}
[0m22:13:53.044604 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:13:53.068267 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:13:53.111286 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:13:53.111567 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:13:53.111742 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:13:53.128171 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb89dbd10>]}
[0m22:13:53.161431 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:13:53.162223 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:13:53.173780 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb97d2850>]}
[0m22:13:53.174042 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:13:53.174228 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb89ec050>]}
[0m22:13:53.175234 [info ] [MainThread]: 
[0m22:13:53.175429 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:13:53.175575 [info ] [MainThread]: 
[0m22:13:53.175817 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:13:53.177425 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m22:13:53.177679 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m22:13:53.202434 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m22:13:53.216694 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:13:53.216869 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:13:53.217036 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:13:53.217268 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:13:53.217483 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:13:53.217693 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:13:53.217899 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:53.218108 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:53.218342 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:13:53.223209 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.223448 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.223622 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:13:53.223857 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:13:53.224077 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:13:53.224303 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:13:53.224524 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:13:53.224754 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:13:53.224987 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:13:53.227433 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m22:13:53.227596 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m22:13:53.227747 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m22:13:53.228385 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:13:53.228953 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:13:53.229441 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:13:53.229747 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:13:53.229939 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:13:53.230149 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:13:53.233302 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.233512 [debug] [MainThread]: On master: BEGIN
[0m22:13:53.233680 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:13:53.236916 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:13:53.237310 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.237612 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:13:53.246984 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m22:13:53.247541 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c58daba2-48e5-4604-a5fb-1c26df643de9', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb97dcc10>]}
[0m22:13:53.247806 [debug] [MainThread]: On master: ROLLBACK
[0m22:13:53.248057 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.248245 [debug] [MainThread]: On master: BEGIN
[0m22:13:53.248540 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:13:53.248776 [debug] [MainThread]: On master: COMMIT
[0m22:13:53.248992 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.249139 [debug] [MainThread]: On master: COMMIT
[0m22:13:53.249562 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:53.249753 [debug] [MainThread]: On master: Close
[0m22:13:53.251738 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:13:53.251924 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:13:53.252160 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:13:53.252351 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:13:53.252521 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m22:13:53.252805 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m22:13:53.253081 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m22:13:53.253390 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m22:13:53.253680 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m22:13:53.253925 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m22:13:53.254181 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m22:13:53.254462 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m22:13:53.254689 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:13:53.254908 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:13:53.255136 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:13:53.255394 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:13:53.261683 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:13:53.265057 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:13:53.266527 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:13:53.268061 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:13:53.268970 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:13:53.269314 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:13:53.269515 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:13:53.275395 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:13:53.275630 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:13:53.276581 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:13:53.277535 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:13:53.278667 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:13:53.279006 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:13:53.279335 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:13:53.279782 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:13:53.279944 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m22:13:53.280239 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:13:53.280368 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m22:13:53.280602 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m22:13:53.280889 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:53.281101 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m22:13:53.281368 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:53.281823 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:53.282217 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:13:53.285812 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.286242 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.286475 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:13:53.286699 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.286906 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m22:13:53.287129 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:13:53.287364 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.287596 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:13:53.287814 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:13:53.288027 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.288368 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.288620 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m22:13:53.288805 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.289432 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:13:53.289591 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:13:53.291470 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m22:13:53.291722 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:13:53.292360 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m22:13:53.292966 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m22:13:53.293248 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m22:13:53.293747 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m22:13:53.294035 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m22:13:53.294254 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m22:13:53.294520 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m22:13:53.294883 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m22:13:53.295242 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m22:13:53.295607 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m22:13:53.295890 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:13:53.296202 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m22:13:53.296470 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:13:53.296774 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:13:53.297003 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:13:53.297340 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:13:53.297644 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:13:53.297914 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:13:53.298156 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m22:13:53.298458 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:13:53.298694 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m22:13:53.298950 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m22:13:53.299195 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m22:13:53.299427 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m22:13:53.299696 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m22:13:53.299944 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m22:13:53.300142 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:13:53.300384 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m22:13:53.300602 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:13:53.300819 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:13:53.302530 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:13:53.302755 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:13:53.304245 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:13:53.305828 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:13:53.308288 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:13:53.308754 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:13:53.309452 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:13:53.310480 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:13:53.310629 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:13:53.310859 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:13:53.311676 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:13:53.312730 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:13:53.312931 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:13:53.313899 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:13:53.314357 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m22:13:53.314541 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:13:53.314732 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:13:53.315083 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:53.315308 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:13:53.315439 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m22:13:53.315607 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m22:13:53.315873 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m22:13:53.316077 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:53.316269 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:13:53.316491 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:53.319452 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.319929 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:13:53.320254 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.320636 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.320902 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.321199 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.321401 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.321574 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:13:53.321813 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:13:53.322502 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m22:13:53.322723 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:13:53.322941 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.323165 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.323436 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.323580 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m22:13:53.324291 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m22:13:53.324630 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.324866 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.325047 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.325288 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:13:53.325877 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m22:13:53.326471 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m22:13:53.327046 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m22:13:53.327271 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:13:53.327568 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m22:13:53.327800 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m22:13:53.327997 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m22:13:53.328158 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m22:13:53.328512 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m22:13:53.329186 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m22:13:53.329544 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m22:13:53.329808 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m22:13:53.330100 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:13:53.330397 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:13:53.330665 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:13:53.330857 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:13:53.331107 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:13:53.331384 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:13:53.331674 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:13:53.333526 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:13:53.333757 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m22:13:53.334020 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m22:13:53.334285 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m22:13:53.334700 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m22:13:53.334990 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:13:53.335146 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m22:13:53.335403 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m22:13:53.335643 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:13:53.336739 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:13:53.336957 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:13:53.337153 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:13:53.338848 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:13:53.340587 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:13:53.342978 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:13:53.343177 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:13:53.343671 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:13:53.343943 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:13:53.344074 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m22:13:53.345069 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:13:53.345279 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:13:53.346980 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:13:53.347204 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:53.348229 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:13:53.348479 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:13:53.348774 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:13:53.349092 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m22:13:53.349334 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m22:13:53.349540 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:13:53.349770 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:13:53.350063 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:13:53.350271 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m22:13:53.350826 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:13:53.352675 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.353061 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:13:53.353788 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.354095 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.354426 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:13:53.354621 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m22:13:53.354782 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:13:53.354960 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.355157 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.355402 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:13:53.355621 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:13:53.356311 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m22:13:53.356606 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:13:53.356836 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:13:53.357160 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m22:13:53.357342 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.357745 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m22:13:53.357940 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:13:53.358493 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m22:13:53.358653 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.358915 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:13:53.359464 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m22:13:53.359715 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m22:13:53.360225 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m22:13:53.360460 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:13:53.360717 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m22:13:53.360951 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m22:13:53.361214 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m22:13:53.361417 [info ] [Thread-2 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m22:13:53.361729 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m22:13:53.361976 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:13:53.362287 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m22:13:53.362511 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m22:13:53.362767 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:13:53.363112 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:13:53.363399 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:13:53.365403 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:13:53.365930 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:13:53.366978 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:13:53.367404 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:13:53.367595 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m22:13:53.367767 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:13:53.370312 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m22:13:53.370520 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:13:53.370700 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:13:53.371892 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:13:53.372455 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m22:13:53.372703 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m22:13:53.372961 [info ] [Thread-2 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m22:13:53.373210 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:13:53.373952 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.374153 [debug] [MainThread]: On master: BEGIN
[0m22:13:53.374328 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:13:53.376942 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:13:53.377305 [debug] [MainThread]: On master: COMMIT
[0m22:13:53.377570 [debug] [MainThread]: Using postgres connection "master"
[0m22:13:53.377766 [debug] [MainThread]: On master: COMMIT
[0m22:13:53.377995 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:13:53.378203 [debug] [MainThread]: On master: Close
[0m22:13:53.378426 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:13:53.378635 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m22:13:53.378778 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m22:13:53.378926 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m22:13:53.379099 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m22:13:53.379327 [info ] [MainThread]: 
[0m22:13:53.379544 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m22:13:53.380255 [debug] [MainThread]: Command end result
[0m22:13:53.392205 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:13:53.392951 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:13:53.395726 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:13:53.395885 [info ] [MainThread]: 
[0m22:13:53.396078 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:13:53.396272 [info ] [MainThread]: 
[0m22:13:53.396446 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m22:13:53.397018 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.45382276, "process_in_blocks": "0", "process_kernel_time": 0.100069, "process_mem_max_rss": "129704", "process_out_blocks": "2159", "process_user_time": 1.009697}
[0m22:13:53.397358 [debug] [MainThread]: Command `dbt test` succeeded at 22:13:53.397289 after 0.45 seconds
[0m22:13:53.397569 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9c51b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9763fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9760e50>]}
[0m22:13:53.397798 [debug] [MainThread]: Flushing usage events
[0m22:13:53.756223 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:43.137337 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb558f610>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb20e7b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb2081ed0>]}


============================== 22:14:43.140090 | c364de58-7640-4e07-b2f4-9fd575ae1013 ==============================
[0m22:14:43.140090 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:14:43.140537 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/opt/bluealpha/dbt_project', 'send_anonymous_usage_stats': 'True', 'quiet': 'False', 'target_path': 'None', 'printer_width': '80', 'use_experimental_parser': 'False', 'version_check': 'True', 'partial_parse': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'fail_fast': 'False', 'invocation_command': 'dbt run --full-refresh', 'no_print': 'None', 'empty': 'False', 'introspect': 'True', 'log_format': 'default', 'use_colors': 'True', 'cache_selected_only': 'False', 'log_cache_events': 'False', 'indirect_selection': 'eager', 'write_json': 'True', 'debug': 'False', 'warn_error': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])'}
[0m22:14:43.199437 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb15ee810>]}
[0m22:14:43.218658 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4b36450>]}
[0m22:14:43.219061 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:14:43.242623 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:14:43.284319 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:14:43.284581 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:14:43.284758 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:14:43.300598 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb12e2910>]}
[0m22:14:43.333344 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:14:43.334128 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:14:43.341659 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb115b1d0>]}
[0m22:14:43.341953 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:14:43.342188 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb138f6d0>]}
[0m22:14:43.343096 [info ] [MainThread]: 
[0m22:14:43.343352 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:14:43.343575 [info ] [MainThread]: 
[0m22:14:43.343862 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:14:43.345510 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:14:43.345777 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:14:43.350020 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:14:43.381249 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:14:43.381443 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:14:43.381631 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:14:43.381853 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:14:43.382074 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:14:43.382270 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:14:43.382485 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:43.382686 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:43.382857 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:43.387995 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.005 seconds
[0m22:14:43.388178 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.006 seconds
[0m22:14:43.388324 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.006 seconds
[0m22:14:43.388885 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:14:43.389425 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:14:43.389944 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:14:43.391674 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m22:14:43.391945 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m22:14:43.394171 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:14:43.394338 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m22:14:43.395203 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:14:43.396388 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:14:43.396179 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:14:43.395392 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:14:43.396569 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:14:43.396780 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:14:43.396958 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:14:43.397337 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:14:43.400976 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.401169 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.401339 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.401534 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:14:43.401755 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:14:43.401976 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:14:43.402227 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:14:43.402485 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:14:43.402716 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:14:43.405049 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m22:14:43.405203 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m22:14:43.405359 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m22:14:43.405859 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:14:43.406352 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:14:43.406849 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:14:43.407116 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:14:43.407321 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:14:43.407516 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:14:43.410742 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.410932 [debug] [MainThread]: On master: BEGIN
[0m22:14:43.411093 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:14:43.413787 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:14:43.414027 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.414352 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:14:43.423489 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m22:14:43.423971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb44db6d0>]}
[0m22:14:43.424226 [debug] [MainThread]: On master: ROLLBACK
[0m22:14:43.424461 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.424623 [debug] [MainThread]: On master: BEGIN
[0m22:14:43.424909 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:14:43.425243 [debug] [MainThread]: On master: COMMIT
[0m22:14:43.425417 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.425580 [debug] [MainThread]: On master: COMMIT
[0m22:14:43.425791 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:43.425960 [debug] [MainThread]: On master: Close
[0m22:14:43.428087 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:14:43.428264 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:14:43.428434 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:14:43.428702 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m22:14:43.429032 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m22:14:43.429377 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m22:14:43.429674 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m22:14:43.429926 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m22:14:43.430180 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m22:14:43.430413 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:14:43.430675 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:14:43.430897 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m22:14:43.433644 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.434749 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.435796 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.436380 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:14:43.442149 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:14:43.449295 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.450733 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.450924 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m22:14:43.452502 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.452696 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.452934 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.453206 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m22:14:43.453426 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m22:14:43.453645 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.453798 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:43.453996 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:43.454204 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m22:14:43.454912 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:43.458108 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.458287 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.458450 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.458647 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.458857 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.459067 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.459289 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m22:14:43.459571 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m22:14:43.459848 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m22:14:43.463719 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m22:14:43.463896 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m22:14:43.464067 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.004 seconds
[0m22:14:43.466460 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.467688 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.468829 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.469064 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m22:14:43.469287 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m22:14:43.469474 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m22:14:43.469894 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.470053 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.471165 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.471343 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:43.472421 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.472648 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m22:14:43.473662 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.473883 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m22:14:43.474222 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m22:14:43.474402 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.480571 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:14:43.480745 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m22:14:43.480887 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.006 seconds
[0m22:14:43.481086 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.481668 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:14:43.482231 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:14:43.482446 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:14:43.482668 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.482886 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.483220 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:14:43.483521 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:14:43.483682 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m22:14:43.486200 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m22:14:43.486368 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:14:43.486515 [debug] [Thread-1 (]: SQL status: COMMIT in 0.003 seconds
[0m22:14:43.488297 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:14:43.489242 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m22:14:43.490176 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m22:14:43.490400 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m22:14:43.490752 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:14:43.491097 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:14:43.491385 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m22:14:43.491573 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m22:14:43.491826 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:14:43.492922 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m22:14:43.493099 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:14:43.493255 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:14:43.494325 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m22:14:43.494534 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0560e10>]}
[0m22:14:43.495051 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m22:14:43.495354 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb04a3810>]}
[0m22:14:43.495678 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m22:14:43.496111 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb11fe550>]}
[0m22:14:43.496394 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m22:14:43.496731 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:14:43.497054 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m22:14:43.497452 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:14:43.497941 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:14:43.498347 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m22:14:43.498636 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m22:14:43.498883 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m22:14:43.499201 [info ] [Thread-2 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m22:14:43.499524 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m22:14:43.499758 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m22:14:43.499959 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m22:14:43.500169 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m22:14:43.503481 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.504796 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.505411 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m22:14:43.505565 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m22:14:43.518401 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.519861 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.520479 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.520695 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m22:14:43.520894 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:14:43.521084 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.521437 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m22:14:43.521698 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:43.524829 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:43.524997 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m22:14:43.525214 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.525438 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.525652 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


  );
  
  
[0m22:14:43.525888 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

  );
  
  
[0m22:14:43.529987 [debug] [Thread-2 (]: SQL status: SELECT 79 in 0.004 seconds
[0m22:14:43.530203 [debug] [Thread-4 (]: SQL status: SELECT 90 in 0.004 seconds
[0m22:14:43.533584 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.534772 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.534986 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders" rename to "int_crm_orders__dbt_backup"
[0m22:14:43.535171 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily" rename to "int_campaign_daily__dbt_backup"
[0m22:14:43.535528 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.536683 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.536842 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m22:14:43.537022 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
alter table "warehouse"."staging_intermediate"."int_crm_orders__dbt_tmp" rename to "int_crm_orders"
[0m22:14:43.538019 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.538319 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.538464 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
alter table "warehouse"."staging_intermediate"."int_campaign_daily__dbt_tmp" rename to "int_campaign_daily"
[0m22:14:43.539085 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:14:43.539379 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.539532 [debug] [Thread-4 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.539710 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:14:43.540329 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:14:43.540690 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.540999 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:14:43.541139 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m22:14:43.542110 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup"
[0m22:14:43.542267 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m22:14:43.543347 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:14:43.544273 [debug] [Thread-4 (]: Applying DROP to: "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup"
[0m22:14:43.544486 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */
drop table if exists "warehouse"."staging_intermediate"."int_crm_orders__dbt_backup" cascade
[0m22:14:43.544801 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:14:43.545087 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */
drop table if exists "warehouse"."staging_intermediate"."int_campaign_daily__dbt_backup" cascade
[0m22:14:43.546951 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m22:14:43.547247 [debug] [Thread-4 (]: SQL status: DROP TABLE in 0.002 seconds
[0m22:14:43.547877 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m22:14:43.548614 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m22:14:43.548959 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0480210>]}
[0m22:14:43.549263 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb04920d0>]}
[0m22:14:43.549581 [info ] [Thread-2 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.05s]
[0m22:14:43.550040 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 90[0m in 0.05s]
[0m22:14:43.550535 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m22:14:43.550892 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m22:14:43.551532 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m22:14:43.551786 [info ] [Thread-3 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m22:14:43.552043 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_google_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m22:14:43.552266 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m22:14:43.553656 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.554124 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m22:14:43.558561 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.558942 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.559109 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m22:14:43.559271 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:43.562461 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m22:14:43.562782 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.562968 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m22:14:43.566431 [debug] [Thread-3 (]: SQL status: SELECT 90 in 0.003 seconds
[0m22:14:43.567643 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.567797 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m22:14:43.568080 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.569105 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.569269 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m22:14:43.569536 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:14:43.570074 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:14:43.570243 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.570377 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:14:43.570952 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m22:14:43.572305 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m22:14:43.574057 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:14:43.574225 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m22:14:43.575812 [debug] [Thread-3 (]: SQL status: DROP TABLE in 0.001 seconds
[0m22:14:43.576355 [debug] [Thread-3 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m22:14:43.576686 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': 'c364de58-7640-4e07-b2f4-9fd575ae1013', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0474490>]}
[0m22:14:43.576980 [info ] [Thread-3 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.02s]
[0m22:14:43.577522 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m22:14:43.578247 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.578423 [debug] [MainThread]: On master: BEGIN
[0m22:14:43.578574 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:14:43.581379 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:14:43.581581 [debug] [MainThread]: On master: COMMIT
[0m22:14:43.581759 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:43.581898 [debug] [MainThread]: On master: COMMIT
[0m22:14:43.582085 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:43.582242 [debug] [MainThread]: On master: Close
[0m22:14:43.582443 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:14:43.582589 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m22:14:43.582715 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m22:14:43.582866 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_crm_orders_daily' was properly closed.
[0m22:14:43.583017 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m22:14:43.583208 [info ] [MainThread]: 
[0m22:14:43.583448 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.24 seconds (0.24s).
[0m22:14:43.583975 [debug] [MainThread]: Command end result
[0m22:14:43.595391 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:14:43.596293 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:14:43.598716 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:14:43.598995 [info ] [MainThread]: 
[0m22:14:43.599234 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:14:43.599462 [info ] [MainThread]: 
[0m22:14:43.599682 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m22:14:43.600201 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.4848064, "process_in_blocks": "0", "process_kernel_time": 0.079241, "process_mem_max_rss": "130752", "process_out_blocks": "2178", "process_user_time": 1.05622}
[0m22:14:43.600427 [debug] [MainThread]: Command `dbt run` succeeded at 22:14:43.600390 after 0.49 seconds
[0m22:14:43.600608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb20c4450>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb20c5890>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6f20510>]}
[0m22:14:43.600778 [debug] [MainThread]: Flushing usage events
[0m22:14:44.354191 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:14:48.546602 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aef38d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aef3350>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8aef15d0>]}


============================== 22:14:48.549350 | 71c0a5de-47e6-4b3d-ad36-7ffbb4709224 ==============================
[0m22:14:48.549350 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:14:48.549772 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'quiet': 'False', 'cache_selected_only': 'False', 'use_colors': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'partial_parse': 'True', 'log_cache_events': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'fail_fast': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'debug': 'False', 'target_path': 'None', 'printer_width': '80', 'write_json': 'True', 'invocation_command': 'dbt test', 'profiles_dir': '/opt/bluealpha/dbt_project', 'use_experimental_parser': 'False', 'log_format': 'default', 'version_check': 'True', 'empty': 'None', 'indirect_selection': 'eager', 'no_print': 'None', 'introspect': 'True'}
[0m22:14:48.608950 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8af53410>]}
[0m22:14:48.628100 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8d926f90>]}
[0m22:14:48.628434 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:14:48.652249 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:14:48.695070 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:14:48.695349 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:14:48.695524 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:14:48.711627 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a151450>]}
[0m22:14:48.744389 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:14:48.745177 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:14:48.756775 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89eb45d0>]}
[0m22:14:48.757065 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:14:48.757340 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a11a890>]}
[0m22:14:48.758396 [info ] [MainThread]: 
[0m22:14:48.758715 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:14:48.758939 [info ] [MainThread]: 
[0m22:14:48.759274 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:14:48.760896 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m22:14:48.761177 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m22:14:48.788092 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m22:14:48.797501 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:14:48.797664 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:14:48.797804 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:14:48.798017 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:14:48.798273 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:14:48.798451 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:14:48.798663 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:48.798865 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:48.799060 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:14:48.804227 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:14:48.804444 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:14:48.804599 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:14:48.804801 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:14:48.805080 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:14:48.805483 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:14:48.805723 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:14:48.805961 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:14:48.806196 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:14:48.808696 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m22:14:48.808839 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m22:14:48.808988 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m22:14:48.809581 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:14:48.810128 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:14:48.810632 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:14:48.810915 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:14:48.811127 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:14:48.811358 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:14:48.814502 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.814712 [debug] [MainThread]: On master: BEGIN
[0m22:14:48.814863 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:14:48.817972 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:14:48.818303 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.818530 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:14:48.827927 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m22:14:48.828436 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '71c0a5de-47e6-4b3d-ad36-7ffbb4709224', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff89fa5f10>]}
[0m22:14:48.828683 [debug] [MainThread]: On master: ROLLBACK
[0m22:14:48.828921 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.829073 [debug] [MainThread]: On master: BEGIN
[0m22:14:48.829341 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:14:48.829583 [debug] [MainThread]: On master: COMMIT
[0m22:14:48.829741 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.829880 [debug] [MainThread]: On master: COMMIT
[0m22:14:48.830086 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:48.830447 [debug] [MainThread]: On master: Close
[0m22:14:48.832536 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:14:48.832717 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:14:48.832936 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:14:48.833135 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:14:48.833314 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m22:14:48.833662 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m22:14:48.833950 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m22:14:48.834323 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m22:14:48.834644 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m22:14:48.834888 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m22:14:48.835152 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m22:14:48.835416 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m22:14:48.835639 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:14:48.835859 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:14:48.836074 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:14:48.836306 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:14:48.843227 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:14:48.846580 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:14:48.848211 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:14:48.849679 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:14:48.850439 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:14:48.850619 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:14:48.856274 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:14:48.857034 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:14:48.858040 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:14:48.858176 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:14:48.859092 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:14:48.859627 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:14:48.860543 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:14:48.860771 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:14:48.861061 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m22:14:48.861321 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:14:48.861684 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m22:14:48.861938 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:14:48.862086 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:48.862354 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m22:14:48.862634 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:48.862856 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m22:14:48.863208 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:48.863590 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:14:48.867150 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.867397 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.867596 [debug] [Thread-2 (]: SQL status: BEGIN in 0.006 seconds
[0m22:14:48.867774 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m22:14:48.867928 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:14:48.868151 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:14:48.868405 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:14:48.868623 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:14:48.868817 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.869054 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.869267 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.869480 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m22:14:48.870213 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.870373 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.870524 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.872373 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m22:14:48.872624 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m22:14:48.873254 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m22:14:48.873814 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m22:14:48.874088 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m22:14:48.874620 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m22:14:48.874904 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m22:14:48.875106 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m22:14:48.875386 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m22:14:48.875753 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m22:14:48.876070 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m22:14:48.876526 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m22:14:48.876891 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:14:48.877279 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m22:14:48.877592 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:14:48.877858 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:14:48.878100 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:14:48.878420 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:14:48.878650 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:14:48.878932 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:14:48.879178 [info ] [Thread-4 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m22:14:48.879518 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:14:48.879770 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m22:14:48.880079 [info ] [Thread-2 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m22:14:48.880372 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m22:14:48.880606 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m22:14:48.880935 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m22:14:48.881208 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m22:14:48.881429 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:14:48.881660 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m22:14:48.881874 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:14:48.882112 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:14:48.883741 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:14:48.883974 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:14:48.885421 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:14:48.886931 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:14:48.889309 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:14:48.889560 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:14:48.890166 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:14:48.891103 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:14:48.891239 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:14:48.891486 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:14:48.892308 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:14:48.893382 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:14:48.893609 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:14:48.894466 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:14:48.894934 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m22:14:48.895099 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:14:48.895312 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:14:48.895591 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:14:48.895784 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m22:14:48.895937 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:14:48.896126 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m22:14:48.896390 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:48.896722 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m22:14:48.896916 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:48.897288 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:48.900861 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.901127 [debug] [Thread-4 (]: SQL status: BEGIN in 0.006 seconds
[0m22:14:48.901319 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.901580 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:14:48.901750 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m22:14:48.901938 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:14:48.902150 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:14:48.902350 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.902564 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:14:48.902762 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.902966 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.903227 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.903783 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:14:48.904519 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m22:14:48.904690 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.904836 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.904993 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:14:48.905253 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m22:14:48.905800 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m22:14:48.906375 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m22:14:48.906919 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m22:14:48.907258 [info ] [Thread-4 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m22:14:48.907593 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m22:14:48.907841 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m22:14:48.908110 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m22:14:48.908316 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:14:48.908635 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m22:14:48.909004 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m22:14:48.909411 [info ] [Thread-2 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m22:14:48.909681 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:14:48.910022 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:14:48.910314 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:14:48.910560 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:14:48.910784 [info ] [Thread-4 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m22:14:48.911135 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:14:48.911406 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:14:48.911641 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:14:48.911879 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m22:14:48.912113 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m22:14:48.912412 [info ] [Thread-1 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m22:14:48.912705 [info ] [Thread-2 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m22:14:48.912986 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:14:48.913234 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m22:14:48.913467 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m22:14:48.913697 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m22:14:48.915512 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:14:48.915739 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:14:48.915959 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:14:48.916169 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:14:48.917889 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:14:48.919451 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:14:48.919620 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:14:48.921682 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:14:48.922187 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:14:48.923103 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:14:48.923313 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:14:48.924405 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:14:48.924645 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:14:48.926296 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:14:48.926595 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:14:48.927439 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:14:48.927661 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:14:48.927940 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m22:14:48.928317 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:14:48.928629 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m22:14:48.928871 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:14:48.929023 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:14:48.929238 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m22:14:48.929425 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:14:48.929597 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m22:14:48.930265 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:14:48.929869 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:14:48.933532 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m22:14:48.934227 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.934017 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m22:14:48.933792 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:14:48.934389 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:14:48.934595 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:14:48.934797 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:14:48.935028 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:14:48.935225 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:14:48.935440 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.935660 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.935889 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:14:48.936690 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.936938 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.937547 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m22:14:48.937722 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:14:48.937871 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:14:48.938421 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m22:14:48.938707 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m22:14:48.939222 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m22:14:48.939763 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m22:14:48.940057 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m22:14:48.940328 [info ] [Thread-2 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m22:14:48.940646 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m22:14:48.940844 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m22:14:48.941081 [info ] [Thread-4 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m22:14:48.942438 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:14:48.941730 [info ] [Thread-1 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m22:14:48.942107 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m22:14:48.941434 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:14:48.942651 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:14:48.942917 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:14:48.943178 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:14:48.943484 [info ] [Thread-4 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m22:14:48.943967 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m22:14:48.944186 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:14:48.945951 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:14:48.946500 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:14:48.947424 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:14:48.947820 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:14:48.947996 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m22:14:48.948161 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:14:48.950993 [debug] [Thread-4 (]: SQL status: BEGIN in 0.003 seconds
[0m22:14:48.951210 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:14:48.951412 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:14:48.952662 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:14:48.953179 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m22:14:48.953401 [debug] [Thread-4 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m22:14:48.953686 [info ] [Thread-4 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m22:14:48.953988 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:14:48.954727 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.954918 [debug] [MainThread]: On master: BEGIN
[0m22:14:48.955058 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:14:48.957525 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m22:14:48.957822 [debug] [MainThread]: On master: COMMIT
[0m22:14:48.958204 [debug] [MainThread]: Using postgres connection "master"
[0m22:14:48.958366 [debug] [MainThread]: On master: COMMIT
[0m22:14:48.958546 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:14:48.958720 [debug] [MainThread]: On master: Close
[0m22:14:48.958943 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:14:48.959092 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m22:14:48.959237 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m22:14:48.959378 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m22:14:48.959514 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m22:14:48.959697 [info ] [MainThread]: 
[0m22:14:48.959892 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m22:14:48.960672 [debug] [MainThread]: Command end result
[0m22:14:48.973258 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:14:48.974065 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:14:48.976982 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:14:48.977161 [info ] [MainThread]: 
[0m22:14:48.977392 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:14:48.977604 [info ] [MainThread]: 
[0m22:14:48.977821 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m22:14:48.978349 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.45009795, "process_in_blocks": "0", "process_kernel_time": 0.098112, "process_mem_max_rss": "129892", "process_out_blocks": "2159", "process_user_time": 1.033185}
[0m22:14:48.978573 [debug] [MainThread]: Command `dbt test` succeeded at 22:14:48.978538 after 0.45 seconds
[0m22:14:48.978746 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8af2d0d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8af2d4d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8fe2b5d0>]}
[0m22:14:48.978914 [debug] [MainThread]: Flushing usage events
[0m22:14:49.349048 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:16:11.516287 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0ab1c50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0ab1dd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0ab0d50>]}


============================== 22:16:11.520499 | 7dc16bc9-7179-4e78-ac75-b98a778958fd ==============================
[0m22:16:11.520499 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:16:11.521107 [debug] [MainThread]: running dbt with arguments {'target_path': 'None', 'debug': 'False', 'fail_fast': 'False', 'indirect_selection': 'eager', 'invocation_command': 'dbt run', 'empty': 'False', 'introspect': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'printer_width': '80', 'quiet': 'False', 'use_colors': 'True', 'log_cache_events': 'False', 'version_check': 'True', 'use_experimental_parser': 'False', 'send_anonymous_usage_stats': 'True', 'write_json': 'True', 'log_format': 'default', 'warn_error': 'None', 'profiles_dir': '/opt/bluealpha/dbt_project', 'partial_parse': 'True', 'log_path': '/opt/bluealpha/dbt_project/logs', 'static_parser': 'True', 'no_print': 'None'}
[0m22:16:11.599497 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0021310>]}
[0m22:16:11.621556 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb3591190>]}
[0m22:16:11.622096 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:16:11.648400 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:16:11.692577 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:16:11.692851 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:16:11.693048 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:16:11.709088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb13d2290>]}
[0m22:16:11.742221 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:16:11.743107 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:16:11.751564 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafb68690>]}
[0m22:16:11.751881 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:16:11.752115 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb0b13050>]}
[0m22:16:11.753016 [info ] [MainThread]: 
[0m22:16:11.753222 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:16:11.753404 [info ] [MainThread]: 
[0m22:16:11.753678 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:16:11.755466 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:16:11.755777 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:16:11.760177 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m22:16:11.797165 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:16:11.797385 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:16:11.797619 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m22:16:11.797888 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:16:11.798426 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:16:11.798693 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m22:16:11.798924 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:11.799155 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:11.799380 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:11.807139 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.008 seconds
[0m22:16:11.807375 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.008 seconds
[0m22:16:11.807547 [debug] [ThreadPool]: SQL status: SELECT 26 in 0.008 seconds
[0m22:16:11.808180 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:16:11.808790 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:16:11.809447 [debug] [ThreadPool]: On list_warehouse: Close
[0m22:16:11.810969 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m22:16:11.811274 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m22:16:11.811553 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m22:16:11.814453 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:16:11.815591 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:16:11.816470 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:16:11.816710 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:16:11.816960 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:16:11.817223 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:16:11.817469 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:16:11.817711 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:16:11.817952 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m22:16:11.822838 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:16:11.823115 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:16:11.823541 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:16:11.823764 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:16:11.824045 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:16:11.824311 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:16:11.824560 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:16:11.824782 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:16:11.825278 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:16:11.827908 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m22:16:11.828104 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m22:16:11.828325 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m22:16:11.828884 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:16:11.829430 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:16:11.829972 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:16:11.830374 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:16:11.830648 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:16:11.830917 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:16:11.834321 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:11.834585 [debug] [MainThread]: On master: BEGIN
[0m22:16:11.834772 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:16:11.838356 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m22:16:11.838719 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:11.839044 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:16:11.849281 [debug] [MainThread]: SQL status: SELECT 3 in 0.010 seconds
[0m22:16:11.849979 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffaf9d0690>]}
[0m22:16:11.850274 [debug] [MainThread]: On master: ROLLBACK
[0m22:16:11.850590 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:11.850762 [debug] [MainThread]: On master: BEGIN
[0m22:16:11.851073 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:16:11.851338 [debug] [MainThread]: On master: COMMIT
[0m22:16:11.851598 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:11.851793 [debug] [MainThread]: On master: COMMIT
[0m22:16:11.852065 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:16:11.852263 [debug] [MainThread]: On master: Close
[0m22:16:11.854405 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:16:11.854593 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:16:11.854759 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:16:11.855066 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m22:16:11.855453 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m22:16:11.855766 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m22:16:11.856081 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m22:16:11.856385 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m22:16:11.856649 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m22:16:11.856912 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:16:11.857220 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:16:11.857507 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m22:16:11.860908 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.862365 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.863598 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.864927 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:16:11.882229 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.882527 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:16:11.882744 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m22:16:11.884631 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.884999 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.887364 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.888596 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.888178 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m22:16:11.889374 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m22:16:11.889771 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:16:11.890132 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.891184 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m22:16:11.890399 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:16:11.891990 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:16:11.896162 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m22:16:11.896793 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.897741 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m22:16:11.898157 [debug] [Thread-3 (]: SQL status: BEGIN in 0.006 seconds
[0m22:16:11.898670 [debug] [Thread-2 (]: SQL status: BEGIN in 0.008 seconds
[0m22:16:11.899021 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.899622 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.900248 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m22:16:11.900800 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)

select 
    'facebook'::text as platform,
    *
from validate
  );
[0m22:16:11.903338 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.005 seconds
[0m22:16:11.906988 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.907259 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m22:16:11.907497 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m22:16:11.907779 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m22:16:11.909356 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.910977 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.911414 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m22:16:11.911675 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:11.911845 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m22:16:11.913638 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.913869 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:16:11.914314 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m22:16:11.914611 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:11.916738 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.918508 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.918715 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.002 seconds
[0m22:16:11.918996 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m22:16:11.919339 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m22:16:11.925703 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:16:11.926208 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.926403 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:11.926599 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:11.926766 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m22:16:11.927504 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:16:11.928162 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:16:11.928537 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.929213 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.929372 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m22:16:11.929605 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m22:16:11.929842 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m22:16:11.933192 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m22:16:11.935641 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m22:16:11.935832 [debug] [Thread-3 (]: SQL status: COMMIT in 0.002 seconds
[0m22:16:11.936006 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m22:16:11.936220 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m22:16:11.937312 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m22:16:11.938359 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m22:16:11.938888 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m22:16:11.939412 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m22:16:11.939742 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m22:16:11.939935 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:16:11.940129 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m22:16:11.941343 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m22:16:11.941505 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:16:11.942865 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m22:16:11.943023 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m22:16:11.943308 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac599510>]}
[0m22:16:11.943594 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac5a1510>]}
[0m22:16:11.944169 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m22:16:11.944513 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.09s]
[0m22:16:11.944862 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.09s]
[0m22:16:11.945207 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffadecdb10>]}
[0m22:16:11.945463 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m22:16:11.945743 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m22:16:11.946057 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.09s]
[0m22:16:11.946489 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m22:16:11.946840 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m22:16:11.947122 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m22:16:11.947574 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m22:16:11.947842 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m22:16:11.948086 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m22:16:11.948350 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m22:16:11.948567 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m22:16:11.952020 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m22:16:11.952252 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m22:16:11.953935 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:11.954359 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m22:16:11.960417 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m22:16:11.969954 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:11.971486 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:11.971809 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp221611963864"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m22:16:11.972232 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp221611970911"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m22:16:11.972581 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:16:11.972894 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:16:11.983597 [debug] [Thread-1 (]: SQL status: SELECT 90 in 0.011 seconds
[0m22:16:11.983932 [debug] [Thread-4 (]: SQL status: SELECT 79 in 0.011 seconds
[0m22:16:11.989090 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:11.991185 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:11.991492 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m22:16:11.991799 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m22:16:11.992283 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m22:16:11.992498 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m22:16:11.992781 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:11.993103 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:11.993453 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp221611970911'
        
      order by ordinal_position

  
[0m22:16:11.993751 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp221611963864'
        
      order by ordinal_position

  
[0m22:16:11.999308 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.005 seconds
[0m22:16:11.999512 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.006 seconds
[0m22:16:12.001742 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:12.003480 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:12.003775 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:16:12.004084 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:16:12.005440 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m22:16:12.005608 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m22:16:12.009014 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:12.010860 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:12.011193 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:16:12.011456 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m22:16:12.012683 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m22:16:12.012878 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m22:16:12.019191 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m22:16:12.020510 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:12.021597 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:12.021911 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:12.022100 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp221611963864" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp221611963864"
    )
  
[0m22:16:12.022394 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp221611970911" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp221611970911"
    )
  
[0m22:16:12.025117 [debug] [Thread-4 (]: SQL status: INSERT 0 79 in 0.002 seconds
[0m22:16:12.025319 [debug] [Thread-1 (]: SQL status: INSERT 0 90 in 0.002 seconds
[0m22:16:12.026166 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:16:12.026917 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:16:12.027311 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m22:16:12.027589 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m22:16:12.027811 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m22:16:12.028095 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m22:16:12.029183 [debug] [Thread-4 (]: SQL status: COMMIT in 0.001 seconds
[0m22:16:12.029359 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m22:16:12.029793 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m22:16:12.030182 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m22:16:12.030676 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafb6b750>]}
[0m22:16:12.031120 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffafd280d0>]}
[0m22:16:12.031891 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 79[0m in 0.08s]
[0m22:16:12.032379 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 90[0m in 0.08s]
[0m22:16:12.032788 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m22:16:12.033522 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m22:16:12.034545 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m22:16:12.034928 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m22:16:12.035326 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m22:16:12.035590 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m22:16:12.037271 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.037807 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m22:16:12.042488 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.043182 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.043453 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m22:16:12.043645 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:16:12.047308 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:12.047597 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.047926 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m22:16:12.052667 [debug] [Thread-2 (]: SQL status: SELECT 90 in 0.004 seconds
[0m22:16:12.055987 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.056287 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m22:16:12.056717 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:12.057973 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.058172 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m22:16:12.058463 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m22:16:12.059091 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:16:12.059277 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.059474 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m22:16:12.060038 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m22:16:12.062233 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m22:16:12.063575 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m22:16:12.063848 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m22:16:12.066492 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m22:16:12.067307 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m22:16:12.067662 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '7dc16bc9-7179-4e78-ac75-b98a778958fd', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffac638050>]}
[0m22:16:12.067999 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.03s]
[0m22:16:12.068318 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m22:16:12.069260 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:12.069933 [debug] [MainThread]: On master: BEGIN
[0m22:16:12.070251 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:16:12.073660 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:16:12.073962 [debug] [MainThread]: On master: COMMIT
[0m22:16:12.074239 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:12.074415 [debug] [MainThread]: On master: COMMIT
[0m22:16:12.074614 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:16:12.074926 [debug] [MainThread]: On master: Close
[0m22:16:12.075246 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:16:12.075480 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m22:16:12.075686 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m22:16:12.075886 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m22:16:12.076071 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m22:16:12.076346 [info ] [MainThread]: 
[0m22:16:12.076566 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.32 seconds (0.32s).
[0m22:16:12.077185 [debug] [MainThread]: Command end result
[0m22:16:12.090770 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:16:12.091945 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:16:12.095144 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:16:12.095355 [info ] [MainThread]: 
[0m22:16:12.095622 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:16:12.095822 [info ] [MainThread]: 
[0m22:16:12.096010 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m22:16:12.096542 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.60295606, "process_in_blocks": "0", "process_kernel_time": 0.140914, "process_mem_max_rss": "130528", "process_out_blocks": "2184", "process_user_time": 1.218909}
[0m22:16:12.096783 [debug] [MainThread]: Command `dbt run` succeeded at 22:16:12.096746 after 0.60 seconds
[0m22:16:12.097022 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5a35fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb57ac810>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb5790490>]}
[0m22:16:12.097283 [debug] [MainThread]: Flushing usage events
[0m22:16:12.565173 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:16:14.465159 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97472690>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97461410>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97461310>]}


============================== 22:16:14.467864 | 974f070e-fce8-4cc5-aec8-951dfe45bebb ==============================
[0m22:16:14.467864 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:16:14.468187 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'partial_parse': 'True', 'debug': 'False', 'no_print': 'None', 'invocation_command': 'dbt test', 'introspect': 'True', 'write_json': 'True', 'log_cache_events': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'static_parser': 'True', 'quiet': 'False', 'fail_fast': 'False', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'target_path': 'None', 'cache_selected_only': 'False', 'printer_width': '80', 'use_colors': 'True', 'version_check': 'True', 'send_anonymous_usage_stats': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'empty': 'None', 'log_format': 'default', 'profiles_dir': '/opt/bluealpha/dbt_project'}
[0m22:16:14.539272 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96a6e3d0>]}
[0m22:16:14.558989 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff99f517d0>]}
[0m22:16:14.559400 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:16:14.583586 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:16:14.626438 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:16:14.626699 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:16:14.626866 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:16:14.643088 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff965d5790>]}
[0m22:16:14.676500 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:16:14.677365 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:16:14.689313 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96434cd0>]}
[0m22:16:14.689638 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:16:14.689870 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96699590>]}
[0m22:16:14.690907 [info ] [MainThread]: 
[0m22:16:14.691094 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:16:14.691237 [info ] [MainThread]: 
[0m22:16:14.691492 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:16:14.693191 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m22:16:14.693467 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m22:16:14.725350 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m22:16:14.735829 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:16:14.736112 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:16:14.736364 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:16:14.736628 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:16:14.736946 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:16:14.737296 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:16:14.737571 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:14.737806 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:14.738036 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:16:14.743122 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.743358 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:16:14.743539 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m22:16:14.744321 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:16:14.744089 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:16:14.743831 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:16:14.745124 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:16:14.744808 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:16:14.744523 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:16:14.747929 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m22:16:14.748124 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m22:16:14.748312 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m22:16:14.748865 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:16:14.749412 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:16:14.750105 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:16:14.750499 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:16:14.750810 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:16:14.751070 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:16:14.754121 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.754415 [debug] [MainThread]: On master: BEGIN
[0m22:16:14.754649 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:16:14.758317 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.758648 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.758894 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:16:14.768653 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m22:16:14.769420 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '974f070e-fce8-4cc5-aec8-951dfe45bebb', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97f99010>]}
[0m22:16:14.769765 [debug] [MainThread]: On master: ROLLBACK
[0m22:16:14.770123 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.770295 [debug] [MainThread]: On master: BEGIN
[0m22:16:14.770614 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:16:14.770858 [debug] [MainThread]: On master: COMMIT
[0m22:16:14.771115 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.771305 [debug] [MainThread]: On master: COMMIT
[0m22:16:14.771543 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:16:14.771733 [debug] [MainThread]: On master: Close
[0m22:16:14.773840 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:16:14.774037 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:16:14.774304 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:16:14.774500 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:16:14.774671 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m22:16:14.774972 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m22:16:14.775274 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m22:16:14.775583 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m22:16:14.775887 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m22:16:14.776144 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m22:16:14.776393 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m22:16:14.776722 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m22:16:14.776980 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:16:14.777338 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:16:14.777581 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:16:14.777823 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:16:14.784214 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:16:14.788302 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:16:14.789904 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:16:14.791385 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:16:14.792543 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:16:14.792806 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:16:14.799194 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:16:14.799537 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:16:14.799732 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:16:14.800753 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:16:14.802096 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:16:14.803219 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:16:14.803521 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:16:14.804231 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:16:14.804521 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:16:14.804747 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m22:16:14.804970 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m22:16:14.805284 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:16:14.805467 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m22:16:14.805698 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:16:14.805979 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:16:14.806283 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m22:16:14.806503 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:16:14.807042 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:16:14.810879 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.811122 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.811324 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.811517 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m22:16:14.811734 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:16:14.811944 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:16:14.812186 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:16:14.812430 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:16:14.812646 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.812880 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.813111 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.813348 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m22:16:14.814218 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.814406 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.814573 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.816424 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m22:16:14.816617 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m22:16:14.817234 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m22:16:14.817866 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m22:16:14.818169 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m22:16:14.818683 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m22:16:14.818988 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m22:16:14.819251 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m22:16:14.819512 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m22:16:14.819819 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m22:16:14.820088 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m22:16:14.820414 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m22:16:14.820749 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:16:14.821118 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.05s]
[0m22:16:14.821392 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:16:14.821685 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:16:14.821912 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:16:14.822239 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:16:14.822498 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:16:14.822754 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:16:14.823004 [info ] [Thread-3 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m22:16:14.823334 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:16:14.823582 [info ] [Thread-4 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m22:16:14.823845 [info ] [Thread-2 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m22:16:14.824122 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m22:16:14.824373 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m22:16:14.824637 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m22:16:14.824885 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m22:16:14.825086 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:16:14.825327 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m22:16:14.825586 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:16:14.825808 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:16:14.827611 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:16:14.827872 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:16:14.829419 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:16:14.831013 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:16:14.833550 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:16:14.833893 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:16:14.834702 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:16:14.834936 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:16:14.835889 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:16:14.836146 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:16:14.836977 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:16:14.837881 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:16:14.838901 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:16:14.839396 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:16:14.839929 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:16:14.840370 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:16:14.840515 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m22:16:14.840749 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:16:14.840876 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m22:16:14.841069 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m22:16:14.841242 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:16:14.841426 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m22:16:14.841590 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:16:14.841770 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:16:14.842044 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:16:14.846157 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.846416 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.846731 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:16:14.846977 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.847179 [debug] [Thread-4 (]: SQL status: BEGIN in 0.006 seconds
[0m22:16:14.847452 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:16:14.847728 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.847988 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:16:14.848233 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:16:14.848458 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.848754 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.849005 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.849192 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.850175 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m22:16:14.850373 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.850559 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.850715 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.850929 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m22:16:14.851539 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m22:16:14.852248 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m22:16:14.852913 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m22:16:14.853411 [info ] [Thread-3 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m22:16:14.853721 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m22:16:14.853941 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m22:16:14.854185 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m22:16:14.854412 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:16:14.854735 [info ] [Thread-4 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m22:16:14.855038 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m22:16:14.855422 [info ] [Thread-2 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m22:16:14.855716 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:16:14.856158 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:16:14.856513 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:16:14.856835 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:16:14.857086 [info ] [Thread-3 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m22:16:14.857456 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:16:14.857748 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:16:14.858023 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:16:14.858369 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m22:16:14.858618 [info ] [Thread-4 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m22:16:14.858907 [info ] [Thread-1 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m22:16:14.859207 [info ] [Thread-2 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m22:16:14.859499 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:16:14.859834 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m22:16:14.860172 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m22:16:14.860472 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m22:16:14.862533 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:16:14.862849 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:16:14.863130 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:16:14.863401 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:16:14.865357 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:16:14.865886 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:16:14.867883 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:16:14.870537 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:16:14.871808 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:16:14.872238 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:16:14.872811 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:16:14.873108 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:16:14.874139 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:16:14.874409 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:16:14.877950 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:16:14.879305 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:16:14.879799 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m22:16:14.880227 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:16:14.880640 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:16:14.880858 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:16:14.881184 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:16:14.881363 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m22:16:14.881583 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m22:16:14.881989 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m22:16:14.882258 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:16:14.882515 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:16:14.882730 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:16:14.885278 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.885820 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:16:14.886408 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.886772 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.886982 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.887252 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:16:14.887459 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m22:16:14.887672 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.887839 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:16:14.888074 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:16:14.888317 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:16:14.889077 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m22:16:14.889339 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.889689 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:16:14.890009 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m22:16:14.890179 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.890702 [info ] [Thread-3 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m22:16:14.891297 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.891918 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m22:16:14.892095 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:16:14.892393 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:16:14.893057 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m22:16:14.893853 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m22:16:14.894002 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m22:16:14.894252 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:16:14.894537 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m22:16:14.894750 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m22:16:14.895096 [info ] [Thread-2 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m22:16:14.895413 [info ] [Thread-3 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m22:16:14.895842 [info ] [Thread-1 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.04s]
[0m22:16:14.896179 [info ] [Thread-4 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.04s]
[0m22:16:14.896476 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:16:14.896754 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m22:16:14.897114 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:16:14.897446 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:16:14.897846 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:16:14.900036 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:16:14.900598 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:16:14.901726 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:16:14.902459 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:16:14.902682 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m22:16:14.902924 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:16:14.906077 [debug] [Thread-3 (]: SQL status: BEGIN in 0.003 seconds
[0m22:16:14.906348 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:16:14.906559 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:16:14.907929 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:16:14.908546 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m22:16:14.908760 [debug] [Thread-3 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m22:16:14.909024 [info ] [Thread-3 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m22:16:14.909304 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:16:14.910110 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.910313 [debug] [MainThread]: On master: BEGIN
[0m22:16:14.910508 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:16:14.914202 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m22:16:14.914534 [debug] [MainThread]: On master: COMMIT
[0m22:16:14.914752 [debug] [MainThread]: Using postgres connection "master"
[0m22:16:14.914925 [debug] [MainThread]: On master: COMMIT
[0m22:16:14.915185 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:16:14.915388 [debug] [MainThread]: On master: Close
[0m22:16:14.915612 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:16:14.915793 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m22:16:14.915963 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m22:16:14.916142 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m22:16:14.916303 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m22:16:14.916508 [info ] [MainThread]: 
[0m22:16:14.916725 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m22:16:14.917577 [debug] [MainThread]: Command end result
[0m22:16:14.931594 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:16:14.932658 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:16:14.935828 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:16:14.936067 [info ] [MainThread]: 
[0m22:16:14.936296 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:16:14.936474 [info ] [MainThread]: 
[0m22:16:14.936665 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m22:16:14.937181 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.49310046, "process_in_blocks": "0", "process_kernel_time": 0.118399, "process_mem_max_rss": "129696", "process_out_blocks": "2159", "process_user_time": 1.098709}
[0m22:16:14.937424 [debug] [MainThread]: Command `dbt test` succeeded at 22:16:14.937387 after 0.49 seconds
[0m22:16:14.937620 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9c3f5fd0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97460b50>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97460cd0>]}
[0m22:16:14.937841 [debug] [MainThread]: Flushing usage events
[0m22:16:15.284824 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m22:40:14.057328 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be2e850>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be20b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be21310>]}


============================== 22:40:14.060509 | bb9135b7-e081-4337-9e4d-73aa8c42a1b1 ==============================
[0m22:40:14.060509 [info ] [MainThread]: Running with dbt=1.11.4
[0m22:40:14.060868 [debug] [MainThread]: running dbt with arguments {'log_path': '/opt/bluealpha/dbt_project/logs', 'static_parser': 'True', 'quiet': 'False', 'invocation_command': 'dbt test', 'printer_width': '80', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'log_format': 'default', 'send_anonymous_usage_stats': 'True', 'use_colors': 'True', 'use_experimental_parser': 'False', 'indirect_selection': 'eager', 'partial_parse': 'True', 'write_json': 'True', 'debug': 'False', 'fail_fast': 'False', 'cache_selected_only': 'False', 'warn_error': 'None', 'empty': 'None', 'log_cache_events': 'False', 'introspect': 'True', 'target_path': 'None', 'no_print': 'None', 'profiles_dir': '/opt/bluealpha/dbt_project', 'version_check': 'True'}
[0m22:40:14.128626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7be8e010>]}
[0m22:40:14.147507 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e896610>]}
[0m22:40:14.147861 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m22:40:14.172078 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m22:40:14.218388 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m22:40:14.218671 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m22:40:14.218859 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m22:40:14.234794 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7af06510>]}
[0m22:40:14.268011 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:40:14.269038 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:40:14.281075 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7ad64490>]}
[0m22:40:14.281356 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m22:40:14.281549 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7bed04d0>]}
[0m22:40:14.282637 [info ] [MainThread]: 
[0m22:40:14.282915 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m22:40:14.283133 [info ] [MainThread]: 
[0m22:40:14.283429 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m22:40:14.285087 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m22:40:14.285364 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m22:40:14.312440 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m22:40:14.321766 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:40:14.321939 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:40:14.322073 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:40:14.322265 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m22:40:14.322490 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m22:40:14.322721 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m22:40:14.322943 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:14.323154 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:14.323351 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m22:40:14.329915 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m22:40:14.330154 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m22:40:14.330312 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m22:40:14.330512 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m22:40:14.330781 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m22:40:14.331023 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m22:40:14.331218 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m22:40:14.331452 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m22:40:14.331675 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m22:40:14.334782 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m22:40:14.334933 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m22:40:14.335074 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.003 seconds
[0m22:40:14.335637 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m22:40:14.336167 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m22:40:14.336657 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m22:40:14.336966 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m22:40:14.337162 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m22:40:14.337357 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m22:40:14.340774 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.340994 [debug] [MainThread]: On master: BEGIN
[0m22:40:14.341159 [debug] [MainThread]: Opening a new connection, currently in state init
[0m22:40:14.344040 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:40:14.344307 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.344502 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m22:40:14.354060 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m22:40:14.354543 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': 'bb9135b7-e081-4337-9e4d-73aa8c42a1b1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7e69fb50>]}
[0m22:40:14.354775 [debug] [MainThread]: On master: ROLLBACK
[0m22:40:14.355009 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.355161 [debug] [MainThread]: On master: BEGIN
[0m22:40:14.355599 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m22:40:14.355817 [debug] [MainThread]: On master: COMMIT
[0m22:40:14.356010 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.356175 [debug] [MainThread]: On master: COMMIT
[0m22:40:14.356382 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:40:14.356538 [debug] [MainThread]: On master: Close
[0m22:40:14.358660 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:40:14.358877 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:40:14.359117 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:40:14.359312 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:40:14.359490 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m22:40:14.359779 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m22:40:14.360107 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m22:40:14.360397 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m22:40:14.360761 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m22:40:14.361064 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m22:40:14.361301 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m22:40:14.361579 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m22:40:14.361835 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:40:14.362063 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:40:14.362297 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:40:14.362521 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:40:14.368651 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:40:14.371959 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:40:14.373447 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:40:14.374853 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:40:14.377775 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:40:14.377962 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:40:14.378259 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:40:14.384229 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:40:14.384424 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:40:14.385351 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:40:14.386265 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:40:14.387331 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:40:14.388030 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:40:14.388214 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:40:14.388724 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m22:40:14.388976 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:40:14.389243 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m22:40:14.389580 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:40:14.390586 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m22:40:14.390198 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m22:40:14.390404 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:14.389931 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:40:14.390751 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m22:40:14.390931 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:40:14.394955 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m22:40:14.395330 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.395492 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m22:40:14.395641 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m22:40:14.395893 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m22:40:14.396065 [debug] [Thread-3 (]: SQL status: BEGIN in 0.006 seconds
[0m22:40:14.396263 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m22:40:14.396472 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m22:40:14.396717 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.396936 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m22:40:14.397149 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.397527 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.397894 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:40:14.399824 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m22:40:14.400013 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:40:14.400187 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m22:40:14.400334 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m22:40:14.400585 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m22:40:14.401145 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m22:40:14.401738 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m22:40:14.402307 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m22:40:14.402708 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m22:40:14.403180 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m22:40:14.403408 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m22:40:14.403746 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m22:40:14.403976 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m22:40:14.404333 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m22:40:14.404954 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m22:40:14.405288 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m22:40:14.405680 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:40:14.406051 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m22:40:14.406310 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m22:40:14.406573 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m22:40:14.406805 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m22:40:14.407115 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:40:14.407376 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:40:14.407644 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:40:14.407955 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m22:40:14.408186 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m22:40:14.408456 [info ] [Thread-1 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m22:40:14.408724 [info ] [Thread-4 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m22:40:14.409053 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:40:14.409286 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m22:40:14.409500 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m22:40:14.409763 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m22:40:14.411595 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:40:14.411831 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:40:14.412037 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:40:14.412260 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:40:14.413944 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:40:14.415464 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:40:14.415724 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:40:14.417899 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:40:14.418569 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:40:14.419455 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:40:14.419715 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:40:14.420730 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:40:14.421003 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:40:14.421949 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:40:14.422177 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:40:14.423278 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:40:14.423581 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:40:14.423793 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m22:40:14.424003 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:40:14.424366 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m22:40:14.424591 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:40:14.424924 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:40:14.425152 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m22:40:14.425468 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:40:14.425872 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m22:40:14.426056 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:14.426412 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:40:14.429664 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:40:14.429931 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.430248 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m22:40:14.430445 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.430602 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m22:40:14.430803 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m22:40:14.431000 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.431204 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m22:40:14.431404 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m22:40:14.431603 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.431904 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.432125 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.432286 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.000 seconds
[0m22:40:14.433345 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m22:40:14.433505 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.433661 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.433835 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.434029 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m22:40:14.434512 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m22:40:14.435109 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m22:40:14.435675 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m22:40:14.436042 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m22:40:14.436366 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m22:40:14.436562 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m22:40:14.436763 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m22:40:14.436978 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m22:40:14.437279 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m22:40:14.437578 [info ] [Thread-4 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m22:40:14.437956 [info ] [Thread-1 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m22:40:14.438260 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:40:14.438629 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m22:40:14.438938 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m22:40:14.439210 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m22:40:14.439408 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m22:40:14.439769 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:40:14.440026 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:40:14.440281 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:40:14.440529 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m22:40:14.440758 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m22:40:14.441073 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m22:40:14.441370 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m22:40:14.441657 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:40:14.441949 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m22:40:14.442197 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m22:40:14.442434 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m22:40:14.444336 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:40:14.444668 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:40:14.444925 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:40:14.445138 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:40:14.447239 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:40:14.448789 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:40:14.448960 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:40:14.451258 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:40:14.453130 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:40:14.453308 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:40:14.453539 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:40:14.454739 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:40:14.454887 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:40:14.455105 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:40:14.458414 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m22:40:14.458145 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:40:14.456834 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:40:14.458604 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:40:14.458863 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:40:14.459557 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m22:40:14.459786 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:40:14.459968 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:40:14.460245 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m22:40:14.460469 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m22:40:14.460666 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m22:40:14.461003 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m22:40:14.461250 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m22:40:14.464030 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m22:40:14.464313 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.464524 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m22:40:14.464808 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m22:40:14.465069 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.465248 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m22:40:14.465468 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.465676 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.465915 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m22:40:14.466124 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m22:40:14.466515 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:40:14.466825 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m22:40:14.467091 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.467292 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.468078 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m22:40:14.468251 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.468425 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.468987 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m22:40:14.469310 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m22:40:14.469885 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m22:40:14.470428 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m22:40:14.470680 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m22:40:14.470984 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m22:40:14.471314 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m22:40:14.471505 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m22:40:14.471746 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m22:40:14.472055 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m22:40:14.472365 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m22:40:14.472737 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m22:40:14.473032 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m22:40:14.473269 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:40:14.473551 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m22:40:14.473839 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m22:40:14.474195 [info ] [Thread-2 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m22:40:14.474816 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m22:40:14.475035 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:40:14.476845 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:40:14.477613 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:40:14.478593 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:40:14.479165 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:40:14.479334 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m22:40:14.479503 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m22:40:14.482573 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m22:40:14.482909 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m22:40:14.483088 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m22:40:14.484553 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m22:40:14.485276 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m22:40:14.485500 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m22:40:14.485784 [info ] [Thread-2 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.01s]
[0m22:40:14.486120 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m22:40:14.486967 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.487205 [debug] [MainThread]: On master: BEGIN
[0m22:40:14.487387 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m22:40:14.490518 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m22:40:14.490793 [debug] [MainThread]: On master: COMMIT
[0m22:40:14.491004 [debug] [MainThread]: Using postgres connection "master"
[0m22:40:14.491160 [debug] [MainThread]: On master: COMMIT
[0m22:40:14.491385 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m22:40:14.491596 [debug] [MainThread]: On master: Close
[0m22:40:14.491840 [debug] [MainThread]: Connection 'master' was properly closed.
[0m22:40:14.492032 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m22:40:14.492185 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m22:40:14.492331 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m22:40:14.492469 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m22:40:14.492654 [info ] [MainThread]: 
[0m22:40:14.493295 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.21 seconds (0.21s).
[0m22:40:14.495807 [debug] [MainThread]: Command end result
[0m22:40:14.509391 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m22:40:14.510336 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m22:40:14.513846 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m22:40:14.514058 [info ] [MainThread]: 
[0m22:40:14.514311 [info ] [MainThread]: [32mCompleted successfully[0m
[0m22:40:14.514594 [info ] [MainThread]: 
[0m22:40:14.514912 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m22:40:14.515505 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.47720945, "process_in_blocks": "0", "process_kernel_time": 0.116424, "process_mem_max_rss": "129800", "process_out_blocks": "2158", "process_user_time": 1.03787}
[0m22:40:14.515775 [debug] [MainThread]: Command `dbt test` succeeded at 22:40:14.515735 after 0.48 seconds
[0m22:40:14.516005 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c34d6d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff80a43310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7c336cd0>]}
[0m22:40:14.516226 [debug] [MainThread]: Flushing usage events
[0m22:40:14.898983 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:20:54.615791 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c02990>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85bf9590>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c02190>]}


============================== 00:20:54.618768 | 1cf2ce33-6c8b-495f-942a-bd878e30c351 ==============================
[0m00:20:54.618768 [info ] [MainThread]: Running with dbt=1.11.4
[0m00:20:54.619078 [debug] [MainThread]: running dbt with arguments {'use_colors': 'True', 'fail_fast': 'False', 'quiet': 'False', 'partial_parse': 'True', 'warn_error': 'None', 'static_parser': 'True', 'log_cache_events': 'False', 'printer_width': '80', 'log_path': '/opt/bluealpha/dbt_project/logs', 'no_print': 'None', 'version_check': 'True', 'write_json': 'True', 'debug': 'False', 'indirect_selection': 'eager', 'log_format': 'default', 'empty': 'False', 'cache_selected_only': 'False', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'target_path': 'None', 'invocation_command': 'dbt run', 'use_experimental_parser': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'introspect': 'True', 'send_anonymous_usage_stats': 'True'}
[0m00:20:54.683579 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85201010>]}
[0m00:20:54.702948 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff886154d0>]}
[0m00:20:54.703344 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m00:20:54.730918 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m00:20:54.731481 [info ] [MainThread]: Unable to do partial parsing because saved manifest not found. Starting full parse.
[0m00:20:54.731759 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'partial_parser', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff85c5b390>]}
[0m00:20:55.074889 [warn ] [MainThread]: [[33mWARNING[0m][MissingArgumentsPropertyInGenericTestDeprecation]: Deprecated
functionality
Found top-level arguments to test `not_null` defined on 'stg_google_ads_daily'
in package 'bluealpha_dbt' (models/schema.yml). Arguments to generic tests
should be nested under the `arguments` property.
[0m00:20:55.075282 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'deprecation', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'property_': 'warn', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d06e90>]}
[0m00:20:55.181108 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84be2750>]}
[0m00:20:55.215321 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:20:55.216254 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:20:55.224675 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f0bcbd0>]}
[0m00:20:55.224954 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m00:20:55.225147 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f22b210>]}
[0m00:20:55.226040 [info ] [MainThread]: 
[0m00:20:55.226247 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:20:55.226404 [info ] [MainThread]: 
[0m00:20:55.226647 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:20:55.228348 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:20:55.228669 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:20:55.232515 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:20:55.243320 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:20:55.243496 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:20:55.243717 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:20:55.243884 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:20:55.244102 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:20:55.244322 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:20:55.244550 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:55.244774 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:55.245136 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:55.250805 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m00:20:55.250999 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m00:20:55.251146 [debug] [ThreadPool]: SQL status: SELECT 9 in 0.006 seconds
[0m00:20:55.251692 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:20:55.252268 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:20:55.252761 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:20:55.253676 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_staging)
[0m00:20:55.253892 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_marts)
[0m00:20:55.254166 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now create_warehouse_staging_intermediate)
[0m00:20:55.254453 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_staging"
"
[0m00:20:55.254754 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_marts"
"
[0m00:20:55.255024 [debug] [ThreadPool]: Creating schema "database: "warehouse"
schema: "staging_intermediate"
"
[0m00:20:55.285097 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m00:20:55.286009 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m00:20:55.286852 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m00:20:55.287071 [debug] [ThreadPool]: On create_warehouse_staging_staging: BEGIN
[0m00:20:55.287294 [debug] [ThreadPool]: On create_warehouse_staging_marts: BEGIN
[0m00:20:55.287495 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: BEGIN
[0m00:20:55.287722 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.287927 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.288128 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.293477 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m00:20:55.293918 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m00:20:55.294567 [debug] [ThreadPool]: On create_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_staging"} */
create schema if not exists "staging_staging"
[0m00:20:55.294838 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m00:20:55.295292 [debug] [ThreadPool]: SQL status: BEGIN in 0.007 seconds
[0m00:20:55.295465 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m00:20:55.295717 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m00:20:55.295943 [debug] [ThreadPool]: On create_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_marts"} */
create schema if not exists "staging_marts"
[0m00:20:55.296102 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m00:20:55.296269 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "create_warehouse_staging_intermediate"} */
create schema if not exists "staging_intermediate"
[0m00:20:55.296834 [debug] [ThreadPool]: On create_warehouse_staging_staging: COMMIT
[0m00:20:55.296992 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.001 seconds
[0m00:20:55.297309 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_staging"
[0m00:20:55.297449 [debug] [ThreadPool]: SQL status: CREATE SCHEMA in 0.000 seconds
[0m00:20:55.297831 [debug] [ThreadPool]: On create_warehouse_staging_marts: COMMIT
[0m00:20:55.298061 [debug] [ThreadPool]: On create_warehouse_staging_staging: COMMIT
[0m00:20:55.298487 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: COMMIT
[0m00:20:55.298706 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_marts"
[0m00:20:55.298985 [debug] [ThreadPool]: Using postgres connection "create_warehouse_staging_intermediate"
[0m00:20:55.299119 [debug] [ThreadPool]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.299272 [debug] [ThreadPool]: On create_warehouse_staging_marts: COMMIT
[0m00:20:55.299460 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: COMMIT
[0m00:20:55.299659 [debug] [ThreadPool]: On create_warehouse_staging_staging: Close
[0m00:20:55.300155 [debug] [ThreadPool]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.300656 [debug] [ThreadPool]: On create_warehouse_staging_marts: Close
[0m00:20:55.300844 [debug] [ThreadPool]: SQL status: COMMIT in 0.001 seconds
[0m00:20:55.301244 [debug] [ThreadPool]: On create_warehouse_staging_intermediate: Close
[0m00:20:55.301983 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_intermediate, now list_warehouse_staging_staging)
[0m00:20:55.302217 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_marts, now list_warehouse_staging_marts)
[0m00:20:55.302448 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly create_warehouse_staging_staging, now list_warehouse_staging_intermediate)
[0m00:20:55.304976 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:20:55.305950 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:20:55.306834 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:20:55.307019 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m00:20:55.307216 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m00:20:55.307389 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m00:20:55.307559 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.307758 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.307943 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:20:55.311437 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m00:20:55.311768 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:20:55.312046 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m00:20:55.313364 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m00:20:55.313577 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:20:55.313814 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m00:20:55.316252 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.004 seconds
[0m00:20:55.316400 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m00:20:55.316986 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m00:20:55.317152 [debug] [ThreadPool]: SQL status: BEGIN in 0.009 seconds
[0m00:20:55.317647 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m00:20:55.317902 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m00:20:55.318044 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:20:55.318300 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m00:20:55.318598 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m00:20:55.320473 [debug] [ThreadPool]: SQL status: SELECT 0 in 0.002 seconds
[0m00:20:55.320950 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m00:20:55.321164 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m00:20:55.323188 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.323375 [debug] [MainThread]: On master: BEGIN
[0m00:20:55.323524 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:20:55.327142 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m00:20:55.327361 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.327567 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:20:55.337303 [debug] [MainThread]: SQL status: SELECT 0 in 0.010 seconds
[0m00:20:55.337862 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f121610>]}
[0m00:20:55.338116 [debug] [MainThread]: On master: ROLLBACK
[0m00:20:55.338355 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.338558 [debug] [MainThread]: On master: BEGIN
[0m00:20:55.338818 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:20:55.339034 [debug] [MainThread]: On master: COMMIT
[0m00:20:55.339219 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.339379 [debug] [MainThread]: On master: COMMIT
[0m00:20:55.339586 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.339789 [debug] [MainThread]: On master: Close
[0m00:20:55.341925 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:20:55.342111 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:20:55.342286 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m00:20:55.342575 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m00:20:55.342874 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m00:20:55.343145 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m00:20:55.343391 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m00:20:55.343619 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m00:20:55.343835 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_google_ads_daily)
[0m00:20:55.344047 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:20:55.344269 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:20:55.344459 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m00:20:55.347106 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.348194 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.349202 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.350640 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:20:55.357370 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m00:20:55.363587 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.363807 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:20:55.365077 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.366488 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.367781 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.367997 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m00:20:55.368162 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.368361 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.368511 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:55.368731 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m00:20:55.368940 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m00:20:55.369292 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:55.369514 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:20:55.373532 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m00:20:55.373846 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m00:20:55.374018 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:55.374227 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.374438 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.374655 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.374883 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m00:20:55.375145 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)
select 
    'facebook'::text as platform,
    *
from validate
  );
[0m00:20:55.375397 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m00:20:55.382096 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:20:55.382274 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m00:20:55.382441 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.007 seconds
[0m00:20:55.384947 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.386163 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.387272 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.387485 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m00:20:55.387717 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m00:20:55.387914 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m00:20:55.388534 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:20:55.388709 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:55.388860 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:20:55.393809 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m00:20:55.394416 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m00:20:55.395018 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m00:20:55.395257 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.395484 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.395810 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.396020 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m00:20:55.396245 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m00:20:55.396498 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m00:20:55.397646 [debug] [Thread-3 (]: SQL status: COMMIT in 0.001 seconds
[0m00:20:55.397826 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m00:20:55.397964 [debug] [Thread-1 (]: SQL status: COMMIT in 0.001 seconds
[0m00:20:55.400261 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m00:20:55.401219 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m00:20:55.402696 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m00:20:55.404562 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:20:55.404939 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:20:55.405292 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:20:55.405505 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m00:20:55.405725 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m00:20:55.405913 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m00:20:55.406234 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:20:55.406459 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:20:55.406700 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.000 seconds
[0m00:20:55.407600 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m00:20:55.408126 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m00:20:55.408620 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m00:20:55.409428 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7d4ddf10>]}
[0m00:20:55.409675 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f114890>]}
[0m00:20:55.409986 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84c22f10>]}
[0m00:20:55.410345 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m00:20:55.410808 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m00:20:55.411169 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m00:20:55.411521 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m00:20:55.411844 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:20:55.412095 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:20:55.412588 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m00:20:55.412900 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m00:20:55.413096 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m00:20:55.413363 [info ] [Thread-2 (]: 5 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m00:20:55.413657 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_campaign_daily'
[0m00:20:55.413883 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.int_crm_orders)
[0m00:20:55.414084 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m00:20:55.414271 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m00:20:55.415915 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m00:20:55.417148 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m00:20:55.418031 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m00:20:55.418227 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m00:20:55.431804 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m00:20:55.433321 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m00:20:55.434202 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:20:55.434424 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m00:20:55.434618 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:20:55.434815 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:20:55.435042 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m00:20:55.435414 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:55.438589 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m00:20:55.438755 [debug] [Thread-4 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:55.439040 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:20:55.439257 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:20:55.439449 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_crm_orders"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

  );
  
  
[0m00:20:55.439684 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
  
    

  create  table "warehouse"."staging_intermediate"."int_campaign_daily"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


  );
  
  
[0m00:20:55.444287 [debug] [Thread-4 (]: SQL status: SELECT 90 in 0.004 seconds
[0m00:20:55.444454 [debug] [Thread-2 (]: SQL status: SELECT 79 in 0.005 seconds
[0m00:20:55.446643 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m00:20:55.447297 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m00:20:55.447528 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:20:55.447727 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:20:55.447916 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m00:20:55.448086 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m00:20:55.448756 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.448921 [debug] [Thread-2 (]: SQL status: COMMIT in 0.001 seconds
[0m00:20:55.449259 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m00:20:55.449598 [debug] [Thread-2 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m00:20:55.449964 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f228d90>]}
[0m00:20:55.450265 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff7f0bcb90>]}
[0m00:20:55.450610 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mSELECT 90[0m in 0.04s]
[0m00:20:55.451059 [info ] [Thread-2 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mSELECT 79[0m in 0.04s]
[0m00:20:55.451376 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m00:20:55.451629 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m00:20:55.452225 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m00:20:55.452457 [info ] [Thread-1 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m00:20:55.452682 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m00:20:55.452851 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m00:20:55.454271 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.454838 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m00:20:55.459623 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.460422 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.460664 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m00:20:55.460843 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:55.464151 [debug] [Thread-1 (]: SQL status: BEGIN in 0.003 seconds
[0m00:20:55.464445 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.464698 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m00:20:55.468687 [debug] [Thread-1 (]: SQL status: SELECT 90 in 0.004 seconds
[0m00:20:55.470971 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.471165 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m00:20:55.471424 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:20:55.471984 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m00:20:55.472160 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.472338 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m00:20:55.472892 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.473732 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m00:20:55.474955 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:20:55.475166 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m00:20:55.475428 [debug] [Thread-1 (]: SQL status: DROP TABLE in 0.000 seconds
[0m00:20:55.475968 [debug] [Thread-1 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m00:20:55.476267 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '1cf2ce33-6c8b-495f-942a-bd878e30c351', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84d7f710>]}
[0m00:20:55.476586 [info ] [Thread-1 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.02s]
[0m00:20:55.476841 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m00:20:55.477839 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.478053 [debug] [MainThread]: On master: BEGIN
[0m00:20:55.478411 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:20:55.481250 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m00:20:55.481573 [debug] [MainThread]: On master: COMMIT
[0m00:20:55.481749 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:55.481923 [debug] [MainThread]: On master: COMMIT
[0m00:20:55.482133 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:55.482287 [debug] [MainThread]: On master: Close
[0m00:20:55.482533 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:20:55.482703 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m00:20:55.482843 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m00:20:55.483025 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m00:20:55.483192 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m00:20:55.483416 [info ] [MainThread]: 
[0m00:20:55.483612 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.26 seconds (0.26s).
[0m00:20:55.484122 [debug] [MainThread]: Command end result
[0m00:20:55.495908 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:20:55.496759 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:20:55.499231 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m00:20:55.499407 [info ] [MainThread]: 
[0m00:20:55.499627 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:20:55.499806 [info ] [MainThread]: 
[0m00:20:55.500129 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m00:20:55.500468 [warn ] [MainThread]: [[33mWARNING[0m][DeprecationsSummary]: Deprecated functionality
Summary of encountered deprecations:
- MissingArgumentsPropertyInGenericTestDeprecation: 7 occurrences
To see all deprecation instances instead of just the first occurrence of each,
run command again with the `--show-all-deprecations` flag. You may also need to
run with `--no-partial-parse` as some deprecations are only encountered during
parsing.
[0m00:20:55.501013 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.9070477, "process_in_blocks": "0", "process_kernel_time": 0.118174, "process_mem_max_rss": "136520", "process_out_blocks": "4321", "process_user_time": 1.478185}
[0m00:20:55.501262 [debug] [MainThread]: Command `dbt run` succeeded at 00:20:55.501226 after 0.91 seconds
[0m00:20:55.501451 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff84ede150>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a82d490>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff8a82cc10>]}
[0m00:20:55.501640 [debug] [MainThread]: Flushing usage events
[0m00:20:56.021942 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:20:57.776037 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e72310>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e73950>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa2e71310>]}


============================== 00:20:57.778849 | 90c35110-7abe-4d07-b26f-86e073d94958 ==============================
[0m00:20:57.778849 [info ] [MainThread]: Running with dbt=1.11.4
[0m00:20:57.779168 [debug] [MainThread]: running dbt with arguments {'warn_error': 'None', 'write_json': 'True', 'no_print': 'None', 'profiles_dir': '/opt/bluealpha/dbt_project', 'log_path': '/opt/bluealpha/dbt_project/logs', 'indirect_selection': 'eager', 'use_experimental_parser': 'False', 'use_colors': 'True', 'printer_width': '80', 'cache_selected_only': 'False', 'introspect': 'True', 'quiet': 'False', 'log_cache_events': 'False', 'version_check': 'True', 'debug': 'False', 'fail_fast': 'False', 'target_path': 'None', 'static_parser': 'True', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'send_anonymous_usage_stats': 'True', 'partial_parse': 'True', 'log_format': 'default', 'empty': 'None', 'invocation_command': 'dbt test'}
[0m00:20:57.842124 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa246de10>]}
[0m00:20:57.863479 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa58a5390>]}
[0m00:20:57.863920 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m00:20:57.887939 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m00:20:57.933993 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:20:57.934382 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m00:20:57.934716 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:20:57.958971 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa20b4510>]}
[0m00:20:57.993707 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:20:57.994576 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:20:58.006024 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1e34b10>]}
[0m00:20:58.006306 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m00:20:58.006486 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa1fead50>]}
[0m00:20:58.007469 [info ] [MainThread]: 
[0m00:20:58.007663 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:20:58.007819 [info ] [MainThread]: 
[0m00:20:58.008070 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:20:58.009738 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m00:20:58.010045 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m00:20:58.041895 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m00:20:58.051748 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:20:58.051933 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:20:58.052080 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:20:58.052302 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m00:20:58.052528 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m00:20:58.052780 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m00:20:58.052999 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:58.053222 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:58.053439 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:20:58.057890 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.058089 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.058260 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.058482 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:20:58.058752 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:20:58.058977 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:20:58.059184 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m00:20:58.059455 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m00:20:58.059705 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m00:20:58.062352 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m00:20:58.062510 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m00:20:58.062652 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.003 seconds
[0m00:20:58.063229 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m00:20:58.063732 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m00:20:58.064275 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m00:20:58.064592 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m00:20:58.064839 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m00:20:58.065059 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m00:20:58.068021 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.068244 [debug] [MainThread]: On master: BEGIN
[0m00:20:58.068414 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:20:58.071460 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m00:20:58.071750 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.072021 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:20:58.081593 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m00:20:58.082151 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '90c35110-7abe-4d07-b26f-86e073d94958', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa5adef50>]}
[0m00:20:58.082399 [debug] [MainThread]: On master: ROLLBACK
[0m00:20:58.082660 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.082828 [debug] [MainThread]: On master: BEGIN
[0m00:20:58.083111 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:20:58.083383 [debug] [MainThread]: On master: COMMIT
[0m00:20:58.083660 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.083867 [debug] [MainThread]: On master: COMMIT
[0m00:20:58.084090 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:58.084260 [debug] [MainThread]: On master: Close
[0m00:20:58.086376 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:20:58.086586 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:20:58.086822 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:20:58.087016 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:20:58.087190 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m00:20:58.087491 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m00:20:58.087779 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m00:20:58.088057 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m00:20:58.088354 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m00:20:58.088620 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m00:20:58.088888 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m00:20:58.089162 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m00:20:58.089415 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:20:58.089733 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:20:58.089971 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:20:58.090187 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:20:58.096770 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:20:58.100133 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:20:58.101689 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:20:58.103221 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:20:58.104411 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:20:58.110498 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:20:58.110705 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:20:58.111032 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:20:58.111252 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:20:58.112216 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:20:58.113327 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:20:58.114329 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:20:58.114530 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:20:58.115099 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m00:20:58.115278 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:20:58.115539 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:58.115896 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:20:58.116123 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:20:58.116276 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m00:20:58.116613 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m00:20:58.116863 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m00:20:58.117137 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:58.117479 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:20:58.117808 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:20:58.119752 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:58.120024 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:20:58.120205 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.120996 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.122800 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m00:20:58.123254 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m00:20:58.123504 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m00:20:58.123732 [debug] [Thread-4 (]: SQL status: BEGIN in 0.006 seconds
[0m00:20:58.123943 [debug] [Thread-3 (]: SQL status: BEGIN in 0.007 seconds
[0m00:20:58.124107 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:20:58.124478 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m00:20:58.124724 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:20:58.124950 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:20:58.125199 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m00:20:58.125474 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:20:58.125694 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.125916 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.126232 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:20:58.126954 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m00:20:58.127144 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m00:20:58.127337 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.127489 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.127709 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m00:20:58.128377 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m00:20:58.128985 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m00:20:58.129574 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m00:20:58.129790 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:20:58.130089 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m00:20:58.130308 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m00:20:58.130526 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m00:20:58.132239 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:20:58.132579 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m00:20:58.132896 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m00:20:58.133263 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m00:20:58.133677 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:20:58.134039 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:20:58.134218 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:20:58.134454 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:20:58.134720 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:20:58.135005 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:20:58.136005 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:20:58.136193 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:20:58.136403 [info ] [Thread-3 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m00:20:58.136651 [info ] [Thread-4 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m00:20:58.136970 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m00:20:58.137239 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m00:20:58.137433 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:20:58.138244 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m00:20:58.137845 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m00:20:58.138066 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:20:58.137628 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m00:20:58.140322 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:20:58.138587 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:20:58.140124 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:20:58.138400 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:58.142569 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:20:58.144159 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:20:58.144903 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:20:58.145566 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:20:58.146591 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:20:58.147639 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:20:58.147816 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:20:58.148139 [debug] [Thread-2 (]: SQL status: BEGIN in 0.010 seconds
[0m00:20:58.148632 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:20:58.149571 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:20:58.149846 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:20:58.150023 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:20:58.150688 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m00:20:58.150470 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.150180 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m00:20:58.150875 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:20:58.151018 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m00:20:58.151302 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:20:58.151506 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m00:20:58.151681 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.000 seconds
[0m00:20:58.152120 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:58.153138 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m00:20:58.153594 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m00:20:58.153948 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.03s]
[0m00:20:58.154616 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:20:58.154850 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:20:58.155154 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m00:20:58.155341 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:58.155632 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.156106 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m00:20:58.156359 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:20:58.156538 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:58.156751 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:20:58.156993 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:20:58.157240 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.157454 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:20:58.157686 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.159606 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:20:58.159899 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.160241 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.000 seconds
[0m00:20:58.161399 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m00:20:58.161579 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.161777 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:20:58.161941 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.162162 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m00:20:58.162677 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m00:20:58.163689 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:20:58.164266 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m00:20:58.164567 [info ] [Thread-3 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.03s]
[0m00:20:58.164877 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m00:20:58.165188 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m00:20:58.165449 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:20:58.165747 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:20:58.165968 [info ] [Thread-4 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.03s]
[0m00:20:58.166278 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.03s]
[0m00:20:58.166511 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:20:58.166764 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m00:20:58.167024 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:20:58.167267 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:20:58.167479 [info ] [Thread-3 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m00:20:58.167706 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:58.167929 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:20:58.168143 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:20:58.168380 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m00:20:58.168684 [info ] [Thread-4 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m00:20:58.169027 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m00:20:58.169299 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:20:58.169538 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m00:20:58.169778 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m00:20:58.171688 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:20:58.171938 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:20:58.172152 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:58.172410 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:20:58.174187 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:20:58.174453 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:20:58.174624 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:20:58.176905 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:20:58.177242 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.178292 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:20:58.178453 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:20:58.178970 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:20:58.180731 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:20:58.180902 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.002 seconds
[0m00:20:58.181865 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:20:58.182089 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:20:58.182795 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m00:20:58.183077 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:20:58.183334 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m00:20:58.183594 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:20:58.183749 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m00:20:58.183907 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m00:20:58.184187 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:20:58.184424 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m00:20:58.184767 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m00:20:58.184969 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m00:20:58.185277 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:20:58.185662 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:20:58.186327 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:20:58.186720 [info ] [Thread-2 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m00:20:58.187037 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m00:20:58.187245 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:20:58.189917 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:20:58.190246 [debug] [Thread-3 (]: SQL status: BEGIN in 0.006 seconds
[0m00:20:58.190422 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.190586 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m00:20:58.190813 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:20:58.190997 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:20:58.191163 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:20:58.191357 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:20:58.191573 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.192554 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:20:58.192736 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:20:58.192961 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m00:20:58.193891 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:20:58.194040 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.194191 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.194341 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.194526 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m00:20:58.195179 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m00:20:58.195752 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m00:20:58.196317 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m00:20:58.196500 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:20:58.196772 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m00:20:58.196979 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m00:20:58.197172 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m00:20:58.197584 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m00:20:58.197868 [info ] [Thread-4 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m00:20:58.198179 [info ] [Thread-3 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m00:20:58.198497 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:20:58.198840 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:20:58.199138 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:20:58.200502 [debug] [Thread-2 (]: SQL status: BEGIN in 0.004 seconds
[0m00:20:58.200730 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:20:58.200933 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m00:20:58.202174 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:20:58.202741 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m00:20:58.202966 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m00:20:58.203209 [info ] [Thread-2 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.02s]
[0m00:20:58.203453 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:20:58.204199 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.204410 [debug] [MainThread]: On master: BEGIN
[0m00:20:58.204567 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:20:58.207190 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m00:20:58.207460 [debug] [MainThread]: On master: COMMIT
[0m00:20:58.207663 [debug] [MainThread]: Using postgres connection "master"
[0m00:20:58.207846 [debug] [MainThread]: On master: COMMIT
[0m00:20:58.208058 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:20:58.208221 [debug] [MainThread]: On master: Close
[0m00:20:58.208417 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:20:58.208592 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m00:20:58.208737 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m00:20:58.208880 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m00:20:58.209063 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m00:20:58.209242 [info ] [MainThread]: 
[0m00:20:58.209437 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.20 seconds (0.20s).
[0m00:20:58.210181 [debug] [MainThread]: Command end result
[0m00:20:58.222102 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:20:58.222931 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:20:58.226097 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m00:20:58.226280 [info ] [MainThread]: 
[0m00:20:58.226491 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:20:58.226680 [info ] [MainThread]: 
[0m00:20:58.226888 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m00:20:58.227342 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.47262797, "process_in_blocks": "0", "process_kernel_time": 0.104238, "process_mem_max_rss": "129876", "process_out_blocks": "2159", "process_user_time": 1.106531}
[0m00:20:58.227563 [debug] [MainThread]: Command `dbt test` succeeded at 00:20:58.227518 after 0.47 seconds
[0m00:20:58.227773 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7b4b790>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7aa1b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffa7aa1a50>]}
[0m00:20:58.227984 [debug] [MainThread]: Flushing usage events
[0m00:20:59.596034 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:24:29.438344 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb99273d0>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9926550>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9926710>]}


============================== 00:24:29.442210 | 4f36d307-6122-4467-af1e-fa4103e14bb1 ==============================
[0m00:24:29.442210 [info ] [MainThread]: Running with dbt=1.11.4
[0m00:24:29.442776 [debug] [MainThread]: running dbt with arguments {'profiles_dir': '/opt/bluealpha/dbt_project', 'version_check': 'True', 'invocation_command': 'dbt run', 'log_format': 'default', 'use_experimental_parser': 'False', 'partial_parse': 'True', 'quiet': 'False', 'static_parser': 'True', 'send_anonymous_usage_stats': 'True', 'no_print': 'None', 'empty': 'False', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'write_json': 'True', 'debug': 'False', 'warn_error': 'None', 'use_colors': 'True', 'log_cache_events': 'False', 'introspect': 'True', 'cache_selected_only': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'fail_fast': 'False', 'printer_width': '80'}
[0m00:24:29.516956 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb98b57d0>]}
[0m00:24:29.538495 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbc2f53d0>]}
[0m00:24:29.539020 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m00:24:29.564358 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m00:24:29.609018 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:24:29.609319 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m00:24:29.609507 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:24:29.626116 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8a3b710>]}
[0m00:24:29.659184 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:24:29.660057 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:24:29.668383 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8978990>]}
[0m00:24:29.668704 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m00:24:29.668926 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb98b4d10>]}
[0m00:24:29.669817 [info ] [MainThread]: 
[0m00:24:29.670033 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:24:29.670233 [info ] [MainThread]: 
[0m00:24:29.670520 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:24:29.672246 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:24:29.676960 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:24:29.677313 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse'
[0m00:24:29.710844 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:24:29.711067 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:24:29.711231 [debug] [ThreadPool]: Using postgres connection "list_warehouse"
[0m00:24:29.711468 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:24:29.711694 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:24:29.711918 [debug] [ThreadPool]: On list_warehouse: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse"} */

    select distinct nspname from pg_namespace
  
[0m00:24:29.712128 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:29.712332 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:29.712578 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:29.718285 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m00:24:29.718449 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m00:24:29.718603 [debug] [ThreadPool]: SQL status: SELECT 12 in 0.006 seconds
[0m00:24:29.719155 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:24:29.719661 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:24:29.720140 [debug] [ThreadPool]: On list_warehouse: Close
[0m00:24:29.721909 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_staging)
[0m00:24:29.722185 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_marts)
[0m00:24:29.722454 [debug] [ThreadPool]: Re-using an available connection from the pool (formerly list_warehouse, now list_warehouse_staging_intermediate)
[0m00:24:29.724668 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:24:29.725531 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:24:29.726363 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:24:29.726552 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m00:24:29.726761 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m00:24:29.726966 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m00:24:29.727159 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:24:29.727375 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:24:29.727576 [debug] [ThreadPool]: Opening a new connection, currently in state closed
[0m00:24:29.731609 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m00:24:29.731790 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m00:24:29.732204 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:24:29.732637 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:24:29.732940 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m00:24:29.733217 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m00:24:29.733396 [debug] [ThreadPool]: SQL status: BEGIN in 0.006 seconds
[0m00:24:29.733879 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:24:29.734125 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m00:24:29.735972 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m00:24:29.736137 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.002 seconds
[0m00:24:29.736283 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m00:24:29.736883 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m00:24:29.737356 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m00:24:29.737821 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m00:24:29.738100 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m00:24:29.738307 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m00:24:29.738499 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m00:24:29.741709 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.741913 [debug] [MainThread]: On master: BEGIN
[0m00:24:29.742069 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:24:29.745900 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m00:24:29.746102 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.746347 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:24:29.755693 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m00:24:29.756229 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8d3e3d0>]}
[0m00:24:29.756510 [debug] [MainThread]: On master: ROLLBACK
[0m00:24:29.756750 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.756902 [debug] [MainThread]: On master: BEGIN
[0m00:24:29.757171 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:24:29.757418 [debug] [MainThread]: On master: COMMIT
[0m00:24:29.757680 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.757956 [debug] [MainThread]: On master: COMMIT
[0m00:24:29.758218 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.759058 [debug] [MainThread]: On master: Close
[0m00:24:29.761039 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:24:29.761222 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:24:29.761397 [debug] [Thread-3 (]: Began running node model.bluealpha_dbt.stg_google_ads_daily
[0m00:24:29.761676 [info ] [Thread-1 (]: 1 of 6 START sql view model staging_staging.stg_crm_orders_daily ............... [RUN]
[0m00:24:29.761978 [info ] [Thread-2 (]: 2 of 6 START sql view model staging_staging.stg_facebook_ads_daily ............. [RUN]
[0m00:24:29.762259 [info ] [Thread-3 (]: 3 of 6 START sql view model staging_staging.stg_google_ads_daily ............... [RUN]
[0m00:24:29.762528 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now model.bluealpha_dbt.stg_crm_orders_daily)
[0m00:24:29.762769 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now model.bluealpha_dbt.stg_facebook_ads_daily)
[0m00:24:29.762999 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now model.bluealpha_dbt.stg_google_ads_daily)
[0m00:24:29.763210 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:24:29.763414 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:24:29.763610 [debug] [Thread-3 (]: Began compiling node model.bluealpha_dbt.stg_google_ads_daily
[0m00:24:29.766449 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.767555 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.768639 [debug] [Thread-3 (]: Writing injected SQL for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.769503 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:24:29.769689 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:24:29.769918 [debug] [Thread-3 (]: Began executing node model.bluealpha_dbt.stg_google_ads_daily
[0m00:24:29.782382 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.783684 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.785003 [debug] [Thread-3 (]: Writing runtime sql for node "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.785890 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.786117 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.786338 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: BEGIN
[0m00:24:29.786509 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.786729 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: BEGIN
[0m00:24:29.786989 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:29.787212 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: BEGIN
[0m00:24:29.787400 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:24:29.787792 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:24:29.791258 [debug] [Thread-1 (]: SQL status: BEGIN in 0.004 seconds
[0m00:24:29.791434 [debug] [Thread-3 (]: SQL status: BEGIN in 0.004 seconds
[0m00:24:29.791610 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:29.791836 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.792056 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.792267 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.792488 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */

  create view "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.crm_revenue_raw
),
--  dedupe by order_id, keep first row
deduped as (
    select *,
        row_number() over (partition by order_id order by row_num) as rn
    from src
),
clean as (
    select
        row_num,
        nullif(trim(order_id),'') as order_id,
        nullif(trim(customer_id),'') as customer_id,
        CASE  
            when order_date ~'^\d{4}-\d{2}-\d{2}$' then to_date(order_date,'YYYY-MM-DD')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' and split_part(order_date,'/',1)::int > 12 then to_date(order_date,'DD/MM/YYYY')
            when order_date ~'^\d{2}/\d{2}/\d{4}$' then to_date(order_date,'MM/DD/YYYY')
            when order_date ~'^\w+ \d{1,2}, \d{4}$' then to_date(order_date,'Month DD, YYYY')
            else null
        end as order_date,
        nullif(revenue,'')::numeric as revenue,
        lower(nullif(trim(channel_attributed),'')) as channel_attributed,
        nullif(trim(campaign_source),'') as campaign_source,
        nullif(trim(product_category),'') as product_category,
        nullif(trim(region),'') as region,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date,
        -- take care of outlier
        case 
            when nullif(revenue, '')::numeric > 10000 then TRUE
            else FALSE
        end as is_outlier,
        case 
            when nullif(revenue, '')::numeric < 0 then TRUE
            else FALSE
        end as is_refund
    from deduped
    where rn =1 
),
validate as (
    select *,
        (
            order_id is not null 
            and customer_id is not null 
            and revenue is not null 
            and order_date is not null
        ) as is_valid
    from clean
)
select 
    'crm'::text as platform,
    *
from validate
  );
[0m00:24:29.792774 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.google_ads_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        nullif(trim(campaign_type),'') as campaign_type,
        nullif(trim(status),'') as status,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        -- cost_micros -> spend
        (nullif(cost_micros,'')::numeric /1000000.0) as spend,
        nullif(conversions,'')::bigint as conversions,
        nullif(conversion_value,'')::numeric as conversion_value,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (campaign_id is not null and campaign_date is not null and spend is not null and spend>=0) as is_valid
    from clean
)

select 
    'google'::text as platform,
    *
from validate
  );
[0m00:24:29.793018 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */

  create view "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp"
    
    
  as (
    

with src as (
    select * from raw.facebook_export_raw
),

clean as (
    select
        row_num,
        nullif(trim(campaign_id),'') as campaign_id,
        nullif(trim(campaign_name),'') as campaign_name,
        CASE  
            when date ~'^\d{4}-\d{2}-\d{2}$' then to_date(date,'YYYY-MM-DD')
            when date ~'^\d{2}/\d{2}/\d{4}$' then to_date(date,'MM/DD/YYYY')
            when date ~'^\d{4}/\d{2}/\d{2}$' then to_date(date,'YYYY/MM/DD')
            when date ~'^\d{2}-\d{2}-\d{4}$' then to_date(date,'MM-DD-YYYY')
            when date ~'^\d{2}-[A-Za-z]{3}-\d{4}$' then to_date(date,'DD-Mon-YYYY')
            else null
        end as campaign_date,
        nullif(impressions,'')::bigint as impressions,
        nullif(clicks,'')::bigint as clicks,
        nullif(spend,'')::numeric as spend,
        coalesce(nullif(purchases,'')::bigint,0) as purchases,
        coalesce(nullif(purchase_value,'')::numeric,0) as purchase_value,
        nullif(reach,'')::bigint as reach,
        nullif(frequency,'')::numeric as frequency,
        run_id,
        load_ts::timestamp as load_ts,
        load_date::date as load_date
    from src
),
validate as (
    select 
        *,
        (
            campaign_id is not null 
            and campaign_date is not null 
            and spend is not null 
            and spend>=0
        ) as is_valid
    from clean
)
select 
    'facebook'::text as platform,
    *
from validate
  );
[0m00:24:29.796418 [debug] [Thread-1 (]: SQL status: CREATE VIEW in 0.003 seconds
[0m00:24:29.799239 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.799405 [debug] [Thread-2 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:24:29.799553 [debug] [Thread-3 (]: SQL status: CREATE VIEW in 0.006 seconds
[0m00:24:29.799754 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily" rename to "stg_crm_orders_daily__dbt_backup"
[0m00:24:29.800881 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.802032 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.802322 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily" rename to "stg_facebook_ads_daily__dbt_backup"
[0m00:24:29.802505 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.802698 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily" rename to "stg_google_ads_daily__dbt_backup"
[0m00:24:29.803810 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.803964 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:24:29.804255 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
alter table "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_tmp" rename to "stg_crm_orders_daily"
[0m00:24:29.804408 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.805468 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.806704 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.806869 [debug] [Thread-1 (]: SQL status: ALTER TABLE in 0.001 seconds
[0m00:24:29.807059 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_tmp" rename to "stg_facebook_ads_daily"
[0m00:24:29.807252 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
alter table "warehouse"."staging_staging"."stg_google_ads_daily__dbt_tmp" rename to "stg_google_ads_daily"
[0m00:24:29.812626 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m00:24:29.813083 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.813255 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.813434 [debug] [Thread-3 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.813582 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: COMMIT
[0m00:24:29.814210 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m00:24:29.814783 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m00:24:29.815105 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.815393 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.815537 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.815752 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: COMMIT
[0m00:24:29.818652 [debug] [Thread-1 (]: Applying DROP to: "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup"
[0m00:24:29.818876 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: COMMIT
[0m00:24:29.820780 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.stg_crm_orders_daily"
[0m00:24:29.820948 [debug] [Thread-2 (]: SQL status: COMMIT in 0.002 seconds
[0m00:24:29.821251 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_crm_orders_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_crm_orders_daily__dbt_backup" cascade
[0m00:24:29.821404 [debug] [Thread-3 (]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.822301 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup"
[0m00:24:29.823368 [debug] [Thread-3 (]: Applying DROP to: "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup"
[0m00:24:29.823585 [debug] [Thread-1 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:24:29.823875 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.stg_facebook_ads_daily"
[0m00:24:29.824234 [debug] [Thread-3 (]: Using postgres connection "model.bluealpha_dbt.stg_google_ads_daily"
[0m00:24:29.825114 [debug] [Thread-1 (]: On model.bluealpha_dbt.stg_crm_orders_daily: Close
[0m00:24:29.825352 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_facebook_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_facebook_ads_daily__dbt_backup" cascade
[0m00:24:29.825549 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.stg_google_ads_daily"} */
drop view if exists "warehouse"."staging_staging"."stg_google_ads_daily__dbt_backup" cascade
[0m00:24:29.826401 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4b89dd0>]}
[0m00:24:29.826993 [info ] [Thread-1 (]: 1 of 6 OK created sql view model staging_staging.stg_crm_orders_daily .......... [[32mCREATE VIEW[0m in 0.06s]
[0m00:24:29.827174 [debug] [Thread-3 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:24:29.827335 [debug] [Thread-2 (]: SQL status: DROP VIEW in 0.001 seconds
[0m00:24:29.827586 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.stg_crm_orders_daily
[0m00:24:29.828126 [debug] [Thread-3 (]: On model.bluealpha_dbt.stg_google_ads_daily: Close
[0m00:24:29.828626 [debug] [Thread-2 (]: On model.bluealpha_dbt.stg_facebook_ads_daily: Close
[0m00:24:29.829003 [debug] [Thread-4 (]: Began running node model.bluealpha_dbt.int_crm_orders
[0m00:24:29.829247 [debug] [Thread-3 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8825290>]}
[0m00:24:29.829517 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6cddf50>]}
[0m00:24:29.829810 [info ] [Thread-4 (]: 4 of 6 START sql incremental model staging_intermediate.int_crm_orders ......... [RUN]
[0m00:24:29.830213 [info ] [Thread-3 (]: 3 of 6 OK created sql view model staging_staging.stg_google_ads_daily .......... [[32mCREATE VIEW[0m in 0.07s]
[0m00:24:29.830598 [info ] [Thread-2 (]: 2 of 6 OK created sql view model staging_staging.stg_facebook_ads_daily ........ [[32mCREATE VIEW[0m in 0.07s]
[0m00:24:29.830863 [debug] [Thread-4 (]: Acquiring new postgres connection 'model.bluealpha_dbt.int_crm_orders'
[0m00:24:29.831129 [debug] [Thread-3 (]: Finished running node model.bluealpha_dbt.stg_google_ads_daily
[0m00:24:29.831396 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.stg_facebook_ads_daily
[0m00:24:29.831600 [debug] [Thread-4 (]: Began compiling node model.bluealpha_dbt.int_crm_orders
[0m00:24:29.831981 [debug] [Thread-1 (]: Began running node model.bluealpha_dbt.int_campaign_daily
[0m00:24:29.835157 [debug] [Thread-4 (]: Writing injected SQL for node "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.835422 [info ] [Thread-1 (]: 5 of 6 START sql incremental model staging_intermediate.int_campaign_daily ..... [RUN]
[0m00:24:29.835787 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_crm_orders_daily, now model.bluealpha_dbt.int_campaign_daily)
[0m00:24:29.835993 [debug] [Thread-1 (]: Began compiling node model.bluealpha_dbt.int_campaign_daily
[0m00:24:29.837459 [debug] [Thread-1 (]: Writing injected SQL for node "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.837627 [debug] [Thread-4 (]: Began executing node model.bluealpha_dbt.int_crm_orders
[0m00:24:29.850769 [debug] [Thread-1 (]: Began executing node model.bluealpha_dbt.int_campaign_daily
[0m00:24:29.851211 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.852750 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.852984 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

    
  
    

  create temporary table "int_crm_orders__dbt_tmp002429846201"
  
  
    as
  
  (
    

select
    order_id,
    customer_id,
    order_date,
    revenue,
    channel_attributed,
    campaign_source,
    product_category,
    region,
    is_outlier,
    is_refund,
    load_ts
from "warehouse"."staging_staging"."stg_crm_orders_daily"
where 
    is_valid = TRUE
    and is_outlier = FALSE

    and load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_crm_orders")

  );
  
  
[0m00:24:29.853216 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

    
  
    

  create temporary table "int_campaign_daily__dbt_tmp002429852162"
  
  
    as
  
  (
    

with google as (
    select
        platform,
        campaign_id,
        campaign_name,
        campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        --asumption Google Ads "conversions" and Facebook "purchases" represent the same business event
        conversions as purchases,
        conversion_value as purchase_value,
        null::bigint as reach,
        null::numeric as frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_google_ads_daily"
    where is_valid = TRUE
),
facebook as (
    select
        platform,
        campaign_id,
        campaign_name,
        null::text as campaign_type,
        campaign_date,
        impressions,
        clicks,
        spend,
        purchases,
        purchase_value,
        reach,
        frequency,
        is_valid,
        load_ts
    from "warehouse"."staging_staging"."stg_facebook_ads_daily"
    where is_valid = TRUE
),
unioned as (
    select * from google
    union all
    select * from facebook
)
select 
    platform,
    campaign_id,
    campaign_name,
    campaign_type,
    campaign_date,
    impressions,
    clicks,
    spend,
    purchases,
    purchase_value,
    reach,
    frequency,
    load_ts,
    case when impressions > 0
        then round(clicks::numeric / impressions *100, 2)
        else 0
    end as ctr_pct,
    case when clicks > 0
        then round(spend / clicks, 2)
        else 0
    end as cost_per_click,
    case when purchases > 0
        then round(spend / purchases, 2)
        else 0
    end as cost_per_purchase
from unioned


where load_ts > (select max(load_ts) from "warehouse"."staging_intermediate"."int_campaign_daily")

  );
  
  
[0m00:24:29.853437 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:24:29.853667 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:24:29.861000 [debug] [Thread-4 (]: SQL status: SELECT 79 in 0.008 seconds
[0m00:24:29.861171 [debug] [Thread-1 (]: SQL status: SELECT 90 in 0.007 seconds
[0m00:24:29.866222 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.868153 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.868378 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: BEGIN
[0m00:24:29.868601 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: BEGIN
[0m00:24:29.868911 [debug] [Thread-4 (]: SQL status: BEGIN in 0.000 seconds
[0m00:24:29.869159 [debug] [Thread-1 (]: SQL status: BEGIN in 0.000 seconds
[0m00:24:29.869370 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.869582 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.869831 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders__dbt_tmp002429846201'
        
      order by ordinal_position

  
[0m00:24:29.870044 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily__dbt_tmp002429852162'
        
      order by ordinal_position

  
[0m00:24:29.875453 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.005 seconds
[0m00:24:29.875623 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.005 seconds
[0m00:24:29.877551 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.878799 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.879047 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m00:24:29.879269 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m00:24:29.880397 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m00:24:29.880547 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m00:24:29.883737 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.885007 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.885235 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_crm_orders'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m00:24:29.885457 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      select
          column_name,
          data_type,
          character_maximum_length,
          numeric_precision,
          numeric_scale

      from "warehouse".INFORMATION_SCHEMA.columns
      where table_name = 'int_campaign_daily'
        
        and table_schema = 'staging_intermediate'
        
      order by ordinal_position

  
[0m00:24:29.886359 [debug] [Thread-4 (]: SQL status: SELECT 11 in 0.001 seconds
[0m00:24:29.886578 [debug] [Thread-1 (]: SQL status: SELECT 16 in 0.001 seconds
[0m00:24:29.891586 [debug] [Thread-4 (]: Writing runtime sql for node "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.892489 [debug] [Thread-1 (]: Writing runtime sql for node "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.893227 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.893471 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.893637 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_crm_orders"} */

      
        
        
        delete from "warehouse"."staging_intermediate"."int_crm_orders" as DBT_INTERNAL_DEST
        where (order_id) in (
            select distinct order_id
            from "int_crm_orders__dbt_tmp002429846201" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_crm_orders" ("order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts")
    (
        select "order_id", "customer_id", "order_date", "revenue", "channel_attributed", "campaign_source", "product_category", "region", "is_outlier", "is_refund", "load_ts"
        from "int_crm_orders__dbt_tmp002429846201"
    )
  
[0m00:24:29.893924 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.int_campaign_daily"} */

      
        delete from "warehouse"."staging_intermediate"."int_campaign_daily" as DBT_INTERNAL_DEST
        where (platform, campaign_id, campaign_date) in (
            select distinct platform, campaign_id, campaign_date
            from "int_campaign_daily__dbt_tmp002429852162" as DBT_INTERNAL_SOURCE
        );

    

    insert into "warehouse"."staging_intermediate"."int_campaign_daily" ("platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase")
    (
        select "platform", "campaign_id", "campaign_name", "campaign_type", "campaign_date", "impressions", "clicks", "spend", "purchases", "purchase_value", "reach", "frequency", "load_ts", "ctr_pct", "cost_per_click", "cost_per_purchase"
        from "int_campaign_daily__dbt_tmp002429852162"
    )
  
[0m00:24:29.895214 [debug] [Thread-4 (]: SQL status: INSERT 0 79 in 0.001 seconds
[0m00:24:29.895380 [debug] [Thread-1 (]: SQL status: INSERT 0 90 in 0.001 seconds
[0m00:24:29.896033 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m00:24:29.896637 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m00:24:29.896871 [debug] [Thread-4 (]: Using postgres connection "model.bluealpha_dbt.int_crm_orders"
[0m00:24:29.897072 [debug] [Thread-1 (]: Using postgres connection "model.bluealpha_dbt.int_campaign_daily"
[0m00:24:29.897280 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: COMMIT
[0m00:24:29.897465 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: COMMIT
[0m00:24:29.897961 [debug] [Thread-4 (]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.898108 [debug] [Thread-1 (]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.898440 [debug] [Thread-4 (]: On model.bluealpha_dbt.int_crm_orders: Close
[0m00:24:29.898810 [debug] [Thread-1 (]: On model.bluealpha_dbt.int_campaign_daily: Close
[0m00:24:29.899159 [debug] [Thread-4 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb8824310>]}
[0m00:24:29.899436 [debug] [Thread-1 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb6cdfa10>]}
[0m00:24:29.899880 [info ] [Thread-4 (]: 4 of 6 OK created sql incremental model staging_intermediate.int_crm_orders .... [[32mINSERT 0 79[0m in 0.07s]
[0m00:24:29.900460 [info ] [Thread-1 (]: 5 of 6 OK created sql incremental model staging_intermediate.int_campaign_daily  [[32mINSERT 0 90[0m in 0.06s]
[0m00:24:29.900818 [debug] [Thread-4 (]: Finished running node model.bluealpha_dbt.int_crm_orders
[0m00:24:29.901269 [debug] [Thread-1 (]: Finished running node model.bluealpha_dbt.int_campaign_daily
[0m00:24:29.902246 [debug] [Thread-2 (]: Began running node model.bluealpha_dbt.fact_campaign_daily
[0m00:24:29.902526 [info ] [Thread-2 (]: 6 of 6 START sql table model staging_marts.fact_campaign_daily ................. [RUN]
[0m00:24:29.902759 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly model.bluealpha_dbt.stg_facebook_ads_daily, now model.bluealpha_dbt.fact_campaign_daily)
[0m00:24:29.902937 [debug] [Thread-2 (]: Began compiling node model.bluealpha_dbt.fact_campaign_daily
[0m00:24:29.904456 [debug] [Thread-2 (]: Writing injected SQL for node "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.905138 [debug] [Thread-2 (]: Began executing node model.bluealpha_dbt.fact_campaign_daily
[0m00:24:29.909742 [debug] [Thread-2 (]: Writing runtime sql for node "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.910214 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.910410 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: BEGIN
[0m00:24:29.910576 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:29.913703 [debug] [Thread-2 (]: SQL status: BEGIN in 0.003 seconds
[0m00:24:29.913932 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.914161 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */

  
    

  create  table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp"
  
  
    as
  
  (
    

with campaigns as (
    select * from "warehouse"."staging_intermediate"."int_campaign_daily"
),

crm_daily as (
    select
        campaign_source as campaign_id,
        order_date as campaign_date,
        count(*) as order_count,
        sum(case when is_refund=FALSE then revenue else 0 end) as attributed_revenue,
        sum(case when is_refund=TRUE then revenue else 0 end) as refund_amount,
        count(distinct customer_id) as unique_customers
    from "warehouse"."staging_intermediate"."int_crm_orders"
    where campaign_source is not null
    group by campaign_source, order_date
)

select 
    c.platform,
    c.campaign_id,
    c.campaign_name,
    c.campaign_type,
    c.campaign_date,
    c.impressions,
    c.clicks,
    c.spend,
    c.purchases,
    c.purchase_value,
    c.reach,
    c.frequency,
    c.ctr_pct,
    c.cost_per_click,
    coalesce(r.order_count,0) as crm_order_count,
    coalesce(r.attributed_revenue,0) as crm_attributed_revenue,
    coalesce(r.refund_amount,0) as crm_refund_amount,
    coalesce(r.unique_customers,0) as crm_unique_customers,
    case 
        when spend>0 then round(coalesce(r.attributed_revenue,0) / c.spend, 2)
        else 0
    end as return_of_ads_spend
from campaigns c
left join crm_daily r
    on c.campaign_id = r.campaign_id
    and c.campaign_date = r.campaign_date
  );
  
[0m00:24:29.918049 [debug] [Thread-2 (]: SQL status: SELECT 90 in 0.004 seconds
[0m00:24:29.920504 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.920690 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily" rename to "fact_campaign_daily__dbt_backup"
[0m00:24:29.920953 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.922118 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.922277 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
alter table "warehouse"."staging_marts"."fact_campaign_daily__dbt_tmp" rename to "fact_campaign_daily"
[0m00:24:29.922512 [debug] [Thread-2 (]: SQL status: ALTER TABLE in 0.000 seconds
[0m00:24:29.923103 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m00:24:29.923263 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.923398 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: COMMIT
[0m00:24:29.923815 [debug] [Thread-2 (]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.925539 [debug] [Thread-2 (]: Applying DROP to: "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup"
[0m00:24:29.926515 [debug] [Thread-2 (]: Using postgres connection "model.bluealpha_dbt.fact_campaign_daily"
[0m00:24:29.926697 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "model.bluealpha_dbt.fact_campaign_daily"} */
drop table if exists "warehouse"."staging_marts"."fact_campaign_daily__dbt_backup" cascade
[0m00:24:29.928958 [debug] [Thread-2 (]: SQL status: DROP TABLE in 0.002 seconds
[0m00:24:29.929460 [debug] [Thread-2 (]: On model.bluealpha_dbt.fact_campaign_daily: Close
[0m00:24:29.929766 [debug] [Thread-2 (]: Sending event: {'category': 'dbt', 'action': 'run_model', 'label': '4f36d307-6122-4467-af1e-fa4103e14bb1', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb4c2c590>]}
[0m00:24:29.930099 [info ] [Thread-2 (]: 6 of 6 OK created sql table model staging_marts.fact_campaign_daily ............ [[32mSELECT 90[0m in 0.03s]
[0m00:24:29.930407 [debug] [Thread-2 (]: Finished running node model.bluealpha_dbt.fact_campaign_daily
[0m00:24:29.931264 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.931451 [debug] [MainThread]: On master: BEGIN
[0m00:24:29.931610 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:24:29.934441 [debug] [MainThread]: SQL status: BEGIN in 0.003 seconds
[0m00:24:29.934670 [debug] [MainThread]: On master: COMMIT
[0m00:24:29.934844 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:29.934989 [debug] [MainThread]: On master: COMMIT
[0m00:24:29.935176 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:24:29.935326 [debug] [MainThread]: On master: Close
[0m00:24:29.935524 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:24:29.935680 [debug] [MainThread]: Connection 'model.bluealpha_dbt.fact_campaign_daily' was properly closed.
[0m00:24:29.935839 [debug] [MainThread]: Connection 'model.bluealpha_dbt.stg_google_ads_daily' was properly closed.
[0m00:24:29.935995 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_campaign_daily' was properly closed.
[0m00:24:29.936122 [debug] [MainThread]: Connection 'model.bluealpha_dbt.int_crm_orders' was properly closed.
[0m00:24:29.936335 [info ] [MainThread]: 
[0m00:24:29.936545 [info ] [MainThread]: Finished running 2 incremental models, 1 table model, 3 view models in 0 hours 0 minutes and 0.27 seconds (0.27s).
[0m00:24:29.937071 [debug] [MainThread]: Command end result
[0m00:24:29.948533 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:24:29.949346 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:24:29.951841 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m00:24:29.952099 [info ] [MainThread]: 
[0m00:24:29.952313 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:24:29.952499 [info ] [MainThread]: 
[0m00:24:29.952692 [info ] [MainThread]: Done. PASS=6 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=6
[0m00:24:29.953220 [debug] [MainThread]: Resource report: {"command_name": "run", "command_success": true, "command_wall_clock_time": 0.53702164, "process_in_blocks": "0", "process_kernel_time": 0.145487, "process_mem_max_rss": "130492", "process_out_blocks": "2185", "process_user_time": 1.10671}
[0m00:24:29.953428 [debug] [MainThread]: Command `dbt run` succeeded at 00:24:29.953397 after 0.54 seconds
[0m00:24:29.953608 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9d96e90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffb9901210>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffffbe59b790>]}
[0m00:24:29.953802 [debug] [MainThread]: Flushing usage events
[0m00:24:30.421713 [debug] [MainThread]: An error was encountered while trying to flush usage events
[0m00:24:32.280127 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'start', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96495b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96494b10>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96495450>]}


============================== 00:24:32.283371 | 9f769df7-b4a8-4ffe-bfe3-dca3483fb17f ==============================
[0m00:24:32.283371 [info ] [MainThread]: Running with dbt=1.11.4
[0m00:24:32.283862 [debug] [MainThread]: running dbt with arguments {'no_print': 'None', 'warn_error': 'None', 'log_cache_events': 'False', 'profiles_dir': '/opt/bluealpha/dbt_project', 'introspect': 'True', 'send_anonymous_usage_stats': 'True', 'use_experimental_parser': 'False', 'invocation_command': 'dbt test', 'target_path': 'None', 'indirect_selection': 'eager', 'warn_error_options': 'WarnErrorOptionsV2(error=[], warn=[], silence=[])', 'cache_selected_only': 'False', 'debug': 'False', 'quiet': 'False', 'write_json': 'True', 'fail_fast': 'False', 'log_path': '/opt/bluealpha/dbt_project/logs', 'version_check': 'True', 'use_colors': 'True', 'log_format': 'default', 'empty': 'None', 'static_parser': 'True', 'partial_parse': 'True', 'printer_width': '80'}
[0m00:24:32.354152 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'project_id', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96ff8c90>]}
[0m00:24:32.375006 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'adapter_info', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98f3d610>]}
[0m00:24:32.375659 [info ] [MainThread]: Registered adapter: postgres=1.8.2
[0m00:24:32.403939 [debug] [MainThread]: checksum: 092b177ba87eb6bb3c55954c38aa57900eebac336561eb9ee32218428aa81d43, vars: {}, profile: , target: , version: 1.11.4
[0m00:24:32.448856 [debug] [MainThread]: Partial parsing enabled: 0 files deleted, 0 files added, 0 files changed.
[0m00:24:32.449231 [debug] [MainThread]: Nothing changed, skipping partial parsing.
[0m00:24:32.449512 [debug] [MainThread]: Partial parsing enabled, no changes found, skipping parsing
[0m00:24:32.466651 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'load_project', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff96517150>]}
[0m00:24:32.503316 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:24:32.504595 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:24:32.517626 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'resource_counts', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff95496450>]}
[0m00:24:32.518074 [info ] [MainThread]: Found 6 models, 13 data tests, 3 sources, 462 macros
[0m00:24:32.518331 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9560f850>]}
[0m00:24:32.519457 [info ] [MainThread]: 
[0m00:24:32.519683 [info ] [MainThread]: Concurrency: 4 threads (target='dev')
[0m00:24:32.519875 [info ] [MainThread]: 
[0m00:24:32.520148 [debug] [MainThread]: Acquiring new postgres connection 'master'
[0m00:24:32.522082 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_staging'
[0m00:24:32.555254 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_intermediate'
[0m00:24:32.522454 [debug] [ThreadPool]: Acquiring new postgres connection 'list_warehouse_staging_marts'
[0m00:24:32.566367 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:24:32.566594 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:24:32.566784 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:24:32.567058 [debug] [ThreadPool]: On list_warehouse_staging_staging: BEGIN
[0m00:24:32.567370 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: BEGIN
[0m00:24:32.567670 [debug] [ThreadPool]: On list_warehouse_staging_marts: BEGIN
[0m00:24:32.567955 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:32.568197 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:32.568400 [debug] [ThreadPool]: Opening a new connection, currently in state init
[0m00:24:32.572853 [debug] [ThreadPool]: SQL status: BEGIN in 0.004 seconds
[0m00:24:32.573109 [debug] [ThreadPool]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.573470 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_marts"
[0m00:24:32.573741 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_intermediate"
[0m00:24:32.574027 [debug] [ThreadPool]: On list_warehouse_staging_marts: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_marts"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_marts'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_marts'
  
[0m00:24:32.574296 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_intermediate"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_intermediate'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_intermediate'
  
[0m00:24:32.575745 [debug] [ThreadPool]: SQL status: BEGIN in 0.008 seconds
[0m00:24:32.576082 [debug] [ThreadPool]: Using postgres connection "list_warehouse_staging_staging"
[0m00:24:32.576498 [debug] [ThreadPool]: On list_warehouse_staging_staging: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "list_warehouse_staging_staging"} */
select
      'warehouse' as database,
      tablename as name,
      schemaname as schema,
      'table' as type
    from pg_tables
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      viewname as name,
      schemaname as schema,
      'view' as type
    from pg_views
    where schemaname ilike 'staging_staging'
    union all
    select
      'warehouse' as database,
      matviewname as name,
      schemaname as schema,
      'materialized_view' as type
    from pg_matviews
    where schemaname ilike 'staging_staging'
  
[0m00:24:32.577127 [debug] [ThreadPool]: SQL status: SELECT 2 in 0.002 seconds
[0m00:24:32.577322 [debug] [ThreadPool]: SQL status: SELECT 1 in 0.003 seconds
[0m00:24:32.578196 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: ROLLBACK
[0m00:24:32.578928 [debug] [ThreadPool]: On list_warehouse_staging_marts: ROLLBACK
[0m00:24:32.579077 [debug] [ThreadPool]: SQL status: SELECT 3 in 0.002 seconds
[0m00:24:32.579410 [debug] [ThreadPool]: On list_warehouse_staging_intermediate: Close
[0m00:24:32.579580 [debug] [ThreadPool]: On list_warehouse_staging_marts: Close
[0m00:24:32.580090 [debug] [ThreadPool]: On list_warehouse_staging_staging: ROLLBACK
[0m00:24:32.581208 [debug] [ThreadPool]: On list_warehouse_staging_staging: Close
[0m00:24:32.583897 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.584241 [debug] [MainThread]: On master: BEGIN
[0m00:24:32.584518 [debug] [MainThread]: Opening a new connection, currently in state init
[0m00:24:32.588240 [debug] [MainThread]: SQL status: BEGIN in 0.004 seconds
[0m00:24:32.588567 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.588881 [debug] [MainThread]: On master: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "connection_name": "master"} */
with relation as (
        select
            pg_rewrite.ev_class as class,
            pg_rewrite.oid as id
        from pg_rewrite
    ),
    class as (
        select
            oid as id,
            relname as name,
            relnamespace as schema,
            relkind as kind
        from pg_class
    ),
    dependency as (
        select distinct
            pg_depend.objid as id,
            pg_depend.refobjid as ref
        from pg_depend
    ),
    schema as (
        select
            pg_namespace.oid as id,
            pg_namespace.nspname as name
        from pg_namespace
        where nspname != 'information_schema' and nspname not like 'pg\_%'
    ),
    referenced as (
        select
            relation.id AS id,
            referenced_class.name ,
            referenced_class.schema ,
            referenced_class.kind
        from relation
        join class as referenced_class on relation.class=referenced_class.id
        where referenced_class.kind in ('r', 'v', 'm')
    ),
    relationships as (
        select
            referenced.name as referenced_name,
            referenced.schema as referenced_schema_id,
            dependent_class.name as dependent_name,
            dependent_class.schema as dependent_schema_id,
            referenced.kind as kind
        from referenced
        join dependency on referenced.id=dependency.id
        join class as dependent_class on dependency.ref=dependent_class.id
        where
            (referenced.name != dependent_class.name or
             referenced.schema != dependent_class.schema)
    )

    select
        referenced_schema.name as referenced_schema,
        relationships.referenced_name as referenced_name,
        dependent_schema.name as dependent_schema,
        relationships.dependent_name as dependent_name
    from relationships
    join schema as dependent_schema on relationships.dependent_schema_id=dependent_schema.id
    join schema as referenced_schema on relationships.referenced_schema_id=referenced_schema.id
    group by referenced_schema, referenced_name, dependent_schema, dependent_name
    order by referenced_schema, referenced_name, dependent_schema, dependent_name;
[0m00:24:32.598453 [debug] [MainThread]: SQL status: SELECT 3 in 0.009 seconds
[0m00:24:32.599074 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'runnable_timing', 'label': '9f769df7-b4a8-4ffe-bfe3-dca3483fb17f', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff98ece750>]}
[0m00:24:32.599335 [debug] [MainThread]: On master: ROLLBACK
[0m00:24:32.599604 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.599827 [debug] [MainThread]: On master: BEGIN
[0m00:24:32.600131 [debug] [MainThread]: SQL status: BEGIN in 0.000 seconds
[0m00:24:32.600393 [debug] [MainThread]: On master: COMMIT
[0m00:24:32.600584 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.600775 [debug] [MainThread]: On master: COMMIT
[0m00:24:32.601016 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:24:32.601181 [debug] [MainThread]: On master: Close
[0m00:24:32.603252 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:24:32.603429 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:24:32.603680 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:24:32.603891 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:24:32.604068 [info ] [Thread-1 (]: 1 of 13 START test accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [RUN]
[0m00:24:32.604393 [info ] [Thread-2 (]: 2 of 13 START test not_null_fact_campaign_daily_campaign_date .................. [RUN]
[0m00:24:32.604678 [info ] [Thread-3 (]: 3 of 13 START test not_null_fact_campaign_daily_campaign_id .................... [RUN]
[0m00:24:32.604974 [info ] [Thread-4 (]: 4 of 13 START test not_null_int_campaign_daily_campaign_date ................... [RUN]
[0m00:24:32.605277 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_staging, now test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3)
[0m00:24:32.605533 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_marts, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c)
[0m00:24:32.605804 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly list_warehouse_staging_intermediate, now test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43)
[0m00:24:32.606069 [debug] [Thread-4 (]: Acquiring new postgres connection 'test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e'
[0m00:24:32.606295 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:24:32.606517 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:24:32.606739 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:24:32.606967 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:24:32.613219 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:24:32.616558 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:24:32.618111 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:24:32.619620 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:24:32.620575 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:24:32.620997 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:24:32.626816 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:24:32.627140 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:24:32.627319 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:24:32.628216 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:24:32.629290 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:24:32.630261 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:24:32.630515 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:24:32.631043 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:24:32.631323 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:24:32.631478 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: BEGIN
[0m00:24:32.631741 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:24:32.631906 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: BEGIN
[0m00:24:32.632092 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: BEGIN
[0m00:24:32.632323 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:24:32.632552 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: BEGIN
[0m00:24:32.632771 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:32.633047 [debug] [Thread-4 (]: Opening a new connection, currently in state init
[0m00:24:32.633426 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:24:32.637366 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.637838 [debug] [Thread-1 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.638092 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"
[0m00:24:32.638285 [debug] [Thread-4 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.638458 [debug] [Thread-3 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.638683 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"
[0m00:24:32.638906 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.639145 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"
[0m00:24:32.639356 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"
[0m00:24:32.639631 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

with all_values as (

    select
        channel_attributed as value_field,
        count(*) as n_records

    from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true and channel_attributed is not null) dbt_subquery
    group by channel_attributed

)

select *
from all_values
where value_field not in (
    'google','facebook','email','direct','organic'
)



  
  
      
    ) dbt_internal_test
[0m00:24:32.639938 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.640188 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_marts"."fact_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.640359 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.642666 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: ROLLBACK
[0m00:24:32.642895 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.002 seconds
[0m00:24:32.643071 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.002 seconds
[0m00:24:32.643236 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.003 seconds
[0m00:24:32.643513 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c: Close
[0m00:24:32.644110 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: ROLLBACK
[0m00:24:32.644785 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: ROLLBACK
[0m00:24:32.645356 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: ROLLBACK
[0m00:24:32.645775 [info ] [Thread-2 (]: 2 of 13 PASS not_null_fact_campaign_daily_campaign_date ........................ [[32mPASS[0m in 0.04s]
[0m00:24:32.646118 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e: Close
[0m00:24:32.646347 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43: Close
[0m00:24:32.646681 [debug] [Thread-1 (]: On test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3: Close
[0m00:24:32.646903 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c
[0m00:24:32.647246 [info ] [Thread-4 (]: 4 of 13 PASS not_null_int_campaign_daily_campaign_date ......................... [[32mPASS[0m in 0.04s]
[0m00:24:32.647573 [info ] [Thread-3 (]: 3 of 13 PASS not_null_fact_campaign_daily_campaign_id .......................... [[32mPASS[0m in 0.04s]
[0m00:24:32.647937 [info ] [Thread-1 (]: 1 of 13 PASS accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic  [[32mPASS[0m in 0.04s]
[0m00:24:32.648217 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:24:32.648555 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e
[0m00:24:32.648851 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43
[0m00:24:32.649132 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3
[0m00:24:32.649340 [info ] [Thread-2 (]: 5 of 13 START test not_null_int_campaign_daily_campaign_id ..................... [RUN]
[0m00:24:32.649641 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:24:32.649921 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:24:32.650197 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:24:32.650439 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_date.9095258d1c, now test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051)
[0m00:24:32.650802 [info ] [Thread-4 (]: 6 of 13 START test not_null_int_crm_orders_order_id ............................ [RUN]
[0m00:24:32.651123 [info ] [Thread-3 (]: 7 of 13 START test not_null_stg_crm_orders_daily_order_id ...................... [RUN]
[0m00:24:32.651431 [info ] [Thread-1 (]: 8 of 13 START test not_null_stg_facebook_ads_daily_campaign_date ............... [RUN]
[0m00:24:32.651721 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:24:32.652060 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_date.d45b6cad2e, now test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8)
[0m00:24:32.652402 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_fact_campaign_daily_campaign_id.dbd9c41e43, now test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e)
[0m00:24:32.652673 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.accepted_values_stg_crm_orders_daily_channel_attributed__google__facebook__email__direct__organic.6abb51aec3, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e)
[0m00:24:32.654493 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:24:32.654760 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:24:32.654987 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:24:32.655212 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:24:32.656941 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:24:32.657223 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:24:32.659009 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:24:32.661925 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:24:32.663382 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:24:32.663920 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:24:32.664727 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:24:32.664923 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:24:32.666032 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:24:32.666322 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:24:32.667478 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:24:32.671639 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:24:32.672190 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: BEGIN
[0m00:24:32.672552 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:24:32.672970 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:32.673145 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:24:32.675844 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:24:32.676006 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: BEGIN
[0m00:24:32.676377 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: BEGIN
[0m00:24:32.678932 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: BEGIN
[0m00:24:32.680461 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m00:24:32.683797 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:24:32.684401 [debug] [Thread-2 (]: SQL status: BEGIN in 0.011 seconds
[0m00:24:32.687374 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:24:32.691232 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"
[0m00:24:32.691640 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from "warehouse"."staging_intermediate"."int_campaign_daily"
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.692482 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.693256 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: ROLLBACK
[0m00:24:32.694130 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051: Close
[0m00:24:32.694812 [info ] [Thread-2 (]: 5 of 13 PASS not_null_int_campaign_daily_campaign_id ........................... [[32mPASS[0m in 0.04s]
[0m00:24:32.695304 [debug] [Thread-4 (]: SQL status: BEGIN in 0.015 seconds
[0m00:24:32.695668 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051
[0m00:24:32.695895 [debug] [Thread-1 (]: SQL status: BEGIN in 0.009 seconds
[0m00:24:32.696116 [debug] [Thread-3 (]: SQL status: BEGIN in 0.012 seconds
[0m00:24:32.696373 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"
[0m00:24:32.696664 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:24:32.696941 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"
[0m00:24:32.697191 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"
[0m00:24:32.697436 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.697689 [info ] [Thread-2 (]: 9 of 13 START test not_null_stg_facebook_ads_daily_campaign_id ................. [RUN]
[0m00:24:32.697963 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.698214 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select order_id
from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.698576 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_campaign_daily_campaign_id.b278083051, now test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59)
[0m00:24:32.698970 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.699516 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:24:32.700216 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: ROLLBACK
[0m00:24:32.700405 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.700590 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.002 seconds
[0m00:24:32.702538 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:24:32.702888 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8: Close
[0m00:24:32.703519 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: ROLLBACK
[0m00:24:32.704109 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: ROLLBACK
[0m00:24:32.704634 [info ] [Thread-4 (]: 6 of 13 PASS not_null_int_crm_orders_order_id .................................. [[32mPASS[0m in 0.05s]
[0m00:24:32.705072 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:24:32.705274 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e: Close
[0m00:24:32.705581 [debug] [Thread-1 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e: Close
[0m00:24:32.705806 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8
[0m00:24:32.706864 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:24:32.707193 [info ] [Thread-3 (]: 7 of 13 PASS not_null_stg_crm_orders_daily_order_id ............................ [[32mPASS[0m in 0.05s]
[0m00:24:32.707508 [info ] [Thread-1 (]: 8 of 13 PASS not_null_stg_facebook_ads_daily_campaign_date ..................... [[32mPASS[0m in 0.05s]
[0m00:24:32.707791 [debug] [Thread-4 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:24:32.708249 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e
[0m00:24:32.708499 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e
[0m00:24:32.708703 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:24:32.708929 [info ] [Thread-4 (]: 10 of 13 START test not_null_stg_google_ads_daily_campaign_date ................ [RUN]
[0m00:24:32.709178 [debug] [Thread-3 (]: Began running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:24:32.709405 [debug] [Thread-1 (]: Began running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:24:32.709626 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: BEGIN
[0m00:24:32.709836 [debug] [Thread-4 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_int_crm_orders_order_id.7acb2e3ef8, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f)
[0m00:24:32.710060 [info ] [Thread-3 (]: 11 of 13 START test not_null_stg_google_ads_daily_campaign_id .................. [RUN]
[0m00:24:32.710279 [info ] [Thread-1 (]: 12 of 13 START test unique_int_crm_orders_order_id ............................. [RUN]
[0m00:24:32.710524 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:32.710718 [debug] [Thread-4 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:24:32.710943 [debug] [Thread-3 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_crm_orders_daily_order_id.65d347650e, now test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c)
[0m00:24:32.711145 [debug] [Thread-1 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_date.e8b4300e4e, now test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291)
[0m00:24:32.713342 [debug] [Thread-4 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:24:32.713635 [debug] [Thread-3 (]: Began compiling node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:24:32.713940 [debug] [Thread-1 (]: Began compiling node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:24:32.716286 [debug] [Thread-3 (]: Writing injected SQL for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:24:32.718964 [debug] [Thread-1 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:24:32.719182 [debug] [Thread-2 (]: SQL status: BEGIN in 0.009 seconds
[0m00:24:32.719359 [debug] [Thread-4 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:24:32.719811 [debug] [Thread-3 (]: Began executing node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:24:32.719958 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"
[0m00:24:32.721013 [debug] [Thread-4 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:24:32.721242 [debug] [Thread-1 (]: Began executing node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:24:32.723104 [debug] [Thread-3 (]: Writing runtime sql for node "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:24:32.723321 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_facebook_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.724418 [debug] [Thread-1 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:24:32.724755 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:24:32.725318 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:24:32.725522 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: BEGIN
[0m00:24:32.725741 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:24:32.725916 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.726094 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: BEGIN
[0m00:24:32.726308 [debug] [Thread-4 (]: Opening a new connection, currently in state closed
[0m00:24:32.726476 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: BEGIN
[0m00:24:32.727087 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: ROLLBACK
[0m00:24:32.727264 [debug] [Thread-3 (]: Opening a new connection, currently in state closed
[0m00:24:32.727596 [debug] [Thread-1 (]: Opening a new connection, currently in state closed
[0m00:24:32.728013 [debug] [Thread-2 (]: On test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59: Close
[0m00:24:32.728609 [info ] [Thread-2 (]: 9 of 13 PASS not_null_stg_facebook_ads_daily_campaign_id ....................... [[32mPASS[0m in 0.03s]
[0m00:24:32.729032 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59
[0m00:24:32.729419 [debug] [Thread-2 (]: Began running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:24:32.729699 [info ] [Thread-2 (]: 13 of 13 START test unique_stg_crm_orders_daily_order_id ....................... [RUN]
[0m00:24:32.730000 [debug] [Thread-2 (]: Re-using an available connection from the pool (formerly test.bluealpha_dbt.not_null_stg_facebook_ads_daily_campaign_id.cd2bde1f59, now test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf)
[0m00:24:32.730465 [debug] [Thread-2 (]: Began compiling node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:24:32.732830 [debug] [Thread-2 (]: Writing injected SQL for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:24:32.733188 [debug] [Thread-1 (]: SQL status: BEGIN in 0.006 seconds
[0m00:24:32.733352 [debug] [Thread-3 (]: SQL status: BEGIN in 0.006 seconds
[0m00:24:32.733527 [debug] [Thread-4 (]: SQL status: BEGIN in 0.007 seconds
[0m00:24:32.733747 [debug] [Thread-1 (]: Using postgres connection "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"
[0m00:24:32.733920 [debug] [Thread-2 (]: Began executing node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:24:32.734096 [debug] [Thread-3 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"
[0m00:24:32.734307 [debug] [Thread-4 (]: Using postgres connection "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"
[0m00:24:32.734518 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from "warehouse"."staging_intermediate"."int_crm_orders"
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m00:24:32.735548 [debug] [Thread-2 (]: Writing runtime sql for node "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:24:32.735763 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_id
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_id is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.736002 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    



select campaign_date
from (select * from "warehouse"."staging_staging"."stg_google_ads_daily" where is_valid = true) dbt_subquery
where campaign_date is null



  
  
      
    ) dbt_internal_test
[0m00:24:32.736652 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:24:32.736806 [debug] [Thread-1 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.737017 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: BEGIN
[0m00:24:32.737211 [debug] [Thread-3 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.737846 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: ROLLBACK
[0m00:24:32.738012 [debug] [Thread-4 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.738185 [debug] [Thread-2 (]: Opening a new connection, currently in state closed
[0m00:24:32.738721 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: ROLLBACK
[0m00:24:32.738997 [debug] [Thread-1 (]: On test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291: Close
[0m00:24:32.739500 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: ROLLBACK
[0m00:24:32.739903 [debug] [Thread-3 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c: Close
[0m00:24:32.740165 [info ] [Thread-1 (]: 12 of 13 PASS unique_int_crm_orders_order_id ................................... [[32mPASS[0m in 0.03s]
[0m00:24:32.740442 [debug] [Thread-4 (]: On test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f: Close
[0m00:24:32.740722 [info ] [Thread-3 (]: 11 of 13 PASS not_null_stg_google_ads_daily_campaign_id ........................ [[32mPASS[0m in 0.03s]
[0m00:24:32.741054 [debug] [Thread-1 (]: Finished running node test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291
[0m00:24:32.741391 [info ] [Thread-4 (]: 10 of 13 PASS not_null_stg_google_ads_daily_campaign_date ...................... [[32mPASS[0m in 0.03s]
[0m00:24:32.741660 [debug] [Thread-3 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c
[0m00:24:32.742225 [debug] [Thread-4 (]: Finished running node test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f
[0m00:24:32.742721 [debug] [Thread-2 (]: SQL status: BEGIN in 0.005 seconds
[0m00:24:32.742965 [debug] [Thread-2 (]: Using postgres connection "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"
[0m00:24:32.743175 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: /* {"app": "dbt", "dbt_version": "1.11.4", "profile_name": "bluealpha_dbt", "target_name": "dev", "node_id": "test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf"} */

    select
      count(*) as failures,
      count(*) != 0 as should_warn,
      count(*) != 0 as should_error
    from (
      
    
  
    
    

select
    order_id as unique_field,
    count(*) as n_records

from (select * from "warehouse"."staging_staging"."stg_crm_orders_daily" where is_valid = true) dbt_subquery
where order_id is not null
group by order_id
having count(*) > 1



  
  
      
    ) dbt_internal_test
[0m00:24:32.744486 [debug] [Thread-2 (]: SQL status: SELECT 1 in 0.001 seconds
[0m00:24:32.745244 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: ROLLBACK
[0m00:24:32.745474 [debug] [Thread-2 (]: On test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf: Close
[0m00:24:32.745776 [info ] [Thread-2 (]: 13 of 13 PASS unique_stg_crm_orders_daily_order_id ............................. [[32mPASS[0m in 0.02s]
[0m00:24:32.746072 [debug] [Thread-2 (]: Finished running node test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf
[0m00:24:32.746816 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.747000 [debug] [MainThread]: On master: BEGIN
[0m00:24:32.747170 [debug] [MainThread]: Opening a new connection, currently in state closed
[0m00:24:32.749631 [debug] [MainThread]: SQL status: BEGIN in 0.002 seconds
[0m00:24:32.749884 [debug] [MainThread]: On master: COMMIT
[0m00:24:32.750049 [debug] [MainThread]: Using postgres connection "master"
[0m00:24:32.750193 [debug] [MainThread]: On master: COMMIT
[0m00:24:32.750418 [debug] [MainThread]: SQL status: COMMIT in 0.000 seconds
[0m00:24:32.750593 [debug] [MainThread]: On master: Close
[0m00:24:32.750825 [debug] [MainThread]: Connection 'master' was properly closed.
[0m00:24:32.751010 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_int_crm_orders_order_id.5ac7558291' was properly closed.
[0m00:24:32.751189 [debug] [MainThread]: Connection 'test.bluealpha_dbt.unique_stg_crm_orders_daily_order_id.f6ae53aeaf' was properly closed.
[0m00:24:32.751388 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_id.344a2cb16c' was properly closed.
[0m00:24:32.751555 [debug] [MainThread]: Connection 'test.bluealpha_dbt.not_null_stg_google_ads_daily_campaign_date.c53708699f' was properly closed.
[0m00:24:32.751735 [info ] [MainThread]: 
[0m00:24:32.751933 [info ] [MainThread]: Finished running 13 data tests in 0 hours 0 minutes and 0.23 seconds (0.23s).
[0m00:24:32.752637 [debug] [MainThread]: Command end result
[0m00:24:32.764653 [debug] [MainThread]: Wrote artifact WritableManifest to /opt/bluealpha/dbt_project/target/manifest.json
[0m00:24:32.765415 [debug] [MainThread]: Wrote artifact SemanticManifest to /opt/bluealpha/dbt_project/target/semantic_manifest.json
[0m00:24:32.768448 [debug] [MainThread]: Wrote artifact RunExecutionResult to /opt/bluealpha/dbt_project/target/run_results.json
[0m00:24:32.768638 [info ] [MainThread]: 
[0m00:24:32.768848 [info ] [MainThread]: [32mCompleted successfully[0m
[0m00:24:32.769030 [info ] [MainThread]: 
[0m00:24:32.769223 [info ] [MainThread]: Done. PASS=13 WARN=0 ERROR=0 SKIP=0 NO-OP=0 TOTAL=13
[0m00:24:32.769680 [debug] [MainThread]: Resource report: {"command_name": "test", "command_success": true, "command_wall_clock_time": 0.5118945, "process_in_blocks": "0", "process_kernel_time": 0.100058, "process_mem_max_rss": "129748", "process_out_blocks": "2159", "process_user_time": 1.10164}
[0m00:24:32.769904 [debug] [MainThread]: Command `dbt test` succeeded at 00:24:32.769865 after 0.51 seconds
[0m00:24:32.770087 [debug] [MainThread]: Sending event: {'category': 'dbt', 'action': 'invocation', 'label': 'end', 'context': [<snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff97931b90>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9af73390>, <snowplow_tracker.self_describing_json.SelfDescribingJson object at 0xffff9789c790>]}
[0m00:24:32.770287 [debug] [MainThread]: Flushing usage events
[0m00:24:33.157997 [debug] [MainThread]: An error was encountered while trying to flush usage events
